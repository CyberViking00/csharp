<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C# Complete Reference · Fondamenti, Intermedio, Avanzato</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0d0d;
  --surface: #141414;
  --card: #1a1a1a;
  --border: #2a2a2a;
  --border-hover: #3a3a3a;
  --text: #e0e0e0;
  --muted: #666;
  --muted2: #444;
  --code-bg: #111;
  --accent: #fff;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; min-height:100vh; }
.topbar {
  display:flex; align-items:center; gap:1rem;
  padding:0 1.5rem; height:48px;
  background:var(--surface); border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:100;
}
.topbar-brand {
  font-size:.85rem; font-weight:700; color:var(--text);
  white-space:nowrap; letter-spacing:-.3px; flex-shrink:0;
}
.topbar-brand span { color:var(--muted); font-weight:400; }
.topbar-nav {
  display:flex; gap:.25rem; flex-shrink:0;
}
.nav-btn {
  padding:.3rem .75rem; border:1px solid transparent;
  background:transparent; color:var(--muted);
  border-radius:6px; font-family:'Inter',sans-serif;
  font-size:.75rem; font-weight:500; cursor:pointer;
  white-space:nowrap; transition:all .15s;
}
.nav-btn:hover { color:var(--text); background:var(--card); }
.nav-btn.active {
  background:var(--card); color:var(--text);
  border-color:var(--border); font-weight:600;
}
.topbar-divider { width:1px; height:20px; background:var(--border); flex-shrink:0; }
.search-wrap { position:relative; margin-left:auto; flex-shrink:0; }
.search-input {
  background:var(--card); border:1px solid var(--border);
  color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.75rem; padding:.3rem 1.8rem .3rem .75rem;
  border-radius:6px; width:180px; outline:none; transition:all .2s;
}
.search-input:focus { border-color:var(--border-hover); width:240px; }
.search-input::placeholder { color:var(--muted2); }
.search-hint {
  position:absolute; right:2rem; top:50%; transform:translateY(-50%);
  font-size:.65rem; color:var(--muted2); pointer-events:none;
  font-family:'JetBrains Mono',monospace;
}
.search-clear {
  position:absolute; right:.5rem; top:50%; transform:translateY(-50%);
  color:var(--muted); font-size:.9rem; cursor:pointer;
  display:none; background:none; border:none; line-height:1;
}
.search-results {
  position:absolute; top:calc(100% + 6px); right:0;
  background:var(--card); border:1px solid var(--border);
  border-radius:8px; width:340px; max-height:420px;
  overflow-y:auto; z-index:999;
  box-shadow:0 8px 24px rgba(0,0,0,.6); display:none;
}
.search-results.open { display:block; }
.sr-item {
  padding:.6rem .9rem; border-bottom:1px solid var(--border);
  cursor:pointer; transition:background .1s;
}
.sr-item:last-child { border-bottom:none; }
.sr-item:hover { background:#1f1f1f; }
.sr-mod { font-size:.62rem; color:var(--muted); font-family:'JetBrains Mono',monospace; margin-bottom:.15rem; }
.sr-title { font-size:.82rem; font-weight:600; color:var(--text); }
.sr-sub { font-size:.7rem; color:var(--muted); margin-top:.1rem; }
.sr-highlight { color:#fff; background:#2a2a2a; border-radius:2px; padding:0 2px; }
.sr-empty { padding:1rem; text-align:center; color:var(--muted); font-size:.82rem; }

.layout { display:flex; height:calc(100vh - 48px); overflow:hidden; }
.sidebar {
  width:260px; flex-shrink:0;
  background:var(--surface); border-right:1px solid var(--border);
  overflow-y:auto; padding:.75rem 0;
}
.sidebar::-webkit-scrollbar { width:4px; }
.sidebar::-webkit-scrollbar-track { background:transparent; }
.sidebar::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.tree-group { margin-bottom:.125rem; }
.tree-mod {
  display:flex; align-items:center; gap:.5rem;
  padding:.45rem 1rem; cursor:pointer;
  font-size:.78rem; font-weight:600; color:var(--text);
  user-select:none; transition:background .1s;
}
.tree-mod:hover { background:var(--card); }
.tree-mod.open { color:#fff; }
.tree-arrow {
  font-size:.6rem; color:var(--muted); transition:transform .2s; flex-shrink:0;
}
.tree-mod.open .tree-arrow { transform:rotate(90deg); color:var(--text); }
.tree-mod-label { flex:1; min-width:0; }
.tree-count {
  font-size:.65rem; font-family:'JetBrains Mono',monospace;
  color:var(--muted); background:var(--card);
  border:1px solid var(--border); border-radius:3px;
  padding:.05rem .3rem; flex-shrink:0;
}
.tree-children { display:none; padding:.125rem 0; }
.tree-mod.open + .tree-children { display:block; }
.tree-item {
  display:flex; align-items:flex-start; gap:.5rem;
  padding:.35rem 1rem .35rem 2rem; cursor:pointer;
  transition:background .1s; border-left:2px solid transparent;
}
.tree-item:hover { background:var(--card); }
.tree-item.active {
  background:var(--card); border-left-color:var(--text);
}
.tree-num {
  font-size:.62rem; font-family:'JetBrains Mono',monospace;
  color:var(--muted2); flex-shrink:0; margin-top:.1rem; width:20px;
}
.tree-item-text { flex:1; min-width:0; }
.tree-title { font-size:.75rem; font-weight:500; color:var(--text); display:block; }
.tree-sub { font-size:.66rem; color:var(--muted); display:block; margin-top:.05rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.content {
  flex:1; overflow-y:auto; padding:1.5rem 2rem;
  max-width:860px;
}
.content::-webkit-scrollbar { width:4px; }
.content::-webkit-scrollbar-track { background:transparent; }
.content::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.section { display:none; animation:fadeIn .2s ease; }
.section.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:translateY(0)} }

.section-title {
  font-size:1.1rem; font-weight:700; margin-bottom:1.25rem;
  display:flex; align-items:center; gap:.6rem; color:#fff;
}
.tag {
  font-size:.6rem; padding:.15rem .45rem; border-radius:4px;
  font-family:'JetBrains Mono',monospace;
  background:var(--card); color:var(--muted); border:1px solid var(--border);
}

.topic-card {
  background:var(--card); border:1px solid var(--border);
  border-radius:8px; margin-bottom:.6rem; overflow:hidden;
  transition:border-color .15s;
}
.topic-card:hover { border-color:var(--border-hover); }
.topic-header {
  padding:.75rem 1rem; cursor:pointer;
  display:flex; justify-content:space-between; align-items:center;
  user-select:none; gap:.5rem;
}
.topic-header div { flex:1; min-width:0; }
.topic-header h3 { font-size:.85rem; font-weight:600; }
.topic-sub { font-size:.68rem; color:var(--muted); margin-top:.1rem; }
.arrow { color:var(--muted2); transition:transform .25s; font-size:.75rem; flex-shrink:0; }
.topic-card.open .arrow { transform:rotate(180deg); }
.topic-body {
  display:none; padding:.125rem 1rem 1rem;
  border-top:1px solid var(--border);
}
.topic-card.open .topic-body { display:block; }

pre {
  background:var(--code-bg); border:1px solid var(--border);
  border-radius:6px; padding:.85rem 1rem; margin:.65rem 0;
  overflow-x:auto; font-family:'JetBrains Mono',monospace;
  font-size:.75rem; line-height:1.65; color:#c9d1d9;
}
.kw{color:#ff79c6} .ty{color:#8be9fd} .str{color:#f1fa8c}
.cm{color:#555;font-style:italic} .num{color:#bd93f9}
.fn{color:#50fa7b} .op{color:#ff79c6}

.info,.note,.warn,.tip {
  border-radius:0 6px 6px 0; margin:.65rem 0;
  font-size:.8rem; padding:.55rem .9rem; line-height:1.55;
}
.info { background:#111a22; border-left:2px solid #336; color:#8aa; }
.note { background:#1a1a1a; border-left:2px solid #333; color:#888; }
.warn { background:#1a1700; border-left:2px solid #554400; color:#aa8833; }
.tip  { background:#0d1a10; border-left:2px solid #224422; color:#668866; }

table { width:100%; border-collapse:collapse; margin:.65rem 0; font-size:.78rem; }
th { background:#111; color:var(--muted); padding:.45rem .7rem; text-align:left; font-size:.67rem; text-transform:uppercase; letter-spacing:.8px; }
td { padding:.45rem .7rem; border-top:1px solid var(--border); color:#999; font-family:'JetBrains Mono',monospace; font-size:.74rem; }
tr:hover td { background:#1f1f1f; }

p { line-height:1.7; color:#888; margin:.4rem 0; font-size:.83rem; }
h4 { color:var(--muted); font-size:.7rem; margin:.85rem 0 .25rem; text-transform:uppercase; letter-spacing:.8px; }

.mod-label { display:none; }
::-webkit-scrollbar { width:4px; height:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar-brand">C# <span>Reference</span></div>
  <div class="topbar-divider"></div>
  <nav class="topbar-nav">
    <button class="nav-btn active" data-mod="fundamentals" onclick="showMod('fundamentals',this)">I — Fondamenti</button>
    <button class="nav-btn" data-mod="intermediate" onclick="showMod('intermediate',this)">II — Intermedio</button>
    <button class="nav-btn" data-mod="advanced" onclick="showMod('advanced',this)">III — Avanzato</button>
  </nav>
  <div class="search-wrap" id="searchWrap">
    <input class="search-input" id="searchInput" type="text"
           placeholder="Cerca…" autocomplete="off"
           oninput="onSearch()" onfocus="openResults()"/>
    <button class="search-clear" id="searchClear" onclick="clearSearch()">×</button>
    <div class="search-results" id="searchResults"></div>
  </div>
</header>

<!-- LAYOUT -->
<div class="layout">
  <!-- SIDEBAR -->
  <aside class="sidebar">
<div class="tree">
  <!-- I — Fondamenti (15) -->
  <div class="tree-group">
    <div class="tree-mod" onclick="treeToggle(this)" data-mod="fundamentals">
      <span class="tree-arrow">▶</span>
      <span class="tree-mod-label">I — Fondamenti</span>
      <span class="tree-count">15</span>
    </div>
    <div class="tree-children">
      <div class="tree-item" onclick="showTopic('fundamentals',0)"><span class="tree-num">01</span><div class="tree-item-text"><span class="tree-title">Tipi di Dato</span><span class="tree-sub">int, double, string, bool, var, const, casting</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',1)"><span class="tree-num">02</span><div class="tree-item-text"><span class="tree-title">Input / Output</span><span class="tree-sub">Console.Write, ReadLine, interpolazione</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',2)"><span class="tree-num">03</span><div class="tree-item-text"><span class="tree-title">Aritmetica & Math</span><span class="tree-sub">+−×÷%, operatori composti, libreria Math</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',3)"><span class="tree-num">04</span><div class="tree-item-text"><span class="tree-title">Confronto & Booleani</span><span class="tree-sub">==, !=, &&, ||, !, operatore ternario</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',4)"><span class="tree-num">05</span><div class="tree-item-text"><span class="tree-title">Strutture di Controllo</span><span class="tree-sub">if/else, switch, switch expression</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',5)"><span class="tree-num">06</span><div class="tree-item-text"><span class="tree-title">Ciclo for</span><span class="tree-sub">Iterazioni note, break, continue, step</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',6)"><span class="tree-num">07</span><div class="tree-item-text"><span class="tree-title">Ciclo while / do-while</span><span class="tree-sub">Condizione prima/dopo, loop interattivo</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',7)"><span class="tree-num">08</span><div class="tree-item-text"><span class="tree-title">Array & foreach</span><span class="tree-sub">Array fisso, 2D, jagged, metodi Array</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',8)"><span class="tree-num">09</span><div class="tree-item-text"><span class="tree-title">List&lt;T&gt;</span><span class="tree-sub">Add, Remove, Find, Sort, Clear, ToArray</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',9)"><span class="tree-num">10</span><div class="tree-item-text"><span class="tree-title">String — Metodi</span><span class="tree-sub">Length, Split, Trim, Replace, Substring…</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',10)"><span class="tree-num">11</span><div class="tree-item-text"><span class="tree-title">Enum</span><span class="tree-sub">Enumerazioni, valori, casting, Flags</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',11)"><span class="tree-num">12</span><div class="tree-item-text"><span class="tree-title">Metodi</span><span class="tree-sub">Parametri, return, overload, ref/out, ricorsione</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',12)"><span class="tree-num">13</span><div class="tree-item-text"><span class="tree-title">Struct</span><span class="tree-sub">Tipo valore, costruttori, metodi</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',13)"><span class="tree-num">14</span><div class="tree-item-text"><span class="tree-title">Nullable & Null Operators</span><span class="tree-sub">int?, ??, ?., HasValue</span></div></div>
      <div class="tree-item" onclick="showTopic('fundamentals',14)"><span class="tree-num">15</span><div class="tree-item-text"><span class="tree-title">Scope & Visibilità</span><span class="tree-sub">Scope locale, blocco, shadowing</span></div></div>
    </div>
  </div>
  <!-- II — Intermedio (17) -->
  <div class="tree-group">
    <div class="tree-mod" onclick="treeToggle(this)" data-mod="intermediate">
      <span class="tree-arrow">▶</span>
      <span class="tree-mod-label">II — Intermedio</span>
      <span class="tree-count">17</span>
    </div>
    <div class="tree-children">
      <div class="tree-item" onclick="showTopic('intermediate',0)"><span class="tree-num">01</span><div class="tree-item-text"><span class="tree-title">Classi & Oggetti</span><span class="tree-sub">Blueprint, istanza, new, this</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',1)"><span class="tree-num">02</span><div class="tree-item-text"><span class="tree-title">Costruttori</span><span class="tree-sub">Default, parametri, overload, object initializer</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',2)"><span class="tree-num">03</span><div class="tree-item-text"><span class="tree-title">Proprietà</span><span class="tree-sub">get/set, auto-property, validazione, read-only</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',3)"><span class="tree-num">04</span><div class="tree-item-text"><span class="tree-title">Incapsulamento</span><span class="tree-sub">public, private, protected, internal</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',4)"><span class="tree-num">05</span><div class="tree-item-text"><span class="tree-title">Ereditarietà</span><span class="tree-sub">class Figlia : Padre, base, override</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',5)"><span class="tree-num">06</span><div class="tree-item-text"><span class="tree-title">Interfacce</span><span class="tree-sub">interface, implementazione multipla, contratto</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',6)"><span class="tree-num">07</span><div class="tree-item-text"><span class="tree-title">Polimorfismo</span><span class="tree-sub">virtual, override, abstract, sealed</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',7)"><span class="tree-num">08</span><div class="tree-item-text"><span class="tree-title">Eccezioni</span><span class="tree-sub">try/catch/finally, throw, custom exceptions</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',8)"><span class="tree-num">09</span><div class="tree-item-text"><span class="tree-title">Static & Object Init</span><span class="tree-sub">static class, membri statici, initializer</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',9)"><span class="tree-num">10</span><div class="tree-item-text"><span class="tree-title">is, as, typeof</span><span class="tree-sub">Type checking, casting sicuro, runtime</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',10)"><span class="tree-num">11</span><div class="tree-item-text"><span class="tree-title">File di Testo</span><span class="tree-sub">ReadAllText, WriteAllText, AppendAllText</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',11)"><span class="tree-num">12</span><div class="tree-item-text"><span class="tree-title">StreamReader/Writer</span><span class="tree-sub">Lettura/scrittura riga per riga, encoding UTF-8</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',12)"><span class="tree-num">13</span><div class="tree-item-text"><span class="tree-title">JSON</span><span class="tree-sub">JsonSerializer Serialize/Deserialize, opzioni</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',13)"><span class="tree-num">14</span><div class="tree-item-text"><span class="tree-title">XML</span><span class="tree-sub">XmlSerializer, XDocument, LINQ to XML</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',14)"><span class="tree-num">15</span><div class="tree-item-text"><span class="tree-title">Eccezioni I/O</span><span class="tree-sub">FileNotFoundException, IOException, pattern</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',15)"><span class="tree-num">16</span><div class="tree-item-text"><span class="tree-title">Dictionary&lt;K,V&gt;</span><span class="tree-sub">Chiave-valore, ContainsKey, TryGetValue</span></div></div>
      <div class="tree-item" onclick="showTopic('intermediate',16)"><span class="tree-num">17</span><div class="tree-item-text"><span class="tree-title">Classe Path</span><span class="tree-sub">Combine, GetFileName, GetExtension</span></div></div>
    </div>
  </div>
  <!-- III — Avanzato (23) -->
  <div class="tree-group">
    <div class="tree-mod" onclick="treeToggle(this)" data-mod="advanced">
      <span class="tree-arrow">▶</span>
      <span class="tree-mod-label">III — Avanzato</span>
      <span class="tree-count">23</span>
    </div>
    <div class="tree-children">
      <div class="tree-item" onclick="showTopic('advanced',0)"><span class="tree-num">01</span><div class="tree-item-text"><span class="tree-title">LINQ</span><span class="tree-sub">Where, Select, OrderBy, GroupBy, First, Sum</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',1)"><span class="tree-num">02</span><div class="tree-item-text"><span class="tree-title">Generics &lt;T&gt;</span><span class="tree-sub">Classi/metodi generici, constraints where T:</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',2)"><span class="tree-num">03</span><div class="tree-item-text"><span class="tree-title">Delegates & Events</span><span class="tree-sub">Func, Action, Predicate, delegate, event</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',3)"><span class="tree-num">04</span><div class="tree-item-text"><span class="tree-title">Lambda & Closures</span><span class="tree-sub">=> espressioni, corpo, variabili catturate</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',4)"><span class="tree-num">05</span><div class="tree-item-text"><span class="tree-title">async / await</span><span class="tree-sub">Task, async, await, WhenAll, WhenAny</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',5)"><span class="tree-num">06</span><div class="tree-item-text"><span class="tree-title">DateTime & TimeSpan</span><span class="tree-sub">Now, Parse, Add, Format, differenza date</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',6)"><span class="tree-num">07</span><div class="tree-item-text"><span class="tree-title">StringBuilder</span><span class="tree-sub">Append, Insert, Replace, performance loop</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',7)"><span class="tree-num">08</span><div class="tree-item-text"><span class="tree-title">Random & Utilità</span><span class="tree-sub">Next, NextDouble, shuffle, elemento casuale</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',8)"><span class="tree-num">09</span><div class="tree-item-text"><span class="tree-title">Tuple & ValueTuple</span><span class="tree-sub">Ritorno multiplo, named tuples, decostruzione</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',9)"><span class="tree-num">10</span><div class="tree-item-text"><span class="tree-title">Pattern Matching</span><span class="tree-sub">switch expression avanzata, is, when, range</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',10)"><span class="tree-num">11</span><div class="tree-item-text"><span class="tree-title">Record</span><span class="tree-sub">Immutabilità, with expression, value equality</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',11)"><span class="tree-num">12</span><div class="tree-item-text"><span class="tree-title">HashSet, Queue & Stack</span><span class="tree-sub">Elementi unici, FIFO, LIFO</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',12)"><span class="tree-num">13</span><div class="tree-item-text"><span class="tree-title">Regular Expressions</span><span class="tree-sub">IsMatch, Match, Replace, Groups</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',13)"><span class="tree-num">14</span><div class="tree-item-text"><span class="tree-title">Preprocessore & Attributi</span><span class="tree-sub">#region, #if DEBUG, [Obsolete], [Serializable]</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',14)"><span class="tree-num">15</span><div class="tree-item-text"><span class="tree-title">IDisposable & using</span><span class="tree-sub">Gestione risorse, pattern Dispose, using sintattico</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',15)"><span class="tree-num">16</span><div class="tree-item-text"><span class="tree-title">IEnumerable & yield</span><span class="tree-sub">Iteratori pigri, yield return, yield break</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',16)"><span class="tree-num">17</span><div class="tree-item-text"><span class="tree-title">Extension Methods</span><span class="tree-sub">Metodi estensione, this keyword, static class</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',17)"><span class="tree-num">18</span><div class="tree-item-text"><span class="tree-title">Thread, Task & Parallel</span><span class="tree-sub">Task.Run, lock, CancellationToken, Interlocked</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',18)"><span class="tree-num">19</span><div class="tree-item-text"><span class="tree-title">Collezioni Avanzate</span><span class="tree-sub">SortedDictionary, ConcurrentDictionary, LinkedList</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',19)"><span class="tree-num">20</span><div class="tree-item-text"><span class="tree-title">Interfacce Fondamentali</span><span class="tree-sub">IComparable, IEquatable, IComparer</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',20)"><span class="tree-num">21</span><div class="tree-item-text"><span class="tree-title">Operator Overloading</span><span class="tree-sub">Sovraccaricare +, ==, !=, conversioni implicite</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',21)"><span class="tree-num">22</span><div class="tree-item-text"><span class="tree-title">Indexers & Proprietà Avanzate</span><span class="tree-sub">Indicizzatori, init-only, required, backing field</span></div></div>
      <div class="tree-item" onclick="showTopic('advanced',22)"><span class="tree-num">23</span><div class="tree-item-text"><span class="tree-title">Namespaces & using</span><span class="tree-sub">namespace, global using, file-scoped, alias</span></div></div>
    </div>
  </div>
</div>
  </aside>

  <!-- CONTENT -->
  <main class="content">
    <!-- SECTION FONDAMENTI (15) -->
    <div class="section active" id="section-fundamentals">
      <div class="section-title">I — Fondamenti <span class="tag">FOND</span></div>
      <!-- 1. Tipi di Dato -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>1. Tipi di Dato</h3><div class="topic-sub">int, long, double, decimal, string, char, bool, var, const, casting</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">

          <h4>Numeri Interi — usa sempre int per iniziare</h4>
          <table>
            <tr><th>Tipo</th><th>Bit</th><th>Range</th><th>Uso</th></tr>
            <tr><td>byte</td><td>8</td><td>0 – 255</td><td>numeri piccoli positivi</td></tr>
            <tr><td>short</td><td>16</td><td>±32.767</td><td>numeri piccoli</td></tr>
            <tr><td>int</td><td>32</td><td>±2 miliardi</td><td>USO GENERALE ★</td></tr>
            <tr><td>long</td><td>64</td><td>±9 quintilioni</td><td>numeri enormi (aggiungi L)</td></tr>
          </table>
          <pre><span class="ty">int</span>  eta       = <span class="num">25</span>;
<span class="ty">int</span>  punti     = <span class="num">1500</span>;
<span class="ty">int</span>  abitanti  = <span class="num">60_000_000</span>;     <span class="cm">// _ migliora leggibilità</span>
<span class="ty">long</span> distanza  = <span class="num">384_400_000L</span>;  <span class="cm">// Luna in metri — aggiungi L!</span>

<span class="cm">// YouTube: int basta fino a 2 miliardi, long oltre:</span>
<span class="ty">int</span>  views       = <span class="num">2_000_000_000</span>;   <span class="cm">// OK per int</span>
<span class="ty">long</span> viewsVirali = <span class="num">10_000_000_000L</span>; <span class="cm">// serve long!</span>
<span class="cm">// int troppoGrande = 10_000_000_000; → ERRORE!</span></pre>

          <h4>Numeri Decimali — double per tutto, decimal solo per i soldi</h4>
          <table>
            <tr><th>Tipo</th><th>Bit</th><th>Precisione</th><th>Uso</th></tr>
            <tr><td>float</td><td>32</td><td>~7 cifre</td><td>raramente usato (aggiungi f)</td></tr>
            <tr><td>double</td><td>64</td><td>~15 cifre</td><td>USO GENERALE ★</td></tr>
            <tr><td>decimal</td><td>128</td><td>~28 cifre</td><td>SOLDI — sempre! (aggiungi m)</td></tr>
          </table>
          <pre><span class="ty">double</span>  altezza  = <span class="num">1.75</span>;
<span class="ty">double</span>  temp     = <span class="num">36.6</span>;
<span class="ty">float</span>   f        = <span class="num">1.75f</span>;    <span class="cm">// richiede 'f' — usa double invece</span>
<span class="ty">decimal</span> prezzo   = <span class="num">19.99m</span>;  <span class="cm">// richiede 'm'</span>
<span class="ty">decimal</span> stipendio = <span class="num">1_500.00m</span>;

<span class="cm">// Perché decimal per i soldi?</span>
<span class="ty">double</span>  sbagliato = <span class="num">0.1</span> + <span class="num">0.2</span>;   <span class="cm">// → 0.30000000000000004 !</span>
<span class="ty">decimal</span> giusto    = <span class="num">0.1m</span> + <span class="num">0.2m</span>; <span class="cm">// → 0.3  ✓</span></pre>
          <div class="warn">Su milioni di transazioni, l&apos;errore di double diventa un problema ENORME. Usa sempre decimal per i soldi!</div>

          <h4>Testo — string e char</h4>
          <pre><span class="ty">string</span> nome    = <span class="str">"Marco"</span>;      <span class="cm">// testo — doppi apici</span>
<span class="ty">string</span> email   = <span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7e133e1b131f1712501d1113">[email&#160;protected]</a>"</span>;
<span class="ty">string</span> vuoto   = <span class="str">""</span>;           <span class="cm">// stringa vuota — valido!</span>
<span class="ty">char</span>   iniziale = <span class="str">'M'</span>;         <span class="cm">// UN solo carattere — singoli apici</span>
<span class="ty">char</span>   simbolo  = <span class="str">'@'</span>;
<span class="ty">char</span>   cifra    = <span class="str">'5'</span>;         <span class="cm">// è un char, non un int!</span>

<span class="cm">// Errori comuni:</span>
<span class="cm">// char c = "A";       → ERRORE! doppi apici = string</span>
<span class="cm">// string s = 'Ciao';  → ERRORE! singoli apici = char</span></pre>

          <h4>Booleani — bool</h4>
          <pre><span class="ty">bool</span> maggiorenne     = <span class="kw">true</span>;
<span class="ty">bool</span> connesso        = <span class="kw">false</span>;
<span class="ty">bool</span> emailVerificata = <span class="kw">true</span>;   <span class="cm">// solo true o false — nient&apos;altro!</span>

<span class="kw">if</span> (maggiorenne)
    Console.<span class="fn">WriteLine</span>(<span class="str">"Puoi entrare"</span>);</pre>

          <h4>var — lascia decidere al compilatore</h4>
          <pre><span class="kw">var</span> numero = <span class="num">42</span>;        <span class="cm">// int</span>
<span class="kw">var</span> prezzo2 = <span class="num">19.99</span>;    <span class="cm">// double</span>
<span class="kw">var</span> nome2   = <span class="str">"Marco"</span>; <span class="cm">// string</span>
<span class="kw">var</span> attivo  = <span class="kw">true</span>;    <span class="cm">// bool</span>
<span class="cm">// var qualcosa; → ERRORE! deve avere un valore subito</span>

<span class="cm">// OK — tipo ovvio:</span>
<span class="kw">var</span> dict = <span class="kw">new</span> Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">int</span>&gt;&gt;();
<span class="cm">// NO — tipo non chiaro:</span>
<span class="cm">// var x = CalcolaQualcosa();</span></pre>

          <h4>const — valori che non cambiano mai</h4>
          <pre><span class="kw">const</span> <span class="ty">double</span> PI              = <span class="num">3.14159265359</span>;
<span class="kw">const</span> <span class="ty">int</span>    GIORNI_SETTIMANA = <span class="num">7</span>;
<span class="kw">const</span> <span class="ty">double</span> IVA              = <span class="num">0.22</span>;

<span class="kw">const</span> <span class="ty">int</span>    MAX_VITE = <span class="num">3</span>;
<span class="ty">int</span> viteRimaste = MAX_VITE;
viteRimaste--;               <span class="cm">// OK!</span>
<span class="cm">// MAX_VITE--; → ERRORE! const non modificabile</span></pre>
          <div class="tip">Usa const per centralizzare i valori: se cambi IVA dal 22% al 10%, lo modifichi in un solo posto.</div>

          <h4>Type Casting</h4>
          <pre><span class="cm">// Implicito (automatico, sicuro — da piccolo a grande):</span>
<span class="ty">int</span>    n = <span class="num">100</span>;
<span class="ty">double</span> d = n;    <span class="cm">// int → double, nessun rischio</span>

<span class="cm">// Esplicito (manuale — puoi perdere dati!):</span>
<span class="ty">double</span> prezzo3      = <span class="num">19.99</span>;
<span class="ty">int</span>    prezzoIntero = (<span class="ty">int</span>)prezzo3; <span class="cm">// → 19, NON 20! tronca</span>

<span class="cm">// Parse — lancia eccezione se fallisce:</span>
<span class="ty">int</span> n1 = <span class="ty">int</span>.<span class="fn">Parse</span>(<span class="str">"42"</span>);
<span class="cm">// int.Parse("abc") → CRASH! FormatException</span>

<span class="cm">// TryParse — sicuro, non lancia eccezione:</span>
<span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(<span class="str">"123"</span>, <span class="kw">out int</span> risultato))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"OK: {risultato}"</span>);
<span class="kw">else</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Input non valido!"</span>);

<span class="cm">// Da numero a stringa:</span>
<span class="ty">string</span> testo = (<span class="num">1500</span>).<span class="fn">ToString</span>(); <span class="cm">// "1500"</span></pre>

          <h4>Progetto pratico — Scheda Personaggio RPG</h4>
          <pre><span class="kw">const</span> <span class="ty">int</span> MAX_LIVELLO = <span class="num">100</span>;
<span class="kw">const</span> <span class="ty">int</span> VITA_BASE   = <span class="num">100</span>;

<span class="ty">string</span>  nomePersonaggio = <span class="str">"Arthas"</span>;
<span class="ty">char</span>    classe          = <span class="str">'G'</span>;  <span class="cm">// G=Guerriero M=Mago A=Arciere</span>
<span class="ty">int</span>     livello         = <span class="num">15</span>;
<span class="ty">int</span>     vitaAttuale     = <span class="num">85</span>;
<span class="ty">int</span>     vitaMassima     = VITA_BASE + (livello * <span class="num">10</span>);
<span class="ty">double</span>  percVita        = (<span class="ty">double</span>)vitaAttuale / vitaMassima * <span class="num">100</span>;
<span class="ty">bool</span>    vivo            = vitaAttuale > <span class="num">0</span>;
<span class="ty">decimal</span> oro             = <span class="num">1_523.50m</span>;

Console.<span class="fn">WriteLine</span>(<span class="str">$"Nome: {nomePersonaggio}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Livello: {livello}/{MAX_LIVELLO}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Vita: {vitaAttuale}/{vitaMassima} ({percVita:F1}%)"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Oro: {oro:F2} monete"</span>);</pre>

          <h4>Errori comuni</h4>
          <pre><span class="cm">// 1. Dimenticare 'm' per decimal:</span>
<span class="cm">// decimal p = 19.99;      → ERRORE!</span>
<span class="ty">decimal</span> p = <span class="num">19.99m</span>;        <span class="cm">// OK</span>

<span class="cm">// 2. Dimenticare 'L' per long grandi:</span>
<span class="cm">// long g = 10_000_000_000; → ERRORE!</span>
<span class="ty">long</span> g = <span class="num">10_000_000_000L</span>;  <span class="cm">// OK</span>

<span class="cm">// 3. char con doppi apici:</span>
<span class="cm">// char c = "A";  → ERRORE!</span>
<span class="ty">char</span> c = <span class="str">'A'</span>;               <span class="cm">// OK</span>

<span class="cm">// 4. Divisione intera quando vuoi decimali:</span>
<span class="ty">int</span> a = <span class="num">5</span>, b = <span class="num">2</span>;
<span class="ty">double</span> sbagliato = a / b;           <span class="cm">// → 2, non 2.5!</span>
<span class="ty">double</span> giusto2   = (<span class="ty">double</span>)a / b;  <span class="cm">// → 2.5 ✓</span>

<span class="cm">// 5. Confrontare double con ==:</span>
<span class="ty">double</span> x = <span class="num">0.1</span> + <span class="num">0.2</span>;
<span class="cm">// if (x == 0.3) → potrebbe essere false!</span>
<span class="kw">if</span> (Math.<span class="fn">Abs</span>(x - <span class="num">0.3</span>) &lt; <span class="num">0.0001</span>)   <span class="cm">// OK — tolleranza</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Uguali"</span>);</pre>

          <h4>Tabella riassuntiva</h4>
          <table>
            <tr><th>Tipo</th><th>Quando usarlo</th></tr>
            <tr><td>int</td><td>Numeri interi normali (età, quantità, punteggi)</td></tr>
            <tr><td>long</td><td>Numeri interi oltre i 2 miliardi</td></tr>
            <tr><td>double</td><td>Numeri decimali (altezza, temperatura, percentuali)</td></tr>
            <tr><td>decimal</td><td>SOLDI — sempre!</td></tr>
            <tr><td>string</td><td>Testo, parole, frasi</td></tr>
            <tr><td>char</td><td>Un solo carattere</td></tr>
            <tr><td>bool</td><td>Vero/falso, flag, stati</td></tr>
            <tr><td>var</td><td>Quando il tipo è ovvio dal contesto</td></tr>
            <tr><td>const</td><td>Valori che non cambiano mai</td></tr>
          </table>

          <h4>Esercizi</h4>
          <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Dichiara variabili per: nome, età, altezza, peso, sposato</span>
<span class="cm">// 2. Calcola area di un cerchio (usa const per PI)</span>
<span class="cm">// 3. Converti temperatura da Celsius a Fahrenheit</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Scheda prodotto: nome, prezzo, quantità, disponibile</span>
<span class="cm">// 5. Calcola sconto: prezzo 100€, sconto 15%, prezzo finale?</span>
<span class="cm">// 6. Converti minuti totali in ore e minuti (135 min → 2h 15min)</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Calcola interesse composto: capitale, tasso, anni</span>
<span class="cm">// 8. Converti bytes → KB / MB / GB</span>
<span class="cm">// 9. Valida input: chiedi un numero e riprova finché non è valido</span></pre>

          <h4>Soluzioni</h4>
          <pre><span class="cm">// --- 1. Variabili personali ---</span>
<span class="ty">string</span> nomeP  = <span class="str">"Mario Rossi"</span>;
<span class="ty">int</span>    etaP   = <span class="num">30</span>;
<span class="ty">double</span> altP   = <span class="num">1.75</span>;
<span class="ty">double</span> pesoP  = <span class="num">72.5</span>;
<span class="ty">bool</span>   sposato = <span class="kw">false</span>;

<span class="cm">// --- 2. Area cerchio ---</span>
<span class="kw">const</span> <span class="ty">double</span> PI_G = <span class="num">3.14159</span>;
<span class="ty">double</span> raggio = <span class="num">5</span>;
<span class="ty">double</span> area   = PI_G * raggio * raggio;  <span class="cm">// 78.54</span>

<span class="cm">// --- 3. Celsius → Fahrenheit ---</span>
<span class="ty">double</span> celsius    = <span class="num">30</span>;
<span class="ty">double</span> fahrenheit = celsius * <span class="num">9.0</span> / <span class="num">5.0</span> + <span class="num">32</span>; <span class="cm">// 86.0</span>

<span class="cm">// --- 4. Scheda prodotto ---</span>
<span class="ty">string</span>  nomeProd    = <span class="str">"iPhone 15 Pro"</span>;
<span class="ty">decimal</span> prezzoProd  = <span class="num">1_299.99m</span>;
<span class="ty">int</span>     qty         = <span class="num">50</span>;
<span class="ty">bool</span>    disponibile = qty > <span class="num">0</span>;

<span class="cm">// --- 5. Calcolo sconto ---</span>
<span class="ty">decimal</span> prezzoOrig  = <span class="num">100.00m</span>;
<span class="ty">decimal</span> sconto      = prezzoOrig * <span class="num">0.15m</span>;  <span class="cm">// 15.00</span>
<span class="ty">decimal</span> prezzoFinal = prezzoOrig - sconto;  <span class="cm">// 85.00</span>

<span class="cm">// --- 6. Conversione minuti ---</span>
<span class="ty">int</span> minTotali  = <span class="num">135</span>;
<span class="ty">int</span> ore        = minTotali / <span class="num">60</span>;  <span class="cm">// 2</span>
<span class="ty">int</span> minRimasti = minTotali % <span class="num">60</span>; <span class="cm">// 15</span>

<span class="cm">// --- 7. Interesse composto ---</span>
<span class="ty">decimal</span> capitale = <span class="num">1_000.00m</span>;
<span class="ty">double</span>  tasso    = <span class="num">0.05</span>;
<span class="ty">int</span>     anni     = <span class="num">10</span>;
<span class="ty">double</span>  montante = (<span class="ty">double</span>)capitale * Math.<span class="fn">Pow</span>(<span class="num">1</span> + tasso, anni);
<span class="ty">decimal</span> interessi = (<span class="ty">decimal</span>)montante - capitale; <span class="cm">// ~628.89</span>

<span class="cm">// --- 8. Conversione bytes ---</span>
<span class="ty">long</span>   bytes = <span class="num">1_572_864_000L</span>;
<span class="ty">string</span> unita; <span class="ty">double</span> valore;
<span class="kw">if</span>      (bytes >= <span class="num">1024L</span>*<span class="num">1024</span>*<span class="num">1024</span>) { valore = bytes/<span class="num">1073741824.0</span>; unita = <span class="str">"GB"</span>; }
<span class="kw">else if</span> (bytes >= <span class="num">1024L</span>*<span class="num">1024</span>)      { valore = bytes/<span class="num">1048576.0</span>;   unita = <span class="str">"MB"</span>; }
<span class="kw">else if</span> (bytes >= <span class="num">1024L</span>)            { valore = bytes/<span class="num">1024.0</span>;      unita = <span class="str">"KB"</span>; }
<span class="kw">else</span>                                  { valore = bytes;              unita = <span class="str">"bytes"</span>; }
Console.<span class="fn">WriteLine</span>(<span class="str">$"{bytes:N0} = {valore:F2} {unita}"</span>);

<span class="cm">// --- 9. Input validato ---</span>
<span class="ty">int</span>  numero; <span class="ty">bool</span> valido = <span class="kw">false</span>;
<span class="kw">while</span> (!valido) {
    Console.<span class="fn">Write</span>(<span class="str">"Inserisci un numero: "</span>);
    <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> numero)) {
        valido = <span class="kw">true</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Doppio: {numero*2}, Quadrato: {numero*numero}"</span>);
    } <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido, riprova..."</span>);
}</pre>

        </div>
      </div>
      <!-- 2. Input / Output -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>2. Input / Output</h3><div class="topic-sub">Console.Write/WriteLine, ReadLine, interpolazione, formattazione, TryParse, colori</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Output — stampare a schermo</h4>
    <pre><span class="cm">// WriteLine = stampa E va a capo</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Prima riga"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"Seconda riga"</span>);

<span class="cm">// Write = stampa SENZA andare a capo</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome: "</span>); Console.<span class="fn">Write</span>(<span class="str">"Marco"</span>); <span class="cm">// Output: Nome: Marco</span>

<span class="cm">// Menu:</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"+============================+"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"|      MENU PRINCIPALE       |"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"+============================+"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"| 1. Nuovo gioco             |"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"| 2. Carica partita          |"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"+============================+"</span>);
Console.<span class="fn">Write</span>(<span class="str">"Scegli un&apos;opzione: "</span>);</pre>

    <h4>Interpolazione — combinare testo e variabili</h4>
    <pre><span class="ty">string</span> nome = <span class="str">"Marco"</span>; <span class="ty">int</span> eta = <span class="num">25</span>;

<span class="cm">// Metodo 1: interpolazione con $ — CONSIGLIATO</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Mi chiamo {nome}, ho {eta} anni"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Tra 5 anni avro&apos; {eta + 5} anni"</span>);

<span class="cm">// Metodo 2: concatenazione con +</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Mi chiamo "</span> + nome + <span class="str">" e ho "</span> + eta + <span class="str">" anni"</span>);

<span class="cm">// Metodo 3: placeholder {0},{1} — vecchio stile</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Mi chiamo {0} e ho {1} anni"</span>, nome, eta);

<span class="cm">// Metodo 4: String.Format</span>
<span class="ty">string</span> msg = String.<span class="fn">Format</span>(<span class="str">"Ciao {0}, hai {1} anni"</span>, nome, eta);

<span class="cm">// Calcoli dentro {}:</span>
<span class="ty">int</span> a = <span class="num">5</span>, b = <span class="num">3</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"{a} + {b} = {a + b}"</span>);  <span class="cm">// 5 + 3 = 8</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{a} x {b} = {a * b}"</span>);  <span class="cm">// 5 x 3 = 15</span></pre>

    <h4>Formattazione numeri</h4>
    <pre><span class="ty">double</span> prezzo = <span class="num">1234.5678</span>; <span class="ty">int</span> pop = <span class="num">1_000_000</span>; <span class="ty">double</span> perc = <span class="num">0.756</span>;

Console.<span class="fn">WriteLine</span>(<span class="str">$"{prezzo:F2}"</span>);   <span class="cm">// 1234.57   — 2 decimali fissi</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{prezzo:F0}"</span>);   <span class="cm">// 1235      — nessun decimale</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{prezzo:C}"</span>);    <span class="cm">// 1.234,57 EUR — valuta locale</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{prezzo:C0}"</span>);   <span class="cm">// 1.235 EUR</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{pop:N0}"</span>);      <span class="cm">// 1.000.000</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{perc:P0}"</span>);     <span class="cm">// 76%</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{perc:P2}"</span>);     <span class="cm">// 75,60%</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{42:D5}"</span>);       <span class="cm">// 00042</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"{255:X4}"</span>);      <span class="cm">// 00FF</span></pre>
    <table>
      <tr><th>Formato</th><th>Descrizione</th><th>Esempio</th></tr>
      <tr><td>:F2 / :F0</td><td>Decimali fissi</td><td>1234.57 / 1235</td></tr>
      <tr><td>:C / :C0</td><td>Valuta</td><td>1.234,57 EUR</td></tr>
      <tr><td>:N0</td><td>Separatore migliaia</td><td>1.000.000</td></tr>
      <tr><td>:P0 / :P2</td><td>Percentuale</td><td>76% / 75,60%</td></tr>
      <tr><td>:D5</td><td>Padding con zeri</td><td>00042</td></tr>
      <tr><td>:X / :X4</td><td>Esadecimale</td><td>FF / 00FF</td></tr>
    </table>

    <h4>Allineamento e padding</h4>
    <pre><span class="cm">// ,N = destra   ,-N = sinistra</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"|{"Pizza",15}|"</span>);   <span class="cm">// |          Pizza|</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"|{"Pizza",-15}|"</span>);  <span class="cm">// |Pizza          |</span>

Console.<span class="fn">WriteLine</span>(<span class="str">$"{"Prodotto",-20} {"Qta",6} {"Prezzo",10}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(<span class="str">'-'</span>, <span class="num">38</span>));
Console.<span class="fn">WriteLine</span>(<span class="str">$"{"Laptop",-20} {5,6} {999.99,10:C}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{"Mouse",-20} {50,6} {29.99,10:C}"</span>);</pre>

    <h4>Caratteri speciali (escape sequences)</h4>
    <pre><span class="cm">// \n nuova riga   \t tab   \\ backslash   \" virgolette</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Nome:\tMarco\nEta:\t25"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"Path: C:\\Users\\Marco"</span>);

<span class="cm">// @ verbatim — ignora escape:</span>
Console.<span class="fn">WriteLine</span>(<span class="str">@"Path: C:\Users\Marco"</span>);
<span class="ty">string</span> multi = <span class="str">@"Riga uno
Riga due
Riga tre"</span>;</pre>
    <table>
      <tr><th>Escape</th><th>Significato</th></tr>
      <tr><td>\n</td><td>Nuova riga</td></tr>
      <tr><td>\t</td><td>Tab</td></tr>
      <tr><td>\\</td><td>Backslash</td></tr>
      <tr><td>\"</td><td>Virgolette</td></tr>
      <tr><td>\r</td><td>Ritorno carrello</td></tr>
    </table>

    <h4>Input — leggere dalla tastiera</h4>
    <pre><span class="cm">// ReadLine() restituisce SEMPRE una stringa!</span>
Console.<span class="fn">Write</span>(<span class="str">"Come ti chiami? "</span>);
<span class="ty">string</span> nomeInput = Console.<span class="fn">ReadLine</span>();

<span class="ty">int</span>     etaInput    = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
<span class="ty">double</span>  altInput    = <span class="ty">double</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
<span class="ty">decimal</span> prezzoInput = <span class="ty">decimal</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());</pre>
    <div class="warn">int.Parse() CRASHA se l&apos;utente scrive &quot;abc&quot;! Usa sempre TryParse per input utente.</div>

    <h4>TryParse — input sicuro</h4>
    <pre><span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> n))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Inserito: {n}, doppio: {n * 2}"</span>);
<span class="kw">else</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Input non valido!"</span>);

<span class="ty">double</span>.<span class="fn">TryParse</span>(input, <span class="kw">out double</span> d);
<span class="ty">decimal</span>.<span class="fn">TryParse</span>(input, <span class="kw">out decimal</span> m);
<span class="ty">bool</span>.<span class="fn">TryParse</span>(input, <span class="kw">out bool</span> b);</pre>

    <h4>Input ripetuto — chiedi finché non è valido</h4>
    <pre><span class="ty">int</span> nv;
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>);
    <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> nv)) <span class="kw">break</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido. Riprova!"</span>);
}

<span class="cm">// Con range:</span>
<span class="ty">int</span> votoV;
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Voto (0-100): "</span>);
    <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> votoV) &amp;&amp; votoV >= <span class="num">0</span> &amp;&amp; votoV &lt;= <span class="num">100</span>) <span class="kw">break</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">"Deve essere tra 0 e 100!"</span>);
}

<span class="cm">// Con default:</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome [default: Ospite]: "</span>);
<span class="ty">string</span> nomeD = Console.<span class="fn">ReadLine</span>();
<span class="kw">if</span> (<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(nomeD)) nomeD = <span class="str">"Ospite"</span>;</pre>

    <h4>Leggere tasti singoli</h4>
    <pre>ConsoleKeyInfo tasto = Console.<span class="fn">ReadKey</span>();
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nHai premuto: {tasto.KeyChar}"</span>);

ConsoleKeyInfo scelta = Console.<span class="fn">ReadKey</span>(<span class="kw">true</span>); <span class="cm">// true = non mostrare</span>
<span class="kw">if</span>      (scelta.Key == ConsoleKey.S) Console.<span class="fn">WriteLine</span>(<span class="str">"Si!"</span>);
<span class="kw">else if</span> (scelta.Key == ConsoleKey.N) Console.<span class="fn">WriteLine</span>(<span class="str">"No!"</span>);

<span class="kw">while</span> (Console.<span class="fn">ReadKey</span>(<span class="kw">true</span>).Key != ConsoleKey.Enter) { } <span class="cm">// aspetta INVIO</span></pre>

    <h4>Colori nella console</h4>
    <pre>Console.ForegroundColor = ConsoleColor.Green;  Console.<span class="fn">WriteLine</span>(<span class="str">"Verde!"</span>);
Console.ForegroundColor = ConsoleColor.Red;    Console.<span class="fn">WriteLine</span>(<span class="str">"Rosso!"</span>);
Console.BackgroundColor = ConsoleColor.Blue;
Console.ForegroundColor = ConsoleColor.White;  Console.<span class="fn">WriteLine</span>(<span class="str">"Bianco su blu!"</span>);
Console.<span class="fn">ResetColor</span>();

<span class="kw">void</span> <span class="fn">Errore</span>(<span class="ty">string</span> m) { Console.ForegroundColor=ConsoleColor.Red;   Console.<span class="fn">WriteLine</span>(<span class="str">$"[ERRORE] {m}"</span>); Console.<span class="fn">ResetColor</span>(); }
<span class="kw">void</span> <span class="fn">Ok</span>(<span class="ty">string</span> m)     { Console.ForegroundColor=ConsoleColor.Green; Console.<span class="fn">WriteLine</span>(<span class="str">$"[OK] {m}"</span>);     Console.<span class="fn">ResetColor</span>(); }</pre>

    <h4>Altre funzioni utili</h4>
    <pre>Console.<span class="fn">Clear</span>();
Console.<span class="fn">Beep</span>(<span class="num">1000</span>, <span class="num">500</span>);
Console.<span class="fn">SetCursorPosition</span>(<span class="num">10</span>, <span class="num">5</span>);
Console.Title = <span class="str">"Il Mio Programma C#"</span>;
<span class="ty">int</span> w = Console.WindowWidth; <span class="ty">int</span> h = Console.WindowHeight;</pre>

    <h4>Progetto completo — Calcolatore IMC</h4>
    <pre>Console.<span class="fn">Write</span>(<span class="str">"Come ti chiami? "</span>); <span class="ty">string</span> nomeIMC = Console.<span class="fn">ReadLine</span>();

<span class="ty">double</span> altIMC;
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Altezza (es. 1.75): "</span>);
    <span class="kw">if</span> (<span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> altIMC) &amp;&amp; altIMC &gt; <span class="num">0.5</span> &amp;&amp; altIMC &lt; <span class="num">2.5</span>) <span class="kw">break</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non valida (0.5–2.5 m)"</span>);
}
<span class="ty">double</span> pesoIMC;
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Peso in kg: "</span>);
    <span class="kw">if</span> (<span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> pesoIMC) &amp;&amp; pesoIMC &gt; <span class="num">20</span> &amp;&amp; pesoIMC &lt; <span class="num">300</span>) <span class="kw">break</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido (20–300 kg)"</span>);
}
<span class="ty">double</span> imc = pesoIMC / (altIMC * altIMC);
<span class="ty">string</span> cat = imc &lt; <span class="num">18.5</span> ? <span class="str">"Sottopeso"</span> : imc &lt; <span class="num">25</span> ? <span class="str">"Normopeso"</span> : imc &lt; <span class="num">30</span> ? <span class="str">"Sovrappeso"</span> : <span class="str">"Obesita&apos;"</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"IMC: {imc:F1} — {cat}"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Non convertire l&apos;input:</span>
<span class="ty">int</span> r = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>()) * <span class="num">2</span>; <span class="cm">// OK — non usare ReadLine() * 2 direttamente!</span>

<span class="cm">// 2. Dimenticare $:</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Valore: {x}"</span>);   <span class="cm">// stampa {x} letteralmente!</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Valore: {x}"</span>);  <span class="cm">// OK</span>

<span class="cm">// 3. Virgola vs punto (dipende dal sistema):</span>
<span class="cm">// Italia: "1,75"   USA/UK: "1.75"</span>

<span class="cm">// 4. Input vuoto:</span>
<span class="kw">if</span> (<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(Console.<span class="fn">ReadLine</span>()))
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non hai inserito nulla!"</span>);</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Chiedi nome e cognome, stampa "Ciao, [Nome] [Cognome]!"</span>
<span class="cm">// 2. Chiedi due numeri e stampa la somma</span>
<span class="cm">// 3. Chiedi anno di nascita, calcola e stampa l&apos;eta&apos;</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Calcolatrice: chiedi 2 numeri e un operatore (+,-,*,/)</span>
<span class="cm">// 5. Converti temperatura: Celsius → Fahrenheit e Kelvin</span>
<span class="cm">// 6. Chiedi 3 voti, calcola e mostra la media formattata</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Quiz: 5 domande, conta corrette, mostra percentuale</span>
<span class="cm">// 8. Scontrino con 4+ prodotti formattato con colonne</span>
<span class="cm">// 9. Rubrica: nome+telefono in array, mostra tutti</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome: "</span>);    <span class="ty">string</span> n1s = Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">Write</span>(<span class="str">"Cognome: "</span>); <span class="ty">string</span> c1s = Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">WriteLine</span>(<span class="str">$"Ciao, {n1s} {c1s}!"</span>);

<span class="cm">// --- 2. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Primo: "</span>);  <span class="ty">int</span> s1 = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
Console.<span class="fn">Write</span>(<span class="str">"Secondo: "</span>); <span class="ty">int</span> s2 = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
Console.<span class="fn">WriteLine</span>(<span class="str">$"{s1} + {s2} = {s1 + s2}"</span>);

<span class="cm">// --- 3. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Anno di nascita: "</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Hai {DateTime.Now.Year - int.Parse(Console.ReadLine())} anni"</span>);

<span class="cm">// --- 4. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Num1: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> op1);
Console.<span class="fn">Write</span>(<span class="str">"Op: "</span>);   <span class="ty">string</span> op = Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">Write</span>(<span class="str">"Num2: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> op2);
<span class="ty">double</span> res = op <span class="kw">switch</span> {
    <span class="str">"+"</span> =&gt; op1+op2, <span class="str">"-"</span> =&gt; op1-op2,
    <span class="str">"*"</span> =&gt; op1*op2, <span class="str">"/"</span> =&gt; op2!=<span class="num">0</span>?op1/op2:<span class="ty">double</span>.NaN, _ =&gt; <span class="ty">double</span>.NaN
};
Console.<span class="fn">WriteLine</span>(<span class="str">$"{op1} {op} {op2} = {res}"</span>);

<span class="cm">// --- 5. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Celsius: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> cel);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{cel}C = {cel*9.0/5.0+32:F2}F = {cel+273.15:F2}K"</span>);

<span class="cm">// --- 6. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Voto 1: "</span>); <span class="ty">int</span> v1=<span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
Console.<span class="fn">Write</span>(<span class="str">"Voto 2: "</span>); <span class="ty">int</span> v2=<span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
Console.<span class="fn">Write</span>(<span class="str">"Voto 3: "</span>); <span class="ty">int</span> v3=<span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
<span class="ty">double</span> med=(v1+v2+v3)/3.0;
<span class="ty">string</span> giu=med&gt;=9?<span class="str">"Eccellente"</span>:med&gt;=7?<span class="str">"Buono"</span>:med&gt;=6?<span class="str">"Sufficiente"</span>:<span class="str">"Insufficiente"</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Media: {med:F2} — {giu} — {(med &gt;= 6 ? &quot;PROMOSSO&quot; : &quot;BOCCIATO&quot;)}"</span>);

<span class="cm">// --- 7. ---</span>
<span class="ty">int</span> pt=<span class="num">0</span>;
Console.<span class="fn">Write</span>(<span class="str">"Capitale d&apos;Italia? "</span>);
<span class="kw">if</span>(Console.<span class="fn">ReadLine</span>().<span class="fn">Trim</span>().<span class="fn">ToLower</span>()==<span class="str">"roma"</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"[OK]"</span>);pt++;}else Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] Roma"</span>);
Console.<span class="fn">Write</span>(<span class="str">"7 x 8? "</span>);
<span class="kw">if</span>(<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out int</span> r2)&amp;&amp;r2==<span class="num">56</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"[OK]"</span>);pt++;}else Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] 56"</span>);
Console.<span class="fn">Write</span>(<span class="str">"Anno caduta muro Berlino? "</span>);
<span class="kw">if</span>(<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out int</span> r3)&amp;&amp;r3==<span class="num">1989</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"[OK]"</span>);pt++;}else Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] 1989"</span>);
Console.<span class="fn">Write</span>(<span class="str">"Pianeti sistema solare? "</span>);
<span class="kw">if</span>(<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out int</span> r4)&amp;&amp;r4==<span class="num">8</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"[OK]"</span>);pt++;}else Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] 8"</span>);
Console.<span class="fn">Write</span>(<span class="str">"Autore Divina Commedia? "</span>);
<span class="ty">string</span> r5=Console.<span class="fn">ReadLine</span>().<span class="fn">Trim</span>().<span class="fn">ToLower</span>();
<span class="kw">if</span>(r5==<span class="str">"dante"</span>||r5==<span class="str">"dante alighieri"</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"[OK]"</span>);pt++;}else Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] Dante Alighieri"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Risultato: {pt}/5 ({(double)pt/5*100:F0}%)"</span>);

<span class="cm">// --- 8. ---</span>
<span class="ty">string</span>[]  prod={<span class="str">"Pane"</span>,<span class="str">"Latte"</span>,<span class="str">"Pasta"</span>,<span class="str">"Pomodori"</span>,<span class="str">"Olio"</span>};
<span class="ty">decimal</span>[] prz={<span class="num">2.50m</span>,<span class="num">1.80m</span>,<span class="num">1.35m</span>,<span class="num">3.20m</span>,<span class="num">8.90m</span>};
<span class="ty">int</span>[]     qta={<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">1</span>,<span class="num">1</span>};
<span class="ty">decimal</span> sub=<span class="num">0</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"{"Prodotto",-15} {"Qta",4} {"Prezzo",10}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(<span class="str">'-'</span>,31));
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;prod.Length;i++){<span class="ty">decimal</span> t=prz[i]*qta[i];sub+=t;Console.<span class="fn">WriteLine</span>(<span class="str">$"{prod[i],-15}{qta[i],4}{t,10:C}"</span>);}
Console.<span class="fn">WriteLine</span>(<span class="str">$"{"Subtotale:",-20}{sub,10:C}\n{"IVA 22%:",-20}{sub*0.22m,10:C}\n{"TOTALE:",-20}{sub*1.22m,10:C}"</span>);

<span class="cm">// --- 9. ---</span>
<span class="kw">const</span> <span class="ty">int</span> MAX=<span class="num">5</span>; <span class="ty">string</span>[] nR=<span class="kw">new</span> <span class="ty">string</span>[MAX]; <span class="ty">string</span>[] tR=<span class="kw">new</span> <span class="ty">string</span>[MAX]; <span class="ty">int</span> cnt=<span class="num">0</span>;
<span class="kw">while</span>(cnt&lt;MAX){
    Console.<span class="fn">Write</span>(<span class="str">$"Nome {cnt+1} (o &apos;fine&apos;): "</span>); <span class="ty">string</span> nn=Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span>(nn.<span class="fn">ToLower</span>()==<span class="str">"fine"</span>)<span class="kw">break</span>;
    <span class="kw">if</span>(<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(nn)){Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido!"</span>);<span class="kw">continue</span>;}
    Console.<span class="fn">Write</span>(<span class="str">"Tel: "</span>); <span class="ty">string</span> tt=Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span>(<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(tt)){Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido!"</span>);<span class="kw">continue</span>;}
    nR[cnt]=nn; tR[cnt]=tt; cnt++;
}
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;cnt;i++) Console.<span class="fn">WriteLine</span>(<span class="str">$"{i+1,-3} {nR[i],-20} {tR[i],-15}"</span>);</pre>

  </div>
</div>
      <!-- 3. Aritmetica & Math -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>3. Aritmetica &amp; Math</h3><div class="topic-sub">+−×÷%, modulo, operatori composti, incremento, libreria Math, progetti</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Operazioni base</h4>
    <pre><span class="ty">int</span> a = <span class="num">10</span>, b = <span class="num">3</span>;
<span class="ty">int</span> somma    = a + b;  <span class="cm">// 13</span>
<span class="ty">int</span> diff     = a - b;  <span class="cm">// 7</span>
<span class="ty">int</span> prodotto = a * b;  <span class="cm">// 30</span>
<span class="ty">int</span> quoz     = a / b;  <span class="cm">// 3  ← int/int = int! decimali PERSI</span>
<span class="ty">int</span> resto    = a % b;  <span class="cm">// 1  (modulo)</span>

<span class="cm">// Per ottenere decimali:</span>
<span class="ty">double</span> d1 = (<span class="ty">double</span>)a / b;  <span class="cm">// 3.333…  cast esplicito</span>
<span class="ty">double</span> d2 = <span class="num">10.0</span> / <span class="num">3</span>;       <span class="cm">// 3.333…  letterale decimale</span>

<span class="cm">// Media corretta:</span>
<span class="ty">int</span> v1=<span class="num">7</span>, v2=<span class="num">8</span>, v3=<span class="num">6</span>;
<span class="ty">double</span> media = (v1+v2+v3) / <span class="num">3.0</span>;  <span class="cm">// OK: 7.0</span>
<span class="cm">// double media = (v1+v2+v3) / 3;  ← SBAGLIATO: 7 (troncato!)</span></pre>
    <div class="warn">int / int = int. I decimali vengono troncati silenziosamente!</div>

    <h4>Modulo (%) — usi pratici</h4>
    <pre><span class="cm">// Pari o dispari:</span>
<span class="kw">if</span> (n % <span class="num">2</span> == <span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Pari"</span>); <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Dispari"</span>);

<span class="cm">// Divisibile per N:</span>
<span class="kw">if</span> (n % <span class="num">3</span> == <span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Divisibile per 3"</span>);

<span class="cm">// Ultima cifra:</span>
<span class="ty">int</span> ultimaCifra = <span class="num">12345</span> % <span class="num">10</span>;  <span class="cm">// 5</span>

<span class="cm">// Secondi → minuti e secondi:</span>
<span class="ty">int</span> tot = <span class="num">185</span>;
<span class="ty">int</span> min = tot / <span class="num">60</span>;   <span class="cm">// 3</span>
<span class="ty">int</span> sec = tot % <span class="num">60</span>;   <span class="cm">// 5  → "3:05"</span>

<span class="cm">// Secondi → h, m, s:</span>
<span class="ty">int</span> s = <span class="num">3725</span>;
<span class="ty">int</span> ore = s / <span class="num">3600</span>;
<span class="ty">int</span> m2  = (s % <span class="num">3600</span>) / <span class="num">60</span>;
<span class="ty">int</span> s2  = s % <span class="num">60</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"{ore}h {m2}m {s2}s"</span>);  <span class="cm">// 1h 2m 5s</span>

<span class="cm">// Wrap-around (cicla da 0 a N-1):</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) Console.<span class="fn">Write</span>(<span class="str">$"{i % 4} "</span>);
<span class="cm">// 0 1 2 3 0 1 2 3 0 1</span></pre>

    <h4>Operatori composti e incremento</h4>
    <pre>n += <span class="num">5</span>;  n -= <span class="num">3</span>;  n *= <span class="num">2</span>;  n /= <span class="num">4</span>;  n %= <span class="num">3</span>;

<span class="cm">// ++ e -- (pre vs post):</span>
<span class="ty">int</span> i = <span class="num">5</span>;
Console.<span class="fn">WriteLine</span>(i++);  <span class="cm">// stampa 5, poi i diventa 6</span>
Console.<span class="fn">WriteLine</span>(++i);  <span class="cm">// i diventa 7, poi stampa 7</span>

<span class="cm">// Nelle assegnazioni importa:</span>
<span class="ty">int</span> a2 = <span class="num">5</span>, b2 = a2++;  <span class="cm">// b2=5, a2=6  (post)</span>
<span class="ty">int</span> a3 = <span class="num">5</span>, b3 = ++a3;  <span class="cm">// b3=6, a3=6  (pre)</span></pre>

    <h4>Ordine delle operazioni</h4>
    <pre><span class="ty">int</span> r1 = <span class="num">2</span> + <span class="num">3</span> * <span class="num">4</span>;     <span class="cm">// 14 — * prima di +</span>
<span class="ty">int</span> r2 = (<span class="num">2</span> + <span class="num">3</span>) * <span class="num">4</span>;   <span class="cm">// 20 — parentesi prima</span>
<span class="cm">// Regola: nel dubbio, usa le parentesi!</span></pre>

    <h4>Libreria Math</h4>
    <pre>Math.<span class="fn">Abs</span>(-<span class="num">5</span>)           <span class="cm">// 5   — valore assoluto</span>
Math.<span class="fn">Pow</span>(<span class="num">2</span>, <span class="num">10</span>)        <span class="cm">// 1024 — potenza</span>
Math.<span class="fn">Sqrt</span>(<span class="num">144</span>)         <span class="cm">// 12  — radice quadrata</span>
Math.<span class="fn">Round</span>(<span class="num">3.567</span>, <span class="num">2</span>)  <span class="cm">// 3.57</span>
Math.<span class="fn">Floor</span>(<span class="num">3.9</span>)       <span class="cm">// 3.0 — arrotonda per difetto</span>
Math.<span class="fn">Ceiling</span>(<span class="num">3.1</span>)    <span class="cm">// 4.0 — arrotonda per eccesso</span>
Math.<span class="fn">Truncate</span>(<span class="num">3.9</span>)   <span class="cm">// 3.0 — taglia i decimali</span>
Math.<span class="fn">Max</span>(<span class="num">10</span>, <span class="num">20</span>)      <span class="cm">// 20</span>
Math.<span class="fn">Min</span>(<span class="num">10</span>, <span class="num">20</span>)      <span class="cm">// 10</span>
Math.<span class="fn">Log10</span>(<span class="num">1000</span>)      <span class="cm">// 3</span>
Math.<span class="fn">Sin</span>(Math.PI/<span class="num">2</span>)  <span class="cm">// 1.0</span>
Math.<span class="fn">Sign</span>(-<span class="num">42</span>)        <span class="cm">// -1  (segno: -1, 0, 1)</span>
Math.PI                 <span class="cm">// 3.14159…</span>
Math.E                  <span class="cm">// 2.71828…</span>

<span class="cm">// Max/Min tra 3+ valori:</span>
<span class="ty">int</span> max = Math.<span class="fn">Max</span>(Math.<span class="fn">Max</span>(<span class="num">5</span>, <span class="num">12</span>), Math.<span class="fn">Max</span>(<span class="num">7</span>, <span class="num">3</span>));  <span class="cm">// 12</span>

<span class="cm">// Gradi ↔ radianti:</span>
<span class="ty">double</span> rad = <span class="num">90</span> * (Math.PI / <span class="num">180</span>);  <span class="cm">// 90° in radianti</span></pre>

    <h4>Progetto — Calcolatore cerchio</h4>
    <pre>Console.<span class="fn">Write</span>(<span class="str">"Raggio: "</span>);
<span class="ty">double</span> r = <span class="ty">double</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());

Console.<span class="fn">WriteLine</span>(<span class="str">$"Diametro:      {2 * r:F2}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Circonferenza: {2 * Math.PI * r:F2}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Area:          {Math.PI * Math.Pow(r, 2):F2}"</span>);</pre>

    <h4>Progetto — Distanza tra due punti</h4>
    <pre>Console.<span class="fn">Write</span>(<span class="str">"X1: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> x1);
Console.<span class="fn">Write</span>(<span class="str">"Y1: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> y1);
Console.<span class="fn">Write</span>(<span class="str">"X2: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> x2);
Console.<span class="fn">Write</span>(<span class="str">"Y2: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> y2);

<span class="ty">double</span> dist = Math.<span class="fn">Sqrt</span>(Math.<span class="fn">Pow</span>(x2-x1, <span class="num">2</span>) + Math.<span class="fn">Pow</span>(y2-y1, <span class="num">2</span>));
Console.<span class="fn">WriteLine</span>(<span class="str">$"Distanza: {dist:F2}"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Divisione intera inaspettata:</span>
<span class="ty">double</span> media2 = (<span class="num">7</span>+<span class="num">8</span>+<span class="num">6</span>) / <span class="num">3</span>;    <span class="cm">// SBAGLIATO: 7.0</span>
<span class="ty">double</span> media3 = (<span class="num">7</span>+<span class="num">8</span>+<span class="num">6</span>) / <span class="num">3.0</span>;  <span class="cm">// OK: 7.0</span>

<span class="cm">// 2. Dividere per zero:</span>
<span class="kw">if</span> (divisore != <span class="num">0</span>)
    Console.<span class="fn">WriteLine</span>(<span class="num">10</span> / divisore);
<span class="kw">else</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: divisione per zero!"</span>);

<span class="cm">// 3. Overflow:</span>
<span class="ty">int</span> max2 = <span class="ty">int</span>.MaxValue;  <span class="cm">// 2147483647</span>
<span class="cm">// max2++;  ← diventa -2147483648! Usa long per numeri grandi.</span>

<span class="cm">// 4. / vs %:</span>
<span class="cm">// 17 / 5 = 3  (quante volte)   17 % 5 = 2  (resto)</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Area e perimetro di un rettangolo</span>
<span class="cm">// 2. Converti miglia in km (1 miglio = 1.609 km)</span>
<span class="cm">// 3. Calcola il 15% di mancia su un conto</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Ipotenusa con teorema di Pitagora</span>
<span class="cm">// 5. Converti secondi in ore, minuti, secondi</span>
<span class="cm">// 6. Calcola che giorno della settimana sara&apos; tra N giorni</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Verifica se un numero e&apos; primo</span>
<span class="cm">// 8. Calcola il fattoriale di N</span>
<span class="cm">// 9. Risolvi equazione di secondo grado ax^2+bx+c=0</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Rettangolo ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Base: "</span>);    <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> bas);
Console.<span class="fn">Write</span>(<span class="str">"Altezza: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> alt);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Area: {bas*alt:F2}  Perimetro: {2*(bas+alt):F2}  Diagonale: {Math.Sqrt(Math.Pow(bas,2)+Math.Pow(alt,2)):F2}"</span>);

<span class="cm">// --- 2. Miglia → km ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Miglia: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> mig);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{mig} miglia = {mig * 1.609:F2} km"</span>);

<span class="cm">// --- 3. Mancia ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Conto: "</span>); <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out decimal</span> conto);
Console.<span class="fn">WriteLine</span>(<span class="str">$"10%: {conto*0.10m:C}  15%: {conto*0.15m:C}  20%: {conto*0.20m:C}"</span>);

<span class="cm">// --- 4. Pitagora ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Cateto a: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> ca);
Console.<span class="fn">Write</span>(<span class="str">"Cateto b: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> cb);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Ipotenusa: {Math.Sqrt(Math.Pow(ca,2)+Math.Pow(cb,2)):F4}"</span>);

<span class="cm">// --- 5. Secondi → h m s ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Secondi: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> tot5);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{tot5/3600}h {(tot5%3600)/60}m {tot5%60}s"</span>);

<span class="cm">// --- 6. Giorno della settimana ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Giorni da oggi: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> gg);
<span class="ty">string</span>[] giorni6 = {<span class="str">"Domenica"</span>,<span class="str">"Lunedi"</span>,<span class="str">"Martedi"</span>,<span class="str">"Mercoledi"</span>,<span class="str">"Giovedi"</span>,<span class="str">"Venerdi"</span>,<span class="str">"Sabato"</span>};
<span class="ty">int</span> oggi6 = (<span class="ty">int</span>)DateTime.Now.DayOfWeek;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Tra {gg} giorni: {giorni6[(oggi6+gg)%7]}"</span>);

<span class="cm">// --- 7. Numero primo ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> np);
<span class="ty">bool</span> primo = np >= <span class="num">2</span>;
<span class="kw">for</span> (<span class="ty">int</span> d=<span class="num">2</span>; d&lt;=Math.<span class="fn">Sqrt</span>(np)&amp;&amp;primo; d++) <span class="kw">if</span>(np%d==<span class="num">0</span>) primo=<span class="kw">false</span>;
Console.<span class="fn">WriteLine</span>(primo ? <span class="str">$"{np} E&apos; primo"</span> : <span class="str">$"{np} NON e&apos; primo"</span>);

<span class="cm">// --- 8. Fattoriale ---</span>
Console.<span class="fn">Write</span>(<span class="str">"N: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> nf);
<span class="ty">long</span> fatt=<span class="num">1</span>; <span class="kw">for</span>(<span class="ty">int</span> f=<span class="num">2</span>;f&lt;=nf;f++) fatt*=f;
Console.<span class="fn">WriteLine</span>(<span class="str">$"{nf}! = {fatt}"</span>);

<span class="cm">// --- 9. Equazione 2° grado ---</span>
Console.<span class="fn">Write</span>(<span class="str">"a: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> ea);
Console.<span class="fn">Write</span>(<span class="str">"b: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> eb);
Console.<span class="fn">Write</span>(<span class="str">"c: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> ec);
<span class="ty">double</span> delta = Math.<span class="fn">Pow</span>(eb,<span class="num">2</span>) - <span class="num">4</span>*ea*ec;
<span class="kw">if</span>(delta &gt; <span class="num">0</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"x1={(-eb+Math.Sqrt(delta))/(2*ea):F4}  x2={(-eb-Math.Sqrt(delta))/(2*ea):F4}"</span>);
} <span class="kw">else if</span>(delta==<span class="num">0</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"x={-eb/(2*ea):F4} (soluzione doppia)"</span>);
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Nessuna soluzione reale (delta negativo)"</span>);
}</pre>

  </div>
</div>
      <!-- 4. Confronto & Booleani -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>4. Operatori di Confronto &amp; Booleani</h3><div class="topic-sub">==, !=, &gt;, &lt;, &amp;&amp;, ||, !, ternario, short-circuit</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Operatori di confronto</h4>
    <pre><span class="ty">int</span> a = <span class="num">10</span>, b = <span class="num">5</span>;
<span class="ty">bool</span> uguale         = (a == b);  <span class="cm">// false</span>
<span class="ty">bool</span> diverso        = (a != b);  <span class="cm">// true</span>
<span class="ty">bool</span> maggiore       = (a &gt;  b);  <span class="cm">// true</span>
<span class="ty">bool</span> minore         = (a &lt;  b);  <span class="cm">// false</span>
<span class="ty">bool</span> maggioreUguale = (a &gt;= b);  <span class="cm">// true</span>
<span class="ty">bool</span> minoreUguale   = (a &lt;= b);  <span class="cm">// false</span></pre>
    <table>
      <tr><th>Op</th><th>Significato</th><th>Esempio</th></tr>
      <tr><td>==</td><td>Uguale a</td><td>5 == 5 → true</td></tr>
      <tr><td>!=</td><td>Diverso da</td><td>5 != 3 → true</td></tr>
      <tr><td>&gt;</td><td>Maggiore di</td><td>5 &gt; 3 → true</td></tr>
      <tr><td>&lt;</td><td>Minore di</td><td>5 &lt; 3 → false</td></tr>
      <tr><td>&gt;=</td><td>Maggiore o uguale</td><td>5 &gt;= 5 → true</td></tr>
      <tr><td>&lt;=</td><td>Minore o uguale</td><td>5 &lt;= 3 → false</td></tr>
    </table>
    <div class="warn">Non confondere = (assegnazione) con == (confronto)!</div>

    <h4>Operatori logici</h4>
    <pre><span class="cm">// AND (&&) — entrambi devono essere true:</span>
<span class="ty">bool</span> adulto = eta &gt;= <span class="num">18</span> &amp;&amp; haDocumento;

<span class="cm">// OR (||) — almeno uno deve essere true:</span>
<span class="ty">bool</span> paga = haCarta || haContanti;

<span class="cm">// NOT (!) — inverte:</span>
<span class="ty">bool</span> offline = !connesso;</pre>
    <table>
      <tr><th>A</th><th>B</th><th>A &amp;&amp; B</th><th>A || B</th><th>!A</th></tr>
      <tr><td>true</td><td>true</td><td>true</td><td>true</td><td>false</td></tr>
      <tr><td>true</td><td>false</td><td>false</td><td>true</td><td>false</td></tr>
      <tr><td>false</td><td>true</td><td>false</td><td>true</td><td>true</td></tr>
      <tr><td>false</td><td>false</td><td>false</td><td>false</td><td>true</td></tr>
    </table>

    <h4>Esempi pratici</h4>
    <pre><span class="cm">// Accesso sito:</span>
<span class="ty">bool</span> puoAccedere = (eta &gt;= <span class="num">18</span>) &amp;&amp; haAccount &amp;&amp; emailVerificata;

<span class="cm">// Sconto:</span>
<span class="ty">bool</span> sconto = (totale &gt;= <span class="num">50m</span>) &amp;&amp; (premium || codiceScontoValido);

<span class="cm">// Orario apertura:</span>
<span class="ty">bool</span> apertoFer = feriale &amp;&amp; (ora &gt;= <span class="num">9</span> &amp;&amp; ora &lt; <span class="num">18</span>);
<span class="ty">bool</span> apertoWe  = !feriale &amp;&amp; (ora &gt;= <span class="num">10</span> &amp;&amp; ora &lt; <span class="num">16</span>);
<span class="ty">bool</span> aperto    = apertoFer || apertoWe;

<span class="cm">// Stringhe — CASE SENSITIVE!</span>
<span class="ty">bool</span> ok1 = (<span class="str">"Marco"</span> == <span class="str">"marco"</span>);                              <span class="cm">// false!</span>
<span class="ty">bool</span> ok2 = <span class="str">"Marco"</span>.<span class="fn">Equals</span>(<span class="str">"marco"</span>, StringComparison.OrdinalIgnoreCase); <span class="cm">// true</span></pre>

    <h4>Operatore ternario</h4>
    <pre><span class="cm">// condizione ? valore_true : valore_false</span>
<span class="ty">string</span> msg = (eta &gt;= <span class="num">18</span>) ? <span class="str">"Adulto"</span> : <span class="str">"Minore"</span>;

<span class="cm">// Singolare/Plurale:</span>
<span class="ty">string</span> t = (n == <span class="num">1</span>) ? <span class="str">"elemento"</span> : <span class="str">"elementi"</span>;

<span class="cm">// Annidato (voto in lettere):</span>
<span class="ty">string</span> voto = (punti &gt;= <span class="num">90</span>) ? <span class="str">"A"</span> :
              (punti &gt;= <span class="num">80</span>) ? <span class="str">"B"</span> :
              (punti &gt;= <span class="num">70</span>) ? <span class="str">"C"</span> :
              (punti &gt;= <span class="num">60</span>) ? <span class="str">"D"</span> : <span class="str">"F"</span>;

<span class="cm">// Prezzo condizionale:</span>
<span class="ty">string</span> pStr = (prezzo == <span class="num">0</span>) ? <span class="str">"Gratuito"</span> : <span class="str">$"{prezzo:C}"</span>;</pre>

    <h4>Short-circuit evaluation</h4>
    <pre><span class="cm">// && si ferma se il primo è false</span>
<span class="cm">// || si ferma se il primo è true</span>
<span class="cm">// Utile per evitare NullReferenceException:</span>

<span class="ty">string</span> nome = <span class="kw">null</span>;
<span class="cm">// if (nome.Length > 0)          ← CRASH! nome è null</span>
<span class="kw">if</span> (nome != <span class="kw">null</span> &amp;&amp; nome.Length &gt; <span class="num">0</span>) { }  <span class="cm">// OK — null check prima</span>
<span class="kw">if</span> (!<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(nome)) { }        <span class="cm">// ancora meglio</span></pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. = invece di ==:</span>
<span class="kw">if</span> (x == <span class="num">5</span>) { }   <span class="cm">// OK   — confronto</span>
<span class="cm">// if (x = 5)      ← ERRORE — assegnazione!</span>

<span class="cm">// 2. Condizioni ridondanti:</span>
<span class="kw">if</span> (attivo)       <span class="cm">// OK — non serve "== true"</span>
<span class="kw">if</span> (!attivo)      <span class="cm">// OK — non serve "== false"</span>

<span class="cm">// 3. Precedenza: && prima di ||</span>
<span class="cm">// Usa parentesi per chiarezza:</span>
<span class="ty">bool</span> ok = (eta &gt;= <span class="num">18</span>) || (eta &gt;= <span class="num">13</span> &amp;&amp; genPresente);</pre>

    <h4>Progetto — Sistema di login</h4>
    <pre><span class="kw">const</span> <span class="ty">string</span> USER = <span class="str">"admin"</span>, PASS = <span class="str">"admin123"</span>;
<span class="ty">int</span> tentativi = <span class="num">3</span>; <span class="ty">bool</span> ok = <span class="kw">false</span>;

<span class="kw">while</span> (tentativi &gt; <span class="num">0</span> &amp;&amp; !ok) {
    Console.<span class="fn">Write</span>(<span class="str">$"Username ({tentativi} tentativi): "</span>); <span class="ty">string</span> u = Console.<span class="fn">ReadLine</span>();
    Console.<span class="fn">Write</span>(<span class="str">"Password: "</span>);                        <span class="ty">string</span> p = Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span> (u == USER &amp;&amp; p == PASS) { ok = <span class="kw">true</span>; Console.<span class="fn">WriteLine</span>(<span class="str">"[OK] Benvenuto!"</span>); }
    <span class="kw">else</span> { tentativi--; Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] Credenziali errate."</span>); }
}
<span class="kw">if</span> (!ok) Console.<span class="fn">WriteLine</span>(<span class="str">"[BLOCCATO] Troppi tentativi!"</span>);</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Verifica se un numero e&apos; positivo, negativo o zero</span>
<span class="cm">// 2. Controlla se una persona puo&apos; votare (eta >= 18)</span>
<span class="cm">// 3. Anno bisestile (% 400 == 0 || (% 4 == 0 &amp;&amp; % 100 != 0))</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Triangolo valido (somma due lati > terzo)</span>
<span class="cm">// 5. Carattere vocale o consonante</span>
<span class="cm">// 6. Validazione password (lunghezza, maiuscola, numero)</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Validazione data (giorno/mese/anno con bisestile)</span>
<span class="cm">// 8. Prezzo con sconti condizionali cumulativi</span>
<span class="cm">// 9. Sistema prenotazione con disponibilita&apos; e requisiti</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Segno ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> n1);
Console.<span class="fn">WriteLine</span>(n1&gt;<span class="num">0</span>?<span class="str">"POSITIVO"</span>:n1&lt;<span class="num">0</span>?<span class="str">"NEGATIVO"</span>:<span class="str">"ZERO"</span>);

<span class="cm">// --- 2. Voto ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Eta&apos;: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> e2);
Console.<span class="fn">WriteLine</span>(e2&gt;=<span class="num">18</span>?<span class="str">"Puoi votare!"</span>:<span class="str">"Non puoi ancora votare."</span>);

<span class="cm">// --- 3. Bisestile ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Anno: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> anno);
<span class="ty">bool</span> bis = (anno%<span class="num">400</span>==<span class="num">0</span>) || (anno%<span class="num">4</span>==<span class="num">0</span> &amp;&amp; anno%<span class="num">100</span>!=<span class="num">0</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{anno} {(bis ? "E'" : "NON e'")} bisestile"</span>);

<span class="cm">// --- 4. Triangolo ---</span>
Console.<span class="fn">Write</span>(<span class="str">"a: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> la);
Console.<span class="fn">Write</span>(<span class="str">"b: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> lb);
Console.<span class="fn">Write</span>(<span class="str">"c: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> lc);
<span class="ty">bool</span> triang = la&gt;<span class="num">0</span>&amp;&amp;lb&gt;<span class="num">0</span>&amp;&amp;lc&gt;<span class="num">0</span>&amp;&amp;(la+lb&gt;lc)&amp;&amp;(la+lc&gt;lb)&amp;&amp;(lb+lc&gt;la);
Console.<span class="fn">WriteLine</span>(triang?<span class="str">"Triangolo valido"</span>:<span class="str">"Non valido"</span>);
<span class="kw">if</span>(triang) Console.<span class="fn">WriteLine</span>(la==lb&amp;&amp;lb==lc?<span class="str">"Equilatero"</span>:la==lb||lb==lc||la==lc?<span class="str">"Isoscele"</span>:<span class="str">"Scaleno"</span>);

<span class="cm">// --- 5. Vocale o consonante ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Carattere: "</span>); <span class="ty">string</span> ci = Console.<span class="fn">ReadLine</span>();
<span class="kw">if</span>(ci.Length==<span class="num">1</span>&amp;&amp;<span class="ty">char</span>.<span class="fn">IsLetter</span>(ci[<span class="num">0</span>]))
    Console.<span class="fn">WriteLine</span>(<span class="str">"aeiouAEIOU"</span>.<span class="fn">Contains</span>(ci[<span class="num">0</span>])?<span class="str">"Vocale"</span>:<span class="str">"Consonante"</span>);

<span class="cm">// --- 6. Password ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Password: "</span>); <span class="ty">string</span> pwd = Console.<span class="fn">ReadLine</span>();
<span class="ty">bool</span> pwOk = pwd.Length&gt;=<span class="num">8</span> &amp;&amp; pwd.<span class="fn">Any</span>(<span class="ty">char</span>.IsUpper) &amp;&amp; pwd.<span class="fn">Any</span>(<span class="ty">char</span>.IsLower) &amp;&amp; pwd.<span class="fn">Any</span>(<span class="ty">char</span>.IsDigit);
Console.<span class="fn">WriteLine</span>(pwOk?<span class="str">"Password valida"</span>:<span class="str">"Troppo debole (min 8 car, maiusc, minusc, numero)"</span>);

<span class="cm">// --- 7. Valida data ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Giorno: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> gd);
Console.<span class="fn">Write</span>(<span class="str">"Mese: "</span>);   <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> ms);
Console.<span class="fn">Write</span>(<span class="str">"Anno: "</span>);   <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> an);
<span class="ty">bool</span> bisD = (an%<span class="num">400</span>==<span class="num">0</span>)||(an%<span class="num">4</span>==<span class="num">0</span>&amp;&amp;an%<span class="num">100</span>!=<span class="num">0</span>);
<span class="ty">int</span>[] giMax = {<span class="num">0</span>,<span class="num">31</span>,bisD?<span class="num">29</span>:<span class="num">28</span>,<span class="num">31</span>,<span class="num">30</span>,<span class="num">31</span>,<span class="num">30</span>,<span class="num">31</span>,<span class="num">31</span>,<span class="num">30</span>,<span class="num">31</span>,<span class="num">30</span>,<span class="num">31</span>};
<span class="ty">bool</span> dateOk = ms&gt;=<span class="num">1</span>&amp;&amp;ms&lt;=<span class="num">12</span>&amp;&amp;gd&gt;=<span class="num">1</span>&amp;&amp;gd&lt;=giMax[ms];
Console.<span class="fn">WriteLine</span>(dateOk?<span class="str">$"[OK] {gd:D2}/{ms:D2}/{an}"</span>:<span class="str">"[ERRORE] Data non valida"</span>);

<span class="cm">// --- 8. Sconti cumulativi ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Importo: "</span>); <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out decimal</span> imp);
Console.<span class="fn">Write</span>(<span class="str">"Premium? s/n: "</span>); <span class="ty">bool</span> prem = Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>()==<span class="str">"s"</span>;
Console.<span class="fn">Write</span>(<span class="str">"Black Friday? s/n: "</span>); <span class="ty">bool</span> bf = Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>()==<span class="str">"s"</span>;
<span class="ty">decimal</span> sc = <span class="num">0</span>;
<span class="kw">if</span>(imp&gt;=<span class="num">100m</span>) sc+=<span class="num">0.10m</span>; <span class="kw">else if</span>(imp&gt;=<span class="num">50m</span>) sc+=<span class="num">0.05m</span>;
<span class="kw">if</span>(prem) sc+=<span class="num">0.15m</span>;
<span class="kw">if</span>(bf) sc+=<span class="num">0.20m</span>;
<span class="kw">if</span>(sc&gt;<span class="num">0.50m</span>) sc=<span class="num">0.50m</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Sconto: {sc:P0}  Totale: {imp*(1-sc):C}"</span>);

<span class="cm">// --- 9. Prenotazione hotel ---</span>
<span class="ty">bool</span> sinDispo=<span class="kw">true</span>, dopDispo=<span class="kw">true</span>, suitDispo=<span class="kw">false</span>;
Console.<span class="fn">Write</span>(<span class="str">"Stanza (S/D/U): "</span>); <span class="ty">char</span> st=<span class="ty">char</span>.<span class="fn">ToUpper</span>(Console.<span class="fn">ReadLine</span>()[<span class="num">0</span>]);
Console.<span class="fn">Write</span>(<span class="str">"Notti: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> notti);
Console.<span class="fn">Write</span>(<span class="str">"Eta&apos;: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> etaH);
Console.<span class="fn">Write</span>(<span class="str">"Carta? s/n: "</span>); <span class="ty">bool</span> carta=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>()==<span class="str">"s"</span>;
(<span class="ty">bool</span> dispo, <span class="ty">decimal</span> prz, <span class="ty">string</span> nome) stanza = st <span class="kw">switch</span> {
    <span class="str">'S'</span> =&gt; (sinDispo, <span class="num">50m</span>, <span class="str">"Singola"</span>), <span class="str">'D'</span> =&gt; (dopDispo, <span class="num">80m</span>, <span class="str">"Doppia"</span>),
    <span class="str">'U'</span> =&gt; (suitDispo, <span class="num">200m</span>, <span class="str">"Suite"</span>), _ =&gt; (<span class="kw">false</span>, <span class="num">0m</span>, <span class="str">"?"</span>)
};
<span class="ty">bool</span> preOk = stanza.dispo &amp;&amp; etaH&gt;=<span class="num">18</span> &amp;&amp; carta &amp;&amp; notti&gt;=<span class="num">1</span>&amp;&amp;notti&lt;=<span class="num">30</span>;
<span class="kw">if</span>(preOk) Console.<span class="fn">WriteLine</span>(<span class="str">$"[OK] {stanza.nome} x {notti} notti = {stanza.prz*notti:C}"</span>);
<span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"[NO] Prenotazione non possibile"</span>);</pre>

  </div>
</div>
      <!-- 5. Strutture di Controllo -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>5. Strutture di Controllo</h3><div class="topic-sub">if/else if/else, switch, switch expression (C# 8+), progetti</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>if / else if / else</h4>
    <pre><span class="kw">if</span> (voto &gt;= <span class="num">90</span>)      Console.<span class="fn">WriteLine</span>(<span class="str">"Ottimo!"</span>);
<span class="kw">else if</span> (voto &gt;= <span class="num">80</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Molto bene!"</span>);
<span class="kw">else if</span> (voto &gt;= <span class="num">70</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Bene!"</span>);
<span class="kw">else if</span> (voto &gt;= <span class="num">60</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Sufficiente"</span>);
<span class="kw">else</span>                 Console.<span class="fn">WriteLine</span>(<span class="str">"Insufficiente"</span>);</pre>
    <div class="warn">Usa sempre le { } anche per una sola istruzione — senza di esse è facile introdurre bug invisibili.</div>

    <h4>if annidati</h4>
    <pre><span class="kw">if</span> (eta &gt;= <span class="num">18</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Maggiorenne"</span>);
    <span class="kw">if</span> (haPatente) Console.<span class="fn">WriteLine</span>(<span class="str">"Puoi guidare!"</span>);
    <span class="kw">else</span>           Console.<span class="fn">WriteLine</span>(<span class="str">"Ma non hai la patente"</span>);
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Minorenne"</span>);
    <span class="kw">if</span> (eta &gt;= <span class="num">14</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Puoi guidare il motorino"</span>);
    <span class="kw">else</span>            Console.<span class="fn">WriteLine</span>(<span class="str">"Non puoi guidare nulla"</span>);
}</pre>

    <h4>switch classico</h4>
    <pre><span class="kw">switch</span> (giorno) {
    <span class="kw">case</span> <span class="num">1</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Lunedi"</span>);   <span class="kw">break</span>;
    <span class="kw">case</span> <span class="num">2</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Martedi"</span>);  <span class="kw">break</span>;
    <span class="kw">case</span> <span class="num">6</span>:
    <span class="kw">case</span> <span class="num">7</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Weekend!"</span>);  <span class="kw">break</span>;  <span class="cm">// case multipli</span>
    <span class="kw">default</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Altro"</span>);    <span class="kw">break</span>;
}

<span class="cm">// Funziona anche con stringhe:</span>
<span class="kw">switch</span> (comando.<span class="fn">ToLower</span>()) {
    <span class="kw">case</span> <span class="str">"start"</span>: <span class="kw">case</span> <span class="str">"avvia"</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Avvio..."</span>); <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"stop"</span>:  <span class="kw">case</span> <span class="str">"ferma"</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Stop..."</span>);  <span class="kw">break</span>;
    <span class="kw">default</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Comando sconosciuto"</span>); <span class="kw">break</span>;
}</pre>

    <h4>switch expression (C# 8+)</h4>
    <pre><span class="cm">// Restituisce direttamente un valore — più compatto:</span>
<span class="ty">string</span> nomeGiorno = giorno <span class="kw">switch</span> {
    <span class="num">1</span> =&gt; <span class="str">"Lunedi"</span>, <span class="num">2</span> =&gt; <span class="str">"Martedi"</span>, <span class="num">3</span> =&gt; <span class="str">"Mercoledi"</span>,
    <span class="num">4</span> =&gt; <span class="str">"Giovedi"</span>, <span class="num">5</span> =&gt; <span class="str">"Venerdi"</span>, <span class="num">6</span> =&gt; <span class="str">"Sabato"</span>, <span class="num">7</span> =&gt; <span class="str">"Domenica"</span>,
    _ =&gt; <span class="str">"Non valido"</span>
};

<span class="cm">// Con range (C# 9+):</span>
<span class="ty">string</span> valut = punti <span class="kw">switch</span> {
    &gt;= <span class="num">90</span> =&gt; <span class="str">"Eccellente"</span>,
    &gt;= <span class="num">80</span> =&gt; <span class="str">"Ottimo"</span>,
    &gt;= <span class="num">70</span> =&gt; <span class="str">"Buono"</span>,
    &gt;= <span class="num">60</span> =&gt; <span class="str">"Sufficiente"</span>,
    _      =&gt; <span class="str">"Insufficiente"</span>
};

<span class="cm">// Con 'or':</span>
<span class="ty">int</span> giorniMese = mese <span class="kw">switch</span> {
    <span class="num">1</span> <span class="kw">or</span> <span class="num">3</span> <span class="kw">or</span> <span class="num">5</span> <span class="kw">or</span> <span class="num">7</span> <span class="kw">or</span> <span class="num">8</span> <span class="kw">or</span> <span class="num">10</span> <span class="kw">or</span> <span class="num">12</span> =&gt; <span class="num">31</span>,
    <span class="num">4</span> <span class="kw">or</span> <span class="num">6</span> <span class="kw">or</span> <span class="num">9</span> <span class="kw">or</span> <span class="num">11</span> =&gt; <span class="num">30</span>,
    <span class="num">2</span> =&gt; <span class="num">28</span>,
    _ =&gt; <span class="num">0</span>
};</pre>
    <table>
      <tr><th>Usa if quando...</th><th>Usa switch quando...</th></tr>
      <tr><td>Range di valori</td><td>Valori specifici/discreti</td></tr>
      <tr><td>Condizioni complesse</td><td>Una variabile, molti casi</td></tr>
      <tr><td>Poche opzioni (2-3)</td><td>Molte opzioni (&gt; 3)</td></tr>
    </table>

    <h4>Progetto — Calcolatrice</h4>
    <pre>Console.<span class="fn">Write</span>(<span class="str">"Num1: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> n1);
Console.<span class="fn">Write</span>(<span class="str">"Op: "</span>);   <span class="ty">string</span> op = Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">Write</span>(<span class="str">"Num2: "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> n2);

<span class="ty">double</span> res = op <span class="kw">switch</span> {
    <span class="str">"+"</span> =&gt; n1+n2, <span class="str">"-"</span> =&gt; n1-n2, <span class="str">"*"</span> <span class="kw">or</span> <span class="str">"x"</span> =&gt; n1*n2,
    <span class="str">"/"</span> =&gt; n2!=<span class="num">0</span> ? n1/n2 : <span class="ty">double</span>.NaN,
    <span class="str">"%"</span> =&gt; n1%n2,
    _ =&gt; <span class="ty">double</span>.NaN
};
Console.<span class="fn">WriteLine</span>(<span class="ty">double</span>.<span class="fn">IsNaN</span>(res) ? <span class="str">"Operazione non valida"</span> : <span class="str">$"{n1} {op} {n2} = {res}"</span>);</pre>

    <h4>Progetto — BMI con switch expression</h4>
    <pre>Console.<span class="fn">Write</span>(<span class="str">"Peso (kg): "</span>);  <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> peso);
Console.<span class="fn">Write</span>(<span class="str">"Altezza (m): "</span>); <span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> alt);
<span class="ty">double</span> bmi = peso / (alt * alt);

<span class="ty">string</span> cat = bmi <span class="kw">switch</span> {
    &lt; <span class="num">16</span>              =&gt; <span class="str">"Grave magrezza"</span>,
    &gt;= <span class="num">16</span> <span class="kw">and</span> &lt; <span class="num">18.5</span> =&gt; <span class="str">"Sottopeso"</span>,
    &gt;= <span class="num">18.5</span> <span class="kw">and</span> &lt; <span class="num">25</span> =&gt; <span class="str">"Normopeso"</span>,
    &gt;= <span class="num">25</span> <span class="kw">and</span> &lt; <span class="num">30</span>   =&gt; <span class="str">"Sovrappeso"</span>,
    &gt;= <span class="num">30</span> <span class="kw">and</span> &lt; <span class="num">35</span>   =&gt; <span class="str">"Obesita&apos; I"</span>,
    &gt;= <span class="num">35</span>             =&gt; <span class="str">"Obesita&apos; II+"</span>,
    _                  =&gt; <span class="str">"Errore"</span>
};
Console.<span class="fn">WriteLine</span>(<span class="str">$"BMI: {bmi:F1} — {cat}"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Ordine condizioni sbagliato (dal più generale al più specifico):</span>
<span class="kw">if</span> (v &gt;= <span class="num">60</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Sufficiente"</span>);  <span class="cm">// cattura anche 95!</span>
<span class="kw">else if</span> (v &gt;= <span class="num">90</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Ottimo"</span>);   <span class="cm">// mai raggiunto!</span>
<span class="cm">// CORRETTO: metti prima il caso più restrittivo (>= 90)</span>

<span class="cm">// 2. else senza parentesi — il secondo WriteLine esegue SEMPRE:</span>
<span class="kw">if</span> (ok)
    Console.<span class="fn">WriteLine</span>(<span class="str">"A"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">"B"</span>);  <span class="cm">// NON è dentro l'if!</span>

<span class="cm">// 3. Dimenticare break nel switch (errore di compilazione in C#)</span>

<span class="cm">// 4. Else if senza else finale — alcuni casi non vengono gestiti</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Segno del numero (positivo/negativo/zero)</span>
<span class="cm">// 2. Numero mese → nome mese</span>
<span class="cm">// 3. Giorno feriale o weekend</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Voto USA (A/B/C/D/F)</span>
<span class="cm">// 5. Tariffa parcheggio (prima ora 2€, poi 1.50€/ora, max 10€)</span>
<span class="cm">// 6. Distributore automatico con gestione del resto</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Controllo accesso cinema (T, VM14, VM18)</span>
<span class="cm">// 8. Calcolatore imposte progressive (scaglioni IRPEF)</span>
<span class="cm">// 9. Simulatore bancomat con menu e PIN</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Segno ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> ns);
Console.<span class="fn">WriteLine</span>(ns&gt;<span class="num">0</span>?<span class="str">"POSITIVO [+]"</span>:ns&lt;<span class="num">0</span>?<span class="str">"NEGATIVO [-]"</span>:<span class="str">"ZERO [0]"</span>);

<span class="cm">// --- 2. Mese ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Mese (1-12): "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> ms2);
<span class="ty">string</span> nomeMese = ms2 <span class="kw">switch</span> {
    <span class="num">1</span>=&gt;<span class="str">"Gennaio"</span>,<span class="num">2</span>=&gt;<span class="str">"Febbraio"</span>,<span class="num">3</span>=&gt;<span class="str">"Marzo"</span>,<span class="num">4</span>=&gt;<span class="str">"Aprile"</span>,
    <span class="num">5</span>=&gt;<span class="str">"Maggio"</span>,<span class="num">6</span>=&gt;<span class="str">"Giugno"</span>,<span class="num">7</span>=&gt;<span class="str">"Luglio"</span>,<span class="num">8</span>=&gt;<span class="str">"Agosto"</span>,
    <span class="num">9</span>=&gt;<span class="str">"Settembre"</span>,<span class="num">10</span>=&gt;<span class="str">"Ottobre"</span>,<span class="num">11</span>=&gt;<span class="str">"Novembre"</span>,<span class="num">12</span>=&gt;<span class="str">"Dicembre"</span>,
    _=&gt;<span class="str">"Non valido"</span>
};
Console.<span class="fn">WriteLine</span>(nomeMese);

<span class="cm">// --- 3. Feriale/Weekend ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Giorno (1=Lun…7=Dom): "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> gw);
Console.<span class="fn">WriteLine</span>(gw <span class="kw">switch</span> { &gt;=<span class="num">1</span> <span class="kw">and</span> &lt;=<span class="num">5</span>=&gt;<span class="str">"Feriale"</span>, <span class="num">6</span> <span class="kw">or</span> <span class="num">7</span>=&gt;<span class="str">"Weekend"</span>, _=&gt;<span class="str">"Non valido"</span> });

<span class="cm">// --- 4. Voto USA ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Punteggio: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> pv);
Console.<span class="fn">WriteLine</span>(pv <span class="kw">switch</span> { &lt;<span class="num">0</span> <span class="kw">or</span> &gt;<span class="num">100</span>=&gt;<span class="str">"Non valido"</span>, &gt;=<span class="num">90</span>=&gt;<span class="str">"A"</span>, &gt;=<span class="num">80</span>=&gt;<span class="str">"B"</span>, &gt;=<span class="num">70</span>=&gt;<span class="str">"C"</span>, &gt;=<span class="num">60</span>=&gt;<span class="str">"D"</span>, _=&gt;<span class="str">"F"</span> });

<span class="cm">// --- 5. Parcheggio ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Ore: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> ore);
<span class="ty">decimal</span> tariffa = ore &lt;= <span class="num">0</span> ? <span class="num">0m</span> : ore == <span class="num">1</span> ? <span class="num">2.00m</span> : Math.<span class="fn">Min</span>(<span class="num">2.00m</span> + (ore-<span class="num">1</span>)*<span class="num">1.50m</span>, <span class="num">10.00m</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{ore} ore → {tariffa:C}"</span>);

<span class="cm">// --- 6. Distributore ---</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"1.Caffe 0.80  2.Cappuccino 1.20  3.Te 0.70  4.Acqua 0.50"</span>);
Console.<span class="fn">Write</span>(<span class="str">"Scelta: "</span>); <span class="ty">string</span> sc = Console.<span class="fn">ReadLine</span>();
<span class="ty">decimal</span> prz = sc <span class="kw">switch</span> { <span class="str">"1"</span>=&gt;<span class="num">0.80m</span>,<span class="str">"2"</span>=&gt;<span class="num">1.20m</span>,<span class="str">"3"</span>=&gt;<span class="num">0.70m</span>,<span class="str">"4"</span>=&gt;<span class="num">0.50m</span>,_=&gt;-<span class="num">1m</span> };
<span class="kw">if</span>(prz&lt;<span class="num">0</span>){Console.<span class="fn">WriteLine</span>(<span class="str">"Selezione non valida"</span>);}
<span class="kw">else</span> {
    Console.<span class="fn">Write</span>(<span class="str">$"Inserisci {prz:C}: "</span>);
    <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out decimal</span> ins);
    <span class="kw">if</span>(ins&lt;prz) Console.<span class="fn">WriteLine</span>(<span class="str">$"Insufficiente, restituzione {ins:C}"</span>);
    <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">$"Erogazione... Resto: {ins-prz:C}"</span>);
}

<span class="cm">// --- 7. Cinema ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Eta&apos;: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> ec);
Console.<span class="fn">Write</span>(<span class="str">"Classif (T/VM14/VM18): "</span>); <span class="ty">string</span> cl = Console.<span class="fn">ReadLine</span>().<span class="fn">ToUpper</span>();
Console.<span class="fn">Write</span>(<span class="str">"Accompagnato? s/n: "</span>); <span class="ty">bool</span> acc = Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>()==<span class="str">"s"</span>;
<span class="ty">bool</span> cinOk = cl <span class="kw">switch</span> {
    <span class="str">"T"</span>    =&gt; <span class="kw">true</span>,
    <span class="str">"VM14"</span> =&gt; ec&gt;=<span class="num">14</span> || (ec&gt;=<span class="num">10</span>&amp;&amp;acc),
    <span class="str">"VM18"</span> =&gt; ec&gt;=<span class="num">18</span>,
    _      =&gt; <span class="kw">false</span>
};
Console.<span class="fn">WriteLine</span>(cinOk?<span class="str">"[OK] Accesso consentito"</span>:<span class="str">"[NO] Accesso negato"</span>);

<span class="cm">// --- 8. Imposte IRPEF ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Reddito: "</span>); <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out decimal</span> red);
<span class="ty">decimal</span> imp=<span class="num">0</span>, res=red;
<span class="kw">if</span>(res&gt;<span class="num">0</span>){<span class="ty">decimal</span> q=Math.<span class="fn">Min</span>(res,<span class="num">15000m</span>);imp+=q*<span class="num">0.23m</span>;res-=q;}
<span class="kw">if</span>(res&gt;<span class="num">0</span>){<span class="ty">decimal</span> q=Math.<span class="fn">Min</span>(res,<span class="num">13000m</span>);imp+=q*<span class="num">0.27m</span>;res-=q;}
<span class="kw">if</span>(res&gt;<span class="num">0</span>){<span class="ty">decimal</span> q=Math.<span class="fn">Min</span>(res,<span class="num">27000m</span>);imp+=q*<span class="num">0.38m</span>;res-=q;}
<span class="kw">if</span>(res&gt;<span class="num">0</span>) imp+=res*<span class="num">0.43m</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Imposta: {imp:C}  Aliquota eff: {imp/red:P1}  Netto: {red-imp:C}"</span>);

<span class="cm">// --- 9. Bancomat ---</span>
<span class="ty">decimal</span> saldo=<span class="num">1500m</span>; <span class="ty">string</span> pin=<span class="str">"1234"</span>; <span class="ty">int</span> tent=<span class="num">3</span>; <span class="ty">bool</span> auth=<span class="kw">false</span>;
<span class="kw">while</span>(tent&gt;<span class="num">0</span>&amp;&amp;!auth){Console.<span class="fn">Write</span>(<span class="str">$"PIN ({tent} tent.): "</span>);
    <span class="kw">if</span>(Console.<span class="fn">ReadLine</span>()==pin) auth=<span class="kw">true</span>; <span class="kw">else</span>{tent--;Console.<span class="fn">WriteLine</span>(<span class="str">"Errato"</span>);}}
<span class="kw">if</span>(!auth){Console.<span class="fn">WriteLine</span>(<span class="str">"Carta bloccata"</span>);}
<span class="kw">else</span> {
    <span class="ty">bool</span> esci=<span class="kw">false</span>;
    <span class="kw">while</span>(!esci){
        Console.<span class="fn">Write</span>(<span class="str">"1.Saldo 2.Preleva 3.Deposita 0.Esci → "</span>);
        <span class="kw">switch</span>(Console.<span class="fn">ReadLine</span>()){
            <span class="kw">case</span> <span class="str">"1"</span>: Console.<span class="fn">WriteLine</span>(<span class="str">$"Saldo: {saldo:C}"</span>); <span class="kw">break</span>;
            <span class="kw">case</span> <span class="str">"2"</span>: Console.<span class="fn">Write</span>(<span class="str">"Importo: "</span>);
                <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out decimal</span> pr);
                <span class="kw">if</span>(pr&gt;<span class="num">0</span>&amp;&amp;pr&lt;=saldo&amp;&amp;pr&lt;=<span class="num">500m</span>){saldo-=pr;Console.<span class="fn">WriteLine</span>(<span class="str">$"Prelevati {pr:C}. Saldo: {saldo:C}"</span>);}
                <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido (max 500, saldo sufficiente)"</span>); <span class="kw">break</span>;
            <span class="kw">case</span> <span class="str">"3"</span>: Console.<span class="fn">Write</span>(<span class="str">"Importo: "</span>);
                <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out decimal</span> dp);
                <span class="kw">if</span>(dp&gt;<span class="num">0</span>){saldo+=dp;Console.<span class="fn">WriteLine</span>(<span class="str">$"Depositati {dp:C}. Saldo: {saldo:C}"</span>);}
                <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Non valido"</span>); <span class="kw">break</span>;
            <span class="kw">case</span> <span class="str">"0"</span>: esci=<span class="kw">true</span>; Console.<span class="fn">WriteLine</span>(<span class="str">"Arrivederci!"</span>); <span class="kw">break</span>;
            <span class="kw">default</span>: Console.<span class="fn">WriteLine</span>(<span class="str">"Scelta non valida"</span>); <span class="kw">break</span>;
        }
    }
}</pre>

  </div>
</div>
      <!-- 6. Ciclo for -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>6. Ciclo for</h3><div class="topic-sub">Iterazioni note, contatore, break, continue, step, cicli annidati</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Struttura base</h4>
    <pre><span class="cm">// for (inizio; condizione; aggiornamento)</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">5</span>; i++)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"i = {i}"</span>);  <span class="cm">// 0, 1, 2, 3, 4</span>

<span class="cm">// Le tre parti del for:</span>
<span class="cm">// int i = 0  → eseguito UNA volta all'inizio</span>
<span class="cm">// i &lt; 5      → controllata PRIMA di ogni iterazione</span>
<span class="cm">// i++        → eseguito DOPO ogni iterazione</span></pre>

    <h4>Varianti comuni</h4>
    <pre><span class="cm">// Contare al contrario:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">10</span>; i &gt;= <span class="num">0</span>; i--)
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 10 9 8 7 6 5 4 3 2 1 0</span>

<span class="cm">// Step di 2 (numeri pari):</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt;= <span class="num">20</span>; i += <span class="num">2</span>)
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 0 2 4 6 8 10 12 14 16 18 20</span>

<span class="cm">// Step di 5:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt;= <span class="num">100</span>; i += <span class="num">5</span>)
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 0 5 10 15 ... 100</span>

<span class="cm">// Moltiplicare (tavola del 2):</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">10</span>; i *= <span class="num">2</span>)
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 1 2 4 8 16... (attenzione: può non fermarsi!)</span></pre>

    <h4>break e continue</h4>
    <pre><span class="cm">// break — esce dal ciclo immediatamente:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) {
    <span class="kw">if</span> (i == <span class="num">5</span>) <span class="kw">break</span>;
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 0 1 2 3 4</span>
}

<span class="cm">// continue — salta questa iterazione e va alla prossima:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) {
    <span class="kw">if</span> (i % <span class="num">2</span> == <span class="num">0</span>) <span class="kw">continue</span>;  <span class="cm">// salta i pari</span>
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 1 3 5 7 9</span>
}

<span class="cm">// Insieme:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) {
    <span class="kw">if</span> (i == <span class="num">3</span>) <span class="kw">continue</span>;  <span class="cm">// salta 3</span>
    <span class="kw">if</span> (i == <span class="num">7</span>) <span class="kw">break</span>;     <span class="cm">// si ferma a 7</span>
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);  <span class="cm">// 0 1 2 4 5 6</span>
}</pre>

    <h4>Cicli annidati</h4>
    <pre><span class="cm">// Tavola pitagorica:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">5</span>; i++) {
    <span class="kw">for</span> (<span class="ty">int</span> j = <span class="num">1</span>; j &lt;= <span class="num">5</span>; j++) {
        Console.<span class="fn">Write</span>(<span class="str">$"{i*j,4}"</span>);
    }
    Console.<span class="fn">WriteLine</span>();
}
<span class="cm">// Output:</span>
<span class="cm">//    1   2   3   4   5</span>
<span class="cm">//    2   4   6   8  10</span>
<span class="cm">//    3   6   9  12  15  ...</span>

<span class="cm">// Triangolo di asterischi:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">5</span>; i++) {
    <span class="kw">for</span> (<span class="ty">int</span> j = <span class="num">0</span>; j &lt; i; j++)
        Console.<span class="fn">Write</span>(<span class="str">"* "</span>);
    Console.<span class="fn">WriteLine</span>();
}
<span class="cm">// *</span>
<span class="cm">// * *</span>
<span class="cm">// * * *  ...</span></pre>

    <h4>Usi pratici</h4>
    <pre><span class="cm">// Somma dei numeri da 1 a 100:</span>
<span class="ty">int</span> somma = <span class="num">0</span>;
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">100</span>; i++) somma += i;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma 1-100: {somma}"</span>);  <span class="cm">// 5050</span>

<span class="cm">// Conto alla rovescia con messaggio finale:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">10</span>; i &gt;= <span class="num">1</span>; i--) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Lancio tra {i}..."</span>);
}
Console.<span class="fn">WriteLine</span>(<span class="str">"LANCIO!"</span>);

<span class="cm">// Trovare il primo multiplo di 7 dopo 50:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">51</span>; i &lt; <span class="num">200</span>; i++) {
    <span class="kw">if</span> (i % <span class="num">7</span> == <span class="num">0</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Primo multiplo di 7 dopo 50: {i}"</span>);
        <span class="kw">break</span>;
    }
}

<span class="cm">// Stampare numeri da input dell'utente:</span>
Console.<span class="fn">Write</span>(<span class="str">"Fino a che numero? "</span>);
<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> fine);
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= fine; i++)
    Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);</pre>

    <h4>Progetto — Tavola pitagorica completa</h4>
    <pre>Console.<span class="fn">WriteLine</span>(<span class="str">"=== TAVOLA PITAGORICA ==="</span>);
Console.<span class="fn">Write</span>(<span class="str">$"{"",4}"</span>);
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">10</span>; i++) Console.<span class="fn">Write</span>(<span class="str">$"{i,4}"</span>);
Console.<span class="fn">WriteLine</span>();
Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(<span class="str">'-'</span>, <span class="num">44</span>));

<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">10</span>; i++) {
    Console.<span class="fn">Write</span>(<span class="str">$"{i,3}|"</span>);
    <span class="kw">for</span> (<span class="ty">int</span> j = <span class="num">1</span>; j &lt;= <span class="num">10</span>; j++)
        Console.<span class="fn">Write</span>(<span class="str">$"{i*j,4}"</span>);
    Console.<span class="fn">WriteLine</span>();
}</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Ciclo infinito — condizione sempre vera:</span>
<span class="cm">// for (int i = 0; i &gt;= 0; i++)   ← non si ferma mai!</span>

<span class="cm">// 2. Off-by-one — indice sbagliato di 1:</span>
<span class="ty">string</span>[] nomi = { <span class="str">"A"</span>, <span class="str">"B"</span>, <span class="str">"C"</span> };
<span class="cm">// for (int i = 0; i &lt;= nomi.Length; i++)   ← CRASH all'ultimo giro!</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; nomi.Length; i++)    <span class="cm">// OK — &lt; non &lt;=</span>
    Console.<span class="fn">WriteLine</span>(nomi[i]);

<span class="cm">// 3. Modificare i dentro il ciclo:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) {
    <span class="cm">// i = 5;  ← cattiva pratica, causa comportamenti imprevedibili</span>
}

<span class="cm">// 4. Variabile i usata fuori dal ciclo:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">5</span>; i++) { }
<span class="cm">// Console.WriteLine(i);  ← ERRORE! i non esiste fuori dal for</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Stampa tutti i numeri da 1 a 20</span>
<span class="cm">// 2. Stampa solo i numeri dispari da 1 a 30</span>
<span class="cm">// 3. Calcola la somma dei numeri da 1 a N (N inserito dall'utente)</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Tavola del 7 (da 7x1 a 7x10)</span>
<span class="cm">// 5. Trova tutti i multipli di 3 e 5 tra 1 e 100</span>
<span class="cm">// 6. Calcola N! (fattoriale) con un ciclo for</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Stampa un quadrato N×N di asterischi</span>
<span class="cm">// 8. Trova tutti i numeri primi tra 2 e 100</span>
<span class="cm">// 9. Sequenza di Fibonacci fino a N termini</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">20</span>; i++) Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);

<span class="cm">// --- 2. ---</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">30</span>; i += <span class="num">2</span>) Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);

<span class="cm">// --- 3. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"N: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> n3);
<span class="ty">int</span> s3 = <span class="num">0</span>; <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= n3; i++) s3 += i;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma 1-{n3}: {s3}"</span>);

<span class="cm">// --- 4. ---</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">10</span>; i++) Console.<span class="fn">WriteLine</span>(<span class="str">$"7 x {i} = {7*i}"</span>);

<span class="cm">// --- 5. ---</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">1</span>; i &lt;= <span class="num">100</span>; i++)
    <span class="kw">if</span> (i%<span class="num">3</span>==<span class="num">0</span> &amp;&amp; i%<span class="num">5</span>==<span class="num">0</span>) Console.<span class="fn">Write</span>(<span class="str">$"{i} "</span>);

<span class="cm">// --- 6. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"N: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> n6);
<span class="ty">long</span> f = <span class="num">1</span>; <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">2</span>; i &lt;= n6; i++) f *= i;
Console.<span class="fn">WriteLine</span>(<span class="str">$"{n6}! = {f}"</span>);

<span class="cm">// --- 7. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Dimensione: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> dim);
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; dim; i++) {
    <span class="kw">for</span> (<span class="ty">int</span> j = <span class="num">0</span>; j &lt; dim; j++) Console.<span class="fn">Write</span>(<span class="str">"* "</span>);
    Console.<span class="fn">WriteLine</span>();
}

<span class="cm">// --- 8. ---</span>
<span class="kw">for</span> (<span class="ty">int</span> n = <span class="num">2</span>; n &lt;= <span class="num">100</span>; n++) {
    <span class="ty">bool</span> primo = <span class="kw">true</span>;
    <span class="kw">for</span> (<span class="ty">int</span> d = <span class="num">2</span>; d &lt;= Math.<span class="fn">Sqrt</span>(n) &amp;&amp; primo; d++)
        <span class="kw">if</span> (n % d == <span class="num">0</span>) primo = <span class="kw">false</span>;
    <span class="kw">if</span> (primo) Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>);
}

<span class="cm">// --- 9. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Termini: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> fib);
<span class="ty">long</span> a9 = <span class="num">0</span>, b9 = <span class="num">1</span>;
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; fib; i++) {
    Console.<span class="fn">Write</span>(<span class="str">$"{a9} "</span>);
    (<span class="ty">long</span> tmp) = a9 + b9; a9 = b9; b9 = tmp;
}</pre>

  </div>
</div>
      <!-- 7. Ciclo while / do-while -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>7. Ciclo while / do-while</h3><div class="topic-sub">Condizione prima/dopo, input utente, loop infinito, menu interattivo</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>while — condizione controllata PRIMA</h4>
    <pre><span class="cm">// Sintassi: while (condizione) { ... }</span>
<span class="cm">// Se la condizione è falsa subito, il blocco NON esegue mai.</span>

<span class="ty">int</span> i = <span class="num">0</span>;
<span class="kw">while</span> (i &lt; <span class="num">5</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"i = {i}"</span>);
    i++;  <span class="cm">// FONDAMENTALE: senza questo, ciclo infinito!</span>
}

<span class="cm">// Conta al contrario:</span>
<span class="ty">int</span> cont = <span class="num">10</span>;
<span class="kw">while</span> (cont &gt;= <span class="num">0</span>) {
    Console.<span class="fn">Write</span>(<span class="str">$"{cont} "</span>);
    cont--;
}</pre>

    <h4>do-while — condizione controllata DOPO</h4>
    <pre><span class="cm">// Il blocco esegue ALMENO UNA VOLTA, poi controlla la condizione.</span>
<span class="ty">int</span> n = <span class="num">10</span>;
<span class="kw">do</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"n = {n}"</span>);
    n--;
} <span class="kw">while</span> (n &gt; <span class="num">0</span>);

<span class="cm">// Tipico uso: menu che mostra almeno una volta</span>
<span class="ty">string</span> scelta;
<span class="kw">do</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"1. Gioca  0. Esci"</span>);
    Console.<span class="fn">Write</span>(<span class="str">"Scelta: "</span>);
    scelta = Console.<span class="fn">ReadLine</span>();
} <span class="kw">while</span> (scelta != <span class="str">"0"</span>);</pre>
    <table>
      <tr><th></th><th>for</th><th>while</th><th>do-while</th></tr>
      <tr><td>Quando usarlo</td><td>Iterazioni note</td><td>Iterazioni non note</td><td>Almeno 1 volta</td></tr>
      <tr><td>Condizione</td><td>Prima</td><td>Prima</td><td>Dopo</td></tr>
      <tr><td>Caso tipico</td><td>Scorrere array</td><td>Input utente</td><td>Menu interattivo</td></tr>
      <tr><td>Esegue se falso</td><td>No</td><td>No</td><td>Sì (1 volta)</td></tr>
    </table>

    <h4>Usi pratici del while</h4>
    <pre><span class="cm">// 1. Input valido (chiedi finché non è corretto):</span>
<span class="ty">int</span> eta;
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Eta&apos; (0-120): "</span>);
    <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> eta) &amp;&amp; eta &gt;= <span class="num">0</span> &amp;&amp; eta &lt;= <span class="num">120</span>)
        <span class="kw">break</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">"Valore non valido! Riprova."</span>);
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Eta&apos; inserita: {eta}"</span>);

<span class="cm">// 2. Somma finché l'utente non inserisce 0:</span>
<span class="ty">int</span> totale = <span class="num">0</span>, numero = -<span class="num">1</span>;
<span class="kw">while</span> (numero != <span class="num">0</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Numero (0 per finire): "</span>);
    <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> numero);
    totale += numero;
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Totale: {totale}"</span>);

<span class="cm">// 3. Gioco: indovina il numero:</span>
Random rnd = <span class="kw">new</span> Random();
<span class="ty">int</span> segreto = rnd.<span class="fn">Next</span>(<span class="num">1</span>, <span class="num">101</span>);
<span class="ty">int</span> tentativo = <span class="num">0</span>, tentativi = <span class="num">0</span>;
<span class="kw">while</span> (tentativo != segreto) {
    Console.<span class="fn">Write</span>(<span class="str">"Indovina (1-100): "</span>);
    <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> tentativo);
    tentativi++;
    <span class="kw">if</span>      (tentativo &lt; segreto) Console.<span class="fn">WriteLine</span>(<span class="str">"Troppo basso!"</span>);
    <span class="kw">else if</span> (tentativo &gt; segreto) Console.<span class="fn">WriteLine</span>(<span class="str">"Troppo alto!"</span>);
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Bravo! Trovato in {tentativi} tentativi!"</span>);</pre>

    <h4>Loop infinito controllato</h4>
    <pre><span class="cm">// while(true) + break è il pattern più comune per menu:</span>
<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"\n1. Opzione A  2. Opzione B  0. Esci"</span>);
    Console.<span class="fn">Write</span>(<span class="str">"Scelta: "</span>);
    <span class="ty">string</span> s = Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span>      (s == <span class="str">"1"</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Hai scelto A"</span>);
    <span class="kw">else if</span> (s == <span class="str">"2"</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Hai scelto B"</span>);
    <span class="kw">else if</span> (s == <span class="str">"0"</span>) { Console.<span class="fn">WriteLine</span>(<span class="str">"Arrivederci!"</span>); <span class="kw">break</span>; }
    <span class="kw">else</span>              Console.<span class="fn">WriteLine</span>(<span class="str">"Scelta non valida"</span>);
}</pre>

    <h4>Progetto — Gioco della vita (conto punti)</h4>
    <pre><span class="ty">int</span> vite = <span class="num">3</span>, punteggio = <span class="num">0</span>, livello = <span class="num">1</span>;
Random r = <span class="kw">new</span> Random();

<span class="kw">while</span> (vite &gt; <span class="num">0</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"\n[Livello {livello}] Vite: {vite} Punti: {punteggio}"</span>);
    <span class="ty">int</span> risposta = r.<span class="fn">Next</span>(<span class="num">1</span>, <span class="num">11</span>);
    Console.<span class="fn">Write</span>(<span class="str">$"Numero segreto tra 1 e 10, hai 1 tentativo: "</span>);
    <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> guess);
    <span class="kw">if</span> (guess == risposta) {
        punteggio += livello * <span class="num">10</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"ESATTO! +{livello*10} punti!"</span>);
        livello++;
    } <span class="kw">else</span> {
        vite--;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Sbagliato! Era {risposta}. Vite rimaste: {vite}"</span>);
    }
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nGame Over! Punteggio finale: {punteggio} (Livello {livello})"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Ciclo infinito — dimenticare di aggiornare la variabile:</span>
<span class="ty">int</span> x = <span class="num">0</span>;
<span class="kw">while</span> (x &lt; <span class="num">5</span>) {
    Console.<span class="fn">WriteLine</span>(x);
    <span class="cm">// x++;  ← dimenticato! ciclo infinito</span>
}

<span class="cm">// 2. Condizione errata — mai vera:</span>
<span class="ty">int</span> y = <span class="num">10</span>;
<span class="kw">while</span> (y &lt; <span class="num">5</span>) {  <span class="cm">// falsa subito, non esegue mai</span>
    Console.<span class="fn">WriteLine</span>(y);
}

<span class="cm">// 3. do-while con ; mancante:</span>
<span class="kw">do</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao"</span>);
} <span class="kw">while</span> (<span class="kw">false</span>)  <span class="cm">// ← manca il ; finale!</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Chiedi numeri all'utente finché non inserisce un negativo, poi mostra la somma</span>
<span class="cm">// 2. Conta quante volte l'utente inserisce "si" prima di inserire "no"</span>
<span class="cm">// 3. Mostra un menu con 3 opzioni usando do-while</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Indovina il numero (con hints "troppo alto/basso" e conta i tentativi)</span>
<span class="cm">// 5. Chiedi password finché non è corretta (max 3 tentativi)</span>
<span class="cm">// 6. Calcola la media di numeri inseriti dall'utente (0 per terminare)</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Simulatore cassa automatica (inserisci monete finché non copri il prezzo)</span>
<span class="cm">// 8. Gioco del 21 (somma carte, non superare 21)</span>
<span class="cm">// 9. Conversa con l'utente finché non scrive "esci" (eco dei messaggi)</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Somma finché negativo ---</span>
<span class="ty">int</span> s1=<span class="num">0</span>, n1;
<span class="kw">do</span> { Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>); <span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out</span> n1); <span class="kw">if</span>(n1&gt;=<span class="num">0</span>) s1+=n1; } <span class="kw">while</span>(n1&gt;=<span class="num">0</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma: {s1}"</span>);

<span class="cm">// --- 2. Conta "si" ---</span>
<span class="ty">int</span> cnt2=<span class="num">0</span>; <span class="ty">string</span> r2;
<span class="kw">while</span>((r2=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>())!=<span class="str">"no"</span>) <span class="kw">if</span>(r2==<span class="str">"si"</span>) cnt2++;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Hai detto si {cnt2} volte"</span>);

<span class="cm">// --- 3. Menu do-while ---</span>
<span class="ty">string</span> sc3;
<span class="kw">do</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"1.Saluta 2.Calcola 0.Esci"</span>);
    sc3=Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span>(sc3==<span class="str">"1"</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao!"</span>);
    <span class="kw">else if</span>(sc3==<span class="str">"2"</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"2+2=4"</span>);
} <span class="kw">while</span>(sc3!=<span class="str">"0"</span>);

<span class="cm">// --- 4. Indovina numero ---</span>
<span class="ty">int</span> seg=<span class="kw">new</span> Random().<span class="fn">Next</span>(<span class="num">1</span>,<span class="num">101</span>), tent4=<span class="num">0</span>, cnt4=<span class="num">0</span>;
<span class="kw">while</span>(tent4!=seg){Console.<span class="fn">Write</span>(<span class="str">"Indovina: "</span>);<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out</span> tent4);cnt4++;
    <span class="kw">if</span>(tent4&lt;seg)Console.<span class="fn">WriteLine</span>(<span class="str">"Troppo basso!"</span>);<span class="kw">else if</span>(tent4&gt;seg)Console.<span class="fn">WriteLine</span>(<span class="str">"Troppo alto!"</span>);}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Trovato in {cnt4} tentativi!"</span>);

<span class="cm">// --- 5. Password ---</span>
<span class="kw">const</span> <span class="ty">string</span> PWD=<span class="str">"segreto"</span>; <span class="ty">int</span> t5=<span class="num">3</span>;
<span class="kw">while</span>(t5&gt;<span class="num">0</span>){Console.<span class="fn">Write</span>(<span class="str">$"Password ({t5} tentativi): "</span>);
    <span class="kw">if</span>(Console.<span class="fn">ReadLine</span>()==PWD){Console.<span class="fn">WriteLine</span>(<span class="str">"Accesso!"</span>);t5=-<span class="num">1</span>;}
    <span class="kw">else</span>{t5--;Console.<span class="fn">WriteLine</span>(<span class="str">"Errata!"</span>);}}
<span class="kw">if</span>(t5==<span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Bloccato!"</span>);

<span class="cm">// --- 6. Media ---</span>
<span class="ty">double</span> sum6=<span class="num">0</span>; <span class="ty">int</span> cnt6=<span class="num">0</span>, n6;
<span class="kw">while</span>(<span class="kw">true</span>){Console.<span class="fn">Write</span>(<span class="str">"Numero (0 fine): "</span>);<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out</span> n6);
    <span class="kw">if</span>(n6==<span class="num">0</span>)<span class="kw">break</span>;sum6+=n6;cnt6++;}
Console.<span class="fn">WriteLine</span>(cnt6&gt;<span class="num">0</span>?<span class="str">$"Media: {sum6/cnt6:F2}"</span>:<span class="str">"Nessun numero"</span>);

<span class="cm">// --- 7. Cassa ---</span>
<span class="ty">decimal</span> prezzo=<span class="num">1.80m</span>, inserito=<span class="num">0</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Prezzo: {prezzo:C}"</span>);
<span class="kw">while</span>(inserito&lt;prezzo){Console.<span class="fn">Write</span>(<span class="str">"Inserisci moneta: "</span>);
    <span class="ty">decimal</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out decimal</span> m);inserito+=m;
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Inserito: {inserito:C} Mancano: {Math.Max(0,prezzo-inserito):C}"</span>);}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Grazie! Resto: {inserito-prezzo:C}"</span>);

<span class="cm">// --- 8. Gioco del 21 ---</span>
Random r8=<span class="kw">new</span> Random(); <span class="ty">int</span> tot8=<span class="num">0</span>;
<span class="kw">while</span>(tot8&lt;<span class="num">21</span>){<span class="ty">int</span> carta=r8.<span class="fn">Next</span>(<span class="num">1</span>,<span class="num">11</span>);tot8+=carta;
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Carta: {carta}  Totale: {tot8}"</span>);
    <span class="kw">if</span>(tot8&gt;=<span class="num">21</span>)<span class="kw">break</span>;
    Console.<span class="fn">Write</span>(<span class="str">"Altra carta? s/n: "</span>);
    <span class="kw">if</span>(Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>()!=<span class="str">"s"</span>)<span class="kw">break</span>;}
Console.<span class="fn">WriteLine</span>(tot8==<span class="num">21</span>?<span class="str">"21! PERFETTO!"</span>:tot8&gt;<span class="num">21</span>?<span class="str">"Sballato!"</span>:<span class="str">$"Totale: {tot8}"</span>);

<span class="cm">// --- 9. Eco ---</span>
<span class="ty">string</span> msg9;
<span class="kw">while</span>((msg9=Console.<span class="fn">ReadLine</span>()).<span class="fn">ToLower</span>()!=<span class="str">"esci"</span>)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Hai scritto: {msg9}"</span>);</pre>

  </div>
</div>
      <!-- 8. Array & foreach -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>8. Array &amp; foreach</h3><div class="topic-sub">Array fisso, indici, foreach, 2D, metodi Array, errori comuni</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è un array?</h4>
    <pre><span class="cm">// Un array è una sequenza di elementi dello STESSO tipo, a dimensione FISSA.</span>
<span class="cm">// L'indice parte sempre da 0!</span>

<span class="cm">// Dichiarazione vuota (tutti i valori = 0 o null):</span>
<span class="ty">int</span>[] numeri = <span class="kw">new</span> <span class="ty">int</span>[<span class="num">5</span>];   <span class="cm">// [0, 0, 0, 0, 0]</span>

<span class="cm">// Dichiarazione con valori:</span>
<span class="ty">int</span>[]    voti  = { <span class="num">7</span>, <span class="num">8</span>, <span class="num">6</span>, <span class="num">9</span>, <span class="num">7</span> };
<span class="ty">string</span>[] nomi  = { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span>, <span class="str">"Luca"</span> };
<span class="ty">bool</span>[]   flags = { <span class="kw">true</span>, <span class="kw">false</span>, <span class="kw">true</span> };

<span class="cm">// Accesso per indice:</span>
Console.<span class="fn">WriteLine</span>(voti[<span class="num">0</span>]);   <span class="cm">// 7 — primo elemento</span>
Console.<span class="fn">WriteLine</span>(voti[<span class="num">4</span>]);   <span class="cm">// 7 — ultimo elemento</span>
Console.<span class="fn">WriteLine</span>(voti[voti.Length - <span class="num">1</span>]); <span class="cm">// 7 — ultimo (generico)</span>

<span class="cm">// Modificare un elemento:</span>
voti[<span class="num">2</span>] = <span class="num">10</span>;  <span class="cm">// ora è [7, 8, 10, 9, 7]</span>

<span class="cm">// Lunghezza dell'array:</span>
Console.<span class="fn">WriteLine</span>(voti.Length);  <span class="cm">// 5</span></pre>

    <h4>Ciclo for su array</h4>
    <pre><span class="ty">string</span>[] frutti = { <span class="str">"Mela"</span>, <span class="str">"Banana"</span>, <span class="str">"Arancia"</span>, <span class="str">"Pera"</span> };

<span class="cm">// Scorrere con for (puoi modificare gli elementi):</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; frutti.Length; i++)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{i}: {frutti[i]}"</span>);

<span class="cm">// Scorrere al contrario:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = frutti.Length - <span class="num">1</span>; i &gt;= <span class="num">0</span>; i--)
    Console.<span class="fn">Write</span>(<span class="str">$"{frutti[i]} "</span>);

<span class="cm">// Calcolo somma e media:</span>
<span class="ty">int</span>[] punteggi = { <span class="num">85</span>, <span class="num">92</span>, <span class="num">78</span>, <span class="num">95</span>, <span class="num">88</span> };
<span class="ty">int</span> somma = <span class="num">0</span>;
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; punteggi.Length; i++) somma += punteggi[i];
Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma: {somma}  Media: {somma/(double)punteggi.Length:F1}"</span>);</pre>

    <h4>foreach — la forma più semplice</h4>
    <pre><span class="cm">// foreach è ideale quando non hai bisogno dell'indice:</span>
<span class="kw">foreach</span> (<span class="ty">string</span> frutto <span class="kw">in</span> frutti)
    Console.<span class="fn">WriteLine</span>(frutto);

<span class="cm">// Somma con foreach:</span>
<span class="ty">int</span> totale = <span class="num">0</span>;
<span class="kw">foreach</span> (<span class="ty">int</span> p <span class="kw">in</span> punteggi) totale += p;

<span class="cm">// ATTENZIONE: non puoi modificare gli elementi con foreach!</span>
<span class="kw">foreach</span> (<span class="ty">int</span> n <span class="kw">in</span> punteggi) {
    <span class="cm">// n = n * 2;  ← ERRORE! non si può modificare</span>
}
<span class="cm">// Per modificare, usa for con indice.</span></pre>
    <table>
      <tr><th></th><th>for</th><th>foreach</th></tr>
      <tr><td>Accesso indice</td><td>Sì</td><td>No</td></tr>
      <tr><td>Modifica elementi</td><td>Sì</td><td>No</td></tr>
      <tr><td>Leggibilità</td><td>Media</td><td>Alta</td></tr>
      <tr><td>Usalo per</td><td>Modifica, indice necessario</td><td>Solo lettura</td></tr>
    </table>

    <h4>Metodi della classe Array</h4>
    <pre><span class="ty">int</span>[] n = { <span class="num">5</span>, <span class="num">2</span>, <span class="num">8</span>, <span class="num">1</span>, <span class="num">9</span>, <span class="num">3</span> };

Array.<span class="fn">Sort</span>(n);                      <span class="cm">// ordina: [1, 2, 3, 5, 8, 9]</span>
Array.<span class="fn">Reverse</span>(n);                   <span class="cm">// inverte: [9, 8, 5, 3, 2, 1]</span>
<span class="ty">int</span> pos = Array.<span class="fn">IndexOf</span>(n, <span class="num">5</span>);     <span class="cm">// 2 — posizione del valore 5</span>
Array.<span class="fn">Clear</span>(n, <span class="num">0</span>, n.Length);       <span class="cm">// azzera tutti: [0,0,0,0,0,0]</span>

<span class="cm">// Copiare un array:</span>
<span class="ty">int</span>[] copia = (<span class="ty">int</span>[])n.<span class="fn">Clone</span>();   <span class="cm">// copia indipendente</span>
Array.<span class="fn">Copy</span>(n, copia, n.Length);    <span class="cm">// copia in array esistente</span>

<span class="cm">// Min, Max, Sum (con LINQ — using System.Linq):</span>
Console.<span class="fn">WriteLine</span>(n.<span class="fn">Min</span>());  <span class="cm">// 1</span>
Console.<span class="fn">WriteLine</span>(n.<span class="fn">Max</span>());  <span class="cm">// 9</span>
Console.<span class="fn">WriteLine</span>(n.<span class="fn">Sum</span>());  <span class="cm">// 28</span></pre>

    <h4>Array 2D (griglia)</h4>
    <pre><span class="cm">// Matrice 3 righe × 4 colonne:</span>
<span class="ty">int</span>[,] griglia = {
    { <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span> },
    { <span class="num">5</span>, <span class="num">6</span>, <span class="num">7</span>, <span class="num">8</span> },
    { <span class="num">9</span>,<span class="num">10</span>,<span class="num">11</span>,<span class="num">12</span> }
};

Console.<span class="fn">WriteLine</span>(griglia[<span class="num">1</span>, <span class="num">2</span>]);    <span class="cm">// 7 — riga 1, colonna 2</span>
Console.<span class="fn">WriteLine</span>(griglia.<span class="fn">GetLength</span>(<span class="num">0</span>)); <span class="cm">// 3 — numero righe</span>
Console.<span class="fn">WriteLine</span>(griglia.<span class="fn">GetLength</span>(<span class="num">1</span>)); <span class="cm">// 4 — numero colonne</span>

<span class="cm">// Scorrere con cicli annidati:</span>
<span class="kw">for</span> (<span class="ty">int</span> r = <span class="num">0</span>; r &lt; griglia.<span class="fn">GetLength</span>(<span class="num">0</span>); r++) {
    <span class="kw">for</span> (<span class="ty">int</span> c = <span class="num">0</span>; c &lt; griglia.<span class="fn">GetLength</span>(<span class="num">1</span>); c++)
        Console.<span class="fn">Write</span>(<span class="str">$"{griglia[r,c],4}"</span>);
    Console.<span class="fn">WriteLine</span>();
}</pre>

    <h4>Progetto — Gestione voti classe</h4>
    <pre><span class="ty">string</span>[] studenti = { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span>, <span class="str">"Luca"</span>, <span class="str">"Anna"</span>, <span class="str">"Paolo"</span> };
<span class="ty">int</span>[]    voti2    = <span class="kw">new</span> <span class="ty">int</span>[studenti.Length];

<span class="cm">// Inserimento voti:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; studenti.Length; i++) {
    <span class="kw">while</span> (<span class="kw">true</span>) {
        Console.<span class="fn">Write</span>(<span class="str">$"Voto di {studenti[i]}: "</span>);
        <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out</span> voti2[i]) &amp;&amp; voti2[i] &gt;= <span class="num">0</span> &amp;&amp; voti2[i] &lt;= <span class="num">10</span>) <span class="kw">break</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">"Voto non valido (0-10)!"</span>);
    }
}

<span class="cm">// Statistiche:</span>
<span class="ty">int</span> sommaV = <span class="num">0</span>, maxV = voti2[<span class="num">0</span>], minV = voti2[<span class="num">0</span>];
<span class="ty">int</span> idxMax = <span class="num">0</span>, idxMin = <span class="num">0</span>;
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; voti2.Length; i++) {
    sommaV += voti2[i];
    <span class="kw">if</span> (voti2[i] &gt; maxV) { maxV = voti2[i]; idxMax = i; }
    <span class="kw">if</span> (voti2[i] &lt; minV) { minV = voti2[i]; idxMin = i; }
}

Console.<span class="fn">WriteLine</span>(<span class="str">$"\nMedia: {sommaV/(double)voti2.Length:F2}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Migliore: {studenti[idxMax]} ({maxV})"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Peggiore: {studenti[idxMin]} ({minV})"</span>);
<span class="kw">foreach</span> (<span class="ty">int</span> v <span class="kw">in</span> voti2) <span class="kw">if</span> (v &lt; <span class="num">6</span>) Console.<span class="fn">WriteLine</span>(<span class="str">$"{studenti[Array.IndexOf(voti2,v)]} insufficiente"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. IndexOutOfRangeException — indice fuori dai limiti:</span>
<span class="ty">int</span>[] arr = { <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span> };
<span class="cm">// arr[3];  ← CRASH! Indici validi: 0, 1, 2</span>
<span class="cm">// arr[-1]; ← CRASH! Gli indici non possono essere negativi</span>

<span class="cm">// 2. Array non inizializzato:</span>
<span class="ty">int</span>[] arr2;
<span class="cm">// Console.WriteLine(arr2[0]);  ← ERRORE! arr2 non è stato creato</span>
<span class="ty">int</span>[] arr3 = <span class="kw">new</span> <span class="ty">int</span>[<span class="num">3</span>];  <span class="cm">// OK</span>

<span class="cm">// 3. Confondere Length con l'ultimo indice:</span>
<span class="cm">// arr[arr.Length]     ← CRASH! Length=3, ultimo indice=2</span>
<span class="cm">// arr[arr.Length-1]   ← OK! Ultimo elemento</span>

<span class="cm">// 4. Copia per riferimento (non per valore!):</span>
<span class="ty">int</span>[] orig = { <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span> };
<span class="ty">int</span>[] copia2 = orig;   <span class="cm">// NON è una copia! Puntano allo stesso array</span>
copia2[<span class="num">0</span>] = <span class="num">99</span>;        <span class="cm">// modifica anche orig!</span>
<span class="ty">int</span>[] copiavera = (<span class="ty">int</span>[])orig.<span class="fn">Clone</span>();  <span class="cm">// copia vera</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea array di 5 numeri inseriti dall'utente, poi stampali</span>
<span class="cm">// 2. Trova il valore massimo in un array</span>
<span class="cm">// 3. Conta quanti elementi sono maggiori di 50</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Inverti un array senza usare Array.Reverse</span>
<span class="cm">// 5. Verifica se un array è palindromo (uguale letto al contrario)</span>
<span class="cm">// 6. Calcola media e mostra chi è sopra/sotto la media</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Ordina un array con bubble sort</span>
<span class="cm">// 8. Merge di due array ordinati in uno ordinato</span>
<span class="cm">// 9. Gestisci una rubrica con nomi e numeri in due array paralleli</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
<span class="ty">int</span>[] a1 = <span class="kw">new</span> <span class="ty">int</span>[<span class="num">5</span>];
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;<span class="num">5</span>;i++){Console.<span class="fn">Write</span>(<span class="str">$"Numero {i+1}: "</span>);<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(),<span class="kw">out</span> a1[i]);}
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a1) Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>);

<span class="cm">// --- 2. ---</span>
<span class="ty">int</span>[] a2={<span class="num">3</span>,<span class="num">7</span>,<span class="num">1</span>,<span class="num">9</span>,<span class="num">4</span>}; <span class="ty">int</span> max2=a2[<span class="num">0</span>];
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a2) <span class="kw">if</span>(n&gt;max2) max2=n;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Max: {max2}"</span>);

<span class="cm">// --- 3. ---</span>
<span class="ty">int</span>[] a3={<span class="num">10</span>,<span class="num">60</span>,<span class="num">45</span>,<span class="num">80</span>,<span class="num">30</span>,<span class="num">70</span>}; <span class="ty">int</span> cnt3=<span class="num">0</span>;
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a3) <span class="kw">if</span>(n&gt;<span class="num">50</span>) cnt3++;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Maggiori di 50: {cnt3}"</span>);

<span class="cm">// --- 4. Inversione ---</span>
<span class="ty">int</span>[] a4={<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>};
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;a4.Length/<span class="num">2</span>;i++){<span class="ty">int</span> tmp=a4[i];a4[i]=a4[a4.Length-<span class="num">1</span>-i];a4[a4.Length-<span class="num">1</span>-i]=tmp;}
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a4) Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>);

<span class="cm">// --- 5. Palindromo ---</span>
<span class="ty">int</span>[] a5={<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">2</span>,<span class="num">1</span>}; <span class="ty">bool</span> pali=<span class="kw">true</span>;
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;a5.Length/<span class="num">2</span>;i++) <span class="kw">if</span>(a5[i]!=a5[a5.Length-<span class="num">1</span>-i]){pali=<span class="kw">false</span>;<span class="kw">break</span>;}
Console.<span class="fn">WriteLine</span>(pali?<span class="str">"Palindromo"</span>:<span class="str">"Non palindromo"</span>);

<span class="cm">// --- 6. Media e sopra/sotto ---</span>
<span class="ty">int</span>[] a6={<span class="num">6</span>,<span class="num">8</span>,<span class="num">5</span>,<span class="num">9</span>,<span class="num">7</span>}; <span class="ty">double</span> med6=<span class="num">0</span>;
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a6) med6+=n; med6/=a6.Length;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Media: {med6:F1}"</span>);
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;a6.Length;i++)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{a6[i]}: {(a6[i]>=med6?"sopra":"sotto")} la media"</span>);

<span class="cm">// --- 7. Bubble sort ---</span>
<span class="ty">int</span>[] a7={<span class="num">5</span>,<span class="num">3</span>,<span class="num">8</span>,<span class="num">1</span>,<span class="num">9</span>};
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;a7.Length-<span class="num">1</span>;i++)
    <span class="kw">for</span>(<span class="ty">int</span> j=<span class="num">0</span>;j&lt;a7.Length-<span class="num">1</span>-i;j++)
        <span class="kw">if</span>(a7[j]&gt;a7[j+<span class="num">1</span>]){<span class="ty">int</span> t=a7[j];a7[j]=a7[j+<span class="num">1</span>];a7[j+<span class="num">1</span>]=t;}
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> a7) Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>);

<span class="cm">// --- 8. Merge ---</span>
<span class="ty">int</span>[] x8={<span class="num">1</span>,<span class="num">3</span>,<span class="num">5</span>}, y8={<span class="num">2</span>,<span class="num">4</span>,<span class="num">6</span>}, m8=<span class="kw">new</span> <span class="ty">int</span>[<span class="num">6</span>];
<span class="ty">int</span> ia=<span class="num">0</span>,ib=<span class="num">0</span>,ic=<span class="num">0</span>;
<span class="kw">while</span>(ia&lt;x8.Length&amp;&amp;ib&lt;y8.Length) m8[ic++]=(x8[ia]&lt;=y8[ib])?x8[ia++]:y8[ib++];
<span class="kw">while</span>(ia&lt;x8.Length) m8[ic++]=x8[ia++];
<span class="kw">while</span>(ib&lt;y8.Length) m8[ic++]=y8[ib++];
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> m8) Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>);

<span class="cm">// --- 9. Rubrica ---</span>
<span class="ty">string</span>[] nRub=<span class="kw">new</span> <span class="ty">string</span>[<span class="num">5</span>]; <span class="ty">string</span>[] tRub=<span class="kw">new</span> <span class="ty">string</span>[<span class="num">5</span>]; <span class="ty">int</span> cnt9=<span class="num">0</span>;
<span class="kw">while</span>(cnt9&lt;<span class="num">5</span>){Console.<span class="fn">Write</span>(<span class="str">"Nome (fine per uscire): "</span>);<span class="ty">string</span> nn=Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span>(nn.<span class="fn">ToLower</span>()==<span class="str">"fine"</span>)<span class="kw">break</span>;
    Console.<span class="fn">Write</span>(<span class="str">"Tel: "</span>); nRub[cnt9]=nn; tRub[cnt9]=Console.<span class="fn">ReadLine</span>(); cnt9++;}
<span class="kw">for</span>(<span class="ty">int</span> i=<span class="num">0</span>;i&lt;cnt9;i++) Console.<span class="fn">WriteLine</span>(<span class="str">$"{nRub[i],-20} {tRub[i]}"</span>);</pre>

  </div>
</div>
      <!-- 9. List<T> -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>9. List&lt;T&gt;</h3><div class="topic-sub">Array dinamico, Add/Remove/Find/Sort/Clear, confronto con Array</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è una List?</h4>
    <pre><span class="cm">// Una List è come un array, ma la sua dimensione cambia dinamicamente.</span>
<span class="cm">// Puoi aggiungere e rimuovere elementi in qualsiasi momento.</span>

<span class="kw">using</span> System.Collections.Generic;

<span class="cm">// Creare una lista vuota:</span>
List&lt;<span class="ty">string</span>&gt; nomi = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();
List&lt;<span class="ty">int</span>&gt;    numeri = <span class="kw">new</span> List&lt;<span class="ty">int</span>&gt;();

<span class="cm">// Creare con valori iniziali:</span>
List&lt;<span class="ty">string</span>&gt; frutti = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt; { <span class="str">"Mela"</span>, <span class="str">"Banana"</span>, <span class="str">"Arancia"</span> };

<span class="cm">// Accesso come array:</span>
Console.<span class="fn">WriteLine</span>(frutti[<span class="num">0</span>]);    <span class="cm">// "Mela"</span>
Console.<span class="fn">WriteLine</span>(frutti.Count);  <span class="cm">// 3 — usa Count, non Length!</span></pre>

    <h4>Aggiungere elementi</h4>
    <pre>List&lt;<span class="ty">string</span>&gt; lista = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();

lista.<span class="fn">Add</span>(<span class="str">"Marco"</span>);         <span class="cm">// aggiunge in fondo → ["Marco"]</span>
lista.<span class="fn">Add</span>(<span class="str">"Giulia"</span>);        <span class="cm">// → ["Marco", "Giulia"]</span>
lista.<span class="fn">Add</span>(<span class="str">"Luca"</span>);          <span class="cm">// → ["Marco", "Giulia", "Luca"]</span>

lista.<span class="fn">Insert</span>(<span class="num">1</span>, <span class="str">"Anna"</span>);   <span class="cm">// inserisce in posizione 1</span>
<span class="cm">// → ["Marco", "Anna", "Giulia", "Luca"]</span>

<span class="cm">// Aggiungere più elementi da array o altra lista:</span>
<span class="ty">string</span>[] nuovi = { <span class="str">"Sara"</span>, <span class="str">"Paolo"</span> };
lista.<span class="fn">AddRange</span>(nuovi);
<span class="cm">// → ["Marco", "Anna", "Giulia", "Luca", "Sara", "Paolo"]</span></pre>

    <h4>Rimuovere elementi</h4>
    <pre>lista.<span class="fn">Remove</span>(<span class="str">"Marco"</span>);    <span class="cm">// rimuove la prima occorrenza del valore</span>
lista.<span class="fn">RemoveAt</span>(<span class="num">0</span>);        <span class="cm">// rimuove l'elemento all'indice 0</span>
lista.<span class="fn">RemoveRange</span>(<span class="num">0</span>, <span class="num">2</span>); <span class="cm">// rimuove 2 elementi a partire dall'indice 0</span>
lista.<span class="fn">Clear</span>();             <span class="cm">// svuota completamente</span></pre>

    <h4>Cercare e verificare</h4>
    <pre>List&lt;<span class="ty">int</span>&gt; numeri2 = <span class="kw">new</span>() { <span class="num">10</span>, <span class="num">25</span>, <span class="num">8</span>, <span class="num">42</span>, <span class="num">15</span>, <span class="num">3</span> };

<span class="ty">bool</span> c1 = numeri2.<span class="fn">Contains</span>(<span class="num">42</span>);           <span class="cm">// true</span>
<span class="ty">int</span>  c2 = numeri2.<span class="fn">IndexOf</span>(<span class="num">25</span>);            <span class="cm">// 1 — posizione</span>

<span class="cm">// Find — cerca con una condizione (lambda):</span>
<span class="ty">int</span> trovato = numeri2.<span class="fn">Find</span>(n =&gt; n &gt; <span class="num">20</span>);              <span class="cm">// 25 — primo che supera 20</span>
List&lt;<span class="ty">int</span>&gt; tutti = numeri2.<span class="fn">FindAll</span>(n =&gt; n &gt; <span class="num">10</span>);      <span class="cm">// [25, 42, 15]</span>

<span class="cm">// Trovare nell'indice:</span>
<span class="ty">int</span> idx = numeri2.<span class="fn">FindIndex</span>(n =&gt; n &gt; <span class="num">40</span>);            <span class="cm">// 3</span>

<span class="cm">// Verificare con Any/All (LINQ):</span>
<span class="ty">bool</span> qualcuno = numeri2.<span class="fn">Any</span>(n =&gt; n &gt; <span class="num">40</span>);   <span class="cm">// true</span>
<span class="ty">bool</span> tutti2   = numeri2.<span class="fn">All</span>(n =&gt; n &gt; <span class="num">0</span>);    <span class="cm">// true</span></pre>

    <h4>Ordinare e trasformare</h4>
    <pre>List&lt;<span class="ty">string</span>&gt; nomi2 = <span class="kw">new</span>() { <span class="str">"Zara"</span>, <span class="str">"Marco"</span>, <span class="str">"Anna"</span>, <span class="str">"Luca"</span> };

nomi2.<span class="fn">Sort</span>();             <span class="cm">// ordine alfabetico</span>
nomi2.<span class="fn">Reverse</span>();          <span class="cm">// inverte l'ordine</span>

<span class="cm">// Ordine personalizzato (con lambda):</span>
nomi2.<span class="fn">Sort</span>((a, b) =&gt; a.Length.<span class="fn">CompareTo</span>(b.Length));  <span class="cm">// per lunghezza</span>

<span class="cm">// Convertire in array:</span>
<span class="ty">string</span>[] arr = nomi2.<span class="fn">ToArray</span>();

<span class="cm">// ForEach — esegui azione su ogni elemento:</span>
nomi2.<span class="fn">ForEach</span>(n =&gt; Console.<span class="fn">WriteLine</span>(n));</pre>
    <table>
      <tr><th>Operazione</th><th>Array</th><th>List&lt;T&gt;</th></tr>
      <tr><td>Dimensione</td><td>Fissa</td><td>Dinamica</td></tr>
      <tr><td>Lunghezza</td><td>.Length</td><td>.Count</td></tr>
      <tr><td>Aggiungere</td><td>Non possibile</td><td>.Add()</td></tr>
      <tr><td>Rimuovere</td><td>Non possibile</td><td>.Remove()</td></tr>
      <tr><td>Ricerca</td><td>Array.IndexOf</td><td>.Find(), .Contains()</td></tr>
      <tr><td>Usalo per</td><td>Dimensione nota e fissa</td><td>Dimensione variabile</td></tr>
    </table>

    <h4>Progetto — Lista della spesa</h4>
    <pre>List&lt;<span class="ty">string</span>&gt; spesa = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();
<span class="ty">bool</span> esci = <span class="kw">false</span>;

<span class="kw">while</span> (!esci) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"\nLista spesa ({spesa.Count} elementi):"</span>);
    <span class="kw">if</span> (spesa.Count == <span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"  (vuota)"</span>);
    <span class="kw">else</span> <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; spesa.Count; i++)
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  {i+1}. {spesa[i]}"</span>);

    Console.<span class="fn">WriteLine</span>(<span class="str">"1.Aggiungi 2.Rimuovi 3.Cerca 4.Ordina 0.Esci"</span>);
    Console.<span class="fn">Write</span>(<span class="str">"Scelta: "</span>);
    <span class="kw">switch</span> (Console.<span class="fn">ReadLine</span>()) {
        <span class="kw">case</span> <span class="str">"1"</span>:
            Console.<span class="fn">Write</span>(<span class="str">"Articolo: "</span>); <span class="ty">string</span> art = Console.<span class="fn">ReadLine</span>();
            <span class="kw">if</span> (!<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(art)) { spesa.<span class="fn">Add</span>(art); Console.<span class="fn">WriteLine</span>(<span class="str">"Aggiunto!"</span>); }
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="str">"2"</span>:
            Console.<span class="fn">Write</span>(<span class="str">"Articolo da rimuovere: "</span>);
            <span class="ty">string</span> rm = Console.<span class="fn">ReadLine</span>();
            Console.<span class="fn">WriteLine</span>(spesa.<span class="fn">Remove</span>(rm) ? <span class="str">"Rimosso!"</span> : <span class="str">"Non trovato!"</span>);
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="str">"3"</span>:
            Console.<span class="fn">Write</span>(<span class="str">"Cerca: "</span>); <span class="ty">string</span> cerca = Console.<span class="fn">ReadLine</span>();
            Console.<span class="fn">WriteLine</span>(spesa.<span class="fn">Contains</span>(cerca) ? <span class="str">"Presente!"</span> : <span class="str">"Non presente"</span>);
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="str">"4"</span>: spesa.<span class="fn">Sort</span>(); Console.<span class="fn">WriteLine</span>(<span class="str">"Ordinata!"</span>); <span class="kw">break</span>;
        <span class="kw">case</span> <span class="str">"0"</span>: esci = <span class="kw">true</span>; <span class="kw">break</span>;
    }
}</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Usare Length invece di Count:</span>
<span class="cm">// lista.Length  ← ERRORE! Le List usano .Count</span>
<span class="cm">// lista.Count   ← OK</span>

<span class="cm">// 2. Modificare la lista mentre la si scorre con foreach:</span>
<span class="kw">foreach</span> (<span class="ty">string</span> s <span class="kw">in</span> lista) {
    <span class="cm">// lista.Remove(s);  ← CRASH! InvalidOperationException</span>
}
<span class="cm">// Soluzione: crea una lista da rimuovere poi rimuovi dopo:</span>
List&lt;<span class="ty">string</span>&gt; daRimuovere = lista.<span class="fn">FindAll</span>(s =&gt; s.Length &lt; <span class="num">4</span>);
<span class="kw">foreach</span> (<span class="ty">string</span> s <span class="kw">in</span> daRimuovere) lista.<span class="fn">Remove</span>(s);

<span class="cm">// 3. Accedere a indice fuori range:</span>
<span class="cm">// lista[lista.Count]   ← CRASH! Ultimo indice = Count-1</span>
<span class="cm">// lista[lista.Count-1] ← OK</span>

<span class="cm">// 4. Find restituisce il default se non trova nulla:</span>
<span class="ty">int</span> trovato2 = numeri2.<span class="fn">Find</span>(n =&gt; n &gt; <span class="num">1000</span>);  <span class="cm">// 0 (default di int) se non trovato!</span>
<span class="cm">// Usa FirstOrDefault e controlla il risultato.</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una lista di nomi, aggiungine 5, poi stampa in ordine alfabetico</span>
<span class="cm">// 2. Chiedi numeri all'utente finché non scrive "fine", poi mostra la somma</span>
<span class="cm">// 3. Rimuovi tutti i duplicati da una lista di interi</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Gestisci una lista di studenti con aggiunta e rimozione</span>
<span class="cm">// 5. Trova tutti i numeri pari in una lista e mettili in un'altra lista</span>
<span class="cm">// 6. Conta quante volte appare ogni lettera in una lista di stringhe</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Implementa uno stack (pila) usando List (Push, Pop, Peek)</span>
<span class="cm">// 8. Gestisci una lista di prodotti con nome e prezzo, ordina per prezzo</span>
<span class="cm">// 9. Simula una coda (queue): aggiungi in fondo, rimuovi dalla testa</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
List&lt;<span class="ty">string</span>&gt; l1=<span class="kw">new</span>(){<span class="str">"Zara"</span>,<span class="str">"Marco"</span>,<span class="str">"Anna"</span>,<span class="str">"Luca"</span>,<span class="str">"Bea"</span>};
l1.<span class="fn">Sort</span>(); l1.<span class="fn">ForEach</span>(n=&gt;Console.<span class="fn">WriteLine</span>(n));

<span class="cm">// --- 2. ---</span>
List&lt;<span class="ty">int</span>&gt; l2=<span class="kw">new</span>(); <span class="ty">string</span> inp;
<span class="kw">while</span>((inp=Console.<span class="fn">ReadLine</span>()).<span class="fn">ToLower</span>()!=<span class="str">"fine"</span>)
    <span class="kw">if</span>(<span class="ty">int</span>.<span class="fn">TryParse</span>(inp,<span class="kw">out int</span> n2)) l2.<span class="fn">Add</span>(n2);
<span class="ty">int</span> sum2=<span class="num">0</span>; l2.<span class="fn">ForEach</span>(n=&gt;{sum2+=n;});Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma: {sum2}"</span>);

<span class="cm">// --- 3. Rimuovi duplicati ---</span>
List&lt;<span class="ty">int</span>&gt; l3=<span class="kw">new</span>(){<span class="num">1</span>,<span class="num">2</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">1</span>,<span class="num">4</span>};
List&lt;<span class="ty">int</span>&gt; uniq=<span class="kw">new</span>();
<span class="kw">foreach</span>(<span class="ty">int</span> n <span class="kw">in</span> l3) <span class="kw">if</span>(!uniq.<span class="fn">Contains</span>(n)) uniq.<span class="fn">Add</span>(n);
uniq.<span class="fn">ForEach</span>(n=&gt;Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>));

<span class="cm">// --- 4. Studenti ---</span>
List&lt;<span class="ty">string</span>&gt; l4=<span class="kw">new</span>(); <span class="ty">string</span> cmd4;
<span class="kw">while</span>((cmd4=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>())!=<span class="str">"fine"</span>){
    <span class="kw">if</span>(cmd4.<span class="fn">StartsWith</span>(<span class="str">"+"</span>)) l4.<span class="fn">Add</span>(cmd4[<span class="num">1</span>..]);
    <span class="kw">else if</span>(cmd4.<span class="fn">StartsWith</span>(<span class="str">"-"</span>)) l4.<span class="fn">Remove</span>(cmd4[<span class="num">1</span>..]);
    l4.<span class="fn">ForEach</span>(s=&gt;Console.<span class="fn">Write</span>(<span class="str">$"{s} "</span>));Console.<span class="fn">WriteLine</span>();}

<span class="cm">// --- 5. Numeri pari ---</span>
List&lt;<span class="ty">int</span>&gt; l5=<span class="kw">new</span>(){<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>};
List&lt;<span class="ty">int</span>&gt; pari5=l5.<span class="fn">FindAll</span>(n=&gt;n%<span class="num">2</span>==<span class="num">0</span>);
pari5.<span class="fn">ForEach</span>(n=&gt;Console.<span class="fn">Write</span>(<span class="str">$"{n} "</span>));

<span class="cm">// --- 7. Stack con List ---</span>
List&lt;<span class="ty">int</span>&gt; stack=<span class="kw">new</span>();
stack.<span class="fn">Add</span>(<span class="num">1</span>); stack.<span class="fn">Add</span>(<span class="num">2</span>); stack.<span class="fn">Add</span>(<span class="num">3</span>);
<span class="kw">void</span> <span class="fn">Push</span>(<span class="ty">int</span> v){stack.<span class="fn">Add</span>(v);}
<span class="ty">int</span> <span class="fn">Pop</span>(){<span class="ty">int</span> v=stack[stack.Count-<span class="num">1</span>];stack.<span class="fn">RemoveAt</span>(stack.Count-<span class="num">1</span>);<span class="kw">return</span> v;}
<span class="ty">int</span> <span class="fn">Peek</span>()=&gt;stack[stack.Count-<span class="num">1</span>];
Console.<span class="fn">WriteLine</span>(<span class="str">$"Peek: {Peek()}  Pop: {Pop()}  Count: {stack.Count}"</span>);

<span class="cm">// --- 8. Prodotti per prezzo ---</span>
List&lt;(<span class="ty">string</span> nome, <span class="ty">decimal</span> prezzo)&gt; prods=<span class="kw">new</span>(){
    (<span class="str">"Pane"</span>,<span class="num">1.50m</span>),(<span class="str">"Latte"</span>,<span class="num">0.99m</span>),(<span class="str">"Pasta"</span>,<span class="num">1.20m</span>)};
prods.<span class="fn">Sort</span>((a,b)=&gt;a.prezzo.<span class="fn">CompareTo</span>(b.prezzo));
prods.<span class="fn">ForEach</span>(p=&gt;Console.<span class="fn">WriteLine</span>(<span class="str">$"{p.nome,-15} {p.prezzo:C}"</span>));

<span class="cm">// --- 9. Queue con List ---</span>
List&lt;<span class="ty">string</span>&gt; queue=<span class="kw">new</span>();
queue.<span class="fn">Add</span>(<span class="str">"primo"</span>); queue.<span class="fn">Add</span>(<span class="str">"secondo"</span>); queue.<span class="fn">Add</span>(<span class="str">"terzo"</span>);
<span class="ty">string</span> prossimo=queue[<span class="num">0</span>]; queue.<span class="fn">RemoveAt</span>(<span class="num">0</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Servito: {prossimo}  Rimasti: {queue.Count}"</span>);</pre>

  </div>
</div>
      <!-- 10. String — Metodi -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>10. String — Metodi Completi</h3><div class="topic-sub">Length, ToUpper, Trim, Replace, Split, Contains, Substring, Join, IsNullOrEmpty</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Le stringhe sono immutabili</h4>
    <pre><span class="cm">// In C# le stringhe NON possono essere modificate dopo la creazione.</span>
<span class="cm">// Ogni metodo restituisce una NUOVA stringa, non modifica quella originale!</span>

<span class="ty">string</span> s = <span class="str">"ciao mondo"</span>;
<span class="ty">string</span> upper = s.<span class="fn">ToUpper</span>();  <span class="cm">// "CIAO MONDO" — s rimane "ciao mondo"</span>
Console.<span class="fn">WriteLine</span>(s);         <span class="cm">// "ciao mondo" — INVARIATO!</span>
Console.<span class="fn">WriteLine</span>(upper);     <span class="cm">// "CIAO MONDO"</span>

<span class="cm">// Devi assegnare il risultato per usarlo:</span>
s = s.<span class="fn">ToUpper</span>();  <span class="cm">// ora s = "CIAO MONDO"</span></pre>

    <h4>Proprietà e metodi base</h4>
    <pre><span class="ty">string</span> testo = <span class="str">" Ciao Mondo! "</span>;

<span class="cm">// Lunghezza:</span>
Console.<span class="fn">WriteLine</span>(testo.Length);   <span class="cm">// 14 (spazi inclusi)</span>

<span class="cm">// Maiuscolo / minuscolo:</span>
Console.<span class="fn">WriteLine</span>(testo.<span class="fn">ToUpper</span>()); <span class="cm">// " CIAO MONDO! "</span>
Console.<span class="fn">WriteLine</span>(testo.<span class="fn">ToLower</span>()); <span class="cm">// " ciao mondo! "</span>

<span class="cm">// Rimuovere spazi:</span>
Console.<span class="fn">WriteLine</span>(testo.<span class="fn">Trim</span>());      <span class="cm">// "Ciao Mondo!" — rimuove da entrambi i lati</span>
Console.<span class="fn">WriteLine</span>(testo.<span class="fn">TrimStart</span>()); <span class="cm">// "Ciao Mondo! " — solo a sinistra</span>
Console.<span class="fn">WriteLine</span>(testo.<span class="fn">TrimEnd</span>());   <span class="cm">// " Ciao Mondo!" — solo a destra</span>

<span class="cm">// Accedere a singoli caratteri:</span>
Console.<span class="fn">WriteLine</span>(testo[<span class="num">1</span>]);          <span class="cm">// 'C'</span>
<span class="kw">foreach</span> (<span class="ty">char</span> c <span class="kw">in</span> testo) Console.<span class="fn">Write</span>(c);</pre>

    <h4>Cercare all'interno di una stringa</h4>
    <pre><span class="ty">string</span> frase = <span class="str">"Il cielo è blu, il mare è blu"</span>;

<span class="cm">// Verificare se contiene:</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">Contains</span>(<span class="str">"blu"</span>));       <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">Contains</span>(<span class="str">"verde"</span>));     <span class="cm">// false</span>

<span class="cm">// Verificare inizio e fine:</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">StartsWith</span>(<span class="str">"Il"</span>));      <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">EndsWith</span>(<span class="str">"blu"</span>));       <span class="cm">// true</span>

<span class="cm">// Trovare la posizione:</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">IndexOf</span>(<span class="str">"blu"</span>));        <span class="cm">// 13 — prima occorrenza</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">LastIndexOf</span>(<span class="str">"blu"</span>));    <span class="cm">// 29 — ultima occorrenza</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">IndexOf</span>(<span class="str">"verde"</span>));      <span class="cm">// -1 se non trovato</span>

<span class="cm">// Confronto case-insensitive:</span>
Console.<span class="fn">WriteLine</span>(frase.<span class="fn">Contains</span>(<span class="str">"BLU"</span>, StringComparison.OrdinalIgnoreCase));  <span class="cm">// true</span></pre>

    <h4>Estrarre parti di stringa</h4>
    <pre><span class="ty">string</span> s2 = <span class="str">"Programmazione C#"</span>;

<span class="cm">// Substring — estrae una parte:</span>
Console.<span class="fn">WriteLine</span>(s2.<span class="fn">Substring</span>(<span class="num">0</span>, <span class="num">14</span>));  <span class="cm">// "Programmazione"</span>
Console.<span class="fn">WriteLine</span>(s2.<span class="fn">Substring</span>(<span class="num">15</span>));     <span class="cm">// "C#" — dalla pos 15 alla fine</span>

<span class="cm">// Range (C# 8+) — sintassi più moderna:</span>
Console.<span class="fn">WriteLine</span>(s2[<span class="num">0</span>..<span class="num">14</span>]);   <span class="cm">// "Programmazione"</span>
Console.<span class="fn">WriteLine</span>(s2[<span class="num">15</span>..]);   <span class="cm">// "C#"</span>
Console.<span class="fn">WriteLine</span>(s2[^<span class="num">2</span>..]);   <span class="cm">// "C#" — ultimi 2 caratteri</span>

<span class="cm">// Primo e ultimo carattere:</span>
Console.<span class="fn">WriteLine</span>(s2[<span class="num">0</span>]);       <span class="cm">// 'P'</span>
Console.<span class="fn">WriteLine</span>(s2[^<span class="num">1</span>]);      <span class="cm">// '#' — ultimo</span></pre>

    <h4>Modificare stringhe</h4>
    <pre><span class="ty">string</span> s3 = <span class="str">"Ciao Mondo Ciao"</span>;

<span class="cm">// Replace — sostituisce tutte le occorrenze:</span>
Console.<span class="fn">WriteLine</span>(s3.<span class="fn">Replace</span>(<span class="str">"Ciao"</span>, <span class="str">"Addio"</span>));  <span class="cm">// "Addio Mondo Addio"</span>
Console.<span class="fn">WriteLine</span>(s3.<span class="fn">Replace</span>(<span class="str">" "</span>, <span class="str">"_"</span>));          <span class="cm">// "Ciao_Mondo_Ciao"</span>

<span class="cm">// PadLeft / PadRight — aggiunge caratteri per raggiungere una lunghezza:</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"42"</span>.<span class="fn">PadLeft</span>(<span class="num">6</span>));           <span class="cm">// "    42" — riempie con spazi a sinistra</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"42"</span>.<span class="fn">PadLeft</span>(<span class="num">6</span>, <span class="str">'0'</span>));      <span class="cm">// "000042" — riempie con 0</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao"</span>.<span class="fn">PadRight</span>(<span class="num">10</span>, <span class="str">'.'</span>));  <span class="cm">// "Ciao......" </span></pre>

    <h4>Split e Join</h4>
    <pre><span class="cm">// Split — divide una stringa in un array di parti:</span>
<span class="ty">string</span> csv = <span class="str">"Marco,Giulia,Luca,Anna"</span>;
<span class="ty">string</span>[] parti = csv.<span class="fn">Split</span>(<span class="str">','</span>);
<span class="cm">// ["Marco", "Giulia", "Luca", "Anna"]</span>
<span class="kw">foreach</span> (<span class="ty">string</span> p <span class="kw">in</span> parti) Console.<span class="fn">WriteLine</span>(p);

<span class="cm">// Split su più separatori:</span>
<span class="ty">string</span> frase2 = <span class="str">"uno; due, tre. quattro"</span>;
<span class="ty">string</span>[] parole = frase2.<span class="fn">Split</span>(<span class="kw">new</span> <span class="ty">char</span>[] { <span class="str">';'</span>, <span class="str">','</span>, <span class="str">'.'</span>, <span class="str">' '</span> },
    StringSplitOptions.RemoveEmptyEntries);

<span class="cm">// Join — unisce un array in una stringa:</span>
<span class="ty">string</span>[] nomi3 = { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span>, <span class="str">"Luca"</span> };
Console.<span class="fn">WriteLine</span>(<span class="ty">string</span>.<span class="fn">Join</span>(<span class="str">", "</span>, nomi3));   <span class="cm">// "Marco, Giulia, Luca"</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">string</span>.<span class="fn">Join</span>(<span class="str">" | "</span>, nomi3)); <span class="cm">// "Marco | Giulia | Luca"</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">string</span>.<span class="fn">Join</span>(<span class="str">""</span>, nomi3));     <span class="cm">// "MarcoGiuliaLuca"</span></pre>

    <h4>Metodi utili vari</h4>
    <pre><span class="cm">// Verificare null o vuoto:</span>
<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(<span class="str">""</span>);        <span class="cm">// true</span>
<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(<span class="kw">null</span>);      <span class="cm">// true</span>
<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(<span class="str">"ciao"</span>);   <span class="cm">// false</span>
<span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(<span class="str">"   "</span>); <span class="cm">// true — solo spazi conta come vuoto</span>

<span class="cm">// Ripetere una stringa:</span>
<span class="ty">string</span> linea = <span class="kw">new</span> <span class="ty">string</span>(<span class="str">'-'</span>, <span class="num">20</span>);  <span class="cm">// "--------------------"</span>
<span class="ty">string</span> stelle = <span class="kw">new</span> <span class="ty">string</span>(<span class="str">'*'</span>, <span class="num">5</span>);   <span class="cm">// "*****"</span>

<span class="cm">// Capitalizzare prima lettera:</span>
<span class="ty">string</span> nome4 = <span class="str">"marco"</span>;
<span class="ty">string</span> cap = <span class="ty">char</span>.<span class="fn">ToUpper</span>(nome4[<span class="num">0</span>]) + nome4[<span class="num">1</span>..].ToLower();  <span class="cm">// "Marco"</span>

<span class="cm">// Confronto stringhe:</span>
<span class="ty">string</span>.<span class="fn">Compare</span>(<span class="str">"abc"</span>, <span class="str">"ABC"</span>, ignoreCase: <span class="kw">true</span>);  <span class="cm">// 0 (uguale)</span>
<span class="str">"abc"</span>.<span class="fn">Equals</span>(<span class="str">"ABC"</span>, StringComparison.OrdinalIgnoreCase);  <span class="cm">// true</span></pre>
    <table>
      <tr><th>Metodo</th><th>Cosa fa</th><th>Esempio</th></tr>
      <tr><td>.Length</td><td>Numero di caratteri</td><td>"Ciao".Length → 4</td></tr>
      <tr><td>.ToUpper()</td><td>Tutto maiuscolo</td><td>"ciao" → "CIAO"</td></tr>
      <tr><td>.Trim()</td><td>Rimuove spazi bordi</td><td>" ciao " → "ciao"</td></tr>
      <tr><td>.Replace()</td><td>Sostituisce testo</td><td>"a b".Replace(" ","_") → "a_b"</td></tr>
      <tr><td>.Contains()</td><td>Verifica presenza</td><td>"ciao".Contains("ia") → true</td></tr>
      <tr><td>.Split()</td><td>Divide in array</td><td>"a,b".Split(',') → ["a","b"]</td></tr>
      <tr><td>.Substring()</td><td>Estrae parte</td><td>"ciao".Substring(1,2) → "ia"</td></tr>
      <tr><td>string.Join()</td><td>Unisce array</td><td>Join(",",["a","b"]) → "a,b"</td></tr>
      <tr><td>IsNullOrWhiteSpace()</td><td>Controlla se vuoto</td><td>"  " → true</td></tr>
    </table>
    <div class="tip">Le stringhe sono immutabili — ogni metodo crea una nuova stringa. Per molte concatenazioni in un ciclo usa StringBuilder (topic avanzato).</div>

    <h4>Progetto — Analizzatore di testo</h4>
    <pre>Console.<span class="fn">WriteLine</span>(<span class="str">"Inserisci una frase:"</span>);
<span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">""</span>;

<span class="ty">string</span>[] parole4 = input.<span class="fn">Trim</span>().<span class="fn">Split</span>(<span class="str">' '</span>, StringSplitOptions.RemoveEmptyEntries);
<span class="ty">int</span> vocali = <span class="num">0</span>, consonanti = <span class="num">0</span>;
<span class="kw">foreach</span> (<span class="ty">char</span> c <span class="kw">in</span> input.<span class="fn">ToLower</span>())
    <span class="kw">if</span> (<span class="str">"aeiou"</span>.<span class="fn">Contains</span>(c)) vocali++;
    <span class="kw">else if</span> (<span class="ty">char</span>.<span class="fn">IsLetter</span>(c)) consonanti++;

Console.<span class="fn">WriteLine</span>(<span class="str">$"Caratteri: {input.Length}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Parole:    {parole4.Length}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Vocali:    {vocali}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Consonanti:{consonanti}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Maiuscolo: {input.ToUpper()}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Invertita: {new string(input.Reverse().ToArray())}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Parole ordinate: {string.Join(", ", parole4.OrderBy(p => p))}"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Non assegnare il risultato dei metodi stringa:</span>
<span class="ty">string</span> nome5 = <span class="str">"marco"</span>;
nome5.<span class="fn">ToUpper</span>();  <span class="cm">// ← non fa nulla! il risultato viene scartato</span>
nome5 = nome5.<span class="fn">ToUpper</span>();  <span class="cm">// OK</span>

<span class="cm">// 2. Confronto con == è case-sensitive:</span>
<span class="ty">string</span> input2 = <span class="str">"Marco"</span>;
<span class="kw">if</span> (input2 == <span class="str">"marco"</span>)  <span class="cm">// false!</span>
<span class="kw">if</span> (input2.<span class="fn">ToLower</span>() == <span class="str">"marco"</span>)  <span class="cm">// true — soluzione</span>

<span class="cm">// 3. NullReferenceException su stringa null:</span>
<span class="ty">string</span> s4 = <span class="kw">null</span>;
<span class="cm">// s4.ToUpper();  ← CRASH!</span>
<span class="kw">if</span> (!<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(s4)) s4.<span class="fn">ToUpper</span>();  <span class="cm">// sicuro</span>

<span class="cm">// 4. IndexOf restituisce -1 se non trovato:</span>
<span class="ty">int</span> pos4 = <span class="str">"ciao"</span>.<span class="fn">IndexOf</span>(<span class="str">"xyz"</span>);  <span class="cm">// -1</span>
<span class="cm">// Non usare il risultato come indice senza controllare!</span>
<span class="kw">if</span> (pos4 >= <span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Trovato"</span>);</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Chiedi una frase e stampa quante parole contiene</span>
<span class="cm">// 2. Inverti una stringa inserita dall'utente</span>
<span class="cm">// 3. Verifica se una parola è palindroma (es. "kayak")</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Conta le vocali e le consonanti in una frase</span>
<span class="cm">// 5. Converti snake_case in CamelCase (es. "ciao_mondo" → "CiaoMondo")</span>
<span class="cm">// 6. Trova la parola più lunga in una frase</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Verifica se una frase è un anagramma di un'altra</span>
<span class="cm">// 8. Censurata: sostituisce le parolacce con ***</span>
<span class="cm">// 9. Formatta un nome completo: "marco rossi" → "Rossi, Marco"</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Frase: "</span>); <span class="ty">string</span> f1=Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">WriteLine</span>(<span class="str">$"Parole: {f1.Trim().Split(' ',StringSplitOptions.RemoveEmptyEntries).Length}"</span>);

<span class="cm">// --- 2. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Testo: "</span>); <span class="ty">string</span> f2=Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(f2.<span class="fn">Reverse</span>().<span class="fn">ToArray</span>()));

<span class="cm">// --- 3. Palindromo ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Parola: "</span>); <span class="ty">string</span> f3=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>();
<span class="ty">string</span> rev3=<span class="kw">new</span> <span class="ty">string</span>(f3.<span class="fn">Reverse</span>().<span class="fn">ToArray</span>());
Console.<span class="fn">WriteLine</span>(f3==rev3?<span class="str">"Palindromo!"</span>:<span class="str">"Non palindromo"</span>);

<span class="cm">// --- 4. Vocali e consonanti ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Frase: "</span>); <span class="ty">string</span> f4=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>();
<span class="ty">int</span> v4=<span class="num">0</span>,c4=<span class="num">0</span>;
<span class="kw">foreach</span>(<span class="ty">char</span> ch <span class="kw">in</span> f4)
    <span class="kw">if</span>(<span class="str">"aeiou"</span>.<span class="fn">Contains</span>(ch)) v4++; <span class="kw">else if</span>(<span class="ty">char</span>.<span class="fn">IsLetter</span>(ch)) c4++;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Vocali: {v4}  Consonanti: {c4}"</span>);

<span class="cm">// --- 5. snake_case → CamelCase ---</span>
Console.<span class="fn">Write</span>(<span class="str">"snake_case: "</span>); <span class="ty">string</span> f5=Console.<span class="fn">ReadLine</span>();
<span class="ty">string</span>[] parti5=f5.<span class="fn">Split</span>(<span class="str">'_'</span>);
<span class="ty">string</span> camel=<span class="ty">string</span>.<span class="fn">Join</span>(<span class="str">""</span>, parti5.<span class="fn">Select</span>(p=&gt;<span class="ty">char</span>.<span class="fn">ToUpper</span>(p[<span class="num">0</span>])+p[<span class="num">1</span>..]));
Console.<span class="fn">WriteLine</span>(camel);

<span class="cm">// --- 6. Parola più lunga ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Frase: "</span>); <span class="ty">string</span> f6=Console.<span class="fn">ReadLine</span>();
<span class="ty">string</span>[] pw=f6.<span class="fn">Split</span>(<span class="str">' '</span>,StringSplitOptions.RemoveEmptyEntries);
<span class="ty">string</span> piu=pw[<span class="num">0</span>]; <span class="kw">foreach</span>(<span class="ty">string</span> p <span class="kw">in</span> pw) <span class="kw">if</span>(p.Length&gt;piu.Length) piu=p;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Parola più lunga: {piu} ({piu.Length} lettere)"</span>);

<span class="cm">// --- 7. Anagramma ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Parola 1: "</span>); <span class="ty">char</span>[] a7s=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>().<span class="fn">ToCharArray</span>();
Console.<span class="fn">Write</span>(<span class="str">"Parola 2: "</span>); <span class="ty">char</span>[] b7s=Console.<span class="fn">ReadLine</span>().<span class="fn">ToLower</span>().<span class="fn">ToCharArray</span>();
Array.<span class="fn">Sort</span>(a7s); Array.<span class="fn">Sort</span>(b7s);
Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(a7s)==<span class="kw">new</span> <span class="ty">string</span>(b7s)?<span class="str">"Anagramma!"</span>:<span class="str">"Non anagramma"</span>);

<span class="cm">// --- 8. Censura ---</span>
<span class="ty">string</span>[] bad={<span class="str">"stupido"</span>,<span class="str">"cattivo"</span>};
Console.<span class="fn">Write</span>(<span class="str">"Frase: "</span>); <span class="ty">string</span> f8=Console.<span class="fn">ReadLine</span>();
<span class="kw">foreach</span>(<span class="ty">string</span> b <span class="kw">in</span> bad)
    f8=f8.<span class="fn">Replace</span>(b,<span class="kw">new</span> <span class="ty">string</span>(<span class="str">'*'</span>,b.Length),StringComparison.OrdinalIgnoreCase);
Console.<span class="fn">WriteLine</span>(f8);

<span class="cm">// --- 9. Formatta nome ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome completo: "</span>); <span class="ty">string</span>[] parts=Console.<span class="fn">ReadLine</span>().<span class="fn">Trim</span>().<span class="fn">Split</span>(<span class="str">' '</span>);
<span class="kw">if</span>(parts.Length&gt;=<span class="num">2</span>){
    <span class="ty">string</span> nome9=<span class="ty">char</span>.<span class="fn">ToUpper</span>(parts[<span class="num">0</span>][<span class="num">0</span>])+parts[<span class="num">0</span>][<span class="num">1</span>..].<span class="fn">ToLower</span>();
    <span class="ty">string</span> cog9=<span class="ty">char</span>.<span class="fn">ToUpper</span>(parts[<span class="num">1</span>][<span class="num">0</span>])+parts[<span class="num">1</span>][<span class="num">1</span>..].<span class="fn">ToLower</span>();
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{cog9}, {nome9}"</span>);
}</pre>

  </div>
</div>
      <!-- 11. Enum -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>11. Enum</h3><div class="topic-sub">Enumerazioni, valori personalizzati, casting, switch, Flags</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è un Enum?</h4>
    <pre><span class="cm">// Un enum è un tipo speciale che rappresenta un insieme di costanti con nome.</span>
<span class="cm">// Rende il codice più leggibile: usa "Giorno.Lunedi" invece del numero 0!</span>

<span class="cm">// Definizione (fuori dalla classe o dentro):</span>
<span class="kw">enum</span> Giorno { Lunedi, Martedi, Mercoledi, Giovedi, Venerdi, Sabato, Domenica }
<span class="cm">//            0       1        2           3        4         5       6</span>
<span class="cm">// Per default i valori partono da 0 e aumentano di 1</span></pre>

    <h4>Uso base</h4>
    <pre>Giorno oggi = Giorno.Lunedi;
Console.<span class="fn">WriteLine</span>(oggi);          <span class="cm">// "Lunedi" — stampa il nome!</span>
Console.<span class="fn">WriteLine</span>((<span class="ty">int</span>)oggi);    <span class="cm">// 0 — cast a intero</span>

<span class="cm">// Confronto:</span>
<span class="kw">if</span> (oggi == Giorno.Lunedi)
    Console.<span class="fn">WriteLine</span>(<span class="str">"Inizio settimana!"</span>);

<span class="cm">// Tutti i valori di un enum:</span>
<span class="kw">foreach</span> (Giorno g <span class="kw">in</span> Enum.<span class="fn">GetValues</span>(<span class="kw">typeof</span>(Giorno)))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{(int)g}: {g}"</span>);
<span class="cm">// 0: Lunedi  1: Martedi  2: Mercoledi ...</span></pre>

    <h4>Valori personalizzati</h4>
    <pre><span class="cm">// Puoi assegnare qualsiasi valore intero:</span>
<span class="kw">enum</span> Stato { Inattivo = <span class="num">0</span>, Attivo = <span class="num">1</span>, Sospeso = <span class="num">2</span>, Eliminato = <span class="num">99</span> }

<span class="cm">// Utile per codici HTTP, codici errore ecc.:</span>
<span class="kw">enum</span> HttpStatus { OK = <span class="num">200</span>, NotFound = <span class="num">404</span>, ServerError = <span class="num">500</span> }

<span class="cm">// Casting tra int e enum:</span>
Stato s1 = (Stato)<span class="num">1</span>;         <span class="cm">// int → enum: Stato.Attivo</span>
<span class="ty">int</span>   n1 = (<span class="ty">int</span>)Stato.Sospeso; <span class="cm">// enum → int: 2</span>

HttpStatus risposta = HttpStatus.OK;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Codice: {(int)risposta}"</span>);  <span class="cm">// "Codice: 200"</span></pre>

    <h4>Switch su enum</h4>
    <pre><span class="cm">// Il caso d'uso più comune degli enum è con switch:</span>
Giorno oggi2 = Giorno.Sabato;

<span class="kw">switch</span> (oggi2) {
    <span class="kw">case</span> Giorno.Sabato:
    <span class="kw">case</span> Giorno.Domenica:
        Console.<span class="fn">WriteLine</span>(<span class="str">"Weekend! Riposo 🎉"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> Giorno.Venerdi:
        Console.<span class="fn">WriteLine</span>(<span class="str">"Quasi weekend!"</span>);
        <span class="kw">break</span>;
    <span class="kw">default</span>:
        Console.<span class="fn">WriteLine</span>(<span class="str">"Settimana lavorativa"</span>);
        <span class="kw">break</span>;
}

<span class="cm">// Switch expression (C# 8+) — più compatto:</span>
<span class="ty">string</span> tipo = oggi2 <span class="kw">switch</span> {
    Giorno.Sabato   => <span class="str">"Weekend"</span>,
    Giorno.Domenica => <span class="str">"Weekend"</span>,
    Giorno.Venerdi  => <span class="str">"Quasi weekend"</span>,
    _               => <span class="str">"Lavorativo"</span>
};
Console.<span class="fn">WriteLine</span>(tipo);</pre>

    <h4>Parse e TryParse</h4>
    <pre><span class="cm">// Convertire una stringa in enum:</span>
Giorno g1 = Enum.<span class="fn">Parse</span>&lt;Giorno&gt;(<span class="str">"Martedi"</span>);       <span class="cm">// Giorno.Martedi</span>
<span class="cm">// ATTENZIONE: lancia eccezione se la stringa non è valida!</span>

<span class="cm">// Versione sicura con TryParse:</span>
<span class="ty">bool</span> ok = Enum.<span class="fn">TryParse</span>(<span class="str">"Lunedi"</span>, <span class="kw">out</span> Giorno g2);
<span class="kw">if</span> (ok) Console.<span class="fn">WriteLine</span>(<span class="str">$"Convertito: {g2}"</span>);

<span class="ty">bool</span> fallito = Enum.<span class="fn">TryParse</span>(<span class="str">"Festivo"</span>, <span class="kw">out</span> Giorno g3);  <span class="cm">// false</span>

<span class="cm">// Case insensitive:</span>
Enum.<span class="fn">TryParse</span>(<span class="str">"lunedi"</span>, ignoreCase: <span class="kw">true</span>, <span class="kw">out</span> Giorno g4);  <span class="cm">// OK</span>

<span class="cm">// Verificare se un valore è definito nell'enum:</span>
Console.<span class="fn">WriteLine</span>(Enum.<span class="fn">IsDefined</span>(<span class="kw">typeof</span>(Giorno), <span class="str">"Lunedi"</span>));  <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(Enum.<span class="fn">IsDefined</span>(<span class="kw">typeof</span>(Giorno), <span class="num">10</span>));        <span class="cm">// false</span></pre>

    <h4>Confronto con stringhe — perché gli enum sono migliori</h4>
    <pre><span class="cm">// ❌ Senza enum — errori facili, non leggibile:</span>
<span class="ty">string</span> statoUtente = <span class="str">"attivo"</span>;
<span class="kw">if</span> (statoUtente == <span class="str">"Attivo"</span>)  <span class="cm">// case sensitive! Errore silenzioso</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"OK"</span>);

<span class="cm">// ✅ Con enum — sicuro, leggibile, il compilatore verifica:</span>
Stato statoUtente2 = Stato.Attivo;
<span class="kw">if</span> (statoUtente2 == Stato.Attivo)  <span class="cm">// il compilatore verifica!</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"OK"</span>);</pre>
    <table>
      <tr><th>Uso</th><th>Esempio pratico</th></tr>
      <tr><td>Giorni della settimana</td><td>enum Giorno { Lunedi, ..., Domenica }</td></tr>
      <tr><td>Stato di un oggetto</td><td>enum Stato { Attivo, Inattivo, Sospeso }</td></tr>
      <tr><td>Direzioni</td><td>enum Direzione { Nord, Sud, Est, Ovest }</td></tr>
      <tr><td>Codici HTTP</td><td>enum HttpStatus { OK=200, NotFound=404 }</td></tr>
      <tr><td>Livelli di log</td><td>enum LogLevel { Debug, Info, Warning, Error }</td></tr>
    </table>

    <h4>Progetto — Semaforo</h4>
    <pre><span class="kw">enum</span> Colore { Rosso, Giallo, Verde }

<span class="kw">static</span> <span class="ty">string</span> <span class="fn">IstruzioniSemaforo</span>(Colore c) => c <span class="kw">switch</span> {
    Colore.Rosso  => <span class="str">"STOP — fermati!"</span>,
    Colore.Giallo => <span class="str">"ATTENZIONE — rallenta!"</span>,
    Colore.Verde  => <span class="str">"VIA — puoi passare!"</span>,
    _             => <span class="str">"Segnale sconosciuto"</span>
};

<span class="cm">// Simulazione semaforo:</span>
Colore[] sequenza = { Colore.Rosso, Colore.Verde, Colore.Giallo, Colore.Rosso };
<span class="kw">foreach</span> (Colore c <span class="kw">in</span> sequenza) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"[{c}] {IstruzioniSemaforo(c)}"</span>);
    System.Threading.Thread.<span class="fn">Sleep</span>(<span class="num">1000</span>);
}</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Cast non valido — valore non definito nell'enum:</span>
Giorno g5 = (Giorno)<span class="num">99</span>;  <span class="cm">// NON lancia eccezione, ma il valore è "strano"!</span>
Console.<span class="fn">WriteLine</span>(g5);   <span class="cm">// stampa "99" — non è un nome valido</span>
<span class="cm">// Verifica sempre con Enum.IsDefined prima di fare cast!</span>

<span class="cm">// 2. Parse case-sensitive:</span>
<span class="cm">// Enum.Parse&lt;Giorno&gt;("lunedi")  ← ECCEZIONE! La L deve essere maiuscola</span>
<span class="cm">// Usa sempre TryParse con ignoreCase: true per input utente</span>

<span class="cm">// 3. Confronto sbagliato:</span>
<span class="cm">// if (oggi == 0)  ← ERRORE di compilazione! Non si confronta con int</span>
<span class="cm">// if (oggi == Giorno.Lunedi)  ← OK</span>
<span class="cm">// if ((int)oggi == 0)         ← OK se serve il numero</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea un enum Stagione (Primavera/Estate/Autunno/Inverno) e stampa la stagione corrente</span>
<span class="cm">// 2. Crea un enum Pianeta con i pianeti del sistema solare e stampa tutti i valori</span>
<span class="cm">// 3. Chiedi all'utente un numero (1-7) e stampa il giorno corrispondente</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Crea enum Priorita (Bassa=1, Media=5, Alta=10, Critica=100) e ordina una lista di task</span>
<span class="cm">// 5. Simula una macchina a stati: enum Stato { Spento, Acceso, InPausa } con transizioni</span>
<span class="cm">// 6. Crea un convertitore di direzioni bussola (N/S/E/O) usando enum e switch</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Implementa un gioco Carta-Sasso-Forbice con enum</span>
<span class="cm">// 8. Crea un sistema di permessi utente con enum Ruolo (Guest/User/Admin/SuperAdmin)</span>
<span class="cm">// 9. Simula un semaforo automatico con timer usando enum e ciclo</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Stagione ---</span>
<span class="kw">enum</span> Stagione { Primavera, Estate, Autunno, Inverno }
Stagione ora = Stagione.Estate;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Stagione corrente: {ora}"</span>);

<span class="cm">// --- 2. Pianeti ---</span>
<span class="kw">enum</span> Pianeta { Mercurio, Venere, Terra, Marte, Giove, Saturno, Urano, Nettuno }
<span class="kw">foreach</span> (Pianeta p <span class="kw">in</span> Enum.<span class="fn">GetValues</span>(<span class="kw">typeof</span>(Pianeta)))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{(int)p+1}. {p}"</span>);

<span class="cm">// --- 3. Numero → Giorno ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Numero (1-7): "</span>);
<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> num3);
<span class="kw">if</span> (num3 &gt;= <span class="num">1</span> &amp;&amp; num3 &lt;= <span class="num">7</span>)
    Console.<span class="fn">WriteLine</span>((Giorno)(num3 - <span class="num">1</span>));
<span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Numero non valido"</span>);

<span class="cm">// --- 4. Priorità task ---</span>
<span class="kw">enum</span> Priorita { Bassa=<span class="num">1</span>, Media=<span class="num">5</span>, Alta=<span class="num">10</span>, Critica=<span class="num">100</span> }
<span class="kw">var</span> task4 = <span class="kw">new</span> List&lt;(string nome, Priorita p)&gt; {
    (<span class="str">"Riunione"</span>, Priorita.Media), (<span class="str">"Bug critico"</span>, Priorita.Critica),
    (<span class="str">"Email"</span>, Priorita.Bassa), (<span class="str">"Deploy"</span>, Priorita.Alta) };
task4.<span class="fn">Sort</span>((a,b) =&gt; b.p.<span class="fn">CompareTo</span>(a.p));
task4.<span class="fn">ForEach</span>(t =&gt; Console.<span class="fn">WriteLine</span>(<span class="str">$"[{t.p}] {t.nome}"</span>));

<span class="cm">// --- 5. Macchina a stati ---</span>
<span class="kw">enum</span> StatoM { Spento, Acceso, InPausa }
StatoM stato5 = StatoM.Spento;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Stato: {stato5}"</span>);
stato5 = StatoM.Acceso;   Console.<span class="fn">WriteLine</span>(<span class="str">$"Stato: {stato5}"</span>);
stato5 = StatoM.InPausa;  Console.<span class="fn">WriteLine</span>(<span class="str">$"Stato: {stato5}"</span>);
stato5 = StatoM.Spento;   Console.<span class="fn">WriteLine</span>(<span class="str">$"Stato: {stato5}"</span>);

<span class="cm">// --- 6. Bussola ---</span>
<span class="kw">enum</span> Direzione { Nord, Sud, Est, Ovest }
Console.<span class="fn">Write</span>(<span class="str">"Direzione (N/S/E/O): "</span>);
<span class="ty">string</span> input6 = Console.<span class="fn">ReadLine</span>().<span class="fn">ToUpper</span>();
Direzione dir6 = input6 <span class="kw">switch</span> {
    <span class="str">"N"</span> => Direzione.Nord, <span class="str">"S"</span> => Direzione.Sud,
    <span class="str">"E"</span> => Direzione.Est,  <span class="str">"O"</span> => Direzione.Ovest,
    _ => <span class="kw">throw new</span> ArgumentException(<span class="str">"Direzione non valida"</span>)
};
Console.<span class="fn">WriteLine</span>(<span class="str">$"Vai verso: {dir6}"</span>);

<span class="cm">// --- 7. Carta-Sasso-Forbice ---</span>
<span class="kw">enum</span> Mossa { Sasso, Carta, Forbice }
Random r7 = <span class="kw">new</span> Random();
Mossa cpu = (Mossa)r7.<span class="fn">Next</span>(<span class="num">0</span>, <span class="num">3</span>);
Console.<span class="fn">Write</span>(<span class="str">"Sasso(0) Carta(1) Forbice(2): "</span>);
<span class="ty">int</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out int</span> scelta7);
Mossa giocatore7 = (Mossa)scelta7;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Tu: {giocatore7}  CPU: {cpu}"</span>);
<span class="ty">bool</span> vinci = (giocatore7 == Mossa.Sasso &amp;&amp; cpu == Mossa.Forbice) ||
             (giocatore7 == Mossa.Carta &amp;&amp; cpu == Mossa.Sasso) ||
             (giocatore7 == Mossa.Forbice &amp;&amp; cpu == Mossa.Carta);
Console.<span class="fn">WriteLine</span>(giocatore7 == cpu ? <span class="str">"Pareggio!"</span> : vinci ? <span class="str">"Hai vinto!"</span> : <span class="str">"Hai perso!"</span>);

<span class="cm">// --- 8. Ruoli ---</span>
<span class="kw">enum</span> Ruolo { Guest=<span class="num">0</span>, User=<span class="num">1</span>, Admin=<span class="num">2</span>, SuperAdmin=<span class="num">3</span> }
Ruolo ruolo8 = Ruolo.User;
<span class="ty">bool</span> puoScrivere = ruolo8 &gt;= Ruolo.User;
<span class="ty">bool</span> puoAmministrare = ruolo8 &gt;= Ruolo.Admin;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Scrivere: {puoScrivere}  Amministrare: {puoAmministrare}"</span>);

<span class="cm">// --- 9. Semaforo automatico ---</span>
<span class="kw">enum</span> Luce { Rosso, Verde, Giallo }
Luce luce9 = Luce.Rosso;
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">6</span>; i++) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Semaforo: {luce9}"</span>);
    luce9 = luce9 <span class="kw">switch</span> {
        Luce.Rosso  => Luce.Verde,
        Luce.Verde  => Luce.Giallo,
        Luce.Giallo => Luce.Rosso,
        _ => Luce.Rosso
    };
}</pre>

  </div>
</div>
      <!-- 12. Metodi -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>12. I Metodi</h3><div class="topic-sub">Parametri, return, overload, ref/out, params, ricorsione, expression-bodied</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è un metodo?</h4>
    <pre><span class="cm">// Un metodo è un blocco di codice riutilizzabile con un nome.</span>
<span class="cm">// Invece di ripetere lo stesso codice, lo metti in un metodo e lo chiami.</span>

<span class="cm">// Struttura:</span>
<span class="cm">// [modificatore] [tipo_ritorno] NomeMetodo([parametri]) { ... }</span>

<span class="cm">// void = non restituisce niente:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Saluta</span>() {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao!"</span>);
}
<span class="fn">Saluta</span>();  <span class="cm">// chiamata</span>

<span class="cm">// Con parametri:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Saluta</span>(<span class="ty">string</span> nome) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Ciao, {nome}!"</span>);
}
<span class="fn">Saluta</span>(<span class="str">"Marco"</span>);  <span class="cm">// "Ciao, Marco!"</span>
<span class="fn">Saluta</span>(<span class="str">"Giulia"</span>); <span class="cm">// "Ciao, Giulia!"</span></pre>

    <h4>return — restituire un valore</h4>
    <pre><span class="cm">// Il tipo di ritorno indica che tipo di valore il metodo restituisce:</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Somma</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) {
    <span class="kw">return</span> a + b;
}

<span class="kw">static</span> <span class="ty">double</span> <span class="fn">Media</span>(<span class="ty">double</span> x, <span class="ty">double</span> y) {
    <span class="kw">return</span> (x + y) / <span class="num">2</span>;
}

<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">EPari</span>(<span class="ty">int</span> n) {
    <span class="kw">return</span> n % <span class="num">2</span> == <span class="num">0</span>;
}

<span class="kw">static</span> <span class="ty">string</span> <span class="fn">Classifica</span>(<span class="ty">int</span> voto) {
    <span class="kw">if</span> (voto &gt;= <span class="num">9</span>) <span class="kw">return</span> <span class="str">"Ottimo"</span>;
    <span class="kw">if</span> (voto &gt;= <span class="num">7</span>) <span class="kw">return</span> <span class="str">"Buono"</span>;
    <span class="kw">if</span> (voto &gt;= <span class="num">6</span>) <span class="kw">return</span> <span class="str">"Sufficiente"</span>;
    <span class="kw">return</span> <span class="str">"Insufficiente"</span>;
}

<span class="cm">// Uso:</span>
<span class="ty">int</span> risultato = <span class="fn">Somma</span>(<span class="num">3</span>, <span class="num">4</span>);          <span class="cm">// 7</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">EPari</span>(<span class="num">10</span>));         <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Classifica</span>(<span class="num">8</span>));     <span class="cm">// "Buono"</span></pre>

    <h4>Expression-bodied — sintassi compatta con =></h4>
    <pre><span class="cm">// Se il metodo ha una sola espressione, puoi usare =>:</span>
<span class="kw">static</span> <span class="ty">int</span>    <span class="fn">Somma2</span>(<span class="ty">int</span> a, <span class="ty">int</span> b)  => a + b;
<span class="kw">static</span> <span class="ty">bool</span>   <span class="fn">EPari2</span>(<span class="ty">int</span> n)        => n % <span class="num">2</span> == <span class="num">0</span>;
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">Maiuscolo</span>(<span class="ty">string</span> s)  => s.<span class="fn">ToUpper</span>();
<span class="kw">static</span> <span class="ty">void</span>   <span class="fn">Stampa</span>(<span class="ty">string</span> s)     => Console.<span class="fn">WriteLine</span>(s);

<span class="cm">// Identico alla versione con { return ... }, solo più corta.</span></pre>

    <h4>Parametri opzionali e named</h4>
    <pre><span class="cm">// Parametri opzionali — hanno un valore di default:</span>
<span class="cm">// ATTENZIONE: i parametri opzionali devono essere ULTIMI!</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Messaggio</span>(<span class="ty">string</span> testo, <span class="ty">string</span> prefisso = <span class="str">"INFO"</span>, <span class="ty">bool</span> maiusc = <span class="kw">false</span>) {
    <span class="kw">if</span> (maiusc) testo = testo.<span class="fn">ToUpper</span>();
    Console.<span class="fn">WriteLine</span>(<span class="str">$"[{prefisso}] {testo}"</span>);
}

<span class="fn">Messaggio</span>(<span class="str">"Ciao"</span>);                          <span class="cm">// [INFO] Ciao</span>
<span class="fn">Messaggio</span>(<span class="str">"Attenzione"</span>, <span class="str">"WARN"</span>);           <span class="cm">// [WARN] Attenzione</span>
<span class="fn">Messaggio</span>(<span class="str">"Errore"</span>, <span class="str">"ERR"</span>, <span class="kw">true</span>);          <span class="cm">// [ERR] ERRORE</span>

<span class="cm">// Named parameters — specifica il nome del parametro:</span>
<span class="fn">Messaggio</span>(<span class="str">"Test"</span>, maiusc: <span class="kw">true</span>);            <span class="cm">// [INFO] TEST (salti prefisso)</span></pre>

    <h4>Overloading — stesso nome, tipi diversi</h4>
    <pre><span class="cm">// Puoi avere più metodi con lo stesso nome se i parametri sono diversi:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>(<span class="ty">int</span> n)     => Console.<span class="fn">WriteLine</span>(<span class="str">$"Intero: {n}"</span>);
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>(<span class="ty">double</span> d)  => Console.<span class="fn">WriteLine</span>(<span class="str">$"Decimale: {d}"</span>);
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>(<span class="ty">string</span> s)  => Console.<span class="fn">WriteLine</span>(<span class="str">$"Testo: {s}"</span>);
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) => Console.<span class="fn">WriteLine</span>(<span class="str">$"Due interi: {a}, {b}"</span>);

<span class="fn">Stampa</span>(<span class="num">42</span>);        <span class="cm">// "Intero: 42"</span>
<span class="fn">Stampa</span>(<span class="num">3.14</span>);      <span class="cm">// "Decimale: 3.14"</span>
<span class="fn">Stampa</span>(<span class="str">"Ciao"</span>);   <span class="cm">// "Testo: Ciao"</span>
<span class="fn">Stampa</span>(<span class="num">1</span>, <span class="num">2</span>);      <span class="cm">// "Due interi: 1, 2"</span>
<span class="cm">// Il compilatore sceglie il metodo giusto in base ai tipi degli argomenti</span></pre>

    <h4>ref e out — passare per riferimento</h4>
    <pre><span class="cm">// Per default, i tipi valore (int, double...) vengono COPIATI nel metodo.</span>
<span class="cm">// Con ref puoi modificare la variabile originale:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Raddoppia</span>(<span class="kw">ref</span> <span class="ty">int</span> n) { n *= <span class="num">2</span>; }

<span class="ty">int</span> x = <span class="num">5</span>;
<span class="fn">Raddoppia</span>(<span class="kw">ref</span> x);  <span class="cm">// x è 10 ora!</span>
Console.<span class="fn">WriteLine</span>(x);  <span class="cm">// 10</span>

<span class="cm">// out — restituisce più valori (la variabile non deve essere inizializzata):</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MinMax</span>(<span class="ty">int</span>[] arr, <span class="kw">out</span> <span class="ty">int</span> min, <span class="kw">out</span> <span class="ty">int</span> max) {
    min = arr[<span class="num">0</span>]; max = arr[<span class="num">0</span>];
    <span class="kw">foreach</span> (<span class="ty">int</span> n <span class="kw">in</span> arr) {
        <span class="kw">if</span> (n &lt; min) min = n;
        <span class="kw">if</span> (n &gt; max) max = n;
    }
}

<span class="ty">int</span>[] numeri = { <span class="num">3</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">2</span>, <span class="num">9</span> };
<span class="fn">MinMax</span>(numeri, <span class="kw">out int</span> minimo, <span class="kw">out int</span> massimo);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Min: {minimo}  Max: {massimo}"</span>);  <span class="cm">// Min: 1  Max: 9</span></pre>
    <table>
      <tr><th></th><th>Normale</th><th>ref</th><th>out</th></tr>
      <tr><td>Copia o riferimento</td><td>Copia</td><td>Riferimento</td><td>Riferimento</td></tr>
      <tr><td>Deve essere inizializzato</td><td>Sì</td><td>Sì</td><td>No</td></tr>
      <tr><td>Può leggere il valore dentro</td><td>Sì</td><td>Sì</td><td>No (deve assegnare)</td></tr>
      <tr><td>Uso tipico</td><td>Sempre</td><td>Modifica variabile</td><td>Più valori di ritorno</td></tr>
    </table>

    <h4>params — numero variabile di argomenti</h4>
    <pre><span class="cm">// params permette di passare quanti argomenti vuoi:</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Somma</span>(<span class="kw">params</span> <span class="ty">int</span>[] numeri) {
    <span class="ty">int</span> tot = <span class="num">0</span>;
    <span class="kw">foreach</span> (<span class="ty">int</span> n <span class="kw">in</span> numeri) tot += n;
    <span class="kw">return</span> tot;
}

Console.<span class="fn">WriteLine</span>(<span class="fn">Somma</span>(<span class="num">1</span>, <span class="num">2</span>));              <span class="cm">// 3</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Somma</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>));           <span class="cm">// 6</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Somma</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>));    <span class="cm">// 15</span>

<span class="cm">// Può anche ricevere un array:</span>
<span class="ty">int</span>[] arr = { <span class="num">10</span>, <span class="num">20</span>, <span class="num">30</span> };
Console.<span class="fn">WriteLine</span>(<span class="fn">Somma</span>(arr));              <span class="cm">// 60</span>

<span class="cm">// params deve essere l'ultimo parametro!</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Log</span>(<span class="ty">string</span> prefisso, <span class="kw">params</span> <span class="ty">string</span>[] messaggi) {
    <span class="kw">foreach</span> (<span class="ty">string</span> m <span class="kw">in</span> messaggi)
        Console.<span class="fn">WriteLine</span>(<span class="str">$"[{prefisso}] {m}"</span>);
}
<span class="fn">Log</span>(<span class="str">"INFO"</span>, <span class="str">"Avvio"</span>, <span class="str">"Connessione"</span>, <span class="str">"Pronto"</span>);</pre>

    <h4>Ricorsione</h4>
    <pre><span class="cm">// Un metodo ricorsivo si chiama da solo.</span>
<span class="cm">// OBBLIGATORIO: un caso base che ferma la ricorsione, altrimenti ciclo infinito!</span>

<span class="cm">// Fattoriale: 5! = 5×4×3×2×1 = 120</span>
<span class="kw">static</span> <span class="ty">long</span> <span class="fn">Fattoriale</span>(<span class="ty">int</span> n) {
    <span class="kw">if</span> (n &lt;= <span class="num">1</span>) <span class="kw">return</span> <span class="num">1</span>;          <span class="cm">// caso base</span>
    <span class="kw">return</span> n * <span class="fn">Fattoriale</span>(n - <span class="num">1</span>);  <span class="cm">// chiamata ricorsiva</span>
}
<span class="cm">// Fattoriale(5) → 5 × Fattoriale(4)</span>
<span class="cm">//                     → 4 × Fattoriale(3)</span>
<span class="cm">//                           → 3 × Fattoriale(2)</span>
<span class="cm">//                                 → 2 × Fattoriale(1)</span>
<span class="cm">//                                       → 1  (caso base)</span>

<span class="cm">// Fibonacci: 0, 1, 1, 2, 3, 5, 8, 13, ...</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Fibonacci</span>(<span class="ty">int</span> n) {
    <span class="kw">if</span> (n &lt;= <span class="num">1</span>) <span class="kw">return</span> n;
    <span class="kw">return</span> <span class="fn">Fibonacci</span>(n - <span class="num">1</span>) + <span class="fn">Fibonacci</span>(n - <span class="num">2</span>);
}

<span class="cm">// Potenza:</span>
<span class="kw">static</span> <span class="ty">long</span> <span class="fn">Potenza</span>(<span class="ty">long</span> base_, <span class="ty">int</span> exp) {
    <span class="kw">if</span> (exp == <span class="num">0</span>) <span class="kw">return</span> <span class="num">1</span>;
    <span class="kw">return</span> base_ * <span class="fn">Potenza</span>(base_, exp - <span class="num">1</span>);
}</pre>

    <h4>Progetto — Calcolatrice con metodi</h4>
    <pre><span class="kw">static</span> <span class="ty">double</span> <span class="fn">Somma</span>(<span class="ty">double</span> a, <span class="ty">double</span> b)    => a + b;
<span class="kw">static</span> <span class="ty">double</span> <span class="fn">Sottrai</span>(<span class="ty">double</span> a, <span class="ty">double</span> b)  => a - b;
<span class="kw">static</span> <span class="ty">double</span> <span class="fn">Moltiplica</span>(<span class="ty">double</span> a, <span class="ty">double</span> b) => a * b;
<span class="kw">static</span> <span class="ty">double</span> <span class="fn">Dividi</span>(<span class="ty">double</span> a, <span class="ty">double</span> b) {
    <span class="kw">if</span> (b == <span class="num">0</span>) { Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: divisione per zero!"</span>); <span class="kw">return</span> <span class="ty">double</span>.NaN; }
    <span class="kw">return</span> a / b;
}
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MostraRisultato</span>(<span class="ty">double</span> a, <span class="ty">string</span> op, <span class="ty">double</span> b, <span class="ty">double</span> ris) =>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{a} {op} {b} = {ris}"</span>);

<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"Primo numero: "</span>);
    <span class="kw">if</span> (!<span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> a)) <span class="kw">break</span>;
    Console.<span class="fn">Write</span>(<span class="str">"Operazione (+,-,*,/): "</span>);
    <span class="ty">string</span> op = Console.<span class="fn">ReadLine</span>();
    Console.<span class="fn">Write</span>(<span class="str">"Secondo numero: "</span>);
    <span class="kw">if</span> (!<span class="ty">double</span>.<span class="fn">TryParse</span>(Console.<span class="fn">ReadLine</span>(), <span class="kw">out double</span> b)) <span class="kw">break</span>;
    <span class="ty">double</span> ris = op <span class="kw">switch</span> {
        <span class="str">"+"</span> => <span class="fn">Somma</span>(a, b), <span class="str">"-"</span> => <span class="fn">Sottrai</span>(a, b),
        <span class="str">"*"</span> => <span class="fn">Moltiplica</span>(a, b), <span class="str">"/"</span> => <span class="fn">Dividi</span>(a, b),
        _ => <span class="ty">double</span>.NaN
    };
    <span class="fn">MostraRisultato</span>(a, op, b, ris);
}</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Dimenticare return:</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Somma</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) {
    <span class="ty">int</span> ris = a + b;
    <span class="cm">// return ris;  ← dimenticato! Errore di compilazione</span>
}

<span class="cm">// 2. Ricorsione senza caso base:</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Infinito</span>(<span class="ty">int</span> n) {
    <span class="kw">return</span> n * <span class="fn">Infinito</span>(n - <span class="num">1</span>);  <span class="cm">// ← StackOverflowException!</span>
    <span class="cm">// manca il caso base!</span>
}

<span class="cm">// 3. Parametri opzionali non ultimi:</span>
<span class="cm">// static void Test(string a = "x", int b)  ← ERRORE!</span>
<span class="cm">// static void Test(int b, string a = "x")  ← OK</span>

<span class="cm">// 4. ref senza la keyword alla chiamata:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Raddoppia</span>(<span class="kw">ref</span> <span class="ty">int</span> n) { n *= <span class="num">2</span>; }
<span class="ty">int</span> x = <span class="num">5</span>;
<span class="cm">// Raddoppia(x);       ← ERRORE! Manca ref</span>
<span class="cm">// Raddoppia(ref x);   ← OK</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Scrivi un metodo che riceve nome e cognome e restituisce "Cognome, Nome"</span>
<span class="cm">// 2. Scrivi un metodo che verifica se un numero è primo</span>
<span class="cm">// 3. Scrivi un metodo che calcola l'area di un cerchio dato il raggio</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Scrivi un metodo che conta le vocali in una stringa</span>
<span class="cm">// 5. Scrivi un metodo che inverte un array di interi</span>
<span class="cm">// 6. Usa out per restituire sia la somma che la media di un array</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Scrivi un metodo ricorsivo per la somma delle cifre di un numero</span>
<span class="cm">// 8. Scrivi un metodo con params che calcola il massimo tra N numeri</span>
<span class="cm">// 9. Scrivi un metodo che controlla se una stringa è palindroma (ricorsivo)</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">FormatNome</span>(<span class="ty">string</span> nome, <span class="ty">string</span> cognome) => <span class="str">$"{cognome}, {nome}"</span>;
Console.<span class="fn">WriteLine</span>(<span class="fn">FormatNome</span>(<span class="str">"Marco"</span>, <span class="str">"Rossi"</span>)); <span class="cm">// "Rossi, Marco"</span>

<span class="cm">// --- 2. ---</span>
<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">EPrimo</span>(<span class="ty">int</span> n) {
    <span class="kw">if</span> (n &lt; <span class="num">2</span>) <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">2</span>; i &lt;= Math.<span class="fn">Sqrt</span>(n); i++)
        <span class="kw">if</span> (n % i == <span class="num">0</span>) <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">return</span> <span class="kw">true</span>;
}

<span class="cm">// --- 3. ---</span>
<span class="kw">static</span> <span class="ty">double</span> <span class="fn">AreaCerchio</span>(<span class="ty">double</span> r) => Math.PI * r * r;

<span class="cm">// --- 4. ---</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">ContaVocali</span>(<span class="ty">string</span> s) {
    <span class="ty">int</span> cnt = <span class="num">0</span>;
    <span class="kw">foreach</span> (<span class="ty">char</span> c <span class="kw">in</span> s.<span class="fn">ToLower</span>()) <span class="kw">if</span> (<span class="str">"aeiou"</span>.<span class="fn">Contains</span>(c)) cnt++;
    <span class="kw">return</span> cnt;
}

<span class="cm">// --- 5. ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">InvertiArray</span>(<span class="ty">int</span>[] arr) {
    <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; arr.Length / <span class="num">2</span>; i++) {
        (<span class="ty">int</span> tmp) = arr[i]; arr[i] = arr[arr.Length-<span class="num">1</span>-i]; arr[arr.Length-<span class="num">1</span>-i] = tmp;
    }
}

<span class="cm">// --- 6. ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">SommaMedia</span>(<span class="ty">int</span>[] arr, <span class="kw">out int</span> somma, <span class="kw">out double</span> media) {
    somma = <span class="num">0</span>;
    <span class="kw">foreach</span> (<span class="ty">int</span> n <span class="kw">in</span> arr) somma += n;
    media = (<span class="ty">double</span>)somma / arr.Length;
}

<span class="cm">// --- 7. Somma cifre ricorsiva ---</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">SommaCifre</span>(<span class="ty">int</span> n) {
    <span class="kw">if</span> (n &lt; <span class="num">10</span>) <span class="kw">return</span> n;
    <span class="kw">return</span> n % <span class="num">10</span> + <span class="fn">SommaCifre</span>(n / <span class="num">10</span>);
}
Console.<span class="fn">WriteLine</span>(<span class="fn">SommaCifre</span>(<span class="num">1234</span>)); <span class="cm">// 10</span>

<span class="cm">// --- 8. Massimo con params ---</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Massimo</span>(<span class="kw">params</span> <span class="ty">int</span>[] nums) {
    <span class="ty">int</span> max = nums[<span class="num">0</span>];
    <span class="kw">foreach</span> (<span class="ty">int</span> n <span class="kw">in</span> nums) <span class="kw">if</span> (n &gt; max) max = n;
    <span class="kw">return</span> max;
}
Console.<span class="fn">WriteLine</span>(<span class="fn">Massimo</span>(<span class="num">3</span>, <span class="num">7</span>, <span class="num">1</span>, <span class="num">9</span>, <span class="num">4</span>)); <span class="cm">// 9</span>

<span class="cm">// --- 9. Palindromo ricorsivo ---</span>
<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">Palindromo</span>(<span class="ty">string</span> s) {
    <span class="kw">if</span> (s.Length &lt;= <span class="num">1</span>) <span class="kw">return</span> <span class="kw">true</span>;
    <span class="kw">if</span> (s[<span class="num">0</span>] != s[^<span class="num">1</span>]) <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">return</span> <span class="fn">Palindromo</span>(s[<span class="num">1</span>..^<span class="num">1</span>]);
}
Console.<span class="fn">WriteLine</span>(<span class="fn">Palindromo</span>(<span class="str">"kayak"</span>)); <span class="cm">// true</span></pre>

  </div>
</div>
      <!-- 13. Struct -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>13. Struct</h3><div class="topic-sub">Tipo valore, campi, costruttori, metodi, struct vs class</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è una struct?</h4>
    <pre><span class="cm">// Una struct è un tipo che raggruppa dati correlati.</span>
<span class="cm">// Simile a una classe, ma è un TIPO VALORE (copiata, non riferita).</span>
<span class="cm">// Ideale per dati semplici: coordinate, colori, punti, intervalli...</span>

<span class="kw">struct</span> Punto {
    <span class="kw">public</span> <span class="ty">double</span> X;
    <span class="kw">public</span> <span class="ty">double</span> Y;
}

Punto p1 = <span class="kw">new</span> Punto();  <span class="cm">// X=0, Y=0</span>
p1.X = <span class="num">3.0</span>;
p1.Y = <span class="num">4.0</span>;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Punto: ({p1.X}, {p1.Y})"</span>);</pre>

    <h4>Costruttori e metodi</h4>
    <pre><span class="kw">struct</span> Prodotto {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">double</span> Prezzo;
    <span class="kw">public</span> <span class="ty">int</span>    Quantita;

    <span class="cm">// Costruttore — inizializza i campi:</span>
    <span class="kw">public</span> <span class="fn">Prodotto</span>(<span class="ty">string</span> nome, <span class="ty">double</span> prezzo, <span class="ty">int</span> qty) {
        Nome = nome;
        Prezzo = prezzo;
        Quantita = qty;
    }

    <span class="cm">// Metodi — funzionano come nelle classi:</span>
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">ValoreTotale</span>() => Prezzo * Quantita;

    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">Descrivi</span>() =>
        <span class="str">$"{Nome}: €{Prezzo:F2} × {Quantita} = €{ValoreTotale():F2}"</span>;

    <span class="cm">// Override di ToString:</span>
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="fn">Descrivi</span>();
}

Prodotto pizza = <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Pizza"</span>,  <span class="num">8.50</span>, <span class="num">10</span>);
Prodotto pasta = <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Pasta"</span>,  <span class="num">1.20</span>,  <span class="num">5</span>);
Console.<span class="fn">WriteLine</span>(pizza.<span class="fn">Descrivi</span>());    <span class="cm">// Pizza: €8.50 × 10 = €85.00</span>
Console.<span class="fn">WriteLine</span>(pasta.<span class="fn">ValoreTotale</span>()); <span class="cm">// 6.0</span></pre>

    <h4>La differenza chiave: copia vs riferimento</h4>
    <pre><span class="cm">// STRUCT — copia indipendente:</span>
Prodotto orig = <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Mela"</span>, <span class="num">0.50</span>, <span class="num">3</span>);
Prodotto copia = orig;           <span class="cm">// copia INDIPENDENTE</span>
copia.Prezzo = <span class="num">1.00</span>;            <span class="cm">// modifica solo la copia!</span>
Console.<span class="fn">WriteLine</span>(orig.Prezzo);  <span class="cm">// 0.50 — orig NON cambia</span>
Console.<span class="fn">WriteLine</span>(copia.Prezzo); <span class="cm">// 1.00</span>

<span class="cm">// CLASS — riferimento condiviso (per confronto):</span>
<span class="cm">// Se Prodotto fosse una classe:</span>
<span class="cm">// Prodotto ref2 = orig;    // puntano allo STESSO oggetto</span>
<span class="cm">// ref2.Prezzo = 1.00;      // modifica anche orig!</span></pre>

    <table>
      <tr><th>Caratteristica</th><th>struct</th><th>class</th></tr>
      <tr><td>Tipo</td><td>Valore (Stack)</td><td>Riferimento (Heap)</td></tr>
      <tr><td>Copia</td><td>Indipendente</td><td>Condivisa (stesso oggetto)</td></tr>
      <tr><td>Ereditarietà</td><td>No (solo interfacce)</td><td>Sì</td></tr>
      <tr><td>null</td><td>Non può essere null</td><td>Può essere null</td></tr>
      <tr><td>Performance</td><td>Meglio per dati piccoli</td><td>Meglio per dati grandi</td></tr>
      <tr><td>Usalo per</td><td>Punti, colori, coordinate</td><td>Oggetti complessi con logica</td></tr>
    </table>

    <h4>Struct predefinite in C#</h4>
    <pre><span class="cm">// Molti tipi base di C# sono struct:</span>
<span class="cm">// int, double, bool, char, DateTime, TimeSpan, decimal...</span>

DateTime oggi = DateTime.Today;
Console.<span class="fn">WriteLine</span>(oggi);              <span class="cm">// data odierna</span>

<span class="cm">// Anche il tipo int è una struct (alias di System.Int32):</span>
<span class="ty">int</span> n = <span class="num">42</span>;
Console.<span class="fn">WriteLine</span>(n.<span class="fn">GetType</span>());       <span class="cm">// System.Int32</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">int</span>.MaxValue);      <span class="cm">// 2147483647</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">int</span>.MinValue);      <span class="cm">// -2147483648</span></pre>

    <h4>Progetto — Gestione magazzino</h4>
    <pre><span class="kw">struct</span> Articolo {
    <span class="kw">public</span> <span class="ty">string</span> Codice;
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">double</span> Prezzo;
    <span class="kw">public</span> <span class="ty">int</span>    Scorta;

    <span class="kw">public</span> <span class="fn">Articolo</span>(<span class="ty">string</span> cod, <span class="ty">string</span> nome, <span class="ty">double</span> prezzo, <span class="ty">int</span> scorta) {
        Codice = cod; Nome = nome; Prezzo = prezzo; Scorta = scorta;
    }
    <span class="kw">public</span> <span class="ty">bool</span>   <span class="fn">Disponibile</span>()    => Scorta &gt; <span class="num">0</span>;
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">ValoreMagazzino</span>() => Prezzo * Scorta;
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() =>
        <span class="str">$"[{Codice}] {Nome,-20} €{Prezzo,6:F2}  Scorta: {Scorta,4}  Valore: €{ValoreMagazzino():F2}"</span>;
}

Articolo[] magazzino = {
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"A001"</span>, <span class="str">"Pizza Margherita"</span>,  <span class="num">8.50</span>, <span class="num">50</span>),
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"A002"</span>, <span class="str">"Pasta al Pomodoro"</span>, <span class="num">6.00</span>,  <span class="num">0</span>),
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"A003"</span>, <span class="str">"Tiramisu"</span>,          <span class="num">4.50</span>, <span class="num">20</span>),
};

Console.<span class="fn">WriteLine</span>(<span class="str">"=== MAGAZZINO ==="</span>);
<span class="ty">double</span> totale = <span class="num">0</span>;
<span class="kw">foreach</span> (<span class="kw">var</span> a <span class="kw">in</span> magazzino) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{a}  {(a.Disponibile() ? "OK" : "ESAURITO")}"</span>);
    totale += a.<span class="fn">ValoreMagazzino</span>();
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nValore totale magazzino: €{totale:F2}"</span>);</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. La struct è copiata — modifiche nel metodo non si propagano:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">AumentaPrezzo</span>(Prodotto p) {
    p.Prezzo *= <span class="num">1.1</span>;  <span class="cm">// modifica solo la COPIA locale!</span>
}
Prodotto prod = <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Pizza"</span>, <span class="num">8.50</span>, <span class="num">5</span>);
<span class="fn">AumentaPrezzo</span>(prod);
Console.<span class="fn">WriteLine</span>(prod.Prezzo);  <span class="cm">// ancora 8.50! Non è cambiato</span>
<span class="cm">// Soluzione: usa ref</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">AumentaPrezzoRef</span>(<span class="kw">ref</span> Prodotto p) { p.Prezzo *= <span class="num">1.1</span>; }
<span class="fn">AumentaPrezzoRef</span>(<span class="kw">ref</span> prod);
Console.<span class="fn">WriteLine</span>(prod.Prezzo);  <span class="cm">// 9.35 — modificato!</span>

<span class="cm">// 2. Struct troppo grande — meglio usare una class:</span>
<span class="cm">// Una struct con 20 campi viene copiata tutta ogni volta — inefficiente!</span>
<span class="cm">// Regola: struct per 4-5 campi piccoli al massimo, altrimenti usa class</span>

<span class="cm">// 3. Struct non può essere null (a meno di usare ?):</span>
<span class="cm">// Prodotto p2 = null;   ← ERRORE!</span>
<span class="cm">// Prodotto? p2 = null;  ← OK con nullable</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea struct Punto2D (X, Y) con metodo DistanzaDallOrigine()</span>
<span class="cm">// 2. Crea struct Colore (R, G, B) con ToString() che stampa "rgb(R,G,B)"</span>
<span class="cm">// 3. Crea struct Studente (Nome, Voto) e un array di 5 studenti</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Crea struct Rettangolo con Area(), Perimetro(), e IsQuadrato()</span>
<span class="cm">// 5. Crea struct Frazione (Numeratore, Denominatore) con metodo Descrivi()</span>
<span class="cm">// 6. Gestisci un array di Prodotto e calcola il valore totale del carrello</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Crea struct Vettore2D con Somma(), Lunghezza(), Normalizza()</span>
<span class="cm">// 8. Crea struct Data (Giorno, Mese, Anno) con validazione nel costruttore</span>
<span class="cm">// 9. Gestisci un inventario di Articoli con ricerca per codice e stampa report</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Punto2D ---</span>
<span class="kw">struct</span> Punto2D {
    <span class="kw">public</span> <span class="ty">double</span> X, Y;
    <span class="kw">public</span> <span class="fn">Punto2D</span>(<span class="ty">double</span> x, <span class="ty">double</span> y) { X = x; Y = y; }
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">DistanzaDallOrigine</span>() => Math.<span class="fn">Sqrt</span>(X*X + Y*Y);
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"({X}, {Y})"</span>;
}
Punto2D pt = <span class="kw">new</span>(<span class="num">3</span>, <span class="num">4</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{pt} distanza: {pt.DistanzaDallOrigine()}"</span>); <span class="cm">// 5</span>

<span class="cm">// --- 2. Colore ---</span>
<span class="kw">struct</span> Colore {
    <span class="kw">public</span> <span class="ty">byte</span> R, G, B;
    <span class="kw">public</span> <span class="fn">Colore</span>(<span class="ty">byte</span> r, <span class="ty">byte</span> g, <span class="ty">byte</span> b) { R = r; G = g; B = b; }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"rgb({R},{G},{B})"</span>;
    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">ToHex</span>() => <span class="str">$"#{R:X2}{G:X2}{B:X2}"</span>;
}
Colore rosso = <span class="kw">new</span>(<span class="num">255</span>, <span class="num">0</span>, <span class="num">0</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{rosso}  {rosso.ToHex()}"</span>); <span class="cm">// rgb(255,0,0)  #FF0000</span>

<span class="cm">// --- 3. Studenti ---</span>
<span class="kw">struct</span> Studente3 { <span class="kw">public</span> <span class="ty">string</span> Nome; <span class="kw">public</span> <span class="ty">int</span> Voto; }
Studente3[] s3 = {
    <span class="kw">new</span>() { Nome=<span class="str">"Marco"</span>,  Voto=<span class="num">8</span>  },
    <span class="kw">new</span>() { Nome=<span class="str">"Giulia"</span>, Voto=<span class="num">9</span>  },
    <span class="kw">new</span>() { Nome=<span class="str">"Luca"</span>,   Voto=<span class="num">7</span>  },
    <span class="kw">new</span>() { Nome=<span class="str">"Anna"</span>,   Voto=<span class="num">10</span> },
    <span class="kw">new</span>() { Nome=<span class="str">"Paolo"</span>,  Voto=<span class="num">6</span>  }
};
<span class="kw">foreach</span> (<span class="kw">var</span> s <span class="kw">in</span> s3) Console.<span class="fn">WriteLine</span>(<span class="str">$"{s.Nome,-10} {s.Voto}"</span>);

<span class="cm">// --- 4. Rettangolo ---</span>
<span class="kw">struct</span> Rettangolo {
    <span class="kw">public</span> <span class="ty">double</span> Base, Altezza;
    <span class="kw">public</span> <span class="fn">Rettangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> a) { Base = b; Altezza = a; }
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Area</span>()       => Base * Altezza;
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Perimetro</span>()  => <span class="num">2</span> * (Base + Altezza);
    <span class="kw">public</span> <span class="ty">bool</span>   <span class="fn">IsQuadrato</span>() => Base == Altezza;
}
Rettangolo r4 = <span class="kw">new</span>(<span class="num">5</span>, <span class="num">3</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Area:{r4.Area()}  Perim:{r4.Perimetro()}  Quadrato:{r4.IsQuadrato()}"</span>);

<span class="cm">// --- 5. Frazione ---</span>
<span class="kw">struct</span> Frazione {
    <span class="kw">public</span> <span class="ty">int</span> Numeratore, Denominatore;
    <span class="kw">public</span> <span class="fn">Frazione</span>(<span class="ty">int</span> n, <span class="ty">int</span> d) {
        <span class="kw">if</span> (d == <span class="num">0</span>) <span class="kw">throw new</span> ArgumentException(<span class="str">"Denominatore non può essere 0!"</span>);
        Numeratore = n; Denominatore = d;
    }
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Valore</span>()   => (<span class="ty">double</span>)Numeratore / Denominatore;
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"{Numeratore}/{Denominatore} = {Valore():F3}"</span>;
}
Frazione f5 = <span class="kw">new</span>(<span class="num">3</span>, <span class="num">4</span>);
Console.<span class="fn">WriteLine</span>(f5); <span class="cm">// 3/4 = 0.750</span>

<span class="cm">// --- 6. Carrello ---</span>
Prodotto[] carrello = {
    <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Pizza"</span>, <span class="num">8.50</span>, <span class="num">2</span>),
    <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Birra"</span>, <span class="num">2.00</span>, <span class="num">4</span>),
    <span class="kw">new</span> <span class="fn">Prodotto</span>(<span class="str">"Dolce"</span>, <span class="num">3.50</span>, <span class="num">1</span>)
};
<span class="ty">double</span> tot6 = <span class="num">0</span>;
<span class="kw">foreach</span> (<span class="kw">var</span> p <span class="kw">in</span> carrello) {
    Console.<span class="fn">WriteLine</span>(p);
    tot6 += p.<span class="fn">ValoreTotale</span>();
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"TOTALE: €{tot6:F2}"</span>);

<span class="cm">// --- 7. Vettore2D ---</span>
<span class="kw">struct</span> Vettore2D {
    <span class="kw">public</span> <span class="ty">double</span> X, Y;
    <span class="kw">public</span> <span class="fn">Vettore2D</span>(<span class="ty">double</span> x, <span class="ty">double</span> y) { X = x; Y = y; }
    <span class="kw">public</span> <span class="ty">double</span>    <span class="fn">Lunghezza</span>()           => Math.<span class="fn">Sqrt</span>(X*X + Y*Y);
    <span class="kw">public</span> Vettore2D  <span class="fn">Somma</span>(Vettore2D v)    => <span class="kw">new</span>(X+v.X, Y+v.Y);
    <span class="kw">public</span> Vettore2D  <span class="fn">Normalizza</span>() {
        <span class="ty">double</span> len = <span class="fn">Lunghezza</span>();
        <span class="kw">return</span> len &gt; <span class="num">0</span> ? <span class="kw">new</span>(X/len, Y/len) : <span class="kw">new</span>(<span class="num">0</span>, <span class="num">0</span>);
    }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"({X:F2}, {Y:F2})"</span>;
}
Vettore2D v1 = <span class="kw">new</span>(<span class="num">3</span>, <span class="num">4</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Lunghezza: {v1.Lunghezza()}"</span>);      <span class="cm">// 5</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Normalizzato: {v1.Normalizza()}"</span>);  <span class="cm">// (0.60, 0.80)</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Somma: {v1.Somma(new(1,1))}"</span>);      <span class="cm">// (4.00, 5.00)</span>

<span class="cm">// --- 8. Data con validazione ---</span>
<span class="kw">struct</span> Data {
    <span class="kw">public</span> <span class="ty">int</span> Giorno, Mese, Anno;
    <span class="kw">public</span> <span class="fn">Data</span>(<span class="ty">int</span> g, <span class="ty">int</span> m, <span class="ty">int</span> a) {
        <span class="kw">if</span> (m &lt; <span class="num">1</span> || m &gt; <span class="num">12</span>) <span class="kw">throw new</span> ArgumentException(<span class="str">"Mese non valido!"</span>);
        <span class="kw">if</span> (g &lt; <span class="num">1</span> || g &gt; <span class="num">31</span>) <span class="kw">throw new</span> ArgumentException(<span class="str">"Giorno non valido!"</span>);
        Giorno = g; Mese = m; Anno = a;
    }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"{Giorno:D2}/{Mese:D2}/{Anno}"</span>;
}
Data d8 = <span class="kw">new</span>(<span class="num">25</span>, <span class="num">12</span>, <span class="num">2025</span>);
Console.<span class="fn">WriteLine</span>(d8); <span class="cm">// 25/12/2025</span>

<span class="cm">// --- 9. Inventario con ricerca ---</span>
Articolo[] inv9 = {
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"B001"</span>, <span class="str">"Laptop"</span>,  <span class="num">999.00</span>, <span class="num">5</span>),
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"B002"</span>, <span class="str">"Mouse"</span>,   <span class="num">29.90</span>, <span class="num">20</span>),
    <span class="kw">new</span> <span class="fn">Articolo</span>(<span class="str">"B003"</span>, <span class="str">"Tastiera"</span>,<span class="num">49.90</span>,  <span class="num">0</span>)
};
Console.<span class="fn">Write</span>(<span class="str">"Cerca codice: "</span>); <span class="ty">string</span> cerca9 = Console.<span class="fn">ReadLine</span>();
<span class="ty">bool</span> trovato9 = <span class="kw">false</span>;
<span class="kw">foreach</span> (<span class="kw">var</span> art <span class="kw">in</span> inv9) {
    <span class="kw">if</span> (art.Codice.<span class="fn">ToUpper</span>() == cerca9.<span class="fn">ToUpper</span>()) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Trovato: {art}"</span>);
        trovato9 = <span class="kw">true</span>; <span class="kw">break</span>;
    }
}
<span class="kw">if</span> (!trovato9) Console.<span class="fn">WriteLine</span>(<span class="str">"Articolo non trovato"</span>);</pre>

  </div>
</div>
      <!-- 14. Nullable & Null Operators -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>14. Nullable &amp; Null Operators</h3><div class="topic-sub">int?, string?, ??, ?., ??=, HasValue, null-forgiving</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è null?</h4>
    <pre><span class="cm">// null significa "nessun valore" o "non inizializzato".</span>
<span class="cm">// I tipi riferimento (string, class) possono essere null.</span>
<span class="cm">// I tipi valore (int, double, bool) NON possono essere null... a meno che:</span>

<span class="ty">string</span> nome = <span class="kw">null</span>;   <span class="cm">// OK — string è un tipo riferimento</span>
<span class="ty">int</span>    eta  = <span class="kw">null</span>;   <span class="cm">// ERRORE! int non può essere null</span>
<span class="ty">int</span>?   eta2 = <span class="kw">null</span>;   <span class="cm">// OK — int? è un nullable int</span></pre>

    <h4>Tipi nullable — il ? dopo il tipo</h4>
    <pre><span class="cm">// Aggiungi ? per rendere un tipo valore nullable:</span>
<span class="ty">int</span>?    eta     = <span class="kw">null</span>;
<span class="ty">double</span>? altezza = <span class="kw">null</span>;
<span class="ty">bool</span>?   attivo  = <span class="kw">null</span>;  <span class="cm">// true, false, o null (sconosciuto)</span>

<span class="cm">// Assegnare un valore:</span>
eta = <span class="num">25</span>;
Console.<span class="fn">WriteLine</span>(eta);  <span class="cm">// 25</span>

<span class="cm">// Verificare se ha valore:</span>
<span class="kw">if</span> (eta.HasValue)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Eta: {eta.Value}"</span>);
<span class="kw">else</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Eta non inserita"</span>);

<span class="cm">// Scorciatoia equivalente:</span>
<span class="kw">if</span> (eta != <span class="kw">null</span>)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Eta: {eta}"</span>);</pre>

    <h4>?? — operatore null coalescing (valore di default)</h4>
    <pre><span class="cm">// Se il valore è null, usa quello a destra del ??</span>
<span class="ty">int</span>?   eta3  = <span class="kw">null</span>;
<span class="ty">string</span> nome2 = <span class="kw">null</span>;

<span class="ty">int</span>    etaReale = eta3  ?? <span class="num">0</span>;              <span class="cm">// 0 se null</span>
<span class="ty">string</span> nomeVero = nome2 ?? <span class="str">"Sconosciuto"</span>; <span class="cm">// "Sconosciuto" se null</span>

Console.<span class="fn">WriteLine</span>(etaReale);  <span class="cm">// 0</span>
Console.<span class="fn">WriteLine</span>(nomeVero);  <span class="cm">// "Sconosciuto"</span>

<span class="cm">// Concatenazione ??:</span>
<span class="ty">string</span> a = <span class="kw">null</span>, b = <span class="kw">null</span>, c = <span class="str">"trovato"</span>;
<span class="ty">string</span> ris = a ?? b ?? c;  <span class="cm">// "trovato" — prende il primo non-null</span>

<span class="cm">// Uso pratico — input utente:</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome (invio per default): "</span>);
<span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>();
<span class="ty">string</span> nomeFin = input ?? <span class="str">"Ospite"</span>;
<span class="cm">// Se l'utente preme solo invio, ReadLine restituisce ""</span>
<span class="ty">string</span> nomeFin2 = <span class="ty">string</span>.<span class="fn">IsNullOrWhiteSpace</span>(input) ? <span class="str">"Ospite"</span> : input;</pre>

    <h4>??= — assegnazione null coalescing</h4>
    <pre><span class="cm">// Assegna solo se la variabile è null:</span>
<span class="ty">string</span>? config = <span class="kw">null</span>;
config ??= <span class="str">"valore_default"</span>;  <span class="cm">// assegna perché è null</span>
Console.<span class="fn">WriteLine</span>(config);      <span class="cm">// "valore_default"</span>

config ??= <span class="str">"altro"</span>;  <span class="cm">// NON assegna, config è già "valore_default"</span>
Console.<span class="fn">WriteLine</span>(config);  <span class="cm">// "valore_default"</span>

<span class="cm">// Equivalente a:</span>
<span class="cm">// if (config == null) config = "valore_default";</span>

<span class="cm">// Uso pratico — inizializzazione pigra:</span>
List&lt;<span class="ty">string</span>&gt;? cache = <span class="kw">null</span>;
cache ??= <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();  <span class="cm">// crea la lista solo se serve</span>
cache.<span class="fn">Add</span>(<span class="str">"elemento"</span>);</pre>

    <h4>?. — operatore null condizionale</h4>
    <pre><span class="cm">// Accede a proprietà/metodi SOLO se l'oggetto non è null.</span>
<span class="cm">// Evita il NullReferenceException!</span>

<span class="ty">string</span>? testo = <span class="kw">null</span>;

<span class="cm">// CRASH — NullReferenceException:</span>
<span class="cm">// int lungh = testo.Length;   ← CRASH se testo è null!</span>

<span class="cm">// SICURO con ?. :</span>
<span class="ty">int</span>?   lungh  = testo?.Length;    <span class="cm">// null se testo è null</span>
<span class="ty">string</span>? upper = testo?.ToUpper(); <span class="cm">// null se testo è null</span>

Console.<span class="fn">WriteLine</span>(lungh ?? <span class="num">0</span>);  <span class="cm">// 0 (lungh è null)</span>

<span class="cm">// Catena di ?. :</span>
<span class="ty">string</span>? prima = testo?.<span class="fn">Split</span>(<span class="str">' '</span>)?[<span class="num">0</span>];  <span class="cm">// null se testo è null</span>

<span class="cm">// Con oggetti:</span>
<span class="kw">class</span> <span class="ty">Utente</span> { <span class="kw">public</span> <span class="ty">string</span>? Email; }
Utente? utente = <span class="kw">null</span>;
<span class="ty">string</span>? email = utente?.Email;         <span class="cm">// null — non crasha</span>
<span class="ty">int</span>?    len   = utente?.Email?.Length; <span class="cm">// null — doppio ?.</span></pre>

    <h4>Combinare ?? e ?.</h4>
    <pre><span class="cm">// Il pattern più comune in C#:</span>
<span class="ty">string</span>? nome3 = <span class="kw">null</span>;

<span class="cm">// Ottieni la lunghezza, o 0 se nome è null:</span>
<span class="ty">int</span> len2 = nome3?.Length ?? <span class="num">0</span>;

<span class="cm">// Ottieni le prime 3 lettere, o stringa vuota se null:</span>
<span class="ty">string</span> inizio = nome3?.<span class="fn">Substring</span>(<span class="num">0</span>, Math.<span class="fn">Min</span>(<span class="num">3</span>, nome3.Length)) ?? <span class="str">""</span>;

<span class="cm">// Esempio pratico con classe:</span>
<span class="kw">class</span> <span class="ty">Ordine</span> {
    <span class="kw">public</span> <span class="ty">string</span>? Nota;
    <span class="kw">public</span> Utente?  Cliente;
}
Ordine? ordine = <span class="kw">null</span>;
<span class="ty">string</span> emailCliente = ordine?.Cliente?.Email ?? <span class="str">"email non disponibile"</span>;
Console.<span class="fn">WriteLine</span>(emailCliente);  <span class="cm">// "email non disponibile"</span></pre>
    <table>
      <tr><th>Operatore</th><th>Nome</th><th>Cosa fa</th><th>Esempio</th></tr>
      <tr><td>T?</td><td>Nullable type</td><td>Permette null a tipi valore</td><td>int? x = null;</td></tr>
      <tr><td>??</td><td>Null coalescing</td><td>Valore di default se null</td><td>x ?? 0</td></tr>
      <tr><td>??=</td><td>Null coalescing assign</td><td>Assegna solo se null</td><td>x ??= 5;</td></tr>
      <tr><td>?.</td><td>Null conditional</td><td>Accede solo se non null</td><td>obj?.Nome</td></tr>
      <tr><td>!</td><td>Null forgiving</td><td>Dice al compilatore "non è null"</td><td>nome!</td></tr>
    </table>

    <h4>Progetto — Profilo utente opzionale</h4>
    <pre><span class="kw">class</span> <span class="ty">Profilo</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Username;
    <span class="kw">public</span> <span class="ty">string</span>? NomeCompleto;
    <span class="kw">public</span> <span class="ty">int</span>?    Eta;
    <span class="kw">public</span> <span class="ty">string</span>? Email;
    <span class="kw">public</span> <span class="ty">string</span>? Citta;

    <span class="kw">public</span> <span class="fn">Profilo</span>(<span class="ty">string</span> username) { Username = username; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"=== Profilo: {Username} ==="</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Nome:  {NomeCompleto ?? "(non inserito)"}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Eta:   {(Eta.HasValue ? Eta.Value.ToString() : "sconosciuta")}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Email: {Email ?? "(non inserita)"}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Citta: {Citta ?? "(non inserita)"}"</span>);
    }
}

Profilo p = <span class="kw">new</span> Profilo(<span class="str">"marco99"</span>);
p.NomeCompleto = <span class="str">"Marco Rossi"</span>;
p.Eta = <span class="num">25</span>;
<span class="cm">// Email e Citta rimangono null</span>
p.<span class="fn">Stampa</span>();

<span class="cm">// Aggiornamento con ??=:</span>
p.Email ??= <span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="127f7360717d52777f737b7e3c7b66">[email&#160;protected]</a>"</span>;  <span class="cm">// assegna perché è null</span>
p.Email ??= <span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4a2b263e38250a2f272b232664233e">[email&#160;protected]</a>"</span>;  <span class="cm">// NON cambia, già impostata</span></pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Dimenticare ? e avere NullReferenceException:</span>
<span class="ty">string</span> s = <span class="kw">null</span>;
<span class="cm">// Console.WriteLine(s.Length);  ← CRASH!</span>
Console.<span class="fn">WriteLine</span>(s?.Length ?? <span class="num">0</span>);  <span class="cm">// sicuro: 0</span>

<span class="cm">// 2. Usare .Value senza verificare HasValue:</span>
<span class="ty">int</span>? n = <span class="kw">null</span>;
<span class="cm">// Console.WriteLine(n.Value);  ← CRASH! InvalidOperationException</span>
Console.<span class="fn">WriteLine</span>(n ?? <span class="num">0</span>);           <span class="cm">// sicuro: 0</span>

<span class="cm">// 3. Confondere null con stringa vuota:</span>
<span class="ty">string</span> vuota = <span class="str">""</span>;
<span class="ty">string</span> nulla = <span class="kw">null</span>;
Console.<span class="fn">WriteLine</span>(vuota == <span class="kw">null</span>);              <span class="cm">// false! "" non è null</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(vuota)); <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(nulla)); <span class="cm">// true</span>

<span class="cm">// 4. Il null-forgiving ! non protegge a runtime:</span>
<span class="ty">string</span> nome4 = <span class="kw">null</span>!;  <span class="cm">// dici al compilatore "fidati", ma...</span>
<span class="cm">// Console.WriteLine(nome4.Length);  ← CRASH lo stesso a runtime!</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Chiedi nome all'utente, usa ?? per mettere "Anonimo" se non inserisce nulla</span>
<span class="cm">// 2. Crea int? voto = null, poi assegna un valore e stampa con HasValue</span>
<span class="cm">// 3. Usa ??= per inizializzare una lista solo se è null</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Crea classe Persona con nome e eta nullable, stampa con valori di default</span>
<span class="cm">// 5. Usa ?. per accedere in sicurezza a proprietà di un oggetto che può essere null</span>
<span class="cm">// 6. Catena ?. e ?? per navigare oggetti annidati in sicurezza</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Gestisci un array di int? con valori misti null e non-null, calcola la media</span>
<span class="cm">// 8. Implementa un sistema di configurazione con valori nullable e fallback</span>
<span class="cm">// 9. Crea un parser che legge dati opzionali da stringhe CSV con campi mancanti</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Nome: "</span>);
<span class="ty">string</span>? inp1 = Console.<span class="fn">ReadLine</span>();
Console.<span class="fn">WriteLine</span>(<span class="str">$"Ciao, {(string.IsNullOrWhiteSpace(inp1) ? "Anonimo" : inp1)}!"</span>);

<span class="cm">// --- 2. ---</span>
<span class="ty">int</span>? voto2 = <span class="kw">null</span>;
Console.<span class="fn">WriteLine</span>(voto2.HasValue ? <span class="str">$"Voto: {voto2.Value}"</span> : <span class="str">"Nessun voto"</span>);
voto2 = <span class="num">8</span>;
Console.<span class="fn">WriteLine</span>(voto2.HasValue ? <span class="str">$"Voto: {voto2.Value}"</span> : <span class="str">"Nessun voto"</span>);

<span class="cm">// --- 3. ---</span>
List&lt;<span class="ty">string</span>&gt;? lista3 = <span class="kw">null</span>;
lista3 ??= <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();
lista3.<span class="fn">Add</span>(<span class="str">"elemento"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Lista con {lista3.Count} elementi"</span>);

<span class="cm">// --- 4. ---</span>
<span class="kw">class</span> <span class="ty">Persona4</span> { <span class="kw">public</span> <span class="ty">string</span>? Nome; <span class="kw">public</span> <span class="ty">int</span>? Eta; }
Persona4 p4 = <span class="kw">new</span>() { Nome = <span class="str">"Marco"</span> };
Console.<span class="fn">WriteLine</span>(<span class="str">$"{p4.Nome ?? "Sconosciuto"}, {p4.Eta?.ToString() ?? "eta ignota"}"</span>);

<span class="cm">// --- 5. ---</span>
<span class="kw">class</span> <span class="ty">Oggetto5</span> { <span class="kw">public</span> <span class="ty">string</span> Nome = <span class="str">"Test"</span>; }
Oggetto5? obj5 = <span class="kw">null</span>;
Console.<span class="fn">WriteLine</span>(obj5?.Nome ?? <span class="str">"oggetto null"</span>);
obj5 = <span class="kw">new</span>();
Console.<span class="fn">WriteLine</span>(obj5?.Nome ?? <span class="str">"oggetto null"</span>);

<span class="cm">// --- 7. Media di int? ---</span>
<span class="ty">int</span>?[] arr7 = { <span class="num">5</span>, <span class="kw">null</span>, <span class="num">8</span>, <span class="kw">null</span>, <span class="num">3</span>, <span class="num">10</span>, <span class="kw">null</span> };
<span class="ty">int</span> sum7=<span class="num">0</span>, cnt7=<span class="num">0</span>;
<span class="kw">foreach</span>(<span class="ty">int</span>? n7 <span class="kw">in</span> arr7) <span class="kw">if</span>(n7.HasValue){sum7+=n7.Value;cnt7++;}
Console.<span class="fn">WriteLine</span>(cnt7&gt;<span class="num">0</span>?<span class="str">$"Media: {(double)sum7/cnt7:F2}"</span>:<span class="str">"Nessun valore"</span>);

<span class="cm">// --- 8. Configurazione ---</span>
<span class="ty">string</span>? host=<span class="kw">null</span>, porta=<span class="kw">null</span>, db=<span class="str">"mioDB"</span>;
<span class="ty">string</span> connStr = <span class="str">$"Server={host??"localhost"};Port={porta??"5432"};DB={db??"default"}"</span>;
Console.<span class="fn">WriteLine</span>(connStr);

<span class="cm">// --- 9. CSV con campi mancanti ---</span>
<span class="ty">string</span>[] righe9 = { <span class="str">"Marco,25,Roma"</span>, <span class="str">"Giulia,,Milano"</span>, <span class="str">"Luca,30,"</span> };
<span class="kw">foreach</span>(<span class="ty">string</span> riga <span class="kw">in</span> righe9) {
    <span class="ty">string</span>[] campi = riga.<span class="fn">Split</span>(<span class="str">','</span>);
    <span class="ty">string</span>  nome9  = campi[<span class="num">0</span>];
    <span class="ty">int</span>?    eta9   = <span class="ty">int</span>.<span class="fn">TryParse</span>(campi[<span class="num">1</span>], <span class="kw">out int</span> e9) ? e9 : (<span class="ty">int</span>?)<span class="kw">null</span>;
    <span class="ty">string</span>? citta9 = <span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(campi[<span class="num">2</span>]) ? <span class="kw">null</span> : campi[<span class="num">2</span>];
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{nome9}, {eta9?.ToString()??"eta?"}, {citta9??"citta?"}"</span>);
}</pre>

  </div>
</div>
      <!-- 15. Scope & Visibilità -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>15. Scope &amp; Visibilità delle Variabili</h3><div class="topic-sub">Scope locale, blocco, metodo, classe, shadowing, buone pratiche</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è lo scope?</h4>
    <pre><span class="cm">// Lo scope (ambito) definisce DOVE una variabile esiste ed è utilizzabile.</span>
<span class="cm">// Una variabile esiste solo nel blocco {} in cui è dichiarata.</span>

<span class="ty">int</span> x = <span class="num">10</span>;  <span class="cm">// scope: tutto il metodo</span>

<span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="ty">int</span> y = <span class="num">5</span>;       <span class="cm">// scope: solo questo blocco if</span>
    Console.<span class="fn">WriteLine</span>(x);  <span class="cm">// OK — x è visibile (blocco esterno)</span>
    Console.<span class="fn">WriteLine</span>(y);  <span class="cm">// OK — y è visibile (stesso blocco)</span>
}
<span class="cm">// Console.WriteLine(y);  ← ERRORE! y non esiste più</span>
Console.<span class="fn">WriteLine</span>(x);      <span class="cm">// OK — x esiste ancora</span></pre>

    <h4>Scope nei cicli</h4>
    <pre><span class="cm">// La variabile del for esiste solo dentro il for:</span>
<span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; <span class="num">5</span>; i++) {
    <span class="ty">int</span> doppio = i * <span class="num">2</span>;  <span class="cm">// esiste solo in questa iterazione</span>
    Console.<span class="fn">WriteLine</span>(doppio);
}
<span class="cm">// Console.WriteLine(i);      ← ERRORE! i non esiste fuori dal for</span>
<span class="cm">// Console.WriteLine(doppio); ← ERRORE! doppio non esiste fuori dal for</span>

<span class="cm">// Se hai bisogno di i dopo il ciclo, dichiarala fuori:</span>
<span class="ty">int</span> contatore = <span class="num">0</span>;
<span class="kw">for</span> (contatore = <span class="num">0</span>; contatore &lt; <span class="num">10</span>; contatore++) {
    <span class="cm">// ...</span>
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"Finito a: {contatore}"</span>);  <span class="cm">// OK — dichiarata fuori</span>

<span class="cm">// Stesso per while e foreach:</span>
<span class="kw">foreach</span> (<span class="ty">string</span> nome <span class="kw">in</span> <span class="kw">new</span>[] { <span class="str">"A"</span>, <span class="str">"B"</span> }) {
    Console.<span class="fn">WriteLine</span>(nome);
}
<span class="cm">// Console.WriteLine(nome);  ← ERRORE!</span></pre>

    <h4>Scope annidati — i blocchi interni vedono quelli esterni</h4>
    <pre><span class="ty">int</span> a = <span class="num">1</span>;           <span class="cm">// livello 0</span>

<span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="ty">int</span> b = <span class="num">2</span>;         <span class="cm">// livello 1</span>
    Console.<span class="fn">WriteLine</span>(a);  <span class="cm">// OK — vede livello 0</span>

    <span class="kw">if</span> (<span class="kw">true</span>) {
        <span class="ty">int</span> c = <span class="num">3</span>;       <span class="cm">// livello 2</span>
        Console.<span class="fn">WriteLine</span>(a);  <span class="cm">// OK — vede livello 0</span>
        Console.<span class="fn">WriteLine</span>(b);  <span class="cm">// OK — vede livello 1</span>
        Console.<span class="fn">WriteLine</span>(c);  <span class="cm">// OK — vede livello 2</span>
    }
    <span class="cm">// Console.WriteLine(c);  ← ERRORE! c esiste solo dentro il secondo if</span>
}
<span class="cm">// Console.WriteLine(b);  ← ERRORE!</span>
<span class="cm">// Console.WriteLine(c);  ← ERRORE!</span></pre>

    <h4>Scope dei metodi</h4>
    <pre><span class="cm">// Le variabili di un metodo non sono visibili in altri metodi!</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MetodoA</span>() {
    <span class="ty">int</span> x = <span class="num">100</span>;
    Console.<span class="fn">WriteLine</span>(x);  <span class="cm">// OK</span>
}

<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MetodoB</span>() {
    <span class="cm">// Console.WriteLine(x);  ← ERRORE! x di MetodoA non è visibile qui</span>
    <span class="ty">int</span> x = <span class="num">200</span>;  <span class="cm">// questa è una x diversa, locale a MetodoB</span>
    Console.<span class="fn">WriteLine</span>(x);  <span class="cm">// 200</span>
}

<span class="cm">// Per condividere dati tra metodi: usa parametri e return!</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">CalcolaValore</span>() => <span class="num">42</span>;
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">UsaValore</span>(<span class="ty">int</span> valore) => Console.<span class="fn">WriteLine</span>(valore);
<span class="fn">UsaValore</span>(<span class="fn">CalcolaValore</span>());  <span class="cm">// passa il valore esplicitamente</span></pre>

    <h4>Variabili di classe (campi statici)</h4>
    <pre><span class="kw">class</span> <span class="ty">Esempio</span> {
    <span class="cm">// Campo statico — visibile in tutti i metodi della classe:</span>
    <span class="kw">static</span> <span class="ty">int</span> contatore = <span class="num">0</span>;
    <span class="kw">static</span> <span class="ty">string</span> messaggio = <span class="str">"Ciao"</span>;

    <span class="kw">static</span> <span class="ty">void</span> <span class="fn">Incrementa</span>() {
        contatore++;  <span class="cm">// accede al campo della classe</span>
    }

    <span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{messaggio}: {contatore}"</span>);  <span class="cm">// visibile!</span>
    }
}
<span class="cm">// Usalo con moderazione — rende il codice più difficile da seguire</span></pre>

    <h4>Shadowing — variabile locale nasconde quella esterna</h4>
    <pre><span class="cm">// In C# NON puoi ridichiarare una variabile dello scope esterno nello scope interno:</span>
<span class="ty">int</span> x2 = <span class="num">10</span>;
<span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="cm">// int x2 = 20;  ← ERRORE DI COMPILAZIONE in C#!</span>
    <span class="cm">// (In altri linguaggi come Java/JavaScript è permesso — attento!)</span>
    x2 = <span class="num">20</span>;  <span class="cm">// puoi modificare quella esterna</    }
Console.<span class="fn">WriteLine</span>(x2);  <span class="cm">// 20</span>

<span class="cm">// MA in metodi diversi puoi avere lo stesso nome:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Test1</span>() { <span class="ty">int</span> n = <span class="num">1</span>; Console.<span class="fn">WriteLine</span>(n); }
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Test2</span>() { <span class="ty">int</span> n = <span class="num">2</span>; Console.<span class="fn">WriteLine</span>(n); }  <span class="cm">// n diversa!</span></pre>
    <div class="note">Una variabile esiste solo nel blocco {} in cui è dichiarata. I blocchi interni possono vedere le variabili dei blocchi esterni, ma non viceversa.</div>

    <h4>Buone pratiche sullo scope</h4>
    <pre><span class="cm">// 1. Dichiara le variabili il più vicino possibile al loro uso:</span>
<span class="cm">//Male — dichiarata troppo presto:</span>
<span class="ty">string</span> risultato = <span class="str">""</span>;  <span class="cm">// dichiarata qui...</span>
<span class="ty">int</span> a2 = <span class="num">5</span>, b2 = <span class="num">3</span>;
<span class="ty">int</span> somma2 = a2 + b2;
risultato = <span class="str">$"Somma: {somma2}"</span>;  <span class="cm">// ...usata solo qui</span>

<span class="cm">//Bene — dichiarata dove serve:</span>
<span class="ty">int</span> a3 = <span class="num">5</span>, b3 = <span class="num">3</span>;
<span class="ty">int</span> somma3 = a3 + b3;
<span class="ty">string</span> risultato2 = <span class="str">$"Somma: {somma3}"</span>;

<span class="cm">// 2. Evita variabili con scope troppo ampio:</span>
<span class="cm">//Male — i usata come variabile generica ovunque:</span>
<span class="ty">int</span> i = <span class="num">0</span>;
<span class="cm">// ... 50 righe di codice ...</span>
<span class="kw">for</span> (i = <span class="num">0</span>; i &lt; <span class="num">10</span>; i++) { }  <span class="cm">// riusa i — confuso!</span>

<span class="cm">//Bene — ogni ciclo ha la sua variabile:</span>
<span class="kw">for</span> (<span class="ty">int</span> j = <span class="num">0</span>; j &lt; <span class="num">10</span>; j++) { }  <span class="cm">// j locale al for</span>

<span class="cm">// 3. Usa nomi descrittivi per evitare confusione:</span>
<span class="cm">//Male:</span>
<span class="ty">int</span> x3 = <span class="num">0</span>, y3 = <span class="num">0</span>, z3 = <span class="num">0</span>;
<span class="cm">//Bene:</span>
<span class="ty">int</span> totaleVendite = <span class="num">0</span>, mediaVoti = <span class="num">0</span>, maxPunteggio = <span class="num">0</span>;</pre>

    <h4>Errori comuni</h4>
    <pre><span class="cm">// 1. Usare variabile fuori dal suo scope:</span>
<span class="kw">for</span> (<span class="ty">int</span> k = <span class="num">0</span>; k &lt; <span class="num">5</span>; k++) { }
<span class="cm">// Console.WriteLine(k);  ← ERRORE! k non esiste</span>

<span class="cm">// 2. Dimenticare che ogni iterazione ha la sua copia:</span>
<span class="kw">for</span> (<span class="ty">int</span> m = <span class="num">0</span>; m &lt; <span class="num">3</span>; m++) {
    <span class="ty">int</span> tmp = m * <span class="num">10</span>;  <span class="cm">// nuova variabile ad ogni iterazione</span>
    Console.<span class="fn">WriteLine</span>(tmp);
}

<span class="cm">// 3. Variabili non inizializzate:</span>
<span class="ty">int</span> risultato3;
<span class="cm">// Console.WriteLine(risultato3);  ← ERRORE! Non inizializzata</span>
<span class="ty">int</span> risultato4 = <span class="num">0</span>;  <span class="cm">// sempre inizializza!</span>

<span class="cm">// 4. Scope nei blocchi try/catch:</span>
<span class="kw">try</span> {
    <span class="ty">int</span> num = <span class="ty">int</span>.<span class="fn">Parse</span>(<span class="str">"abc"</span>);
} <span class="kw">catch</span> (Exception ex) {
    <span class="cm">// Console.WriteLine(num);  ← ERRORE! num non visibile nel catch</span>
    Console.<span class="fn">WriteLine</span>(ex.Message);
}</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Scrivi codice che usa una variabile dentro e fuori un if — osserva gli errori</span>
<span class="cm">// 2. Dichiara variabile dentro un for e prova ad usarla fuori</span>
<span class="cm">// 3. Crea due metodi con variabili dallo stesso nome — funzionano indipendentemente?</span>
<span class="cm">// MEDIO:</span>
<span class="cm">// 4. Scrivi un metodo che conta quante volte appare una lettera, senza variabili globali</span>
<span class="cm">// 5. Riscrivi codice con scope troppo ampio usando scope minimale</span>
<span class="cm">// 6. Dimostra la differenza tra modificare una variabile di classe vs locale</span>
<span class="cm">// DIFFICILE:</span>
<span class="cm">// 7. Scrivi un sistema di log dove ogni metodo usa solo variabili locali</span>
<span class="cm">// 8. Implementa un contatore usando campo statico — spiega i rischi</span>
<span class="cm">// 9. Identifica e correggi tutti i problemi di scope in un codice dato</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. if scope ---</span>
<span class="ty">int</span> fuori = <span class="num">10</span>;
<span class="kw">if</span> (fuori &gt; <span class="num">5</span>) {
    <span class="ty">int</span> dentro = <span class="num">20</span>;
    Console.<span class="fn">WriteLine</span>(<span class="str">$"fuori={fuori} dentro={dentro}"</span>);
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"fuori={fuori}"</span>); <span class="cm">// OK</span>
<span class="cm">// Console.WriteLine(dentro);  ← ERRORE</span>

<span class="cm">// --- 2. for scope ---</span>
<span class="kw">for</span> (<span class="ty">int</span> idx = <span class="num">0</span>; idx &lt; <span class="num">3</span>; idx++) {
    <span class="ty">int</span> quadrato = idx * idx;
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{idx}^2 = {quadrato}"</span>);
}
<span class="cm">// Console.WriteLine(idx);     ← ERRORE</span>
<span class="cm">// Console.WriteLine(quadrato); ← ERRORE</span>

<span class="cm">// --- 3. Stessi nomi in metodi diversi ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MetodoX</span>() { <span class="ty">int</span> n3 = <span class="num">100</span>; Console.<span class="fn">WriteLine</span>(<span class="str">$"X: {n3}"</span>); }
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MetodoY</span>() { <span class="ty">int</span> n3 = <span class="num">200</span>; Console.<span class="fn">WriteLine</span>(<span class="str">$"Y: {n3}"</span>); }
<span class="fn">MetodoX</span>(); <span class="cm">// X: 100</span>
<span class="fn">MetodoY</span>(); <span class="cm">// Y: 200 — variabili completamente indipendenti</span>

<span class="cm">// --- 4. Conta lettere ---</span>
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">ContaLettera</span>(<span class="ty">string</span> testo, <span class="ty">char</span> lettera) {
    <span class="ty">int</span> cnt4 = <span class="num">0</span>;
    <span class="kw">foreach</span> (<span class="ty">char</span> c <span class="kw">in</span> testo.<span class="fn">ToLower</span>())
        <span class="kw">if</span> (c == <span class="ty">char</span>.<span class="fn">ToLower</span>(lettera)) cnt4++;
    <span class="kw">return</span> cnt4;
}
Console.<span class="fn">WriteLine</span>(<span class="fn">ContaLettera</span>(<span class="str">"Programmazione"</span>, <span class="str">'a'</span>)); <span class="cm">// 2</span>

<span class="cm">// --- 5. Scope minimale ---</span>
<span class="cm">//scope troppo ampio:</span>
<span class="ty">string</span> msg5 = <span class="str">""</span>; <span class="ty">int</span> tot5 = <span class="num">0</span>;
<span class="ty">int</span>[] vals = {<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>};
<span class="kw">foreach</span>(<span class="ty">int</span> v <span class="kw">in</span> vals) tot5 += v;
msg5 = <span class="str">$"Tot: {tot5}"</span>; Console.<span class="fn">WriteLine</span>(msg5);
<span class="cm">//scope minimale:</span>
<span class="ty">int</span> tot5b = <span class="num">0</span>;
<span class="kw">foreach</span>(<span class="ty">int</span> v <span class="kw">in</span> <span class="kw">new</span>[]{<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>}) tot5b += v;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Tot: {tot5b}"</span>);

<span class="cm">// --- 8. Contatore statico ---</span>
<span class="kw">class</span> <span class="ty">ContaOggetti</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> Totale = <span class="num">0</span>;
    <span class="kw">public</span> <span class="fn">ContaOggetti</span>() { Totale++; }
}
<span class="kw">new</span> ContaOggetti(); <span class="kw">new</span> ContaOggetti(); <span class="kw">new</span> ContaOggetti();
Console.<span class="fn">WriteLine</span>(<span class="str">$"Creati: {ContaOggetti.Totale}"</span>); <span class="cm">// 3</span>
<span class="cm">// Rischio: Totale è condiviso — in multi-threading può causare problemi</span></pre>

  </div>
</div>

    </div>
    <!-- SECTION INTERMEDIO (17) -->
    <div class="section" id="section-intermediate">
      <div class="section-title">II — Intermedio <span class="tag">INT</span></div>
      <!-- 1. Classi & Oggetti -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>1. Classi &amp; Oggetti</h3><div class="topic-sub">Blueprint, istanza, new, this, campi pubblici</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è una Classe? — Il Blueprint</h4>
    <p>Una classe è un <strong>modello</strong> (blueprint) che definisce la struttura e il comportamento di un oggetto. L'oggetto è l'<strong>istanza</strong> concreta della classe.</p>
    <table>
      <tr><th>Concetto</th><th>Esempio</th><th>Analogia</th></tr>
      <tr><td>Classe</td><td>class Persona { }</td><td>Progetto architettonico</td></tr>
      <tr><td>Oggetto</td><td>new Persona()</td><td>Casa costruita dal progetto</td></tr>
      <tr><td>Campo</td><td>public string Nome;</td><td>Caratteristica (colore pareti)</td></tr>
      <tr><td>Metodo</td><td>public void Saluta()</td><td>Azione (aprire la porta)</td></tr>
    </table>

    <h4>Definire una Classe</h4>
    <pre><span class="kw">class</span> <span class="ty">Persona</span> {
    <span class="cm">// CAMPI — dati che l'oggetto contiene</span>
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">string</span> Cognome;
    <span class="kw">public</span> <span class="ty">int</span>    Eta;

    <span class="cm">// METODI — azioni che l'oggetto può compiere</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Saluta</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Ciao, sono {Nome} {Cognome}!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">CompiAnni</span>() {
        Eta++;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Ora ho {Eta} anni!"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">EMaggiorenne</span>() {
        <span class="kw">return</span> Eta >= <span class="num">18</span>;
    }
}</pre>

    <h4>Creare un Oggetto (Istanza)</h4>
    <pre><span class="cm">// Sintassi: Tipo nomeVariabile = new Tipo();</span>
Persona p1 = <span class="kw">new</span> <span class="ty">Persona</span>();  <span class="cm">// crea un oggetto vuoto</span>

<span class="cm">// Assegna valori ai campi:</span>
p1.Nome    = <span class="str">"Marco"</span>;
p1.Cognome = <span class="str">"Rossi"</span>;
p1.Eta     = <span class="num">25</span>;

<span class="cm">// Chiama i metodi:</span>
p1.<span class="fn">Saluta</span>();        <span class="cm">// Ciao, sono Marco Rossi!</span>
p1.<span class="fn">CompiAnni</span>();     <span class="cm">// Ora ho 26 anni!</span>

<span class="kw">if</span> (p1.<span class="fn">EMaggiorenne</span>())
    Console.<span class="fn">WriteLine</span>(<span class="str">"Può votare"</span>);

<span class="cm">// Più oggetti dalla stessa classe:</span>
Persona p2 = <span class="kw">new</span> <span class="ty">Persona</span>();
p2.Nome = <span class="str">"Giulia"</span>;
p2.Eta  = <span class="num">17</span>;

<span class="cm">// p1 e p2 sono INDIPENDENTI — ognuno ha i suoi dati!</span>
Console.<span class="fn">WriteLine</span>(p1.Eta);  <span class="cm">// 26</span>
Console.<span class="fn">WriteLine</span>(p2.Eta);  <span class="cm">// 17</span></pre>

    <h4>La parola chiave this</h4>
    <pre><span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">double</span> Prezzo;

    <span class="cm">// PROBLEMA: parametro ha lo stesso nome del campo!</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Imposta</span>(<span class="ty">string</span> Nome, <span class="ty">double</span> Prezzo) {
        <span class="cm">// this.Campo = parametro</span>
        <span class="kw">this</span>.Nome   = Nome;    <span class="cm">// this.Nome è il campo</span>
        <span class="kw">this</span>.Prezzo = Prezzo;  <span class="cm">// Nome è il parametro</span>
    }

    <span class="cm">// Restituisce l'oggetto stesso (fluent pattern):</span>
    <span class="kw">public</span> Prodotto <span class="fn">ConSconto</span>(<span class="ty">double</span> percentuale) {
        <span class="kw">this</span>.Prezzo *= (<span class="num">1</span> - percentuale);
        <span class="kw">return</span> <span class="kw">this</span>;  <span class="cm">// permette di concatenare chiamate</span>
    }
}

<span class="cm">// Uso del fluent pattern:</span>
Prodotto prod = <span class="kw">new</span> <span class="ty">Prodotto</span>();
prod.<span class="fn">Imposta</span>(<span class="str">"Laptop"</span>, <span class="num">1000</span>).<span class="fn">ConSconto</span>(<span class="num">0.1</span>);  <span class="cm">// concatenato!</span></pre>
    <div class="tip">Usa this solo quando necessario (parametro = campo) o per fluent API. Non serve scriverlo ovunque!</div>

    <h4>Valori di Default dei Campi</h4>
    <table>
      <tr><th>Tipo campo</th><th>Valore di default</th></tr>
      <tr><td>int, double, decimal</td><td>0</td></tr>
      <tr><td>bool</td><td>false</td></tr>
      <tr><td>string (e tutti i reference)</td><td>null</td></tr>
      <tr><td>char</td><td>'\0' (carattere nullo)</td></tr>
    </table>
    <pre>Persona p = <span class="kw">new</span> <span class="ty">Persona</span>();
Console.<span class="fn">WriteLine</span>(p.Nome);  <span class="cm">// null (non assegnato!)</span>
Console.<span class="fn">WriteLine</span>(p.Eta);   <span class="cm">// 0</span>

<span class="cm">// ATTENZIONE: accesso a null causa NullReferenceException!</span>
<span class="cm">// Console.WriteLine(p.Nome.Length); → CRASH!</span></pre>

    <h4>Reference Type vs Value Type</h4>
    <pre><span class="cm">// Le classi sono REFERENCE TYPE — la variabile contiene un riferimento:</span>
Persona a = <span class="kw">new</span> <span class="ty">Persona</span>();
a.Nome = <span class="str">"Mario"</span>;

Persona b = a;  <span class="cm">// b punta allo STESSO oggetto di a!</span>
b.Nome = <span class="str">"Luigi"</span>;

Console.<span class="fn">WriteLine</span>(a.Nome);  <span class="cm">// "Luigi" — SORPRESA!</span>
Console.<span class="fn">WriteLine</span>(b.Nome);  <span class="cm">// "Luigi"</span>

<span class="cm">// Per creare una copia separata, devi creare un nuovo oggetto:</span>
Persona c = <span class="kw">new</span> <span class="ty">Persona</span>();
c.Nome = a.Nome;  <span class="cm">// copia il valore</span>
c.Nome = <span class="str">"Peach"</span>;
Console.<span class="fn">WriteLine</span>(a.Nome);  <span class="cm">// "Luigi" — a non cambia</span></pre>
    <div class="warn">Quando assegni un oggetto a un'altra variabile, stai copiando il RIFERIMENTO, non l'oggetto!</div>

    <h4>Progetto Pratico — Sistema Biblioteca</h4>
    <pre><span class="kw">class</span> <span class="ty">Libro</span> {
    <span class="kw">public</span> <span class="ty">string</span> Titolo;
    <span class="kw">public</span> <span class="ty">string</span> Autore;
    <span class="kw">public</span> <span class="ty">int</span>    Pagine;
    <span class="kw">public</span> <span class="ty">bool</span>   Prestato;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        <span class="ty">string</span> stato = Prestato ? <span class="str">"[PRESTATO]"</span> : <span class="str">"[DISPONIBILE]"</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{stato} \"{Titolo}\" di {Autore} ({Pagine} pag.)"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Presta</span>() {
        <span class="kw">if</span> (Prestato) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Libro già in prestito!"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        Prestato = <span class="kw">true</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Hai preso in prestito \"{Titolo}\""</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Restituisci</span>() {
        Prestato = <span class="kw">false</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\"{Titolo}\" restituito. Grazie!"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
Libro libro1 = <span class="kw">new</span> <span class="ty">Libro</span>();
libro1.Titolo = <span class="str">"Il Signore degli Anelli"</span>;
libro1.Autore = <span class="str">"J.R.R. Tolkien"</span>;
libro1.Pagine = <span class="num">1178</span>;

libro1.<span class="fn">Stampa</span>();      <span class="cm">// [DISPONIBILE] "Il Signore..."</span>
libro1.<span class="fn">Presta</span>();      <span class="cm">// Hai preso in prestito...</span>
libro1.<span class="fn">Stampa</span>();      <span class="cm">// [PRESTATO] "Il Signore..."</span>
libro1.<span class="fn">Presta</span>();      <span class="cm">// Libro già in prestito!</span>
libro1.<span class="fn">Restituisci</span>();</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare new:</span>
<span class="cm">// Persona p; p.Nome = "Test"; → ERRORE! p non è inizializzato</span>
Persona p = <span class="kw">new</span> <span class="ty">Persona</span>();  <span class="cm">// OK</span>

<span class="cm">// 2. Accedere a campi null:</span>
Persona q = <span class="kw">new</span> <span class="ty">Persona</span>();
<span class="cm">// int len = q.Nome.Length; → CRASH! Nome è null</span>
<span class="kw">if</span> (q.Nome != <span class="kw">null</span>)
    Console.<span class="fn">WriteLine</span>(q.Nome.Length);  <span class="cm">// OK</span>

<span class="cm">// 3. Confondere classe e oggetto:</span>
<span class="cm">// Persona.Nome = "Test"; → ERRORE! Persona è la classe</span>
<span class="cm">// Devi usare un'istanza: p.Nome = "Test";</span>

<span class="cm">// 4. Modificare tramite copia di riferimento:</span>
Persona orig = <span class="kw">new</span> <span class="ty">Persona</span> { Nome = <span class="str">"A"</span> };
Persona copia = orig;      <span class="cm">// stesso oggetto!</span>
copia.Nome = <span class="str">"B"</span>;
<span class="cm">// orig.Nome ora è "B" — probabilmente non volevi questo!</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una classe "Auto" con: Marca, Modello, Anno, Accesa (bool)</span>
<span class="cm">//    Aggiungi metodi Accendi(), Spegni(), Stampa()</span>

<span class="cm">// 2. Crea una classe "Rettangolo" con: Base, Altezza</span>
<span class="cm">//    Aggiungi metodi Area(), Perimetro(), EQuadrato()</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 3. Crea una classe "ContaClick" con un contatore</span>
<span class="cm">//    Metodi: Click(), Reset(), Stampa()</span>

<span class="cm">// 4. Crea una classe "Studente" con: Nome, Voti (array int[5])</span>
<span class="cm">//    Metodi: AggiungiVoto(int), CalcolaMedia(), Promosso()</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 5. Crea una classe "Playlist" con: Nome, Brani (List&lt;string&gt;)</span>
<span class="cm">//    Metodi: Aggiungi(), Rimuovi(), MostraTutti(), Shuffle()</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Classe Auto ---</span>
<span class="kw">class</span> <span class="ty">Auto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Marca;
    <span class="kw">public</span> <span class="ty">string</span> Modello;
    <span class="kw">public</span> <span class="ty">int</span>    Anno;
    <span class="kw">public</span> <span class="ty">bool</span>   Accesa;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Accendi</span>() {
        <span class="kw">if</span> (!Accesa) { Accesa = <span class="kw">true</span>; Console.<span class="fn">WriteLine</span>(<span class="str">"Vroom!"</span>); }
        <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Già accesa!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Spegni</span>() {
        <span class="kw">if</span> (Accesa) { Accesa = <span class="kw">false</span>; Console.<span class="fn">WriteLine</span>(<span class="str">"Motore spento."</span>); }
        <span class="kw">else</span> Console.<span class="fn">WriteLine</span>(<span class="str">"Già spenta!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() =>
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Marca} {Modello} ({Anno}) - {(Accesa ? "ON" : "OFF")}"</span>);
}

<span class="cm">// --- 2. Classe Rettangolo ---</span>
<span class="kw">class</span> <span class="ty">Rettangolo</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base;
    <span class="kw">public</span> <span class="ty">double</span> Altezza;

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Area</span>()      => Base * Altezza;
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Perimetro</span>() => <span class="num">2</span> * (Base + Altezza);
    <span class="kw">public</span> <span class="ty">bool</span>   <span class="fn">EQuadrato</span>() => Base == Altezza;
}

<span class="cm">// --- 3. Classe ContaClick ---</span>
<span class="kw">class</span> <span class="ty">ContaClick</span> {
    <span class="kw">public</span> <span class="ty">int</span> Conteggio;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Click</span>()  => Conteggio++;
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Reset</span>()  => Conteggio = <span class="num">0</span>;
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">$"Click: {Conteggio}"</span>);
}

<span class="cm">// --- 4. Classe Studente ---</span>
<span class="kw">class</span> <span class="ty">Studente</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">int</span>[] Voti = <span class="kw">new</span> <span class="ty">int</span>[<span class="num">5</span>];
    <span class="kw">private</span> <span class="ty">int</span> indice = <span class="num">0</span>;

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">AggiungiVoto</span>(<span class="ty">int</span> voto) {
        <span class="kw">if</span> (indice >= <span class="num">5</span>) <span class="kw">return</span> <span class="kw">false</span>;
        Voti[indice++] = voto;
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">CalcolaMedia</span>() {
        <span class="kw">if</span> (indice == <span class="num">0</span>) <span class="kw">return</span> <span class="num">0</span>;
        <span class="ty">int</span> somma = <span class="num">0</span>;
        <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; indice; i++) somma += Voti[i];
        <span class="kw">return</span> (<span class="ty">double</span>)somma / indice;
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Promosso</span>() => <span class="fn">CalcolaMedia</span>() >= <span class="num">6</span>;
}

<span class="cm">// --- 5. Classe Playlist ---</span>
<span class="kw">class</span> <span class="ty">Playlist</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; Brani = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(<span class="ty">string</span> brano) => Brani.<span class="fn">Add</span>(brano);
    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">string</span> brano)  => Brani.<span class="fn">Remove</span>(brano);

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">MostraTutti</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"🎵 {Nome} ({Brani.Count} brani):"</span>);
        <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i &lt; Brani.Count; i++)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {i+1}. {Brani[i]}"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Shuffle</span>() {
        Random rnd = <span class="kw">new</span> Random();
        <span class="kw">for</span> (<span class="ty">int</span> i = Brani.Count - <span class="num">1</span>; i > <span class="num">0</span>; i--) {
            <span class="ty">int</span> j = rnd.<span class="fn">Next</span>(i + <span class="num">1</span>);
            (Brani[i], Brani[j]) = (Brani[j], Brani[i]);
        }
    }
}</pre>

  </div>
</div>
      <!-- 2. Costruttori & Object Initializer -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>2. Costruttori &amp; Object Initializer</h3><div class="topic-sub">Costruttore di default, con parametri, overload, object initializer</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è un Costruttore?</h4>
    <p>Un costruttore è un <strong>metodo speciale</strong> che viene chiamato automaticamente quando crei un oggetto con <code>new</code>. Serve per inizializzare l'oggetto con valori validi.</p>
    <table>
      <tr><th>Caratteristica</th><th>Descrizione</th></tr>
      <tr><td>Nome</td><td>Identico al nome della classe</td></tr>
      <tr><td>Tipo di ritorno</td><td>Nessuno (neanche void!)</td></tr>
      <tr><td>Chiamata</td><td>Automatica con new</td></tr>
      <tr><td>Overload</td><td>Puoi averne più di uno</td></tr>
    </table>

    <h4>Costruttore di Default</h4>
    <pre><span class="kw">class</span> <span class="ty">Persona</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">int</span>    Eta;

    <span class="cm">// Costruttore SENZA parametri (default):</span>
    <span class="kw">public</span> <span class="fn">Persona</span>() {
        Nome = <span class="str">"Sconosciuto"</span>;
        Eta  = <span class="num">0</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">"Persona creata!"</span>);
    }
}

Persona p = <span class="kw">new</span> <span class="ty">Persona</span>();  <span class="cm">// stampa "Persona creata!"</span>
Console.<span class="fn">WriteLine</span>(p.Nome);   <span class="cm">// "Sconosciuto"</span></pre>
    <div class="note">Se non definisci nessun costruttore, C# ne crea uno vuoto automaticamente. Ma se definisci UN costruttore con parametri, quello di default NON viene più creato!</div>

    <h4>Costruttore con Parametri</h4>
    <pre><span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Nome;
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo;
    <span class="kw">public</span> <span class="ty">int</span>     Quantita;

    <span class="cm">// Costruttore con parametri — forza a passare valori:</span>
    <span class="kw">public</span> <span class="fn">Prodotto</span>(<span class="ty">string</span> nome, <span class="ty">decimal</span> prezzo) {
        Nome     = nome;
        Prezzo   = prezzo;
        Quantita = <span class="num">0</span>;  <span class="cm">// valore di default</span>
    }
}

<span class="cm">// Ora DEVI passare nome e prezzo:</span>
Prodotto prod = <span class="kw">new</span> <span class="ty">Prodotto</span>(<span class="str">"Laptop"</span>, <span class="num">999.99m</span>);

<span class="cm">// Prodotto prod2 = new Prodotto(); → ERRORE! non esiste più</span></pre>

    <h4>Overload dei Costruttori</h4>
    <pre><span class="kw">class</span> <span class="ty">Auto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Marca;
    <span class="kw">public</span> <span class="ty">string</span> Modello;
    <span class="kw">public</span> <span class="ty">int</span>    Anno;
    <span class="kw">public</span> <span class="ty">string</span> Colore;

    <span class="cm">// 1. Costruttore vuoto:</span>
    <span class="kw">public</span> <span class="fn">Auto</span>() {
        Marca = <span class="str">"Sconosciuta"</span>;
        Anno  = DateTime.Now.Year;
    }

    <span class="cm">// 2. Solo marca:</span>
    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> marca) {
        Marca = marca;
        Anno  = DateTime.Now.Year;
    }

    <span class="cm">// 3. Marca e modello:</span>
    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> marca, <span class="ty">string</span> modello) {
        Marca   = marca;
        Modello = modello;
        Anno    = DateTime.Now.Year;
    }

    <span class="cm">// 4. Completo:</span>
    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> marca, <span class="ty">string</span> modello, <span class="ty">int</span> anno, <span class="ty">string</span> colore) {
        Marca   = marca;
        Modello = modello;
        Anno    = anno;
        Colore  = colore;
    }
}

<span class="cm">// Puoi chiamare qualsiasi costruttore:</span>
Auto a1 = <span class="kw">new</span> <span class="ty">Auto</span>();
Auto a2 = <span class="kw">new</span> <span class="ty">Auto</span>(<span class="str">"Ferrari"</span>);
Auto a3 = <span class="kw">new</span> <span class="ty">Auto</span>(<span class="str">"BMW"</span>, <span class="str">"M3"</span>);
Auto a4 = <span class="kw">new</span> <span class="ty">Auto</span>(<span class="str">"Porsche"</span>, <span class="str">"911"</span>, <span class="num">2023</span>, <span class="str">"Rosso"</span>);</pre>

    <h4>Constructor Chaining con this()</h4>
    <pre><span class="kw">class</span> <span class="ty">Studente</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">int</span>    Eta;
    <span class="kw">public</span> <span class="ty">string</span> Corso;

    <span class="cm">// Costruttore "principale" con tutti i parametri:</span>
    <span class="kw">public</span> <span class="fn">Studente</span>(<span class="ty">string</span> nome, <span class="ty">int</span> eta, <span class="ty">string</span> corso) {
        Nome  = nome;
        Eta   = eta;
        Corso = corso;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Studente {nome} iscritto a {corso}"</span>);
    }

    <span class="cm">// Costruttore con valori di default — chiama l'altro:</span>
    <span class="kw">public</span> <span class="fn">Studente</span>(<span class="ty">string</span> nome, <span class="ty">int</span> eta)
        : <span class="kw">this</span>(nome, eta, <span class="str">"Informatica"</span>) { }  <span class="cm">// riusa il costruttore sopra</span>

    <span class="kw">public</span> <span class="fn">Studente</span>(<span class="ty">string</span> nome)
        : <span class="kw">this</span>(nome, <span class="num">18</span>, <span class="str">"Informatica"</span>) { }

    <span class="kw">public</span> <span class="fn">Studente</span>()
        : <span class="kw">this</span>(<span class="str">"Anonimo"</span>, <span class="num">18</span>, <span class="str">"Informatica"</span>) { }
}</pre>
    <div class="tip">Usa this() per evitare di duplicare codice di inizializzazione. Metti la logica nel costruttore più completo!</div>

    <h4>Parametri con Valori di Default</h4>
    <pre><span class="kw">class</span> <span class="ty">Email</span> {
    <span class="kw">public</span> <span class="ty">string</span> Destinatario;
    <span class="kw">public</span> <span class="ty">string</span> Oggetto;
    <span class="kw">public</span> <span class="ty">string</span> Corpo;
    <span class="kw">public</span> <span class="ty">bool</span>   Urgente;

    <span class="cm">// UN costruttore con parametri opzionali:</span>
    <span class="kw">public</span> <span class="fn">Email</span>(
        <span class="ty">string</span> destinatario,
        <span class="ty">string</span> oggetto = <span class="str">"(Nessun oggetto)"</span>,
        <span class="ty">string</span> corpo   = <span class="str">""</span>,
        <span class="ty">bool</span>   urgente = <span class="kw">false</span>)
    {
        Destinatario = destinatario;
        Oggetto      = oggetto;
        Corpo        = corpo;
        Urgente      = urgente;
    }
}

<span class="cm">// Flessibilità:</span>
Email e1 = <span class="kw">new</span> <span class="ty">Email</span>(<span class="str">"test@email.com"</span>);
Email e2 = <span class="kw">new</span> <span class="ty">Email</span>(<span class="str">"test@email.com"</span>, <span class="str">"Ciao!"</span>);
Email e3 = <span class="kw">new</span> <span class="ty">Email</span>(<span class="str">"test@email.com"</span>, urgente: <span class="kw">true</span>);  <span class="cm">// named argument!</span></pre>

    <h4>Object Initializer — Sintassi Moderna</h4>
    <pre><span class="kw">class</span> <span class="ty">Libro</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Titolo;
    <span class="kw">public</span> <span class="ty">string</span>  Autore;
    <span class="kw">public</span> <span class="ty">int</span>     Pagine;
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo;
}

<span class="cm">// PRIMA (verbose):</span>
Libro libro1 = <span class="kw">new</span> <span class="ty">Libro</span>();
libro1.Titolo = <span class="str">"1984"</span>;
libro1.Autore = <span class="str">"George Orwell"</span>;
libro1.Pagine = <span class="num">328</span>;
libro1.Prezzo = <span class="num">12.99m</span>;

<span class="cm">// DOPO — Object Initializer:</span>
Libro libro2 = <span class="kw">new</span> <span class="ty">Libro</span> {
    Titolo = <span class="str">"1984"</span>,
    Autore = <span class="str">"George Orwell"</span>,
    Pagine = <span class="num">328</span>,
    Prezzo = <span class="num">12.99m</span>
};

<span class="cm">// Funziona anche DOPO un costruttore con parametri:</span>
<span class="kw">class</span> <span class="ty">Giocatore</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome;
    <span class="kw">public</span> <span class="ty">int</span>    Livello;
    <span class="kw">public</span> <span class="ty">int</span>    PuntiVita;

    <span class="kw">public</span> <span class="fn">Giocatore</span>(<span class="ty">string</span> nome) { Nome = nome; }
}

Giocatore g = <span class="kw">new</span> <span class="ty">Giocatore</span>(<span class="str">"Mario"</span>) {
    Livello   = <span class="num">10</span>,     <span class="cm">// impostato DOPO il costruttore</span>
    PuntiVita = <span class="num">100</span>
};</pre>
    <div class="tip">Object Initializer è perfetto per DTO, configurazioni e quando vuoi vedere chiaramente tutti i valori impostati.</div>

    <h4>Target-typed new (C# 9+)</h4>
    <pre><span class="cm">// Prima:</span>
Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">int</span>&gt;&gt; dict = <span class="kw">new</span> Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">int</span>&gt;&gt;();

<span class="cm">// Dopo — target-typed new:</span>
Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">int</span>&gt;&gt; dict2 = <span class="kw">new</span>();  <span class="cm">// il tipo è inferito!</span>

<span class="cm">// Funziona anche con initializer:</span>
Libro libro = <span class="kw">new</span>() { Titolo = <span class="str">"Test"</span>, Pagine = <span class="num">100</span> };

<span class="cm">// E nei parametri dei metodi:</span>
<span class="ty">void</span> <span class="fn">StampaLibro</span>(Libro libro) { }
<span class="fn">StampaLibro</span>(<span class="kw">new</span>() { Titolo = <span class="str">"Inline"</span> });</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare che il costruttore default sparisce:</span>
<span class="kw">class</span> <span class="ty">Test</span> {
    <span class="kw">public</span> <span class="fn">Test</span>(<span class="ty">int</span> x) { }
}
<span class="cm">// Test t = new Test(); → ERRORE! serve parametro</span>
Test t = <span class="kw">new</span> <span class="ty">Test</span>(<span class="num">5</span>);  <span class="cm">// OK</span>

<span class="cm">// 2. Confondere = e { } in object initializer:</span>
<span class="cm">// Libro l = new Libro(Titolo = "Test"); → ERRORE!</span>
Libro l = <span class="kw">new</span> <span class="ty">Libro</span> { Titolo = <span class="str">"Test"</span> };  <span class="cm">// OK</span>

<span class="cm">// 3. Tipo di ritorno nel costruttore:</span>
<span class="cm">// public void Persona() { } → NON è un costruttore, è un metodo!</span>
<span class="cm">// public Persona() { }      → Costruttore corretto</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una classe "Cerchio" con raggio — costruttore obbligatorio</span>
<span class="cm">// 2. Crea "Temperatura" con gradi Celsius — converti in Fahrenheit</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 3. Crea "CartaCredito" con: numero, titolare, scadenza, plafond</span>
<span class="cm">//    3 costruttori: completo, senza scadenza (default: +3 anni), minimo</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 4. Crea "ConfigApp" con valori di default sensati</span>
<span class="cm">//    Host, Port, Timeout, SSL, MaxConnections</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Cerchio ---</span>
<span class="kw">class</span> <span class="ty">Cerchio</span> {
    <span class="kw">public</span> <span class="ty">double</span> Raggio;

    <span class="kw">public</span> <span class="fn">Cerchio</span>(<span class="ty">double</span> raggio) {
        <span class="kw">if</span> (raggio &lt;= <span class="num">0</span>) <span class="kw">throw new</span> ArgumentException(<span class="str">"Raggio deve essere positivo"</span>);
        Raggio = raggio;
    }

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Area</span>()         => Math.PI * Raggio * Raggio;
    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Circonferenza</span>() => <span class="num">2</span> * Math.PI * Raggio;
}

<span class="cm">// --- 2. Temperatura ---</span>
<span class="kw">class</span> <span class="ty">Temperatura</span> {
    <span class="kw">public</span> <span class="ty">double</span> Celsius;

    <span class="kw">public</span> <span class="fn">Temperatura</span>(<span class="ty">double</span> celsius) { Celsius = celsius; }

    <span class="kw">public</span> <span class="ty">double</span> Fahrenheit => Celsius * <span class="num">9.0</span> / <span class="num">5.0</span> + <span class="num">32</span>;
    <span class="kw">public</span> <span class="ty">double</span> Kelvin     => Celsius + <span class="num">273.15</span>;
}

<span class="cm">// --- 3. CartaCredito ---</span>
<span class="kw">class</span> <span class="ty">CartaCredito</span> {
    <span class="kw">public</span> <span class="ty">string</span>   Numero;
    <span class="kw">public</span> <span class="ty">string</span>   Titolare;
    <span class="kw">public</span> DateTime Scadenza;
    <span class="kw">public</span> <span class="ty">decimal</span>  Plafond;

    <span class="kw">public</span> <span class="fn">CartaCredito</span>(<span class="ty">string</span> numero, <span class="ty">string</span> titolare, DateTime scadenza, <span class="ty">decimal</span> plafond) {
        Numero   = numero;
        Titolare = titolare;
        Scadenza = scadenza;
        Plafond  = plafond;
    }

    <span class="kw">public</span> <span class="fn">CartaCredito</span>(<span class="ty">string</span> numero, <span class="ty">string</span> titolare, <span class="ty">decimal</span> plafond)
        : <span class="kw">this</span>(numero, titolare, DateTime.Now.<span class="fn">AddYears</span>(<span class="num">3</span>), plafond) { }

    <span class="kw">public</span> <span class="fn">CartaCredito</span>(<span class="ty">string</span> numero, <span class="ty">string</span> titolare)
        : <span class="kw">this</span>(numero, titolare, <span class="num">1000m</span>) { }
}

<span class="cm">// --- 4. ConfigApp ---</span>
<span class="kw">class</span> <span class="ty">ConfigApp</span> {
    <span class="kw">public</span> <span class="ty">string</span> Host           { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    Port           { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    TimeoutMs      { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span>   UseSSL         { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    MaxConnections { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">ConfigApp</span>(
        <span class="ty">string</span> host           = <span class="str">"localhost"</span>,
        <span class="ty">int</span>    port           = <span class="num">8080</span>,
        <span class="ty">int</span>    timeoutMs      = <span class="num">30000</span>,
        <span class="ty">bool</span>   useSSL         = <span class="kw">true</span>,
        <span class="ty">int</span>    maxConnections = <span class="num">100</span>)
    {
        Host = host; Port = port; TimeoutMs = timeoutMs;
        UseSSL = useSSL; MaxConnections = maxConnections;
    }
}

<span class="kw">var</span> cfg = <span class="kw">new</span> <span class="ty">ConfigApp</span>(port: <span class="num">443</span>, useSSL: <span class="kw">true</span>);  <span class="cm">// named args!</span></pre>

  </div>
</div>
      <!-- 3. Proprietà (Properties) -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>3. Proprietà (Properties)</h3><div class="topic-sub">get/set, auto-property, validazione, read-only, init</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Perché le Proprietà?</h4>
    <p>Le proprietà sono un modo elegante per <strong>controllare l'accesso</strong> ai dati. Permettono di aggiungere validazione, calcoli, e logica senza cambiare l'interfaccia pubblica.</p>
    <table>
      <tr><th>Campo Pubblico</th><th>Proprietà</th></tr>
      <tr><td>Accesso diretto</td><td>Accesso controllato</td></tr>
      <tr><td>Nessuna validazione</td><td>Validazione possibile</td></tr>
      <tr><td>Difficile da refactorare</td><td>Facile da modificare</td></tr>
      <tr><td>public int Eta;</td><td>public int Eta { get; set; }</td></tr>
    </table>

    <h4>Proprietà con Backing Field</h4>
    <pre><span class="kw">class</span> <span class="ty">Persona</span> {
    <span class="cm">// Campo privato (backing field):</span>
    <span class="kw">private</span> <span class="ty">int</span> _eta;

    <span class="cm">// Proprietà pubblica con validazione:</span>
    <span class="kw">public</span> <span class="ty">int</span> Eta {
        <span class="kw">get</span> {
            <span class="kw">return</span> _eta;  <span class="cm">// restituisce il valore</span>
        }
        <span class="kw">set</span> {
            <span class="cm">// 'value' è il valore assegnato dall'utente</span>
            <span class="kw">if</span> (value >= <span class="num">0</span> && value &lt;= <span class="num">150</span>)
                _eta = value;
            <span class="kw">else</span>
                <span class="kw">throw new</span> ArgumentException(<span class="str">"Età non valida"</span>);
        }
    }
}

Persona p = <span class="kw">new</span> <span class="ty">Persona</span>();
p.Eta = <span class="num">25</span>;  <span class="cm">// chiama set { }</span>
Console.<span class="fn">WriteLine</span>(p.Eta);  <span class="cm">// chiama get { } → 25</span>

<span class="cm">// p.Eta = -5;  → ECCEZIONE!</span>
<span class="cm">// p.Eta = 200; → ECCEZIONE!</span></pre>

    <h4>Auto-Property (Forma Breve)</h4>
    <pre><span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="cm">// Auto-property — il backing field è generato automaticamente:</span>
    <span class="kw">public</span> <span class="ty">string</span>  Nome   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// Con valore iniziale:</span>
    <span class="kw">public</span> <span class="ty">int</span>  Quantita    { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">0</span>;
    <span class="kw">public</span> <span class="ty">bool</span> Disponibile { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;

    <span class="cm">// Equivalente a:</span>
    <span class="cm">// private string _nome;</span>
    <span class="cm">// public string Nome { get { return _nome; } set { _nome = value; } }</span>
}</pre>
    <div class="tip">Usa auto-property quando non serve validazione. Puoi sempre aggiungere logica dopo senza modificare il codice che le usa!</div>

    <h4>Read-only e Write-only</h4>
    <pre><span class="kw">class</span> <span class="ty">ContoBancario</span> {
    <span class="kw">private</span> <span class="ty">decimal</span> _saldo;

    <span class="cm">// READ-ONLY — solo getter pubblico:</span>
    <span class="kw">public</span> <span class="ty">decimal</span> Saldo {
        <span class="kw">get</span> { <span class="kw">return</span> _saldo; }
        <span class="kw">private set</span> { _saldo = value; }  <span class="cm">// set privato</span>
    }

    <span class="cm">// Sintassi breve per read-only:</span>
    <span class="kw">public</span> <span class="ty">string</span> IBAN { <span class="kw">get</span>; }  <span class="cm">// solo get, impostabile solo nel costruttore</span>

    <span class="cm">// WRITE-ONLY (raro):</span>
    <span class="kw">private</span> <span class="ty">string</span> _password;
    <span class="kw">public</span> <span class="ty">string</span> Password {
        <span class="kw">set</span> { _password = <span class="fn">HashPassword</span>(value); }  <span class="cm">// niente get!</span>
    }

    <span class="kw">public</span> <span class="fn">ContoBancario</span>(<span class="ty">string</span> iban) {
        IBAN = iban;   <span class="cm">// impostabile solo qui!</span>
        _saldo = <span class="num">0</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Deposita</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">if</span> (importo > <span class="num">0</span>) Saldo += importo;  <span class="cm">// usa private set</span>
    }
}

ContoBancario c = <span class="kw">new</span> <span class="ty">ContoBancario</span>(<span class="str">"IT123456"</span>);
Console.<span class="fn">WriteLine</span>(c.Saldo);  <span class="cm">// OK — lettura</span>
<span class="cm">// c.Saldo = 1000;  → ERRORE! setter è private</span></pre>

    <h4>Init-only Properties (C# 9+)</h4>
    <pre><span class="kw">class</span> <span class="ty">Ordine</span> {
    <span class="kw">public</span> <span class="ty">int</span>      Id      { <span class="kw">get</span>; <span class="kw">init</span>; }  <span class="cm">// solo in inizializzazione</span>
    <span class="kw">public</span> <span class="ty">string</span>   Cliente { <span class="kw">get</span>; <span class="kw">init</span>; }
    <span class="kw">public</span> DateTime Data    { <span class="kw">get</span>; <span class="kw">init</span>; }
}

<span class="cm">// Impostabile con object initializer:</span>
Ordine o = <span class="kw">new</span> <span class="ty">Ordine</span> {
    Id      = <span class="num">1</span>,
    Cliente = <span class="str">"Mario"</span>,
    Data    = DateTime.Now
};

<span class="cm">// Ma NON modificabile dopo:</span>
<span class="cm">// o.Id = 2; → ERRORE! init-only</span></pre>
    <div class="note">init è perfetto per oggetti immutabili: possono essere inizializzati in modo flessibile ma non modificati dopo.</div>

    <h4>Expression-bodied Properties</h4>
    <pre><span class="kw">class</span> <span class="ty">Rettangolo</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base    { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// Proprietà CALCOLATA (read-only) — sintassi =>:</span>
    <span class="kw">public</span> <span class="ty">double</span> Area      => Base * Altezza;
    <span class="kw">public</span> <span class="ty">double</span> Perimetro => <span class="num">2</span> * (Base + Altezza);
    <span class="kw">public</span> <span class="ty">bool</span>   EQuadrato => Base == Altezza;

    <span class="cm">// Expression-bodied con get e set:</span>
    <span class="kw">private</span> <span class="ty">string</span> _nome;
    <span class="kw">public</span> <span class="ty">string</span> Nome {
        <span class="kw">get</span> => _nome;
        <span class="kw">set</span> => _nome = value?.Trim() ?? <span class="str">""</span>;  <span class="cm">// pulisce input</span>
    }
}

Rettangolo r = <span class="kw">new</span> <span class="ty">Rettangolo</span> { Base = <span class="num">5</span>, Altezza = <span class="num">3</span> };
Console.<span class="fn">WriteLine</span>(r.Area);       <span class="cm">// 15 — calcolato al volo!</span>
Console.<span class="fn">WriteLine</span>(r.Perimetro);  <span class="cm">// 16</span></pre>

    <h4>Required Properties (C# 11+)</h4>
    <pre><span class="kw">class</span> <span class="ty">Utente</span> {
    <span class="kw">public</span> <span class="kw">required</span> <span class="ty">string</span> Email    { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// OBBLIGATORIO</span>
    <span class="kw">public</span> <span class="kw">required</span> <span class="ty">string</span> Password { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>? Nome { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// opzionale</span>
}

<span class="cm">// DEVI specificare Email e Password:</span>
Utente u = <span class="kw">new</span> <span class="ty">Utente</span> {
    Email    = <span class="str">"test@mail.com"</span>,
    Password = <span class="str">"secret123"</span>
};

<span class="cm">// Utente u2 = new Utente { Nome = "Mario" }; → ERRORE! manca Email e Password</span></pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Ricorsione infinita nel setter:</span>
<span class="kw">class</span> <span class="ty">Sbagliato</span> {
    <span class="kw">public</span> <span class="ty">int</span> Valore {
        <span class="kw">get</span> { <span class="kw">return</span> Valore; }  <span class="cm">// RICORSIONE! chiama se stesso</span>
        <span class="kw">set</span> { Valore = value; }  <span class="cm">// RICORSIONE! chiama se stesso</span>
    }
    <span class="cm">// → StackOverflowException!</span>
}

<span class="kw">class</span> <span class="ty">Corretto</span> {
    <span class="kw">private</span> <span class="ty">int</span> _valore;  <span class="cm">// backing field</span>
    <span class="kw">public</span> <span class="ty">int</span> Valore {
        <span class="kw">get</span> { <span class="kw">return</span> _valore; }
        <span class="kw">set</span> { _valore = value; }
    }
}

<span class="cm">// 2. Confondere { get; } e { get; set; }:</span>
<span class="kw">public</span> <span class="ty">string</span> ReadOnly  { <span class="kw">get</span>; }       <span class="cm">// solo in costruttore</span>
<span class="kw">public</span> <span class="ty">string</span> ReadWrite { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// ovunque</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea "Temperatura" con Celsius (validato >= -273.15)</span>
<span class="cm">//    Proprietà calcolate: Fahrenheit, Kelvin</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea "Password" con validazione (min 8 char, almeno 1 numero)</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "Scadenza" con Data — proprietà calcolate:</span>
<span class="cm">//    GiorniRimanenti, Scaduta, Urgente (&lt;7 giorni)</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Temperatura ---</span>
<span class="kw">class</span> <span class="ty">Temperatura</span> {
    <span class="kw">private</span> <span class="ty">double</span> _celsius;

    <span class="kw">public</span> <span class="ty">double</span> Celsius {
        <span class="kw">get</span> => _celsius;
        <span class="kw">set</span> {
            <span class="kw">if</span> (value &lt; -<span class="num">273.15</span>)
                <span class="kw">throw new</span> ArgumentException(<span class="str">"Sotto zero assoluto!"</span>);
            _celsius = value;
        }
    }

    <span class="kw">public</span> <span class="ty">double</span> Fahrenheit => Celsius * <span class="num">9.0</span> / <span class="num">5.0</span> + <span class="num">32</span>;
    <span class="kw">public</span> <span class="ty">double</span> Kelvin     => Celsius + <span class="num">273.15</span>;
}

<span class="cm">// --- 2. Password ---</span>
<span class="kw">class</span> <span class="ty">Password</span> {
    <span class="kw">private</span> <span class="ty">string</span> _valore;

    <span class="kw">public</span> <span class="ty">string</span> Valore {
        <span class="kw">get</span> => _valore;
        <span class="kw">set</span> {
            <span class="kw">if</span> (value.Length &lt; <span class="num">8</span>)
                <span class="kw">throw new</span> ArgumentException(<span class="str">"Minimo 8 caratteri"</span>);
            <span class="kw">if</span> (!value.<span class="fn">Any</span>(<span class="ty">char</span>.IsDigit))
                <span class="kw">throw new</span> ArgumentException(<span class="str">"Serve almeno un numero"</span>);
            _valore = value;
        }
    }
}

<span class="cm">// --- 3. Scadenza ---</span>
<span class="kw">class</span> <span class="ty">Scadenza</span> {
    <span class="kw">public</span> DateTime Data { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">int</span>  GiorniRimanenti => (Data - DateTime.Today).Days;
    <span class="kw">public</span> <span class="ty">bool</span> Scaduta         => GiorniRimanenti &lt; <span class="num">0</span>;
    <span class="kw">public</span> <span class="ty">bool</span> Urgente         => !Scaduta && GiorniRimanenti &lt;= <span class="num">7</span>;
}</pre>

  </div>
</div>
      <!-- 4. Incapsulamento -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>4. Incapsulamento</h3><div class="topic-sub">public, private, protected, internal — modificatori di accesso</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è l'Incapsulamento?</h4>
    <p>L'incapsulamento è il principio di <strong>nascondere i dettagli interni</strong> di un oggetto ed esporre solo ciò che serve. Come un'auto: usi volante e pedali, non accedi direttamente al motore.</p>
    <table>
      <tr><th>Senza Incapsulamento</th><th>Con Incapsulamento</th></tr>
      <tr><td>Chiunque può modificare i dati</td><td>Accesso controllato</td></tr>
      <tr><td>Nessuna validazione</td><td>Validazione nei metodi</td></tr>
      <tr><td>Facile corrompere lo stato</td><td>Stato sempre consistente</td></tr>
      <tr><td>Difficile da mantenere</td><td>Facile da modificare</td></tr>
    </table>

    <h4>Modificatori di Accesso</h4>
    <table>
      <tr><th>Modificatore</th><th>Accessibile da</th><th>Uso tipico</th></tr>
      <tr><td>public</td><td>Ovunque</td><td>API pubblica, interfaccia</td></tr>
      <tr><td>private</td><td>Solo dentro la classe</td><td>Dettagli interni, backing fields</td></tr>
      <tr><td>protected</td><td>Classe + classi derivate</td><td>Metodi ereditabili</td></tr>
      <tr><td>internal</td><td>Stesso assembly (.dll)</td><td>Uso interno al progetto</td></tr>
      <tr><td>protected internal</td><td>Derivate O stesso assembly</td><td>Framework, librerie</td></tr>
      <tr><td>private protected</td><td>Derivate E stesso assembly</td><td>Raro, molto restrittivo</td></tr>
      <tr><td>(nessuno)</td><td>private per campi, internal per classi</td><td>Default</td></tr>
    </table>

    <h4>Esempio Base: Campo Privato vs Pubblico</h4>
    <pre><span class="cm">// SBAGLIATO — campo pubblico, nessun controllo:</span>
<span class="kw">class</span> <span class="ty">PersonaSbagliata</span> {
    <span class="kw">public</span> <span class="ty">int</span> Eta;  <span class="cm">// chiunque può scrivere qualsiasi valore!</span>
}

PersonaSbagliata p = <span class="kw">new</span> <span class="ty">PersonaSbagliata</span>();
p.Eta = -<span class="num">50</span>;    <span class="cm">// accettato! ma non ha senso</span>
p.Eta = <span class="num">9999</span>;   <span class="cm">// accettato! impossibile</span>

<span class="cm">// ✓ CORRETTO — campo privato con validazione:</span>
<span class="kw">class</span> <span class="ty">PersonaCorretta</span> {
    <span class="kw">private</span> <span class="ty">int</span> _eta;  <span class="cm">// nascosto!</span>

    <span class="kw">public</span> <span class="ty">int</span> Eta {
        <span class="kw">get</span> => _eta;
        <span class="kw">set</span> {
            <span class="kw">if</span> (value >= <span class="num">0</span> && value &lt;= <span class="num">150</span>)
                _eta = value;
            <span class="kw">else</span>
                <span class="kw">throw new</span> ArgumentException(<span class="str">"Età non valida"</span>);
        }
    }
}

PersonaCorretta p2 = <span class="kw">new</span> <span class="ty">PersonaCorretta</span>();
p2.Eta = <span class="num">25</span>;     <span class="cm">// OK</span>
<span class="cm">// p2.Eta = -50; → ECCEZIONE!</span></pre>

    <h4>Esempio Completo: Conto Bancario Sicuro</h4>
    <pre><span class="kw">class</span> <span class="ty">ContoBancario</span> {
    <span class="cm">// ═══ PRIVATE — nessuno può accedere direttamente ═══</span>
    <span class="kw">private</span> <span class="ty">decimal</span> _saldo;
    <span class="kw">private</span> <span class="ty">string</span>  _pin;
    <span class="kw">private</span> List&lt;<span class="ty">string</span>&gt; _movimenti = <span class="kw">new</span>();
    <span class="kw">private</span> <span class="ty">int</span> _tentativiFalliti = <span class="num">0</span>;

    <span class="cm">// ═══ PUBLIC — interfaccia esposta all'esterno ═══</span>
    <span class="kw">public</span> <span class="ty">string</span>  Intestatario { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  IBAN         { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Saldo        => _saldo;  <span class="cm">// solo lettura!</span>
    <span class="kw">public</span> <span class="ty">bool</span>    Bloccato     => _tentativiFalliti >= <span class="num">3</span>;

    <span class="kw">public</span> <span class="fn">ContoBancario</span>(<span class="ty">string</span> intestatario, <span class="ty">string</span> iban, <span class="ty">string</span> pin) {
        Intestatario = intestatario;
        IBAN         = iban;
        _pin         = pin;
        _saldo       = <span class="num">0</span>;
        <span class="fn">RegistraMovimento</span>(<span class="str">"Conto aperto"</span>);
    }

    <span class="cm">// ═══ Metodi PUBLIC — operazioni controllate ═══</span>
    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Deposita</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">if</span> (importo &lt;= <span class="num">0</span>) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"❌ Importo non valido"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        _saldo += importo;
        <span class="fn">RegistraMovimento</span>(<span class="str">$"Deposito: +{importo:C}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Depositati {importo:C}. Nuovo saldo: {_saldo:C}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Preleva</span>(<span class="ty">decimal</span> importo, <span class="ty">string</span> pin) {
        <span class="kw">if</span> (Bloccato) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"🔒 Conto bloccato! Contatta la banca."</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }

        <span class="kw">if</span> (!<span class="fn">VerificaPin</span>(pin)) {
            _tentativiFalliti++;
            <span class="fn">RegistraMovimento</span>(<span class="str">$"⚠️ TENTATIVO FALLITO #{_tentativiFalliti}"</span>);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"❌ PIN errato! Tentativi rimasti: {3 - _tentativiFalliti}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }

        _tentativiFalliti = <span class="num">0</span>;  <span class="cm">// reset dopo successo</span>

        <span class="kw">if</span> (importo &lt;= <span class="num">0</span> || importo > _saldo) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"❌ Importo non valido o saldo insufficiente"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }

        _saldo -= importo;
        <span class="fn">RegistraMovimento</span>(<span class="str">$"Prelievo: -{importo:C}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Prelevati {importo:C}. Nuovo saldo: {_saldo:C}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">string</span>[] <span class="fn">EstrattoConto</span>(<span class="ty">string</span> pin) {
        <span class="kw">if</span> (!<span class="fn">VerificaPin</span>(pin)) {
            <span class="kw">return</span> <span class="kw">new</span> <span class="ty">string</span>[] { <span class="str">"❌ PIN errato"</span> };
        }
        <span class="cm">// Restituisce COPIA, non la lista originale!</span>
        <span class="kw">return</span> _movimenti.<span class="fn">ToArray</span>();
    }

    <span class="cm">// ═══ Metodi PRIVATE — logica interna nascosta ═══</span>
    <span class="kw">private</span> <span class="ty">bool</span> <span class="fn">VerificaPin</span>(<span class="ty">string</span> pin) {
        <span class="kw">return</span> _pin == pin;
    }

    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">RegistraMovimento</span>(<span class="ty">string</span> descrizione) {
        _movimenti.<span class="fn">Add</span>(<span class="str">$"{DateTime.Now:g} | {descrizione}"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> conto = <span class="kw">new</span> <span class="ty">ContoBancario</span>(<span class="str">"Mario Rossi"</span>, <span class="str">"IT1234567890"</span>, <span class="str">"1234"</span>);
conto.<span class="fn">Deposita</span>(<span class="num">1000</span>);
conto.<span class="fn">Preleva</span>(<span class="num">200</span>, <span class="str">"1234"</span>);   <span class="cm">// OK</span>
conto.<span class="fn">Preleva</span>(<span class="num">100</span>, <span class="str">"0000"</span>);   <span class="cm">// PIN errato!</span>

<span class="cm">// conto._saldo = 1000000;  → ERRORE! _saldo è private</span>
<span class="cm">// conto._pin = "0000";     → ERRORE! _pin è private</span></pre>
    <div class="tip">Restituisci sempre COPIE dei dati interni (ToArray(), ToList()), mai riferimenti diretti a collezioni private!</div>

    <h4>Protected — Per l'Ereditarietà</h4>
    <pre><span class="kw">class</span> <span class="ty">Veicolo</span> {
    <span class="kw">private</span>   <span class="ty">string</span> _numeroTelaio;  <span class="cm">// solo Veicolo può accedere</span>
    <span class="kw">protected</span> <span class="ty">int</span>    _kmPercorsi;    <span class="cm">// Veicolo + classi figlie</span>
    <span class="kw">public</span>    <span class="ty">string</span> Marca;          <span class="cm">// tutti possono accedere</span>

    <span class="kw">public</span> <span class="fn">Veicolo</span>(<span class="ty">string</span> telaio) {
        _numeroTelaio = telaio;
        _kmPercorsi = <span class="num">0</span>;
    }

    <span class="kw">protected</span> <span class="ty">void</span> <span class="fn">AggiornaKm</span>(<span class="ty">int</span> km) {
        <span class="kw">if</span> (km > <span class="num">0</span>) _kmPercorsi += km;
    }

    <span class="kw">public</span> <span class="ty">int</span> KmTotali => _kmPercorsi;
}

<span class="kw">class</span> <span class="ty">Auto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> telaio) : <span class="kw">base</span>(telaio) { }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Guida</span>(<span class="ty">int</span> km) {
        <span class="fn">AggiornaKm</span>(km);  <span class="cm">// ✓ OK — protected accessibile nelle figlie</span>
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Km totali: {_kmPercorsi}"</span>);  <span class="cm">// ✓ OK</span>

        <span class="cm">// Console.WriteLine(_numeroTelaio);  → ERRORE! private</span>
    }
}

<span class="cm">// Dall'esterno:</span>
Auto a = <span class="kw">new</span> <span class="ty">Auto</span>(<span class="str">"ABC123"</span>);
a.<span class="fn">Guida</span>(<span class="num">100</span>);
Console.<span class="fn">WriteLine</span>(a.KmTotali);  <span class="cm">// ✓ OK — proprietà pubblica</span>
<span class="cm">// a._kmPercorsi = 0;  → ERRORE! protected non accessibile dall'esterno</span></pre>

    <h4>Internal — Visibilità a Livello di Assembly</h4>
    <pre><span class="cm">// File: MiaLibreria.dll</span>
<span class="kw">namespace</span> MiaLibreria {
    <span class="cm">// Classe INTERNAL — visibile solo dentro MiaLibreria.dll:</span>
    <span class="kw">internal</span> <span class="kw">class</span> <span class="ty">HelperInterno</span> {
        <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> <span class="fn">FormattaData</span>(DateTime d) => d.<span class="fn">ToString</span>(<span class="str">"yyyy-MM-dd"</span>);
    }

    <span class="cm">// Classe PUBLIC — visibile ovunque:</span>
    <span class="kw">public</span> <span class="kw">class</span> <span class="ty">Servizio</span> {
        <span class="cm">// Metodo INTERNAL — solo dentro la dll:</span>
        <span class="kw">internal</span> <span class="ty">void</span> <span class="fn">MetodoInterno</span>() {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Uso interno"</span>);
        }

        <span class="cm">// Metodo PUBLIC — ovunque:</span>
        <span class="kw">public</span> <span class="ty">void</span> <span class="fn">MetodoPubblico</span>() {
            <span class="cm">// Può usare classi e metodi internal:</span>
            <span class="ty">string</span> data = HelperInterno.<span class="fn">FormattaData</span>(DateTime.Now);
            <span class="fn">MetodoInterno</span>();
        }
    }
}

<span class="cm">// In un ALTRO progetto che referenzia MiaLibreria:</span>
<span class="kw">var</span> s = <span class="kw">new</span> MiaLibreria.Servizio();
s.<span class="fn">MetodoPubblico</span>();    <span class="cm">// ✓ OK</span>
<span class="cm">// s.MetodoInterno();   → ERRORE! internal non visibile</span>
<span class="cm">// new HelperInterno(); → ERRORE! classe internal non visibile</span></pre>

    <h4>Best Practices</h4>
    <pre><span class="kw">class</span> <span class="ty">ClasseBenProgettata</span> {
    <span class="cm">// 1. ✓ Campi SEMPRE private:</span>
    <span class="kw">private</span> <span class="ty">int</span> _contatore;
    <span class="kw">private</span> List&lt;<span class="ty">string</span>&gt; _elementi = <span class="kw">new</span>();
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">object</span> _lock = <span class="kw">new</span>();

    <span class="cm">// 2. ✓ Esponi tramite proprietà read-only o con validazione:</span>
    <span class="kw">public</span> <span class="ty">int</span> Contatore => _contatore;
    <span class="kw">public</span> <span class="ty">int</span> NumeroElementi => _elementi.Count;

    <span class="cm">// 3. ✓ Metodi pubblici con validazione:</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(<span class="ty">string</span> elemento) {
        <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(elemento))
            <span class="kw">throw new</span> ArgumentException(<span class="str">"Elemento non valido"</span>);

        <span class="kw">lock</span> (_lock) {
            _elementi.<span class="fn">Add</span>(elemento);
            _contatore++;
        }
    }

    <span class="cm">// 4. ✓ Restituisci copie, non riferimenti:</span>
    <span class="kw">public</span> IReadOnlyList&lt;<span class="ty">string</span>&gt; <span class="fn">OttieniElementi</span>() {
        <span class="kw">return</span> _elementi.<span class="fn">AsReadOnly</span>();  <span class="cm">// non modificabile!</span>
    }

    <span class="cm">// 5. ✓ Metodi helper private:</span>
    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">ValidaStato</span>() {
        <span class="kw">if</span> (_contatore &lt; <span class="num">0</span>)
            <span class="kw">throw new</span> InvalidOperationException(<span class="str">"Stato corrotto"</span>);
    }
}

<span class="cm">// CLASSE MAL PROGETTATA:</span>
<span class="kw">class</span> <span class="ty">ClasseMalProgettata</span> {
    <span class="kw">public</span> <span class="ty">int</span> contatore;                    <span class="cm">// ❌ pubblico</span>
    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; elementi = <span class="kw">new</span>();  <span class="cm">// ❌ lista pubblica</span>
}

<span class="kw">var</span> bad = <span class="kw">new</span> <span class="ty">ClasseMalProgettata</span>();
bad.contatore = -<span class="num">999</span>;         <span class="cm">// stato corrotto!</span>
bad.elementi.<span class="fn">Clear</span>();         <span class="cm">// svuotata dall'esterno!</span>
bad.elementi = <span class="kw">null</span>;          <span class="cm">// NullReferenceException in arrivo!</span></pre>
    <div class="warn">Mai esporre collezioni mutabili direttamente. Usa IReadOnlyList, AsReadOnly(), o restituisci ToArray()/ToList().</div>

    <h4>Riepilogo Visivo</h4>
    <pre><span class="cm">// Immagina le classi come cerchi concentrici:</span>

<span class="cm">//  ┌─────────────────────────────────────────────┐</span>
<span class="cm">//  │  ASSEMBLY (MiaApp.dll)                      │</span>
<span class="cm">//  │  ┌─────────────────────────────────────┐    │</span>
<span class="cm">//  │  │  CLASSE BASE                        │    │</span>
<span class="cm">//  │  │  ┌─────────────────────────────┐    │    │</span>
<span class="cm">//  │  │  │  CLASSE DERIVATA            │    │    │</span>
<span class="cm">//  │  │  │  ┌─────────────────────┐    │    │    │</span>
<span class="cm">//  │  │  │  │  private           │    │    │    │</span>
<span class="cm">//  │  │  │  └─────────────────────┘    │    │    │</span>
<span class="cm">//  │  │  │  protected ←───────────────→│    │    │</span>
<span class="cm">//  │  │  └─────────────────────────────┘    │    │</span>
<span class="cm">//  │  │  internal ←─────────────────────────→    │</span>
<span class="cm">//  │  └─────────────────────────────────────┘    │</span>
<span class="cm">//  │  public ←───────────────────────────────────→ OVUNQUE</span>
<span class="cm">//  └─────────────────────────────────────────────┘</span></pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Esporre campo invece di proprietà:</span>
<span class="kw">public</span> <span class="ty">int</span> eta;              <span class="cm">// nessun controllo</span>
<span class="kw">public</span> <span class="ty">int</span> Eta { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// ✓ puoi aggiungere validazione dopo</span>

<span class="cm">// 2. Restituire riferimento a collezione interna:</span>
<span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; <span class="fn">GetLista</span>() => _lista;  <span class="cm">// ❌ possono modificarla!</span>
<span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; <span class="fn">GetLista</span>() => _lista.<span class="fn">ToList</span>();  <span class="cm">// ✓ copia</span>

<span class="cm">// 3. Dimenticare di validare input:</span>
<span class="kw">public</span> <span class="ty">void</span> <span class="fn">Imposta</span>(<span class="ty">string</span> valore) {
    _valore = valore;  <span class="cm">// valore potrebbe essere null!</span>
}
<span class="kw">public</span> <span class="ty">void</span> <span class="fn">Imposta</span>(<span class="ty">string</span> valore) {
    _valore = valore ?? <span class="kw">throw new</span> ArgumentNullException();  <span class="cm">// ✓</span>
}

<span class="cm">// 4. Protected per cose che non servono ai figli:</span>
<span class="kw">protected</span> <span class="ty">string</span> _configDatabase;  <span class="cm">// serve davvero ai figli?</span>
<span class="kw">private</span> <span class="ty">string</span> _configDatabase;    <span class="cm">// ✓ se non serve, tienilo private</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea "Cronometro" con tempo interno privato</span>
<span class="cm">//    Metodi pubblici: Start(), Stop(), Reset(), TempoTrascorso</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea "CarrelloSpesa" con lista prodotti privata</span>
<span class="cm">//    Metodi: Aggiungi(nome, prezzo), Rimuovi(nome), Totale, Svuota()</span>
<span class="cm">//    Restituisci solo copie dei dati!</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "GestoreUtenti" che memorizza hash delle password</span>
<span class="cm">//    Metodi: Registra(user, pwd), Verifica(user, pwd), CambiaPassword()</span>
<span class="cm">//    Il pin/password non deve MAI essere accessibile!</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Cronometro ---</span>
<span class="kw">class</span> <span class="ty">Cronometro</span> {
    <span class="kw">private</span> DateTime? _inizio;
    <span class="kw">private</span> TimeSpan _accumulato = TimeSpan.Zero;
    <span class="kw">private</span> <span class="ty">bool</span> _inEsecuzione;

    <span class="kw">public</span> <span class="ty">bool</span> InEsecuzione => _inEsecuzione;

    <span class="kw">public</span> TimeSpan TempoTrascorso {
        <span class="kw">get</span> {
            <span class="kw">if</span> (_inEsecuzione && _inizio.HasValue)
                <span class="kw">return</span> _accumulato + (DateTime.Now - _inizio.Value);
            <span class="kw">return</span> _accumulato;
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Start</span>() {
        <span class="kw">if</span> (!_inEsecuzione) {
            _inizio = DateTime.Now;
            _inEsecuzione = <span class="kw">true</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stop</span>() {
        <span class="kw">if</span> (_inEsecuzione && _inizio.HasValue) {
            _accumulato += DateTime.Now - _inizio.Value;
            _inEsecuzione = <span class="kw">false</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Reset</span>() {
        _accumulato = TimeSpan.Zero;
        _inizio = <span class="kw">null</span>;
        _inEsecuzione = <span class="kw">false</span>;
    }
}

<span class="cm">// --- 2. CarrelloSpesa ---</span>
<span class="kw">class</span> <span class="ty">CarrelloSpesa</span> {
    <span class="kw">private</span> List&lt;(<span class="ty">string</span> Nome, <span class="ty">decimal</span> Prezzo)&gt; _prodotti = <span class="kw">new</span>();

    <span class="kw">public</span> <span class="ty">int</span> NumeroProdotti => _prodotti.Count;
    <span class="kw">public</span> <span class="ty">decimal</span> Totale => _prodotti.<span class="fn">Sum</span>(p => p.Prezzo);
    <span class="kw">public</span> <span class="ty">bool</span> Vuoto => _prodotti.Count == <span class="num">0</span>;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(<span class="ty">string</span> nome, <span class="ty">decimal</span> prezzo) {
        <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(nome))
            <span class="kw">throw new</span> ArgumentException(<span class="str">"Nome non valido"</span>);
        <span class="kw">if</span> (prezzo &lt; <span class="num">0</span>)
            <span class="kw">throw new</span> ArgumentException(<span class="str">"Prezzo non valido"</span>);
        _prodotti.<span class="fn">Add</span>((nome, prezzo));
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">string</span> nome) {
        <span class="kw">var</span> prodotto = _prodotti.<span class="fn">FirstOrDefault</span>(p => p.Nome == nome);
        <span class="kw">if</span> (prodotto != <span class="kw">default</span>) {
            _prodotti.<span class="fn">Remove</span>(prodotto);
            <span class="kw">return</span> <span class="kw">true</span>;
        }
        <span class="kw">return</span> <span class="kw">false</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Svuota</span>() => _prodotti.<span class="fn">Clear</span>();

    <span class="cm">// Restituisce COPIA!</span>
    <span class="kw">public</span> (<span class="ty">string</span> Nome, <span class="ty">decimal</span> Prezzo)[] <span class="fn">OttieniProdotti</span>() {
        <span class="kw">return</span> _prodotti.<span class="fn">ToArray</span>();
    }
}

<span class="cm">// --- 3. GestoreUtenti ---</span>
<span class="kw">class</span> <span class="ty">GestoreUtenti</span> {
    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; _utenti = <span class="kw">new</span>();

    <span class="kw">private</span> <span class="ty">string</span> <span class="fn">Hash</span>(<span class="ty">string</span> password) {
        <span class="cm">// In produzione usa BCrypt o Argon2!</span>
        <span class="kw">using</span> <span class="kw">var</span> sha = System.Security.Cryptography.SHA256.<span class="fn">Create</span>();
        <span class="kw">var</span> bytes = sha.<span class="fn">ComputeHash</span>(System.Text.Encoding.UTF8.<span class="fn">GetBytes</span>(password));
        <span class="kw">return</span> Convert.<span class="fn">ToBase64String</span>(bytes);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Registra</span>(<span class="ty">string</span> username, <span class="ty">string</span> password) {
        <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(username) || <span class="ty">string</span>.IsNullOrWhiteSpace(password))
            <span class="kw">return</span> <span class="kw">false</span>;
        <span class="kw">if</span> (_utenti.<span class="fn">ContainsKey</span>(username))
            <span class="kw">return</span> <span class="kw">false</span>;

        _utenti[username] = <span class="fn">Hash</span>(password);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Verifica</span>(<span class="ty">string</span> username, <span class="ty">string</span> password) {
        <span class="kw">if</span> (!_utenti.<span class="fn">TryGetValue</span>(username, <span class="kw">out var</span> hashSalvato))
            <span class="kw">return</span> <span class="kw">false</span>;
        <span class="kw">return</span> hashSalvato == <span class="fn">Hash</span>(password);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">CambiaPassword</span>(<span class="ty">string</span> username, <span class="ty">string</span> vecchia, <span class="ty">string</span> nuova) {
        <span class="kw">if</span> (!<span class="fn">Verifica</span>(username, vecchia))
            <span class="kw">return</span> <span class="kw">false</span>;
        <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(nuova) || nuova.Length &lt; <span class="num">8</span>)
            <span class="kw">return</span> <span class="kw">false</span>;

        _utenti[username] = <span class="fn">Hash</span>(nuova);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="cm">// NON esiste GetPassword() — le password non sono MAI accessibili!</span>
}</pre>

  </div>
</div>
      <!-- 5. Ereditarietà -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>5. Ereditarietà</h3><div class="topic-sub">class Figlia : Padre, base, override, virtual, sealed</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è l'Ereditarietà?</h4>
    <p>L'ereditarietà permette di creare nuove classi basate su classi esistenti. La classe figlia <strong>eredita</strong> campi, proprietà e metodi dalla classe padre, e può aggiungerne di nuovi o modificarli.</p>
    <table>
      <tr><th>Termine</th><th>Significato</th><th>Esempio</th></tr>
      <tr><td>Classe Base / Padre</td><td>Classe da cui si eredita</td><td>Animale</td></tr>
      <tr><td>Classe Derivata / Figlia</td><td>Classe che eredita</td><td>Cane : Animale</td></tr>
      <tr><td>Ereditare</td><td>Ricevere membri dal padre</td><td>Cane ha Nome come Animale</td></tr>
      <tr><td>Override</td><td>Modificare comportamento ereditato</td><td>Cane.FaiVerso() diverso da Animale</td></tr>
    </table>

    <h4>Sintassi Base</h4>
    <pre><span class="cm">// Classe BASE (padre):</span>
<span class="kw">class</span> <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    Eta  { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Mangia</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} sta mangiando."</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Dormi</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} sta dormendo."</span>);
    }
}

<span class="cm">// Classe DERIVATA (figlia) — eredita tutto da Animale:</span>
<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">Animale</span> {
    <span class="cm">// Aggiunge nuovi membri:</span>
    <span class="kw">public</span> <span class="ty">string</span> Razza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Abbaia</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: BAU BAU!"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Gatto</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="ty">bool</span> PeloLungo { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Miagola</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MIAO!"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
Cane fido = <span class="kw">new</span> <span class="ty">Cane</span>();
fido.Nome  = <span class="str">"Fido"</span>;      <span class="cm">// ereditato da Animale</span>
fido.Eta   = <span class="num">3</span>;           <span class="cm">// ereditato da Animale</span>
fido.Razza = <span class="str">"Labrador"</span>;  <span class="cm">// proprio di Cane</span>

fido.<span class="fn">Mangia</span>();   <span class="cm">// ereditato — "Fido sta mangiando."</span>
fido.<span class="fn">Dormi</span>();    <span class="cm">// ereditato — "Fido sta dormendo."</span>
fido.<span class="fn">Abbaia</span>();   <span class="cm">// proprio   — "Fido dice: BAU BAU!"</span></pre>
    <div class="note">In C# una classe può ereditare da UNA sola classe padre (ereditarietà singola), ma può implementare PIU interfacce.</div>

    <h4>Costruttori e base()</h4>
    <pre><span class="kw">class</span> <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">string</span> Marca { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    Anno  { <span class="kw">get</span>; }

    <span class="cm">// Costruttore della classe base:</span>
    <span class="kw">public</span> <span class="fn">Veicolo</span>(<span class="ty">string</span> marca, <span class="ty">int</span> anno) {
        Marca = marca;
        Anno  = anno;
        Console.<span class="fn">WriteLine</span>(<span class="str">"Costruttore Veicolo chiamato"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Auto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">int</span> NumeroPorte { <span class="kw">get</span>; }

    <span class="cm">// DEVE chiamare il costruttore del padre con base():</span>
    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> marca, <span class="ty">int</span> anno, <span class="ty">int</span> porte)
        : <span class="kw">base</span>(marca, anno)  <span class="cm">// chiama Veicolo(marca, anno)</span>
    {
        NumeroPorte = porte;
        Console.<span class="fn">WriteLine</span>(<span class="str">"Costruttore Auto chiamato"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Moto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">int</span> Cilindrata { <span class="kw">get</span>; }

    <span class="kw">public</span> <span class="fn">Moto</span>(<span class="ty">string</span> marca, <span class="ty">int</span> anno, <span class="ty">int</span> cilindrata)
        : <span class="kw">base</span>(marca, anno)
    {
        Cilindrata = cilindrata;
    }
}

<span class="cm">// Ordine di esecuzione:</span>
Auto bmw = <span class="kw">new</span> <span class="ty">Auto</span>(<span class="str">"BMW"</span>, <span class="num">2023</span>, <span class="num">4</span>);
<span class="cm">// Output:</span>
<span class="cm">// Costruttore Veicolo chiamato</span>
<span class="cm">// Costruttore Auto chiamato</span></pre>
    <div class="warn">I costruttori NON vengono ereditati! Ogni classe derivata deve definire i propri e chiamare quello del padre con base().</div>

    <h4>virtual e override — Polimorfismo</h4>
    <pre><span class="kw">class</span> <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// virtual = "può essere sovrascritto dalle classi figlie"</span>
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} fa un verso generico."</span>);
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">string</span> <span class="fn">Descrizione</span>() {
        <span class="kw">return</span> <span class="str">$"Sono un animale chiamato {Nome}"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">Animale</span> {
    <span class="cm">// override = "sostituisco l'implementazione del padre"</span>
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: BAU!"</span>);
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">Descrizione</span>() {
        <span class="cm">// Chiama la versione del padre e aggiunge:</span>
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fn">Descrizione</span>() + <span class="str">" e sono un cane!"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Gatto</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MIAO!"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Mucca</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MUUUU!"</span>);
    }
}

<span class="cm">// POLIMORFISMO in azione — stesso tipo, comportamenti diversi:</span>
Animale[] zoo = {
    <span class="kw">new</span> <span class="ty">Cane</span>  { Nome = <span class="str">"Fido"</span> },
    <span class="kw">new</span> <span class="ty">Gatto</span> { Nome = <span class="str">"Micia"</span> },
    <span class="kw">new</span> <span class="ty">Mucca</span> { Nome = <span class="str">"Bella"</span> },
    <span class="kw">new</span> <span class="ty">Animale</span> { Nome = <span class="str">"Sconosciuto"</span> }
};

<span class="kw">foreach</span> (Animale a <span class="kw">in</span> zoo) {
    a.<span class="fn">FaiVerso</span>();  <span class="cm">// chiama la versione corretta per ogni tipo!</span>
}
<span class="cm">// Fido dice: BAU!</span>
<span class="cm">// Micia dice: MIAO!</span>
<span class="cm">// Bella dice: MUUUU!</span>
<span class="cm">// Sconosciuto fa un verso generico.</span></pre>

    <h4>sealed — Bloccare l'Ereditarietà</h4>
    <pre><span class="cm">// sealed su CLASSE — nessuno può ereditare:</span>
<span class="kw">sealed</span> <span class="kw">class</span> <span class="ty">Configurazione</span> {
    <span class="kw">public</span> <span class="ty">string</span> NomeApp { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> Versione { <span class="kw">get</span>; <span class="kw">set</span>; }
}
<span class="cm">// class MiaConfig : Configurazione { }  -> ERRORE!</span>

<span class="cm">// sealed su METODO — blocca ulteriori override:</span>
<span class="kw">class</span> <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">Respira</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Respiro..."</span>);
    }
}

<span class="kw">class</span> <span class="ty">Mammifero</span> : <span class="ty">Animale</span> {
    <span class="cm">// sealed + override = "io faccio override, ma nessuno può più farlo"</span>
    <span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Respira</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Respiro con i polmoni"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">Mammifero</span> {
    <span class="cm">// public override void Respira() { }  -> ERRORE! è sealed</span>
}</pre>

    <h4>new — Nascondere Membri (Hiding)</h4>
    <pre><span class="kw">class</span> <span class="ty">Padre</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Metodo</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Padre.Metodo"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Figlio</span> : <span class="ty">Padre</span> {
    <span class="cm">// new = "nascondo il metodo del padre, non faccio override"</span>
    <span class="kw">public</span> <span class="kw">new</span> <span class="ty">void</span> <span class="fn">Metodo</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Figlio.Metodo"</span>);
    }
}

Figlio f = <span class="kw">new</span> <span class="ty">Figlio</span>();
f.<span class="fn">Metodo</span>();  <span class="cm">// "Figlio.Metodo"</span>

Padre p = f;  <span class="cm">// stesso oggetto, tipo diverso</span>
p.<span class="fn">Metodo</span>();  <span class="cm">// "Padre.Metodo" — ATTENZIONE! niente polimorfismo</span>

<span class="cm">// Confronto con virtual/override:</span>
<span class="kw">class</span> <span class="ty">PadreVirtual</span> {
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">Metodo</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Padre"</span>);
}

<span class="kw">class</span> <span class="ty">FiglioOverride</span> : <span class="ty">PadreVirtual</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Metodo</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Figlio"</span>);
}

PadreVirtual pv = <span class="kw">new</span> <span class="ty">FiglioOverride</span>();
pv.<span class="fn">Metodo</span>();  <span class="cm">// "Figlio" — polimorfismo funziona!</span></pre>
    <div class="note">Usa override per polimorfismo (comportamento diverso in base al tipo reale). Usa new solo quando vuoi nascondere intenzionalmente (raro).</div>

    <h4>Gerarchia di Classi — Esempio Completo</h4>
    <pre><span class="cm">// Gerarchia: Dipendente -> Manager / Sviluppatore / Stagista</span>
<span class="kw">class</span> <span class="ty">Dipendente</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> StipendioBase { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">protected</span> <span class="ty">int</span> AnniServizio { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Dipendente</span>(<span class="ty">string</span> nome, <span class="ty">decimal</span> stipendio) {
        Nome = nome;
        StipendioBase = stipendio;
        AnniServizio = <span class="num">0</span>;
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">decimal</span> <span class="fn">CalcolaStipendio</span>() {
        <span class="kw">return</span> StipendioBase;
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">string</span> <span class="fn">GetTitolo</span>() {
        <span class="kw">return</span> <span class="str">"Dipendente"</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{GetTitolo()}: {Nome}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  Stipendio: {CalcolaStipendio():C}"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Manager</span> : <span class="ty">Dipendente</span> {
    <span class="kw">public</span> <span class="ty">decimal</span> Bonus { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> NumeroSubordinati { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Manager</span>(<span class="ty">string</span> nome, <span class="ty">decimal</span> stipendio, <span class="ty">decimal</span> bonus)
        : <span class="kw">base</span>(nome, stipendio) {
        Bonus = bonus;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaStipendio</span>() {
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fn">CalcolaStipendio</span>() + Bonus;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTitolo</span>() {
        <span class="kw">return</span> <span class="str">"Manager"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Sviluppatore</span> : <span class="ty">Dipendente</span> {
    <span class="kw">public</span> <span class="ty">string</span> Linguaggio { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span> Senior { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Sviluppatore</span>(<span class="ty">string</span> nome, <span class="ty">decimal</span> stipendio, <span class="ty">string</span> linguaggio)
        : <span class="kw">base</span>(nome, stipendio) {
        Linguaggio = linguaggio;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaStipendio</span>() {
        <span class="ty">decimal</span> base_stip = <span class="kw">base</span>.<span class="fn">CalcolaStipendio</span>();
        <span class="kw">return</span> Senior ? base_stip * <span class="num">1.2m</span> : base_stip;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTitolo</span>() {
        <span class="kw">return</span> Senior ? <span class="str">"Senior Developer"</span> : <span class="str">"Developer"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Stagista</span> : <span class="ty">Dipendente</span> {
    <span class="kw">public</span> <span class="ty">int</span> MesiRimasti { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Stagista</span>(<span class="ty">string</span> nome, <span class="ty">int</span> mesi)
        : <span class="kw">base</span>(nome, <span class="num">800m</span>) {  <span class="cm">// stipendio fisso</span>
        MesiRimasti = mesi;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTitolo</span>() {
        <span class="kw">return</span> <span class="str">"Stagista"</span>;
    }
}

<span class="cm">// Polimorfismo:</span>
Dipendente[] team = {
    <span class="kw">new</span> <span class="ty">Manager</span>(<span class="str">"Anna"</span>, <span class="num">5000</span>, <span class="num">1000</span>),
    <span class="kw">new</span> <span class="ty">Sviluppatore</span>(<span class="str">"Marco"</span>, <span class="num">3500</span>, <span class="str">"C#"</span>) { Senior = <span class="kw">true</span> },
    <span class="kw">new</span> <span class="ty">Sviluppatore</span>(<span class="str">"Giulia"</span>, <span class="num">2800</span>, <span class="str">"Python"</span>),
    <span class="kw">new</span> <span class="ty">Stagista</span>(<span class="str">"Luca"</span>, <span class="num">6</span>)
};

<span class="ty">decimal</span> costoTotale = <span class="num">0</span>;
<span class="kw">foreach</span> (Dipendente d <span class="kw">in</span> team) {
    d.<span class="fn">Stampa</span>();
    costoTotale += d.<span class="fn">CalcolaStipendio</span>();
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nCosto totale mensile: {costoTotale:C}"</span>);</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare base() nel costruttore:</span>
<span class="kw">class</span> <span class="ty">Padre</span> {
    <span class="kw">public</span> <span class="fn">Padre</span>(<span class="ty">int</span> x) { }
}
<span class="cm">// class Figlio : Padre { }  -> ERRORE! Padre non ha costruttore vuoto</span>
<span class="kw">class</span> <span class="ty">Figlio</span> : <span class="ty">Padre</span> {
    <span class="kw">public</span> <span class="fn">Figlio</span>(<span class="ty">int</span> x) : <span class="kw">base</span>(x) { }  <span class="cm">// OK</span>
}

<span class="cm">// 2. Dimenticare virtual nel padre:</span>
<span class="kw">class</span> <span class="ty">A</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Metodo</span>() { }  <span class="cm">// NON è virtual!</span>
}
<span class="kw">class</span> <span class="ty">B</span> : <span class="ty">A</span> {
    <span class="cm">// public override void Metodo() { }  -> ERRORE!</span>
    <span class="kw">public</span> <span class="kw">new</span> <span class="ty">void</span> <span class="fn">Metodo</span>() { }  <span class="cm">// compila ma niente polimorfismo</span>
}

<span class="cm">// 3. Accedere a membri private del padre:</span>
<span class="kw">class</span> <span class="ty">Padre2</span> {
    <span class="kw">private</span> <span class="ty">int</span> _segreto = <span class="num">42</span>;
    <span class="kw">protected</span> <span class="ty">int</span> _visibile = <span class="num">10</span>;
}
<span class="kw">class</span> <span class="ty">Figlio2</span> : <span class="ty">Padre2</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Test</span>() {
        <span class="cm">// Console.WriteLine(_segreto);  -> ERRORE! private</span>
        Console.<span class="fn">WriteLine</span>(_visibile);    <span class="cm">// OK — protected</span>
    }
}

<span class="cm">// 4. Ereditarietà multipla (non supportata):</span>
<span class="kw">class</span> <span class="ty">ClasseA</span> { }
<span class="kw">class</span> <span class="ty">ClasseB</span> { }
<span class="cm">// class ClasseC : ClasseA, ClasseB { }  -> ERRORE!</span>
<span class="cm">// Usa interfacce per "ereditarietà multipla"</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Gerarchia: Forma -> Rettangolo, Cerchio, Triangolo</span>
<span class="cm">//    Metodo virtuale: CalcolaArea()</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Gerarchia: Veicolo -> Auto, Moto, Camion</span>
<span class="cm">//    Proprietà comuni: Marca, Targa, KmPercorsi</span>
<span class="cm">//    Metodo virtuale: CalcolaBollo()</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Sistema di gioco RPG:</span>
<span class="cm">//    Personaggio -> Guerriero, Mago, Arciere</span>
<span class="cm">//    Metodi: Attacca(), Difendi(), UsaAbilitaSpeciale()</span>
<span class="cm">//    Ogni classe ha statistiche e comportamenti diversi</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Forme geometriche ---</span>
<span class="kw">class</span> <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => <span class="num">0</span>;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome}: Area = {CalcolaArea():F2}"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Rettangolo</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Rettangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> h) {
        Nome = <span class="str">"Rettangolo"</span>;
        Base = b;
        Altezza = h;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Base * Altezza;
}

<span class="kw">class</span> <span class="ty">Cerchio</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Raggio { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Cerchio</span>(<span class="ty">double</span> r) {
        Nome = <span class="str">"Cerchio"</span>;
        Raggio = r;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Math.PI * Raggio * Raggio;
}

<span class="kw">class</span> <span class="ty">Triangolo</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Triangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> h) {
        Nome = <span class="str">"Triangolo"</span>;
        Base = b;
        Altezza = h;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Base * Altezza / <span class="num">2</span>;
}

<span class="cm">// --- 2. Veicoli e bollo ---</span>
<span class="kw">class</span> <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">string</span> Marca { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Targa { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> KW { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Veicolo</span>(<span class="ty">string</span> marca, <span class="ty">string</span> targa, <span class="ty">int</span> kw) {
        Marca = marca;
        Targa = targa;
        KW = kw;
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">decimal</span> <span class="fn">CalcolaBollo</span>() {
        <span class="kw">return</span> KW * <span class="num">2.58m</span>;  <span class="cm">// tariffa base</span>
    }
}

<span class="kw">class</span> <span class="ty">Auto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">bool</span> Euro6 { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Auto</span>(<span class="ty">string</span> marca, <span class="ty">string</span> targa, <span class="ty">int</span> kw)
        : <span class="kw">base</span>(marca, targa, kw) { }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaBollo</span>() {
        <span class="ty">decimal</span> bollo = <span class="kw">base</span>.<span class="fn">CalcolaBollo</span>();
        <span class="kw">return</span> Euro6 ? bollo * <span class="num">0.9m</span> : bollo;  <span class="cm">// sconto 10% Euro6</span>
    }
}

<span class="kw">class</span> <span class="ty">Moto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="fn">Moto</span>(<span class="ty">string</span> marca, <span class="ty">string</span> targa, <span class="ty">int</span> kw)
        : <span class="kw">base</span>(marca, targa, kw) { }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaBollo</span>() {
        <span class="kw">return</span> KW * <span class="num">1.80m</span>;  <span class="cm">// tariffa moto</span>
    }
}

<span class="kw">class</span> <span class="ty">Camion</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">int</span> Portata { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// tonnellate</span>

    <span class="kw">public</span> <span class="fn">Camion</span>(<span class="ty">string</span> marca, <span class="ty">string</span> targa, <span class="ty">int</span> kw, <span class="ty">int</span> portata)
        : <span class="kw">base</span>(marca, targa, kw) {
        Portata = portata;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaBollo</span>() {
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fn">CalcolaBollo</span>() + (Portata * <span class="num">50m</span>);
    }
}

<span class="cm">// --- 3. Sistema RPG ---</span>
<span class="kw">class</span> <span class="ty">Personaggio</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> HP { <span class="kw">get</span>; <span class="kw">protected set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> MaxHP { <span class="kw">get</span>; <span class="kw">protected set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> Livello { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">1</span>;

    <span class="kw">public</span> <span class="fn">Personaggio</span>(<span class="ty">string</span> nome, <span class="ty">int</span> hp) {
        Nome = nome;
        HP = hp;
        MaxHP = hp;
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">int</span> <span class="fn">Attacca</span>() {
        <span class="ty">int</span> danno = Livello * <span class="num">5</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} attacca per {danno} danni!"</span>);
        <span class="kw">return</span> danno;
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">Difendi</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} si mette in difesa."</span>);
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">UsaAbilitaSpeciale</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} non ha abilita speciali."</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">SubisciDanno</span>(<span class="ty">int</span> danno) {
        HP = Math.<span class="fn">Max</span>(<span class="num">0</span>, HP - danno);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} subisce {danno} danni. HP: {HP}/{MaxHP}"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Guerriero</span> : <span class="ty">Personaggio</span> {
    <span class="kw">public</span> <span class="ty">int</span> Forza { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">15</span>;

    <span class="kw">public</span> <span class="fn">Guerriero</span>(<span class="ty">string</span> nome) : <span class="kw">base</span>(nome, <span class="num">150</span>) { }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">int</span> <span class="fn">Attacca</span>() {
        <span class="ty">int</span> danno = Livello * <span class="num">5</span> + Forza;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} colpisce con la spada per {danno} danni!"</span>);
        <span class="kw">return</span> danno;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">UsaAbilitaSpeciale</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} usa FURIA! Forza raddoppiata per il prossimo turno!"</span>);
        Forza *= <span class="num">2</span>;
    }
}

<span class="kw">class</span> <span class="ty">Mago</span> : <span class="ty">Personaggio</span> {
    <span class="kw">public</span> <span class="ty">int</span> Mana { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">100</span>;
    <span class="kw">public</span> <span class="ty">int</span> Intelligenza { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">20</span>;

    <span class="kw">public</span> <span class="fn">Mago</span>(<span class="ty">string</span> nome) : <span class="kw">base</span>(nome, <span class="num">80</span>) { }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">int</span> <span class="fn">Attacca</span>() {
        <span class="kw">if</span> (Mana >= <span class="num">10</span>) {
            Mana -= <span class="num">10</span>;
            <span class="ty">int</span> danno = Livello * <span class="num">3</span> + Intelligenza;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} lancia un incantesimo per {danno} danni! (Mana: {Mana})"</span>);
            <span class="kw">return</span> danno;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} non ha abbastanza mana!"</span>);
        <span class="kw">return</span> <span class="num">0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">UsaAbilitaSpeciale</span>() {
        <span class="kw">if</span> (Mana >= <span class="num">50</span>) {
            Mana -= <span class="num">50</span>;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} lancia PALLA DI FUOCO! Danni enormi a tutti i nemici!"</span>);
        } <span class="kw">else</span> {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} non ha abbastanza mana per l'abilita speciale!"</span>);
        }
    }
}

<span class="kw">class</span> <span class="ty">Arciere</span> : <span class="ty">Personaggio</span> {
    <span class="kw">public</span> <span class="ty">int</span> Frecce { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">30</span>;
    <span class="kw">public</span> <span class="ty">int</span> Precisione { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">18</span>;

    <span class="kw">public</span> <span class="fn">Arciere</span>(<span class="ty">string</span> nome) : <span class="kw">base</span>(nome, <span class="num">100</span>) { }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">int</span> <span class="fn">Attacca</span>() {
        <span class="kw">if</span> (Frecce > <span class="num">0</span>) {
            Frecce--;
            <span class="ty">int</span> danno = Livello * <span class="num">4</span> + Precisione;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} scocca una freccia per {danno} danni! (Frecce: {Frecce})"</span>);
            <span class="kw">return</span> danno;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} ha finito le frecce!"</span>);
        <span class="kw">return</span> <span class="num">0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">UsaAbilitaSpeciale</span>() {
        <span class="kw">if</span> (Frecce >= <span class="num">3</span>) {
            Frecce -= <span class="num">3</span>;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} usa PIOGGIA DI FRECCE! Colpisce tutti i nemici!"</span>);
        } <span class="kw">else</span> {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} non ha abbastanza frecce!"</span>);
        }
    }
}</pre>

  </div>
</div>
      <!-- 6. Interfacce -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>6. Interfacce</h3><div class="topic-sub">interface, implementazione multipla, contratto</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'e un'Interfaccia?</h4>
    <p>Un'interfaccia e un <strong>contratto</strong>: definisce COSA una classe deve fare, non COME lo fa. E come una lista di requisiti che una classe promette di soddisfare.</p>
    <table>
      <tr><th>Interfaccia</th><th>Classe Astratta</th></tr>
      <tr><td>Solo firme (niente codice)*</td><td>Puo avere implementazione</td></tr>
      <tr><td>Implementazione multipla</td><td>Ereditarieta singola</td></tr>
      <tr><td>Niente campi</td><td>Puo avere campi</td></tr>
      <tr><td>Niente costruttore</td><td>Puo avere costruttore</td></tr>
      <tr><td>Membri implicitamente public</td><td>Qualsiasi visibilita</td></tr>
    </table>
    <div class="note">*Da C# 8, le interfacce possono avere implementazioni di default (Default Interface Methods).</div>

    <h4>Sintassi Base</h4>
    <pre><span class="cm">// Interfaccia — per convenzione inizia con 'I':</span>
<span class="kw">interface</span> <span class="ty">IAnimale</span> {
    <span class="cm">// Solo firme — niente corpo!</span>
    <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="ty">void</span> <span class="fn">FaiVerso</span>();
    <span class="ty">void</span> <span class="fn">Mangia</span>(<span class="ty">string</span> cibo);
}

<span class="cm">// Classe che IMPLEMENTA l'interfaccia:</span>
<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">IAnimale</span> {
    <span class="cm">// DEVE implementare TUTTO cio che e nell'interfaccia:</span>
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: BAU!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Mangia</span>(<span class="ty">string</span> cibo) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} mangia {cibo}"</span>);
    }

    <span class="cm">// Puo avere metodi aggiuntivi:</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Annusa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"*sniff sniff*"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Gatto</span> : <span class="ty">IAnimale</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MIAO!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Mangia</span>(<span class="ty">string</span> cibo) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} mangia {cibo} con eleganza"</span>);
    }
}

<span class="cm">// Utilizzo tramite interfaccia:</span>
IAnimale animale1 = <span class="kw">new</span> <span class="ty">Cane</span> { Nome = <span class="str">"Fido"</span> };
IAnimale animale2 = <span class="kw">new</span> <span class="ty">Gatto</span> { Nome = <span class="str">"Micia"</span> };

animale1.<span class="fn">FaiVerso</span>();  <span class="cm">// Fido dice: BAU!</span>
animale2.<span class="fn">FaiVerso</span>();  <span class="cm">// Micia dice: MIAO!</span></pre>

    <h4>Implementazione Multipla</h4>
    <pre><span class="cm">// Una classe puo implementare PIU interfacce:</span>
<span class="kw">interface</span> <span class="ty">IVolante</span> {
    <span class="ty">void</span> <span class="fn">Decolla</span>();
    <span class="ty">void</span> <span class="fn">Atterra</span>();
    <span class="ty">double</span> Altitudine { <span class="kw">get</span>; }
}

<span class="kw">interface</span> <span class="ty">INuotante</span> {
    <span class="ty">void</span> <span class="fn">Nuota</span>();
    <span class="ty">double</span> Profondita { <span class="kw">get</span>; }
}

<span class="kw">interface</span> <span class="ty">ICamminante</span> {
    <span class="ty">void</span> <span class="fn">Cammina</span>();
    <span class="ty">double</span> Velocita { <span class="kw">get</span>; }
}

<span class="cm">// Anatra implementa TUTTE e tre le interfacce:</span>
<span class="kw">class</span> <span class="ty">Anatra</span> : <span class="ty">IVolante</span>, <span class="ty">INuotante</span>, <span class="ty">ICamminante</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altitudine { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Profondita { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Velocita { <span class="kw">get</span>; <span class="kw">private set</span>; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Decolla</span>() {
        Altitudine = <span class="num">100</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} decolla!"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Atterra</span>() {
        Altitudine = <span class="num">0</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} atterra."</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Nuota</span>() {
        Profondita = <span class="num">0.5</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} nuota."</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Cammina</span>() {
        Velocita = <span class="num">2</span>;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} cammina."</span>);
    }
}

<span class="cm">// Puoi usare l'anatra come qualsiasi delle interfacce:</span>
Anatra paperino = <span class="kw">new</span> <span class="ty">Anatra</span> { Nome = <span class="str">"Paperino"</span> };

IVolante volatore = paperino;
volatore.<span class="fn">Decolla</span>();

INuotante nuotatore = paperino;
nuotatore.<span class="fn">Nuota</span>();

ICamminante camminatore = paperino;
camminatore.<span class="fn">Cammina</span>();</pre>

    <h4>Interfacce come Parametri e Collezioni</h4>
    <pre><span class="kw">interface</span> <span class="ty">IStampabile</span> {
    <span class="ty">string</span> <span class="fn">FormattaPerStampa</span>();
}

<span class="kw">class</span> <span class="ty">Fattura</span> : <span class="ty">IStampabile</span> {
    <span class="kw">public</span> <span class="ty">int</span> Numero { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Totale { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">FormattaPerStampa</span>() {
        <span class="kw">return</span> <span class="str">$"FATTURA #{Numero} - Totale: {Totale:C}"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Report</span> : <span class="ty">IStampabile</span> {
    <span class="kw">public</span> <span class="ty">string</span> Titolo { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> DateTime Data { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">FormattaPerStampa</span>() {
        <span class="kw">return</span> <span class="str">$"REPORT: {Titolo} ({Data:d})"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Email</span> : <span class="ty">IStampabile</span> {
    <span class="kw">public</span> <span class="ty">string</span> Destinatario { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Oggetto { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">FormattaPerStampa</span>() {
        <span class="kw">return</span> <span class="str">$"EMAIL a {Destinatario}: {Oggetto}"</span>;
    }
}

<span class="cm">// Metodo che accetta QUALSIASI cosa stampabile:</span>
<span class="kw">class</span> <span class="ty">Stampante</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>(IStampabile documento) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"=== STAMPA ==="</span>);
        Console.<span class="fn">WriteLine</span>(documento.<span class="fn">FormattaPerStampa</span>());
        Console.<span class="fn">WriteLine</span>(<span class="str">"=============="</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaTutti</span>(IEnumerable&lt;IStampabile&gt; documenti) {
        <span class="kw">foreach</span> (<span class="kw">var</span> doc <span class="kw">in</span> documenti) {
            <span class="fn">Stampa</span>(doc);
        }
    }
}

<span class="cm">// Utilizzo:</span>
Stampante stampante = <span class="kw">new</span> <span class="ty">Stampante</span>();

List&lt;IStampabile&gt; documenti = <span class="kw">new</span> List&lt;IStampabile&gt; {
    <span class="kw">new</span> <span class="ty">Fattura</span> { Numero = <span class="num">1</span>, Totale = <span class="num">150.00m</span> },
    <span class="kw">new</span> <span class="ty">Report</span> { Titolo = <span class="str">"Vendite Q1"</span>, Data = DateTime.Now },
    <span class="kw">new</span> <span class="ty">Email</span> { Destinatario = <span class="str">"cliente@mail.com"</span>, Oggetto = <span class="str">"Conferma ordine"</span> }
};

stampante.<span class="fn">StampaTutti</span>(documenti);</pre>

    <h4>Implementazione Esplicita</h4>
    <pre><span class="cm">// Quando due interfacce hanno membri con lo stesso nome:</span>
<span class="kw">interface</span> <span class="ty">IAmericano</span> {
    <span class="ty">string</span> <span class="fn">GetCalcio</span>();  <span class="cm">// football americano</span>
}

<span class="kw">interface</span> <span class="ty">IEuropeo</span> {
    <span class="ty">string</span> <span class="fn">GetCalcio</span>();  <span class="cm">// calcio = soccer</span>
}

<span class="kw">class</span> <span class="ty">Sport</span> : <span class="ty">IAmericano</span>, <span class="ty">IEuropeo</span> {
    <span class="cm">// Implementazione ESPLICITA — specifica quale interfaccia:</span>
    <span class="ty">string</span> IAmericano.<span class="fn">GetCalcio</span>() {
        <span class="kw">return</span> <span class="str">"Football americano (NFL)"</span>;
    }

    <span class="ty">string</span> IEuropeo.<span class="fn">GetCalcio</span>() {
        <span class="kw">return</span> <span class="str">"Calcio (Serie A)"</span>;
    }
}

Sport sport = <span class="kw">new</span> <span class="ty">Sport</span>();
<span class="cm">// sport.GetCalcio();  -> ERRORE! ambiguo</span>

<span class="cm">// Devi castare all'interfaccia specifica:</span>
IAmericano usa = sport;
Console.<span class="fn">WriteLine</span>(usa.<span class="fn">GetCalcio</span>());  <span class="cm">// Football americano (NFL)</span>

IEuropeo eu = sport;
Console.<span class="fn">WriteLine</span>(eu.<span class="fn">GetCalcio</span>());   <span class="cm">// Calcio (Serie A)</span>

<span class="cm">// Oppure cast inline:</span>
Console.<span class="fn">WriteLine</span>(((IAmericano)sport).<span class="fn">GetCalcio</span>());
Console.<span class="fn">WriteLine</span>(((IEuropeo)sport).<span class="fn">GetCalcio</span>());</pre>

    <h4>Default Interface Methods (C# 8+)</h4>
    <pre><span class="kw">interface</span> <span class="ty">ILogger</span> {
    <span class="ty">void</span> <span class="fn">Log</span>(<span class="ty">string</span> messaggio);

    <span class="cm">// Metodo con implementazione di default:</span>
    <span class="ty">void</span> <span class="fn">LogError</span>(<span class="ty">string</span> messaggio) {
        <span class="fn">Log</span>(<span class="str">$"[ERRORE] {messaggio}"</span>);
    }

    <span class="ty">void</span> <span class="fn">LogWarning</span>(<span class="ty">string</span> messaggio) {
        <span class="fn">Log</span>(<span class="str">$"[WARNING] {messaggio}"</span>);
    }

    <span class="ty">void</span> <span class="fn">LogInfo</span>(<span class="ty">string</span> messaggio) {
        <span class="fn">Log</span>(<span class="str">$"[INFO] {messaggio}"</span>);
    }
}

<span class="cm">// La classe deve implementare solo Log():</span>
<span class="kw">class</span> <span class="ty">ConsoleLogger</span> : <span class="ty">ILogger</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Log</span>(<span class="ty">string</span> messaggio) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{DateTime.Now:HH:mm:ss} - {messaggio}"</span>);
    }
}

<span class="cm">// FileLogger usa i metodi default per Warning e Info:</span>
<span class="kw">class</span> <span class="ty">FileLogger</span> : <span class="ty">ILogger</span> {
    <span class="kw">private</span> <span class="ty">string</span> _filePath;

    <span class="kw">public</span> <span class="fn">FileLogger</span>(<span class="ty">string</span> path) { _filePath = path; }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Log</span>(<span class="ty">string</span> messaggio) {
        File.<span class="fn">AppendAllText</span>(_filePath, <span class="str">$"{DateTime.Now}: {messaggio}\n"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
ILogger logger = <span class="kw">new</span> <span class="ty">ConsoleLogger</span>();
logger.<span class="fn">Log</span>(<span class="str">"Messaggio normale"</span>);
logger.<span class="fn">LogError</span>(<span class="str">"Qualcosa e andato storto"</span>);
logger.<span class="fn">LogWarning</span>(<span class="str">"Attenzione"</span>);</pre>

    <h4>Interfacce Comuni in .NET</h4>
    <table>
      <tr><th>Interfaccia</th><th>Scopo</th><th>Metodi principali</th></tr>
      <tr><td>IEnumerable&lt;T&gt;</td><td>Iterazione con foreach</td><td>GetEnumerator()</td></tr>
      <tr><td>ICollection&lt;T&gt;</td><td>Collezione modificabile</td><td>Add(), Remove(), Count</td></tr>
      <tr><td>IList&lt;T&gt;</td><td>Lista con indice</td><td>this[index], Insert()</td></tr>
      <tr><td>IComparable&lt;T&gt;</td><td>Confronto per ordinamento</td><td>CompareTo()</td></tr>
      <tr><td>IEquatable&lt;T&gt;</td><td>Uguaglianza tipizzata</td><td>Equals()</td></tr>
      <tr><td>IDisposable</td><td>Rilascio risorse</td><td>Dispose()</td></tr>
      <tr><td>ICloneable</td><td>Clonazione oggetti</td><td>Clone()</td></tr>
    </table>

    <h4>Esempio: IComparable per Ordinamento</h4>
    <pre><span class="kw">class</span> <span class="ty">Studente</span> : IComparable&lt;Studente&gt; {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Media { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// Implementa CompareTo per ordinare per media (decrescente):</span>
    <span class="kw">public</span> <span class="ty">int</span> <span class="fn">CompareTo</span>(Studente altro) {
        <span class="kw">if</span> (altro == <span class="kw">null</span>) <span class="kw">return</span> <span class="num">1</span>;
        <span class="cm">// Ordine decrescente: altro.Media - this.Media</span>
        <span class="kw">return</span> altro.Media.<span class="fn">CompareTo</span>(<span class="kw">this</span>.Media);
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() {
        <span class="kw">return</span> <span class="str">$"{Nome}: {Media:F2}"</span>;
    }
}

List&lt;Studente&gt; studenti = <span class="kw">new</span> List&lt;Studente&gt; {
    <span class="kw">new</span> <span class="ty">Studente</span> { Nome = <span class="str">"Marco"</span>, Media = <span class="num">7.5</span> },
    <span class="kw">new</span> <span class="ty">Studente</span> { Nome = <span class="str">"Anna"</span>, Media = <span class="num">9.0</span> },
    <span class="kw">new</span> <span class="ty">Studente</span> { Nome = <span class="str">"Luca"</span>, Media = <span class="num">6.5</span> }
};

studenti.<span class="fn">Sort</span>();  <span class="cm">// usa CompareTo automaticamente</span>

<span class="kw">foreach</span> (<span class="kw">var</span> s <span class="kw">in</span> studenti) {
    Console.<span class="fn">WriteLine</span>(s);
}
<span class="cm">// Anna: 9.00</span>
<span class="cm">// Marco: 7.50</span>
<span class="cm">// Luca: 6.50</span></pre>

    <h4>Esempio: IDisposable</h4>
    <pre><span class="kw">class</span> <span class="ty">DatabaseConnection</span> : IDisposable {
    <span class="kw">private</span> <span class="ty">bool</span> _disposed = <span class="kw">false</span>;
    <span class="kw">private</span> <span class="ty">string</span> _connectionString;

    <span class="kw">public</span> <span class="fn">DatabaseConnection</span>(<span class="ty">string</span> connString) {
        _connectionString = connString;
        Console.<span class="fn">WriteLine</span>(<span class="str">"Connessione aperta"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Query</span>(<span class="ty">string</span> sql) {
        <span class="kw">if</span> (_disposed)
            <span class="kw">throw new</span> ObjectDisposedException(<span class="kw">nameof</span>(DatabaseConnection));
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Esecuzione: {sql}"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Dispose</span>() {
        <span class="kw">if</span> (!_disposed) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Connessione chiusa"</span>);
            _disposed = <span class="kw">true</span>;
        }
    }
}

<span class="cm">// Utilizzo con using — Dispose() chiamato automaticamente:</span>
<span class="kw">using</span> (<span class="kw">var</span> db = <span class="kw">new</span> <span class="ty">DatabaseConnection</span>(<span class="str">"Server=localhost"</span>)) {
    db.<span class="fn">Query</span>(<span class="str">"SELECT * FROM utenti"</span>);
}  <span class="cm">// Dispose() chiamato qui</span>

<span class="cm">// Sintassi moderna (C# 8+):</span>
<span class="kw">using</span> <span class="kw">var</span> db2 = <span class="kw">new</span> <span class="ty">DatabaseConnection</span>(<span class="str">"Server=localhost"</span>);
db2.<span class="fn">Query</span>(<span class="str">"SELECT * FROM prodotti"</span>);
<span class="cm">// Dispose() chiamato alla fine del blocco</span></pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare di implementare tutti i membri:</span>
<span class="kw">interface</span> <span class="ty">IVeicolo</span> {
    <span class="ty">void</span> <span class="fn">Avvia</span>();
    <span class="ty">void</span> <span class="fn">Ferma</span>();
    <span class="ty">int</span> Velocita { <span class="kw">get</span>; }
}
<span class="cm">// class Auto : IVeicolo { public void Avvia() { } }</span>
<span class="cm">// ERRORE! Manca Ferma() e Velocita</span>

<span class="cm">// 2. Confondere interfaccia e classe astratta:</span>
<span class="cm">// interface non puo avere campi:</span>
<span class="kw">interface</span> <span class="ty">ISbagliato</span> {
    <span class="cm">// int _campo;  -> ERRORE!</span>
    <span class="ty">int</span> Proprieta { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// OK</span>
}

<span class="cm">// 3. Dimenticare public nell'implementazione:</span>
<span class="kw">class</span> <span class="ty">MiaClasse</span> : <span class="ty">IAnimale</span> {
    <span class="cm">// void FaiVerso() { }  -> ERRORE! deve essere public</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() { }  <span class="cm">// OK</span>
}

<span class="cm">// 4. Accedere a metodi espliciti senza cast:</span>
<span class="kw">class</span> <span class="ty">MiaClasse2</span> : <span class="ty">IAmericano</span>, <span class="ty">IEuropeo</span> {
    <span class="ty">string</span> IAmericano.<span class="fn">GetCalcio</span>() => <span class="str">"NFL"</span>;
    <span class="ty">string</span> IEuropeo.<span class="fn">GetCalcio</span>() => <span class="str">"Serie A"</span>;
}
MiaClasse2 obj = <span class="kw">new</span> <span class="ty">MiaClasse2</span>();
<span class="cm">// obj.GetCalcio();  -> ERRORE!</span>
((IAmericano)obj).<span class="fn">GetCalcio</span>();  <span class="cm">// OK</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea interfaccia ICalcolabile con metodo CalcolaValore()</span>
<span class="cm">//    Implementa: Cerchio, Rettangolo (calcola area)</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea interfaccia ISerializzabile con Serializza() e Deserializza()</span>
<span class="cm">//    Implementa per una classe Utente (JSON semplificato)</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea sistema di plugin:</span>
<span class="cm">//    IPlugin con Nome, Versione, Esegui(), Inizializza()</span>
<span class="cm">//    PluginManager che carica e gestisce piu plugin</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. ICalcolabile ---</span>
<span class="kw">interface</span> <span class="ty">ICalcolabile</span> {
    <span class="ty">double</span> <span class="fn">CalcolaValore</span>();
    <span class="ty">string</span> <span class="fn">GetDescrizione</span>();
}

<span class="kw">class</span> <span class="ty">Cerchio</span> : <span class="ty">ICalcolabile</span> {
    <span class="kw">public</span> <span class="ty">double</span> Raggio { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Cerchio</span>(<span class="ty">double</span> raggio) { Raggio = raggio; }

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">CalcolaValore</span>() => Math.PI * Raggio * Raggio;
    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">GetDescrizione</span>() => <span class="str">$"Cerchio r={Raggio}"</span>;
}

<span class="kw">class</span> <span class="ty">Rettangolo</span> : <span class="ty">ICalcolabile</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Rettangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> h) { Base = b; Altezza = h; }

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">CalcolaValore</span>() => Base * Altezza;
    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">GetDescrizione</span>() => <span class="str">$"Rettangolo {Base}x{Altezza}"</span>;
}

<span class="cm">// --- 2. ISerializzabile ---</span>
<span class="kw">interface</span> <span class="ty">ISerializzabile</span> {
    <span class="ty">string</span> <span class="fn">Serializza</span>();
    <span class="ty">void</span> <span class="fn">Deserializza</span>(<span class="ty">string</span> dati);
}

<span class="kw">class</span> <span class="ty">Utente</span> : <span class="ty">ISerializzabile</span> {
    <span class="kw">public</span> <span class="ty">int</span> Id { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Email { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">Serializza</span>() {
        <span class="kw">return</span> <span class="str">$"{{\"id\":{Id},\"nome\":\"{Nome}\",\"email\":\"{Email}\"}}"</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Deserializza</span>(<span class="ty">string</span> dati) {
        <span class="cm">// Parsing semplificato</span>
        <span class="kw">var</span> parti = dati.<span class="fn">Split</span>(<span class="str">','</span>);
        <span class="kw">foreach</span> (<span class="kw">var</span> parte <span class="kw">in</span> parti) {
            <span class="kw">if</span> (parte.<span class="fn">Contains</span>(<span class="str">"id"</span>)) {
                Id = <span class="ty">int</span>.<span class="fn">Parse</span>(parte.<span class="fn">Split</span>(<span class="str">':'</span>)[<span class="num">1</span>].<span class="fn">Trim</span>(<span class="str">'}'</span>));
            }
        }
    }
}

<span class="cm">// --- 3. Sistema Plugin ---</span>
<span class="kw">interface</span> <span class="ty">IPlugin</span> {
    <span class="ty">string</span> Nome { <span class="kw">get</span>; }
    <span class="ty">string</span> Versione { <span class="kw">get</span>; }
    <span class="ty">void</span> <span class="fn">Inizializza</span>();
    <span class="ty">void</span> <span class="fn">Esegui</span>();
    <span class="ty">void</span> <span class="fn">Termina</span>();
}

<span class="kw">class</span> <span class="ty">PluginLogger</span> : <span class="ty">IPlugin</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome => <span class="str">"Logger"</span>;
    <span class="kw">public</span> <span class="ty">string</span> Versione => <span class="str">"1.0"</span>;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Inizializza</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Logger inizializzato"</span>);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Esegui</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Logger in esecuzione"</span>);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Termina</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Logger terminato"</span>);
}

<span class="kw">class</span> <span class="ty">PluginStats</span> : <span class="ty">IPlugin</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome => <span class="str">"Statistiche"</span>;
    <span class="kw">public</span> <span class="ty">string</span> Versione => <span class="str">"2.1"</span>;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Inizializza</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Stats inizializzato"</span>);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Esegui</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Calcolo statistiche..."</span>);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Termina</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Stats terminato"</span>);
}

<span class="kw">class</span> <span class="ty">PluginManager</span> {
    <span class="kw">private</span> List&lt;IPlugin&gt; _plugins = <span class="kw">new</span> List&lt;IPlugin&gt;();

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Registra</span>(IPlugin plugin) {
        _plugins.<span class="fn">Add</span>(plugin);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Plugin registrato: {plugin.Nome} v{plugin.Versione}"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">InizializzaTutti</span>() {
        <span class="kw">foreach</span> (<span class="kw">var</span> p <span class="kw">in</span> _plugins) p.<span class="fn">Inizializza</span>();
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">EseguiTutti</span>() {
        <span class="kw">foreach</span> (<span class="kw">var</span> p <span class="kw">in</span> _plugins) p.<span class="fn">Esegui</span>();
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">TerminaTutti</span>() {
        <span class="kw">foreach</span> (<span class="kw">var</span> p <span class="kw">in</span> _plugins) p.<span class="fn">Termina</span>();
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> manager = <span class="kw">new</span> <span class="ty">PluginManager</span>();
manager.<span class="fn">Registra</span>(<span class="kw">new</span> <span class="ty">PluginLogger</span>());
manager.<span class="fn">Registra</span>(<span class="kw">new</span> <span class="ty">PluginStats</span>());
manager.<span class="fn">InizializzaTutti</span>();
manager.<span class="fn">EseguiTutti</span>();
manager.<span class="fn">TerminaTutti</span>();</pre>

  </div>
</div>
      <!-- 7. Polimorfismo, Abstract & Sealed -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>7. Polimorfismo, Abstract &amp; Sealed</h3><div class="topic-sub">virtual, override, abstract class, sealed</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è il Polimorfismo?</h4>
    <p>Il polimorfismo permette di trattare oggetti di classi diverse in modo uniforme. "Molte forme" — lo stesso metodo si comporta diversamente in base all'oggetto reale.</p>
    <table>
      <tr><th>Tipo</th><th>Descrizione</th><th>Meccanismo</th></tr>
      <tr><td>Compile-time</td><td>Overloading (stesso nome, parametri diversi)</td><td>Risolto dal compilatore</td></tr>
      <tr><td>Runtime</td><td>Override (stessa firma, classi diverse)</td><td>Risolto a runtime</td></tr>
    </table>

    <h4>virtual e override</h4>
    <pre><span class="kw">class</span> <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// virtual = "le classi figlie POSSONO sovrascrivere"</span>
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} fa un verso generico."</span>);
    }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">double</span> <span class="fn">CalcolaCibo</span>() {
        <span class="kw">return</span> <span class="num">1.0</span>;  <span class="cm">// kg al giorno</span>
    }
}

<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="ty">double</span> Peso { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// override = "sostituisco l'implementazione del padre"</span>
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: BAU!"</span>);
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaCibo</span>() {
        <span class="kw">return</span> Peso * <span class="num">0.03</span>;  <span class="cm">// 3% del peso corporeo</span>
    }
}

<span class="kw">class</span> <span class="ty">Gatto</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MIAO!"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Mucca</span> : <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">FaiVerso</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} dice: MUUUU!"</span>);
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaCibo</span>() {
        <span class="kw">return</span> <span class="num">25.0</span>;  <span class="cm">// mucche mangiano tanto</span>
    }
}

<span class="cm">// POLIMORFISMO in azione — stesso tipo, comportamenti diversi:</span>
Animale[] zoo = {
    <span class="kw">new</span> <span class="ty">Cane</span>  { Nome = <span class="str">"Fido"</span>, Peso = <span class="num">20</span> },
    <span class="kw">new</span> <span class="ty">Gatto</span> { Nome = <span class="str">"Micia"</span> },
    <span class="kw">new</span> <span class="ty">Mucca</span> { Nome = <span class="str">"Bella"</span> },
    <span class="kw">new</span> <span class="ty">Animale</span> { Nome = <span class="str">"Sconosciuto"</span> }
};

<span class="kw">foreach</span> (Animale a <span class="kw">in</span> zoo) {
    a.<span class="fn">FaiVerso</span>();  <span class="cm">// chiama la versione corretta!</span>
}
<span class="cm">// Fido dice: BAU!</span>
<span class="cm">// Micia dice: MIAO!</span>
<span class="cm">// Bella dice: MUUUU!</span>
<span class="cm">// Sconosciuto fa un verso generico.</span></pre>

    <h4>Chiamare il Metodo Base con base</h4>
    <pre><span class="kw">class</span> <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">string</span> Marca { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">string</span> <span class="fn">GetDescrizione</span>() {
        <span class="kw">return</span> <span class="str">$"Veicolo: {Marca}"</span>;
    }
}

<span class="kw">class</span> <span class="ty">Auto</span> : <span class="ty">Veicolo</span> {
    <span class="kw">public</span> <span class="ty">string</span> Modello { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetDescrizione</span>() {
        <span class="cm">// Chiama la versione del padre e aggiunge:</span>
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fn">GetDescrizione</span>() + <span class="str">$", Modello: {Modello}"</span>;
    }
}

<span class="kw">class</span> <span class="ty">AutoSportiva</span> : <span class="ty">Auto</span> {
    <span class="kw">public</span> <span class="ty">int</span> Cavalli { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetDescrizione</span>() {
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fn">GetDescrizione</span>() + <span class="str">$", {Cavalli} CV"</span>;
    }
}

<span class="kw">var</span> ferrari = <span class="kw">new</span> <span class="ty">AutoSportiva</span> {
    Marca = <span class="str">"Ferrari"</span>,
    Modello = <span class="str">"488"</span>,
    Cavalli = <span class="num">670</span>
};
Console.<span class="fn">WriteLine</span>(ferrari.<span class="fn">GetDescrizione</span>());
<span class="cm">// Veicolo: Ferrari, Modello: 488, 670 CV</span></pre>

    <h4>abstract — Classi e Metodi Astratti</h4>
    <pre><span class="cm">// abstract class = NON può essere istanziata direttamente</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Colore { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// abstract method = DEVE essere implementato dalle figlie</span>
    <span class="cm">// (niente corpo, niente { })</span>
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>();
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">double</span> <span class="fn">CalcolaPerimetro</span>();

    <span class="cm">// Metodo normale (con implementazione) — ereditato cosi com'e:</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} ({Colore})"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  Area: {CalcolaArea():F2}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  Perimetro: {CalcolaPerimetro():F2}"</span>);
    }

    <span class="cm">// Metodo virtual — può essere sovrascritto (opzionale):</span>
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">bool</span> <span class="fn">Contiene</span>(<span class="ty">double</span> x, <span class="ty">double</span> y) {
        <span class="kw">return</span> <span class="kw">false</span>;  <span class="cm">// implementazione di default</span>
    }
}

<span class="kw">class</span> <span class="ty">Rettangolo</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Rettangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> h) {
        Nome = <span class="str">"Rettangolo"</span>;
        Base = b;
        Altezza = h;
    }

    <span class="cm">// OBBLIGATO a implementare i metodi abstract:</span>
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Base * Altezza;
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaPerimetro</span>() => <span class="num">2</span> * (Base + Altezza);
}

<span class="kw">class</span> <span class="ty">Cerchio</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Raggio { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Cerchio</span>(<span class="ty">double</span> r) {
        Nome = <span class="str">"Cerchio"</span>;
        Raggio = r;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Math.PI * Raggio * Raggio;
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaPerimetro</span>() => <span class="num">2</span> * Math.PI * Raggio;
}

<span class="kw">class</span> <span class="ty">Triangolo</span> : <span class="ty">Forma</span> {
    <span class="kw">public</span> <span class="ty">double</span> Base { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Altezza { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Lato1 { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">double</span> Lato2 { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">Triangolo</span>(<span class="ty">double</span> b, <span class="ty">double</span> h, <span class="ty">double</span> l1, <span class="ty">double</span> l2) {
        Nome = <span class="str">"Triangolo"</span>;
        Base = b; Altezza = h; Lato1 = l1; Lato2 = l2;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaArea</span>() => Base * Altezza / <span class="num">2</span>;
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">double</span> <span class="fn">CalcolaPerimetro</span>() => Base + Lato1 + Lato2;
}

<span class="cm">// Forma f = new Forma();  -> ERRORE! non si puo istanziare abstract</span>

<span class="cm">// Polimorfismo con classi astratte:</span>
Forma[] forme = {
    <span class="kw">new</span> <span class="ty">Rettangolo</span>(<span class="num">4</span>, <span class="num">5</span>) { Colore = <span class="str">"Rosso"</span> },
    <span class="kw">new</span> <span class="ty">Cerchio</span>(<span class="num">3</span>) { Colore = <span class="str">"Blu"</span> },
    <span class="kw">new</span> <span class="ty">Triangolo</span>(<span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>, <span class="num">5</span>) { Colore = <span class="str">"Verde"</span> }
};

<span class="ty">double</span> areaTotal = <span class="num">0</span>;
<span class="kw">foreach</span> (Forma f <span class="kw">in</span> forme) {
    f.<span class="fn">Stampa</span>();
    areaTotal += f.<span class="fn">CalcolaArea</span>();
}
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nArea totale: {areaTotal:F2}"</span>);</pre>

    <h4>Confronto: virtual vs abstract</h4>
    <table>
      <tr><th></th><th>virtual</th><th>abstract</th></tr>
      <tr><td>Ha implementazione</td><td>Si (override opzionale)</td><td>No (override obbligatorio)</td></tr>
      <tr><td>Classe deve essere abstract?</td><td>No</td><td>Si</td></tr>
      <tr><td>Uso tipico</td><td>Comportamento di default</td><td>Forzare implementazione</td></tr>
      <tr><td>Esempio</td><td>ToString() in Object</td><td>Area() in Forma</td></tr>
    </table>

    <h4>sealed — Bloccare Ereditarieta e Override</h4>
    <pre><span class="cm">// sealed su CLASSE — nessuno puo ereditare:</span>
<span class="kw">sealed</span> <span class="kw">class</span> <span class="ty">Configurazione</span> {
    <span class="kw">public</span> <span class="ty">string</span> AppName { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Version { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span> MaxConnections { <span class="kw">get</span>; <span class="kw">set</span>; }
}
<span class="cm">// class MiaConfig : Configurazione { }  -> ERRORE!</span>

<span class="cm">// sealed su METODO — blocca ulteriori override:</span>
<span class="kw">class</span> <span class="ty">Animale</span> {
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">Respira</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Respiro..."</span>);
    }
}

<span class="kw">class</span> <span class="ty">Mammifero</span> : <span class="ty">Animale</span> {
    <span class="cm">// sealed + override = "io faccio override, ma nessuno puo piu farlo"</span>
    <span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Respira</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Respiro con i polmoni"</span>);
    }
}

<span class="kw">class</span> <span class="ty">Cane</span> : <span class="ty">Mammifero</span> {
    <span class="cm">// public override void Respira() { }  -> ERRORE! e sealed</span>

    <span class="cm">// Puo aggiungere altri metodi:</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Abbaia</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"BAU!"</span>);
    }
}</pre>
    <div class="note">Usa sealed per: sicurezza (impedire modifiche), performance (il compilatore puo ottimizzare), design (classe "finale").</div>

    <h4>Esempio Pratico: Sistema di Pagamenti</h4>
    <pre><span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">MetodoPagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> Intestatario { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span> Attivo { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;

    <span class="cm">// Ogni metodo di pagamento DEVE implementare:</span>
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">bool</span> <span class="fn">Paga</span>(<span class="ty">decimal</span> importo);
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">string</span> <span class="fn">GetTipo</span>();

    <span class="cm">// Metodo comune a tutti:</span>
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaRicevuta</span>(<span class="ty">decimal</span> importo) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"================================"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"RICEVUTA - {GetTipo()}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Intestatario: {Intestatario}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Importo: {importo:C}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Data: {DateTime.Now}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">"================================"</span>);
    }

    <span class="cm">// Metodo virtual — override opzionale:</span>
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">decimal</span> <span class="fn">CalcolaCommissione</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">return</span> <span class="num">0</span>;  <span class="cm">// nessuna commissione di default</span>
    }
}

<span class="kw">class</span> <span class="ty">CartaCredito</span> : <span class="ty">MetodoPagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> NumeroMascherato { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">private</span> <span class="ty">decimal</span> _plafond;
    <span class="kw">private</span> <span class="ty">decimal</span> _utilizzato;

    <span class="kw">public</span> <span class="fn">CartaCredito</span>(<span class="ty">string</span> intestatario, <span class="ty">string</span> numero, <span class="ty">decimal</span> plafond) {
        Intestatario = intestatario;
        NumeroMascherato = <span class="str">"****"</span> + numero.<span class="fn">Substring</span>(numero.Length - <span class="num">4</span>);
        _plafond = plafond;
        _utilizzato = <span class="num">0</span>;
    }

    <span class="kw">public</span> <span class="ty">decimal</span> DisponibilitaResidua => _plafond - _utilizzato;

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Paga</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">if</span> (!Attivo) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Carta non attiva"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        <span class="kw">if</span> (importo > DisponibilitaResidua) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Plafond insufficiente"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        _utilizzato += importo;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Pagamento carta {NumeroMascherato} approvato"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTipo</span>() => <span class="str">"Carta di Credito"</span>;

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaCommissione</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">return</span> importo * <span class="num">0.02m</span>;  <span class="cm">// 2% commissione</span>
    }
}

<span class="kw">class</span> <span class="ty">PayPal</span> : <span class="ty">MetodoPagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> Email { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">PayPal</span>(<span class="ty">string</span> intestatario, <span class="ty">string</span> email) {
        Intestatario = intestatario;
        Email = email;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Paga</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">if</span> (!Attivo) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Account PayPal non attivo"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Pagamento PayPal ({Email}) approvato"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTipo</span>() => <span class="str">"PayPal"</span>;

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaCommissione</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">return</span> <span class="num">0.35m</span> + importo * <span class="num">0.034m</span>;  <span class="cm">// 0.35 + 3.4%</span>
    }
}

<span class="kw">sealed</span> <span class="kw">class</span> <span class="ty">Contanti</span> : <span class="ty">MetodoPagamento</span> {
    <span class="kw">public</span> <span class="fn">Contanti</span>() {
        Intestatario = <span class="str">"Anonimo"</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Paga</span>(<span class="ty">decimal</span> importo) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Pagamento in contanti: {importo:C}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetTipo</span>() => <span class="str">"Contanti"</span>;
}

<span class="cm">// Utilizzo polimorfico:</span>
<span class="ty">void</span> <span class="fn">ProcessaOrdine</span>(<span class="ty">decimal</span> importo, MetodoPagamento metodo) {
    <span class="ty">decimal</span> commissione = metodo.<span class="fn">CalcolaCommissione</span>(importo);
    <span class="ty">decimal</span> totale = importo + commissione;

    Console.<span class="fn">WriteLine</span>(<span class="str">$"Importo: {importo:C}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Commissione: {commissione:C}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Totale: {totale:C}"</span>);

    <span class="kw">if</span> (metodo.<span class="fn">Paga</span>(totale)) {
        metodo.<span class="fn">StampaRicevuta</span>(totale);
    }
}

MetodoPagamento[] metodi = {
    <span class="kw">new</span> <span class="ty">CartaCredito</span>(<span class="str">"Mario"</span>, <span class="str">"1234567890123456"</span>, <span class="num">5000</span>),
    <span class="kw">new</span> <span class="ty">PayPal</span>(<span class="str">"Luigi"</span>, <span class="str">"luigi@email.com"</span>),
    <span class="kw">new</span> <span class="ty">Contanti</span>()
};

<span class="kw">foreach</span> (<span class="kw">var</span> m <span class="kw">in</span> metodi) {
    <span class="fn">ProcessaOrdine</span>(<span class="num">100.00m</span>, m);
    Console.<span class="fn">WriteLine</span>();
}</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare abstract sulla classe quando ha metodi abstract:</span>
<span class="cm">// class Test { public abstract void M(); }  -> ERRORE!</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Test</span> { <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">void</span> <span class="fn">M</span>(); }  <span class="cm">// OK</span>

<span class="cm">// 2. Non implementare tutti i metodi abstract:</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">A</span> {
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">void</span> <span class="fn">M1</span>();
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">void</span> <span class="fn">M2</span>();
}
<span class="cm">// class B : A { public override void M1() { } }  -> ERRORE! manca M2</span>

<span class="cm">// 3. Dimenticare virtual nel padre per fare override:</span>
<span class="kw">class</span> <span class="ty">Padre</span> {
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Metodo</span>() { }  <span class="cm">// NON e virtual!</span>
}
<span class="kw">class</span> <span class="ty">Figlio</span> : <span class="ty">Padre</span> {
    <span class="cm">// public override void Metodo() { }  -> ERRORE!</span>
}

<span class="cm">// 4. Confondere new e override:</span>
<span class="kw">class</span> <span class="ty">PadreV</span> {
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">M</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Padre"</span>);
}
<span class="kw">class</span> <span class="ty">FiglioNew</span> : <span class="ty">PadreV</span> {
    <span class="kw">public</span> <span class="kw">new</span> <span class="ty">void</span> <span class="fn">M</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Figlio"</span>);
}
<span class="kw">class</span> <span class="ty">FiglioOverride</span> : <span class="ty">PadreV</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">M</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Figlio"</span>);
}

PadreV p1 = <span class="kw">new</span> <span class="ty">FiglioNew</span>();
p1.<span class="fn">M</span>();  <span class="cm">// "Padre" - niente polimorfismo con new!</span>

PadreV p2 = <span class="kw">new</span> <span class="ty">FiglioOverride</span>();
p2.<span class="fn">M</span>();  <span class="cm">// "Figlio" - polimorfismo funziona con override</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea classe astratta "Strumento" con metodo astratto Suona()</span>
<span class="cm">//    Implementa: Chitarra, Pianoforte, Batteria</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Sistema di notifiche astratto con Invia(messaggio)</span>
<span class="cm">//    Implementa: NotificaEmail, NotificaSMS, NotificaPush</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Sistema di sconti per e-commerce</span>
<span class="cm">//    Classe astratta Sconto con CalcolaSconto(prezzo, quantita)</span>
<span class="cm">//    Implementa: ScontoPercentuale, ScontoFisso, ScontoQuantita</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Strumenti musicali ---</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Strumento</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">void</span> <span class="fn">Suona</span>();

    <span class="kw">public</span> <span class="kw">virtual</span> <span class="ty">void</span> <span class="fn">Accorda</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Accordo {Nome}..."</span>);
    }
}

<span class="kw">class</span> <span class="ty">Chitarra</span> : <span class="ty">Strumento</span> {
    <span class="kw">public</span> <span class="fn">Chitarra</span>() { Nome = <span class="str">"Chitarra"</span>; }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Suona</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Twang twang!"</span>);
}

<span class="kw">class</span> <span class="ty">Pianoforte</span> : <span class="ty">Strumento</span> {
    <span class="kw">public</span> <span class="fn">Pianoforte</span>() { Nome = <span class="str">"Pianoforte"</span>; }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Suona</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Plin plin!"</span>);
}

<span class="kw">class</span> <span class="ty">Batteria</span> : <span class="ty">Strumento</span> {
    <span class="kw">public</span> <span class="fn">Batteria</span>() { Nome = <span class="str">"Batteria"</span>; }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Suona</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"Boom tss!"</span>);
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">void</span> <span class="fn">Accorda</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"La batteria non si accorda!"</span>);
}

<span class="cm">// --- 2. Sistema notifiche ---</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Notifica</span> {
    <span class="kw">public</span> <span class="ty">string</span> Destinatario { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">bool</span> <span class="fn">Invia</span>(<span class="ty">string</span> messaggio);
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">string</span> <span class="fn">GetCanale</span>();
}

<span class="kw">class</span> <span class="ty">NotificaEmail</span> : <span class="ty">Notifica</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Invia</span>(<span class="ty">string</span> messaggio) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Email a {Destinatario}: {messaggio}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetCanale</span>() => <span class="str">"Email"</span>;
}

<span class="kw">class</span> <span class="ty">NotificaSMS</span> : <span class="ty">Notifica</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Invia</span>(<span class="ty">string</span> messaggio) {
        <span class="ty">string</span> sms = messaggio.Length > <span class="num">160</span>
            ? messaggio.<span class="fn">Substring</span>(<span class="num">0</span>, <span class="num">157</span>) + <span class="str">"..."</span>
            : messaggio;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"SMS a {Destinatario}: {sms}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetCanale</span>() => <span class="str">"SMS"</span>;
}

<span class="kw">class</span> <span class="ty">NotificaPush</span> : <span class="ty">Notifica</span> {
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">bool</span> <span class="fn">Invia</span>(<span class="ty">string</span> messaggio) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Push a {Destinatario}: {messaggio}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">GetCanale</span>() => <span class="str">"Push"</span>;
}

<span class="cm">// --- 3. Sistema sconti ---</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Sconto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="ty">decimal</span> <span class="fn">CalcolaSconto</span>(<span class="ty">decimal</span> prezzo, <span class="ty">int</span> quantita);

    <span class="kw">public</span> <span class="ty">decimal</span> <span class="fn">PrezzoFinale</span>(<span class="ty">decimal</span> prezzo, <span class="ty">int</span> quantita) {
        <span class="ty">decimal</span> sconto = <span class="fn">CalcolaSconto</span>(prezzo, quantita);
        <span class="kw">return</span> Math.<span class="fn">Max</span>(<span class="num">0</span>, prezzo * quantita - sconto);
    }
}

<span class="kw">class</span> <span class="ty">ScontoPercentuale</span> : <span class="ty">Sconto</span> {
    <span class="kw">public</span> <span class="ty">decimal</span> Percentuale { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">ScontoPercentuale</span>(<span class="ty">decimal</span> percentuale) {
        Nome = <span class="str">$"Sconto {percentuale}%"</span>;
        Percentuale = percentuale;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaSconto</span>(<span class="ty">decimal</span> prezzo, <span class="ty">int</span> quantita) {
        <span class="kw">return</span> prezzo * quantita * Percentuale / <span class="num">100</span>;
    }
}

<span class="kw">class</span> <span class="ty">ScontoFisso</span> : <span class="ty">Sconto</span> {
    <span class="kw">public</span> <span class="ty">decimal</span> Importo { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">ScontoFisso</span>(<span class="ty">decimal</span> importo) {
        Nome = <span class="str">$"Sconto {importo:C}"</span>;
        Importo = importo;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaSconto</span>(<span class="ty">decimal</span> prezzo, <span class="ty">int</span> quantita) {
        <span class="kw">return</span> Importo;
    }
}

<span class="kw">class</span> <span class="ty">ScontoQuantita</span> : <span class="ty">Sconto</span> {
    <span class="kw">public</span> <span class="ty">int</span> SogliaQuantita { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> PercentualeSconto { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="kw">public</span> <span class="fn">ScontoQuantita</span>(<span class="ty">int</span> soglia, <span class="ty">decimal</span> percentuale) {
        Nome = <span class="str">$"Sconto {percentuale}% per {soglia}+ pezzi"</span>;
        SogliaQuantita = soglia;
        PercentualeSconto = percentuale;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">decimal</span> <span class="fn">CalcolaSconto</span>(<span class="ty">decimal</span> prezzo, <span class="ty">int</span> quantita) {
        <span class="kw">if</span> (quantita >= SogliaQuantita)
            <span class="kw">return</span> prezzo * quantita * PercentualeSconto / <span class="num">100</span>;
        <span class="kw">return</span> <span class="num">0</span>;
    }
}</pre>

  </div>
</div>
      <!-- 8. Gestione delle Eccezioni -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>8. Gestione delle Eccezioni</h3><div class="topic-sub">try/catch/finally, throw, eccezioni personalizzate</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'e un'Eccezione?</h4>
    <p>Un'eccezione e un <strong>errore a runtime</strong> che interrompe il normale flusso del programma. Senza gestione, l'applicazione crasha. Con try/catch, puoi intercettare e gestire l'errore.</p>
    <table>
      <tr><th>Termine</th><th>Significato</th></tr>
      <tr><td>throw</td><td>Lancia un'eccezione</td></tr>
      <tr><td>try</td><td>Blocco di codice "a rischio"</td></tr>
      <tr><td>catch</td><td>Intercetta e gestisce l'eccezione</td></tr>
      <tr><td>finally</td><td>Eseguito SEMPRE (con o senza errore)</td></tr>
    </table>

    <h4>Sintassi Base try/catch</h4>
    <pre><span class="kw">try</span> {
    <span class="cm">// Codice che potrebbe fallire:</span>
    Console.<span class="fn">Write</span>(<span class="str">"Inserisci un numero: "</span>);
    <span class="ty">int</span> numero = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Il doppio e {numero * 2}"</span>);
}
<span class="kw">catch</span> (Exception ex) {
    <span class="cm">// Gestione dell'errore:</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
}

Console.<span class="fn">WriteLine</span>(<span class="str">"Il programma continua..."</span>);  <span class="cm">// eseguito sempre!</span></pre>

    <h4>Catch Multipli — Eccezioni Specifiche</h4>
    <pre><span class="kw">try</span> {
    Console.<span class="fn">Write</span>(<span class="str">"Numero: "</span>);
    <span class="ty">int</span> n = <span class="ty">int</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());

    <span class="ty">int</span>[] arr = { <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span> };
    Console.<span class="fn">WriteLine</span>(arr[n]);

    <span class="ty">int</span> risultato = <span class="num">100</span> / n;
}
<span class="kw">catch</span> (FormatException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Devi inserire un NUMERO!"</span>);
}
<span class="kw">catch</span> (IndexOutOfRangeException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Indice fuori dai limiti (0-2)"</span>);
}
<span class="kw">catch</span> (DivideByZeroException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Non puoi dividere per zero!"</span>);
}
<span class="kw">catch</span> (Exception ex) {
    <span class="cm">// Cattura TUTTO il resto (sempre per ultimo!):</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore generico: {ex.Message}"</span>);
}</pre>
    <div class="warn">Metti sempre i catch piu specifici PRIMA di Exception generico, altrimenti non verranno mai raggiunti!</div>

    <h4>finally — Eseguito SEMPRE</h4>
    <pre>StreamReader reader = <span class="kw">null</span>;
<span class="kw">try</span> {
    reader = <span class="kw">new</span> StreamReader(<span class="str">"file.txt"</span>);
    <span class="ty">string</span> contenuto = reader.<span class="fn">ReadToEnd</span>();
    Console.<span class="fn">WriteLine</span>(contenuto);
}
<span class="kw">catch</span> (FileNotFoundException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato!"</span>);
}
<span class="kw">catch</span> (IOException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
}
<span class="kw">finally</span> {
    <span class="cm">// Pulizia — eseguito SEMPRE, anche se c'e eccezione:</span>
    <span class="kw">if</span> (reader != <span class="kw">null</span>) {
        reader.<span class="fn">Close</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">"File chiuso"</span>);
    }
    Console.<span class="fn">WriteLine</span>(<span class="str">"Blocco finally eseguito"</span>);
}

<span class="cm">// Modo moderno — using chiude automaticamente:</span>
<span class="kw">try</span> {
    <span class="kw">using</span> StreamReader r = <span class="kw">new</span> StreamReader(<span class="str">"file.txt"</span>);
    Console.<span class="fn">WriteLine</span>(r.<span class="fn">ReadToEnd</span>());
}  <span class="cm">// r.Dispose() chiamato automaticamente qui!</span>
<span class="kw">catch</span> (Exception ex) {
    Console.<span class="fn">WriteLine</span>(ex.Message);
}</pre>

    <h4>throw — Lanciare Eccezioni</h4>
    <pre><span class="kw">class</span> <span class="ty">ContoBancario</span> {
    <span class="kw">private</span> <span class="ty">decimal</span> _saldo;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Deposita</span>(<span class="ty">decimal</span> importo) {
        <span class="cm">// Validazione — lancia eccezione se invalido:</span>
        <span class="kw">if</span> (importo &lt;= <span class="num">0</span>)
            <span class="kw">throw new</span> ArgumentException(<span class="str">"L'importo deve essere positivo"</span>);

        _saldo += importo;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Preleva</span>(<span class="ty">decimal</span> importo) {
        <span class="kw">if</span> (importo &lt;= <span class="num">0</span>)
            <span class="kw">throw new</span> ArgumentException(<span class="str">"L'importo deve essere positivo"</span>);

        <span class="kw">if</span> (importo > _saldo)
            <span class="kw">throw new</span> InvalidOperationException(
                <span class="str">$"Saldo insufficiente: {_saldo:C} disponibili"</span>);

        _saldo -= importo;
    }

    <span class="kw">public</span> <span class="ty">decimal</span> <span class="fn">GetSaldo</span>() => _saldo;
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> conto = <span class="kw">new</span> <span class="ty">ContoBancario</span>();
<span class="kw">try</span> {
    conto.<span class="fn">Deposita</span>(<span class="num">100</span>);
    conto.<span class="fn">Preleva</span>(<span class="num">500</span>);  <span class="cm">// lancia eccezione!</span>
}
<span class="kw">catch</span> (ArgumentException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Argomento non valido: {ex.Message}"</span>);
}
<span class="kw">catch</span> (InvalidOperationException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Operazione non permessa: {ex.Message}"</span>);
}</pre>

    <h4>Eccezioni Personalizzate</h4>
    <pre><span class="cm">// Eccezione custom per il dominio applicativo:</span>
<span class="kw">class</span> <span class="ty">SaldoInsufficienteException</span> : Exception {
    <span class="kw">public</span> <span class="ty">decimal</span> SaldoAttuale { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> ImportoRichiesto { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Mancante => ImportoRichiesto - SaldoAttuale;

    <span class="kw">public</span> <span class="fn">SaldoInsufficienteException</span>(<span class="ty">decimal</span> saldo, <span class="ty">decimal</span> richiesto)
        : <span class="kw">base</span>(<span class="str">$"Saldo insufficiente: hai {saldo:C}, servono {richiesto:C}"</span>)
    {
        SaldoAttuale = saldo;
        ImportoRichiesto = richiesto;
    }
}

<span class="kw">class</span> <span class="ty">PINErratoException</span> : Exception {
    <span class="kw">public</span> <span class="ty">int</span> TentativiRimasti { <span class="kw">get</span>; }

    <span class="kw">public</span> <span class="fn">PINErratoException</span>(<span class="ty">int</span> tentativiRimasti)
        : <span class="kw">base</span>(<span class="str">$"PIN errato! Tentativi rimasti: {tentativiRimasti}"</span>)
    {
        TentativiRimasti = tentativiRimasti;
    }
}

<span class="kw">class</span> <span class="ty">AccountBlocatoException</span> : Exception {
    <span class="kw">public</span> DateTime SbloccoPrevisto { <span class="kw">get</span>; }

    <span class="kw">public</span> <span class="fn">AccountBlocatoException</span>(DateTime sblocco)
        : <span class="kw">base</span>(<span class="str">$"Account bloccato fino a {sblocco}"</span>)
    {
        SbloccoPrevisto = sblocco;
    }
}

<span class="cm">// Utilizzo delle eccezioni custom:</span>
<span class="kw">try</span> {
    <span class="kw">throw new</span> <span class="ty">SaldoInsufficienteException</span>(<span class="num">50m</span>, <span class="num">100m</span>);
}
<span class="kw">catch</span> (SaldoInsufficienteException ex) {
    Console.<span class="fn">WriteLine</span>(ex.Message);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Ti mancano {ex.Mancante:C}"</span>);
}</pre>

    <h4>Eccezioni Comuni in .NET</h4>
    <table>
      <tr><th>Eccezione</th><th>Causa tipica</th><th>Come evitarla</th></tr>
      <tr><td>NullReferenceException</td><td>Accesso a .Proprieta su null</td><td>Controllo != null o ?.</td></tr>
      <tr><td>IndexOutOfRangeException</td><td>array[indice] con indice invalido</td><td>Controlla .Length</td></tr>
      <tr><td>FormatException</td><td>int.Parse("abc")</td><td>Usa TryParse</td></tr>
      <tr><td>ArgumentNullException</td><td>Parametro null non ammesso</td><td>Valida input</td></tr>
      <tr><td>ArgumentException</td><td>Parametro non valido</td><td>Valida input</td></tr>
      <tr><td>InvalidOperationException</td><td>Operazione non valida nello stato attuale</td><td>Controlla stato</td></tr>
      <tr><td>FileNotFoundException</td><td>File.ReadAllText("inesistente")</td><td>File.Exists()</td></tr>
      <tr><td>DivideByZeroException</td><td>x / 0</td><td>Controlla divisore</td></tr>
      <tr><td>OverflowException</td><td>checked { int.MaxValue + 1 }</td><td>Usa tipo piu grande</td></tr>
      <tr><td>KeyNotFoundException</td><td>dict["chiaveInesistente"]</td><td>ContainsKey o TryGetValue</td></tr>
    </table>

    <h4>when — Filtro su Catch (C# 6+)</h4>
    <pre><span class="cm">// Filtra eccezioni in base a condizioni:</span>
<span class="kw">try</span> {
    <span class="fn">EseguiOperazioneDiRete</span>();
}
<span class="kw">catch</span> (HttpRequestException ex) <span class="kw">when</span> (ex.StatusCode == <span class="num">404</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Risorsa non trovata (404)"</span>);
}
<span class="kw">catch</span> (HttpRequestException ex) <span class="kw">when</span> (ex.StatusCode == <span class="num">401</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non autorizzato (401) — riprova login"</span>);
}
<span class="kw">catch</span> (HttpRequestException ex) <span class="kw">when</span> (ex.StatusCode >= <span class="num">500</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore server — riprova piu tardi"</span>);
}
<span class="kw">catch</span> (HttpRequestException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore HTTP: {ex.StatusCode}"</span>);
}

<span class="cm">// Filtro su eccezione personalizzata:</span>
<span class="kw">try</span> {
    <span class="fn">EseguiOperazione</span>();
}
<span class="kw">catch</span> (SaldoInsufficienteException ex) <span class="kw">when</span> (ex.Mancante &lt; <span class="num">10</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Ti manca poco! Deposita almeno 10 euro."</span>);
}
<span class="kw">catch</span> (SaldoInsufficienteException ex) <span class="kw">when</span> (ex.Mancante &lt; <span class="num">100</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Fondi insufficienti. Considera un piccolo prestito."</span>);
}
<span class="kw">catch</span> (SaldoInsufficienteException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Operazione impossibile: mancano {ex.Mancante:C}"</span>);
}

<span class="cm">// Filtro con condizioni esterne:</span>
<span class="ty">bool</span> debugMode = <span class="kw">true</span>;
<span class="kw">try</span> {
    <span class="fn">Operazione</span>();
}
<span class="kw">catch</span> (Exception ex) <span class="kw">when</span> (debugMode) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"DEBUG: {ex.GetType().Name}: {ex.Message}"</span>);
    Console.<span class="fn">WriteLine</span>(ex.StackTrace);
    <span class="kw">throw</span>;  <span class="cm">// rilancia dopo il log</span>
}</pre>

    <h4>Re-throw e Exception Chaining</h4>
    <pre><span class="cm">// CORRETTO — preserva lo stack trace originale:</span>
<span class="kw">try</span> {
    <span class="fn">Operazione</span>();
}
<span class="kw">catch</span> (Exception ex) {
    <span class="fn">LogErrore</span>(ex);
    <span class="kw">throw</span>;  <span class="cm">// rilancia l'eccezione originale</span>
}

<span class="cm">// SBAGLIATO — perde lo stack trace originale:</span>
<span class="kw">catch</span> (Exception ex) {
    <span class="fn">LogErrore</span>(ex);
    <span class="kw">throw</span> ex;  <span class="cm">// NO! Perde informazioni di debug</span>
}

<span class="cm">// Exception chaining — arricchisci con contesto:</span>
<span class="kw">public</span> <span class="ty">void</span> <span class="fn">CaricaConfigurazione</span>(<span class="ty">string</span> path) {
    <span class="kw">try</span> {
        <span class="ty">string</span> json = File.<span class="fn">ReadAllText</span>(path);
        <span class="fn">ParseConfig</span>(json);
    }
    <span class="kw">catch</span> (FileNotFoundException ex) {
        <span class="cm">// Avvolgi con piu contesto, mantieni l'originale come InnerException:</span>
        <span class="kw">throw new</span> InvalidOperationException(
            <span class="str">$"Impossibile caricare configurazione da '{path}'"</span>,
            ex  <span class="cm">// inner exception</span>
        );
    }
    <span class="kw">catch</span> (JsonException ex) {
        <span class="kw">throw new</span> InvalidOperationException(
            <span class="str">$"File di configurazione '{path}' non valido"</span>,
            ex
        );
    }
}

<span class="cm">// Gestione con InnerException:</span>
<span class="kw">try</span> {
    <span class="fn">CaricaConfigurazione</span>(<span class="str">"config.json"</span>);
}
<span class="kw">catch</span> (InvalidOperationException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
    <span class="kw">if</span> (ex.InnerException != <span class="kw">null</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Causa: {ex.InnerException.Message}"</span>);
    }
}</pre>

    <h4>Pattern: Guard Clauses</h4>
    <pre><span class="kw">public</span> <span class="ty">void</span> <span class="fn">InviaEmail</span>(<span class="ty">string</span> destinatario, <span class="ty">string</span> oggetto, <span class="ty">string</span> corpo) {
    <span class="cm">// Guard clauses all'inizio — fallisci subito se input invalido:</span>
    <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(destinatario))
        <span class="kw">throw new</span> ArgumentNullException(<span class="kw">nameof</span>(destinatario), <span class="str">"Destinatario obbligatorio"</span>);

    <span class="kw">if</span> (!destinatario.<span class="fn">Contains</span>(<span class="str">"@"</span>))
        <span class="kw">throw new</span> ArgumentException(<span class="str">"Email non valida"</span>, <span class="kw">nameof</span>(destinatario));

    <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(oggetto))
        <span class="kw">throw new</span> ArgumentNullException(<span class="kw">nameof</span>(oggetto), <span class="str">"Oggetto obbligatorio"</span>);

    <span class="kw">if</span> (oggetto.Length > <span class="num">100</span>)
        <span class="kw">throw new</span> ArgumentException(<span class="str">"Oggetto troppo lungo (max 100 caratteri)"</span>, <span class="kw">nameof</span>(oggetto));

    <span class="cm">// Se arriviamo qui, tutti i parametri sono validi:</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Invio email a {destinatario}..."</span>);
    <span class="cm">// ... logica di invio</span>
}

<span class="cm">// C# 10+ con metodi helper:</span>
<span class="kw">public</span> <span class="ty">void</span> <span class="fn">Processa</span>(<span class="ty">string</span> dato, <span class="ty">int</span> quantita) {
    ArgumentNullException.<span class="fn">ThrowIfNull</span>(dato);
    ArgumentException.<span class="fn">ThrowIfNullOrWhiteSpace</span>(dato);

    <span class="kw">if</span> (quantita &lt;= <span class="num">0</span>)
        <span class="kw">throw new</span> ArgumentOutOfRangeException(<span class="kw">nameof</span>(quantita), <span class="str">"Deve essere positivo"</span>);

    <span class="cm">// ... logica</span>
}</pre>

    <h4>TryParse vs Parse</h4>
    <pre><span class="cm">// Parse — lancia eccezione se fallisce:</span>
<span class="kw">try</span> {
    <span class="ty">int</span> n = <span class="ty">int</span>.<span class="fn">Parse</span>(<span class="str">"abc"</span>);  <span class="cm">// FormatException!</span>
}
<span class="kw">catch</span> (FormatException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non e un numero"</span>);
}

<span class="cm">// TryParse — restituisce bool, niente eccezione:</span>
<span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(<span class="str">"abc"</span>, <span class="kw">out int</span> risultato)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Numero: {risultato}"</span>);
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Non e un numero"</span>);
}

<span class="cm">// TryParse e migliore per input utente:</span>
<span class="ty">int</span> <span class="fn">LeggiNumero</span>(<span class="ty">string</span> prompt, <span class="ty">int</span> defaultValue = <span class="num">0</span>) {
    Console.<span class="fn">Write</span>(prompt);
    <span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>();

    <span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(input, <span class="kw">out int</span> valore)) {
        <span class="kw">return</span> valore;
    }

    Console.<span class="fn">WriteLine</span>(<span class="str">$"Input non valido, uso default: {defaultValue}"</span>);
    <span class="kw">return</span> defaultValue;
}

<span class="cm">// Altri TryParse disponibili:</span>
<span class="ty">double</span>.<span class="fn">TryParse</span>(<span class="str">"3.14"</span>, <span class="kw">out double</span> d);
DateTime.<span class="fn">TryParse</span>(<span class="str">"2024-01-15"</span>, <span class="kw">out</span> DateTime dt);
<span class="ty">bool</span>.<span class="fn">TryParse</span>(<span class="str">"true"</span>, <span class="kw">out bool</span> b);
Enum.<span class="fn">TryParse</span>&lt;DayOfWeek&gt;(<span class="str">"Monday"</span>, <span class="kw">out</span> DayOfWeek day);</pre>

    <h4>Progetto Pratico: Input Validator</h4>
    <pre><span class="kw">class</span> <span class="ty">InputValidator</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> <span class="fn">LeggiIntero</span>(<span class="ty">string</span> prompt, <span class="ty">int</span> min = <span class="ty">int</span>.MinValue, <span class="ty">int</span> max = <span class="ty">int</span>.MaxValue) {
        <span class="kw">while</span> (<span class="kw">true</span>) {
            <span class="kw">try</span> {
                Console.<span class="fn">Write</span>(prompt);
                <span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">""</span>;

                <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(input))
                    <span class="kw">throw new</span> FormatException(<span class="str">"Input vuoto"</span>);

                <span class="ty">int</span> valore = <span class="ty">int</span>.<span class="fn">Parse</span>(input);

                <span class="kw">if</span> (valore &lt; min || valore > max)
                    <span class="kw">throw new</span> ArgumentOutOfRangeException(
                        <span class="kw">nameof</span>(valore), <span class="str">$"Deve essere tra {min} e {max}"</span>);

                <span class="kw">return</span> valore;
            }
            <span class="kw">catch</span> (FormatException) {
                Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Inserisci un numero intero valido"</span>);
            }
            <span class="kw">catch</span> (ArgumentOutOfRangeException ex) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
            }
            <span class="kw">catch</span> (OverflowException) {
                Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Numero troppo grande o troppo piccolo"</span>);
            }
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">decimal</span> <span class="fn">LeggiDecimale</span>(<span class="ty">string</span> prompt, <span class="ty">decimal</span> min = <span class="ty">decimal</span>.MinValue) {
        <span class="kw">while</span> (<span class="kw">true</span>) {
            <span class="kw">try</span> {
                Console.<span class="fn">Write</span>(prompt);
                <span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">""</span>;

                <span class="ty">decimal</span> valore = <span class="ty">decimal</span>.<span class="fn">Parse</span>(input);

                <span class="kw">if</span> (valore &lt; min)
                    <span class="kw">throw new</span> ArgumentOutOfRangeException(
                        <span class="kw">nameof</span>(valore), <span class="str">$"Deve essere almeno {min}"</span>);

                <span class="kw">return</span> valore;
            }
            <span class="kw">catch</span> (FormatException) {
                Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Inserisci un numero valido (es: 10.50)"</span>);
            }
            <span class="kw">catch</span> (ArgumentOutOfRangeException ex) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
            }
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> <span class="fn">LeggiStringa</span>(<span class="ty">string</span> prompt, <span class="ty">int</span> minLen = <span class="num">1</span>, <span class="ty">int</span> maxLen = <span class="num">100</span>) {
        <span class="kw">while</span> (<span class="kw">true</span>) {
            Console.<span class="fn">Write</span>(prompt);
            <span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">""</span>;

            <span class="kw">if</span> (input.Length &lt; minLen) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: Minimo {minLen} caratteri"</span>);
                <span class="kw">continue</span>;
            }
            <span class="kw">if</span> (input.Length > maxLen) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: Massimo {maxLen} caratteri"</span>);
                <span class="kw">continue</span>;
            }

            <span class="kw">return</span> input;
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> DateTime <span class="fn">LeggiData</span>(<span class="ty">string</span> prompt) {
        <span class="kw">while</span> (<span class="kw">true</span>) {
            <span class="kw">try</span> {
                Console.<span class="fn">Write</span>(prompt);
                <span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">""</span>;
                <span class="kw">return</span> DateTime.<span class="fn">Parse</span>(input);
            }
            <span class="kw">catch</span> (FormatException) {
                Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Formato data non valido (es: 2024-01-15)"</span>);
            }
        }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="ty">int</span> eta = InputValidator.<span class="fn">LeggiIntero</span>(<span class="str">"Eta: "</span>, <span class="num">0</span>, <span class="num">120</span>);
<span class="ty">decimal</span> stipendio = InputValidator.<span class="fn">LeggiDecimale</span>(<span class="str">"Stipendio: "</span>, <span class="num">0</span>);
<span class="ty">string</span> nome = InputValidator.<span class="fn">LeggiStringa</span>(<span class="str">"Nome: "</span>, <span class="num">2</span>, <span class="num">50</span>);
DateTime nascita = InputValidator.<span class="fn">LeggiData</span>(<span class="str">"Data di nascita: "</span>);</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Catch vuoto che nasconde errori:</span>
<span class="kw">try</span> {
    <span class="fn">Operazione</span>();
}
<span class="kw">catch</span> { }  <span class="cm">// SBAGLIATO! Errore silenzioso</span>

<span class="cm">// Corretto — almeno logga:</span>
<span class="kw">catch</span> (Exception ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);  <span class="cm">// o usa un logger</span>
}

<span class="cm">// 2. Catturare Exception per tutto:</span>
<span class="kw">try</span> {
    <span class="fn">LeggiFile</span>();
}
<span class="kw">catch</span> (Exception) {  <span class="cm">// troppo generico</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore"</span>);
}

<span class="cm">// Corretto — gestisci eccezioni specifiche:</span>
<span class="kw">catch</span> (FileNotFoundException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato"</span>);
}
<span class="kw">catch</span> (UnauthorizedAccessException) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Permesso negato"</span>);
}

<span class="cm">// 3. Usare eccezioni per controllo di flusso:</span>
<span class="cm">// SBAGLIATO — lento e confuso:</span>
<span class="kw">try</span> {
    <span class="ty">int</span> n = <span class="ty">int</span>.<span class="fn">Parse</span>(input);
    <span class="fn">Processa</span>(n);
}
<span class="kw">catch</span> (FormatException) {
    <span class="fn">UsaDefault</span>();
}

<span class="cm">// CORRETTO — usa TryParse:</span>
<span class="kw">if</span> (<span class="ty">int</span>.<span class="fn">TryParse</span>(input, <span class="kw">out int</span> n)) {
    <span class="fn">Processa</span>(n);
} <span class="kw">else</span> {
    <span class="fn">UsaDefault</span>();
}

<span class="cm">// 4. throw ex invece di throw:</span>
<span class="kw">catch</span> (Exception ex) {
    <span class="fn">Log</span>(ex);
    <span class="kw">throw</span> ex;  <span class="cm">// SBAGLIATO — perde stack trace</span>
    <span class="kw">throw</span>;     <span class="cm">// CORRETTO — preserva stack trace</span>
}</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una calcolatrice che gestisce divisione per zero</span>
<span class="cm">//    e input non numerico</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea un lettore di file con retry automatico</span>
<span class="cm">//    (riprova 3 volte prima di fallire)</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Sistema di login con:</span>
<span class="cm">//    - CredentialsException (custom)</span>
<span class="cm">//    - Blocco account dopo 3 tentativi</span>
<span class="cm">//    - Sblocco automatico dopo 30 secondi</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Calcolatrice ---</span>
<span class="kw">class</span> <span class="ty">Calcolatrice</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span> <span class="fn">Calcola</span>(<span class="ty">double</span> a, <span class="ty">char</span> operatore, <span class="ty">double</span> b) {
        <span class="kw">return</span> operatore <span class="kw">switch</span> {
            <span class="str">'+'</span> => a + b,
            <span class="str">'-'</span> => a - b,
            <span class="str">'*'</span> => a * b,
            <span class="str">'/'</span> => b != <span class="num">0</span> ? a / b
                : <span class="kw">throw new</span> DivideByZeroException(<span class="str">"Divisione per zero"</span>),
            _ => <span class="kw">throw new</span> ArgumentException(<span class="str">$"Operatore '{operatore}' non valido"</span>)
        };
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">Esegui</span>() {
        <span class="kw">while</span> (<span class="kw">true</span>) {
            <span class="kw">try</span> {
                Console.<span class="fn">Write</span>(<span class="str">"Primo numero (o 'q' per uscire): "</span>);
                <span class="ty">string</span> input1 = Console.<span class="fn">ReadLine</span>();
                <span class="kw">if</span> (input1.<span class="fn">ToLower</span>() == <span class="str">"q"</span>) <span class="kw">break</span>;

                <span class="ty">double</span> a = <span class="ty">double</span>.<span class="fn">Parse</span>(input1);

                Console.<span class="fn">Write</span>(<span class="str">"Operatore (+, -, *, /): "</span>);
                <span class="ty">char</span> op = Console.<span class="fn">ReadLine</span>()[<span class="num">0</span>];

                Console.<span class="fn">Write</span>(<span class="str">"Secondo numero: "</span>);
                <span class="ty">double</span> b = <span class="ty">double</span>.<span class="fn">Parse</span>(Console.<span class="fn">ReadLine</span>());

                <span class="ty">double</span> risultato = <span class="fn">Calcola</span>(a, op, b);
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Risultato: {a} {op} {b} = {risultato}"</span>);
            }
            <span class="kw">catch</span> (FormatException) {
                Console.<span class="fn">WriteLine</span>(<span class="str">"Errore: Inserisci un numero valido"</span>);
            }
            <span class="kw">catch</span> (DivideByZeroException ex) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
            }
            <span class="kw">catch</span> (ArgumentException ex) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
            }
            Console.<span class="fn">WriteLine</span>();
        }
    }
}

<span class="cm">// --- 2. Lettore file con retry ---</span>
<span class="kw">class</span> <span class="ty">FileReaderConRetry</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> <span class="fn">LeggiFile</span>(<span class="ty">string</span> path, <span class="ty">int</span> maxTentativi = <span class="num">3</span>, <span class="ty">int</span> delayMs = <span class="num">1000</span>) {
        Exception ultimaEccezione = <span class="kw">null</span>;

        <span class="kw">for</span> (<span class="ty">int</span> tentativo = <span class="num">1</span>; tentativo &lt;= maxTentativi; tentativo++) {
            <span class="kw">try</span> {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"Tentativo {tentativo}/{maxTentativi}..."</span>);
                <span class="kw">return</span> File.<span class="fn">ReadAllText</span>(path);
            }
            <span class="kw">catch</span> (FileNotFoundException ex) {
                <span class="cm">// Non ha senso riprovare se il file non esiste</span>
                <span class="kw">throw</span>;
            }
            <span class="kw">catch</span> (IOException ex) {
                ultimaEccezione = ex;
                Console.<span class="fn">WriteLine</span>(<span class="str">$"  Errore I/O: {ex.Message}"</span>);

                <span class="kw">if</span> (tentativo &lt; maxTentativi) {
                    Console.<span class="fn">WriteLine</span>(<span class="str">$"  Attendo {delayMs}ms prima di riprovare..."</span>);
                    Thread.<span class="fn">Sleep</span>(delayMs);
                }
            }
        }

        <span class="kw">throw new</span> IOException(
            <span class="str">$"Impossibile leggere '{path}' dopo {maxTentativi} tentativi"</span>,
            ultimaEccezione
        );
    }
}

<span class="cm">// --- 3. Sistema login ---</span>
<span class="kw">class</span> <span class="ty">CredentialsException</span> : Exception {
    <span class="kw">public</span> <span class="fn">CredentialsException</span>(<span class="ty">string</span> message) : <span class="kw">base</span>(message) { }
}

<span class="kw">class</span> <span class="ty">AccountBlockedException</span> : Exception {
    <span class="kw">public</span> DateTime SbloccoPrevisto { <span class="kw">get</span>; }
    <span class="kw">public</span> TimeSpan TempoRimanente => SbloccoPrevisto - DateTime.Now;

    <span class="kw">public</span> <span class="fn">AccountBlockedException</span>(DateTime sblocco)
        : <span class="kw">base</span>(<span class="str">$"Account bloccato. Riprova tra {(sblocco - DateTime.Now).Seconds} secondi"</span>)
    {
        SbloccoPrevisto = sblocco;
    }
}

<span class="kw">class</span> <span class="ty">LoginManager</span> {
    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; _utenti = <span class="kw">new</span>() {
        { <span class="str">"admin"</span>, <span class="str">"password123"</span> },
        { <span class="str">"user"</span>, <span class="str">"user456"</span> }
    };

    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; _tentativiFalliti = <span class="kw">new</span>();
    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, DateTime&gt; _bloccatiFinoA = <span class="kw">new</span>();

    <span class="kw">private</span> <span class="kw">const</span> <span class="ty">int</span> MAX_TENTATIVI = <span class="num">3</span>;
    <span class="kw">private</span> <span class="kw">const</span> <span class="ty">int</span> BLOCCO_SECONDI = <span class="num">30</span>;

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Login</span>(<span class="ty">string</span> username, <span class="ty">string</span> password) {
        <span class="cm">// Controlla se bloccato</span>
        <span class="kw">if</span> (_bloccatiFinoA.<span class="fn">TryGetValue</span>(username, <span class="kw">out</span> DateTime sblocco)) {
            <span class="kw">if</span> (DateTime.Now &lt; sblocco) {
                <span class="kw">throw new</span> <span class="ty">AccountBlockedException</span>(sblocco);
            }
            <span class="cm">// Tempo scaduto, rimuovi blocco</span>
            _bloccatiFinoA.<span class="fn">Remove</span>(username);
            _tentativiFalliti.<span class="fn">Remove</span>(username);
        }

        <span class="cm">// Verifica credenziali</span>
        <span class="kw">if</span> (!_utenti.<span class="fn">TryGetValue</span>(username, <span class="kw">out</span> <span class="ty">string</span> pwdCorretta)) {
            <span class="kw">throw new</span> <span class="ty">CredentialsException</span>(<span class="str">"Utente non trovato"</span>);
        }

        <span class="kw">if</span> (password != pwdCorretta) {
            <span class="cm">// Incrementa tentativi falliti</span>
            <span class="kw">if</span> (!_tentativiFalliti.<span class="fn">ContainsKey</span>(username))
                _tentativiFalliti[username] = <span class="num">0</span>;

            _tentativiFalliti[username]++;

            <span class="ty">int</span> rimasti = MAX_TENTATIVI - _tentativiFalliti[username];

            <span class="kw">if</span> (rimasti &lt;= <span class="num">0</span>) {
                _bloccatiFinoA[username] = DateTime.Now.<span class="fn">AddSeconds</span>(BLOCCO_SECONDI);
                <span class="kw">throw new</span> <span class="ty">AccountBlockedException</span>(_bloccatiFinoA[username]);
            }

            <span class="kw">throw new</span> <span class="ty">CredentialsException</span>(<span class="str">$"Password errata. Tentativi rimasti: {rimasti}"</span>);
        }

        <span class="cm">// Login riuscito — reset tentativi</span>
        _tentativiFalliti.<span class="fn">Remove</span>(username);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> loginManager = <span class="kw">new</span> <span class="ty">LoginManager</span>();

<span class="kw">while</span> (<span class="kw">true</span>) {
    <span class="kw">try</span> {
        Console.<span class="fn">Write</span>(<span class="str">"Username: "</span>);
        <span class="ty">string</span> user = Console.<span class="fn">ReadLine</span>();

        Console.<span class="fn">Write</span>(<span class="str">"Password: "</span>);
        <span class="ty">string</span> pwd = Console.<span class="fn">ReadLine</span>();

        <span class="kw">if</span> (loginManager.<span class="fn">Login</span>(user, pwd)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Login effettuato con successo!"</span>);
            <span class="kw">break</span>;
        }
    }
    <span class="kw">catch</span> (CredentialsException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
    }
    <span class="kw">catch</span> (AccountBlockedException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore: {ex.Message}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">"Attendi..."</span>);
        Thread.<span class="fn">Sleep</span>(ex.TempoRimanente);
    }
}</pre>

  </div>
</div>
      <!-- 9. Static & Object Initializer -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>9. Static &amp; Object Initializer</h3><div class="topic-sub">static class, membri statici, singleton, object initializer, costruttore statico</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è static?</h4>
    <p>Un membro <strong>static</strong> appartiene alla <strong>classe stessa</strong>, non a una singola istanza. Esiste uno solo in memoria, condiviso tra tutte le istanze. Una <strong>static class</strong> non può essere istanziata — contiene solo membri statici.</p>
    <table>
      <tr><th>Concetto</th><th>Appartiene a</th><th>Esempio</th></tr>
      <tr><td>Membro normale</td><td>Ogni istanza separata</td><td>persona1.Nome, persona2.Nome</td></tr>
      <tr><td>Membro static</td><td>La classe stessa</td><td>Contatore.Totale (uno solo)</td></tr>
      <tr><td>static class</td><td>Solo uso diretto</td><td>Math.Sqrt(), Console.WriteLine()</td></tr>
      <tr><td>Costruttore statico</td><td>Chiamato una volta sola</td><td>Inizializza membri statici</td></tr>
    </table>

    <h4>static class — Classe Solo Statica</h4>
    <pre><span class="cm">// static class — non si può fare new, solo membri statici:</span>
<span class="kw">static</span> <span class="kw">class</span> <span class="ty">Matematica</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">double</span> PI = <span class="num">3.14159265</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">double</span> E  = <span class="num">2.71828182</span>;

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span>    <span class="fn">Quadrato</span>(<span class="ty">int</span> n)    => n * n;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span> <span class="fn">Cubo</span>(<span class="ty">double</span> n)     => n * n * n;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">bool</span>   <span class="fn">IsPari</span>(<span class="ty">int</span> n)      => n % <span class="num">2</span> == <span class="num">0</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span> <span class="fn">AreaCerchio</span>(<span class="ty">double</span> r) => PI * r * r;

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> <span class="fn">MassimoComunDivisore</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) {
        <span class="kw">while</span> (b != <span class="num">0</span>) { <span class="ty">int</span> t = b; b = a % b; a = t; }
        <span class="kw">return</span> a;
    }
}

<span class="cm">// Utilizzo — diretto, senza new:</span>
Console.<span class="fn">WriteLine</span>(Matematica.PI);                 <span class="cm">// 3.14159265</span>
Console.<span class="fn">WriteLine</span>(Matematica.<span class="fn">Quadrato</span>(<span class="num">7</span>));         <span class="cm">// 49</span>
Console.<span class="fn">WriteLine</span>(Matematica.<span class="fn">AreaCerchio</span>(<span class="num">5</span>));      <span class="cm">// 78.539...</span>
Console.<span class="fn">WriteLine</span>(Matematica.<span class="fn">MassimoComunDivisore</span>(<span class="num">12</span>, <span class="num">8</span>));  <span class="cm">// 4</span>

<span class="cm">// new Matematica();  → ERRORE! static class non istanziabile</span>

<span class="cm">// Esempi di static class già in .NET:</span>
<span class="ty">double</span> x = Math.<span class="fn">Sqrt</span>(<span class="num">16</span>);          <span class="cm">// Math è static</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao"</span>);          <span class="cm">// Console è static</span>
<span class="ty">string</span> s = <span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(<span class="str">""</span>).ToString();  <span class="cm">// string ha metodi statici</span></pre>

    <h4>Membri Static in Classi Normali</h4>
    <pre><span class="cm">// Un membro static condivide lo stesso valore tra TUTTE le istanze:</span>
<span class="kw">class</span> <span class="ty">Contatore</span> {
    <span class="cm">// Static — uno solo per tutta la classe:</span>
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> Totale = <span class="num">0</span>;

    <span class="cm">// Normale — ogni istanza ha il proprio:</span>
    <span class="kw">public</span> <span class="ty">int</span> Id { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; }

    <span class="kw">public</span> <span class="fn">Contatore</span>(<span class="ty">string</span> nome) {
        Totale++;         <span class="cm">// incrementa il contatore globale</span>
        Id   = Totale;    <span class="cm">// assegna ID univoco</span>
        Nome = nome;
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">Reset</span>() => Totale = <span class="num">0</span>;  <span class="cm">// metodo statico</span>
}

<span class="kw">var</span> a = <span class="kw">new</span> <span class="ty">Contatore</span>(<span class="str">"Alice"</span>);
<span class="kw">var</span> b = <span class="kw">new</span> <span class="ty">Contatore</span>(<span class="str">"Bob"</span>);
<span class="kw">var</span> c = <span class="kw">new</span> <span class="ty">Contatore</span>(<span class="str">"Carlo"</span>);

Console.<span class="fn">WriteLine</span>(Contatore.Totale);  <span class="cm">// 3 — condiviso!</span>
Console.<span class="fn">WriteLine</span>(a.Id);              <span class="cm">// 1</span>
Console.<span class="fn">WriteLine</span>(b.Id);              <span class="cm">// 2</span>
Console.<span class="fn">WriteLine</span>(c.Id);              <span class="cm">// 3</span>

Contatore.<span class="fn">Reset</span>();
Console.<span class="fn">WriteLine</span>(Contatore.Totale);  <span class="cm">// 0</span>

<span class="cm">// ⚠️ Non puoi accedere a static tramite istanza (solo tramite classe):</span>
<span class="cm">// a.Totale   → ERRORE! (warning in alcuni IDE)</span>
<span class="cm">// Contatore.Totale → OK</span></pre>
    <div class="note">Accedi sempre ai membri statici tramite il nome della classe (Contatore.Totale), mai tramite un'istanza. Il compilatore ti avvisa, ma è buona pratica essere espliciti.</div>

    <h4>Costruttore Statico</h4>
    <pre><span class="cm">// Il costruttore statico viene chiamato UNA SOLA VOLTA,</span>
<span class="cm">// la prima volta che la classe viene usata:</span>
<span class="kw">class</span> <span class="ty">ConfigurazioneSistema</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> NomeApp   { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Versione  { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Ambiente  { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="kw">static</span> DateTime AvviatoAlle { <span class="kw">get</span>; <span class="kw">private set</span>; }

    <span class="cm">// Costruttore statico — nessun parametro, nessun modificatore di accesso:</span>
    <span class="kw">static</span> <span class="fn">ConfigurazioneSistema</span>() {
        NomeApp    = <span class="str">"MiaApp"</span>;
        Versione   = <span class="str">"1.0.0"</span>;
        Ambiente   = Environment.<span class="fn">GetEnvironmentVariable</span>(<span class="str">"APP_ENV"</span>) ?? <span class="str">"development"</span>;
        AvviatoAlle = DateTime.Now;
        Console.<span class="fn">WriteLine</span>(<span class="str">"[ConfigurazioneSistema] Inizializzato!"</span>);
    }
}

<span class="cm">// La prima volta che usi la classe, il costruttore statico scatta:</span>
Console.<span class="fn">WriteLine</span>(ConfigurazioneSistema.NomeApp);   <span class="cm">// "[Config...] Inizializzato!" + "MiaApp"</span>
Console.<span class="fn">WriteLine</span>(ConfigurazioneSistema.Versione);   <span class="cm">// "1.0.0" (costruttore NON rieseguito)</span>
Console.<span class="fn">WriteLine</span>(ConfigurazioneSistema.Ambiente);   <span class="cm">// "development"</span></pre>

    <h4>Pattern Singleton — Una Sola Istanza</h4>
    <pre><span class="cm">// Il Singleton usa static per garantire che esista UNA sola istanza:</span>
<span class="kw">class</span> <span class="ty">Logger</span> {
    <span class="cm">// Unica istanza, privata:</span>
    <span class="kw">private</span> <span class="kw">static</span> Logger? _istanza;
    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">object</span> _lock = <span class="kw">new</span>();

    <span class="kw">private</span> List&lt;<span class="ty">string</span>&gt; _log = <span class="kw">new</span>();

    <span class="cm">// Costruttore privato — nessuno può fare new Logger():</span>
    <span class="kw">private</span> <span class="fn">Logger</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Logger creato."</span>);
    }

    <span class="cm">// Proprietà statica per ottenere l'unica istanza:</span>
    <span class="kw">public</span> <span class="kw">static</span> Logger Istanza {
        <span class="kw">get</span> {
            <span class="kw">if</span> (_istanza == <span class="kw">null</span>) {
                <span class="kw">lock</span> (_lock) {
                    _istanza ??= <span class="kw">new</span> <span class="ty">Logger</span>();
                }
            }
            <span class="kw">return</span> _istanza;
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Scrivi</span>(<span class="ty">string</span> messaggio) {
        <span class="ty">string</span> entry = <span class="str">$"[{DateTime.Now:HH:mm:ss}] {messaggio}"</span>;
        _log.<span class="fn">Add</span>(entry);
        Console.<span class="fn">WriteLine</span>(entry);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaLog</span>() {
        <span class="kw">foreach</span> (<span class="kw">var</span> e <span class="kw">in</span> _log)
            Console.<span class="fn">WriteLine</span>(e);
    }
}

<span class="cm">// Utilizzo:</span>
Logger.Istanza.<span class="fn">Scrivi</span>(<span class="str">"Applicazione avviata"</span>);   <span class="cm">// "Logger creato."</span>
Logger.Istanza.<span class="fn">Scrivi</span>(<span class="str">"Utente connesso"</span>);         <span class="cm">// stessa istanza!</span>
Logger.Istanza.<span class="fn">Scrivi</span>(<span class="str">"Operazione completata"</span>);

Logger.Istanza.<span class="fn">StampaLog</span>();

<span class="cm">// new Logger();  → ERRORE! costruttore privato</span></pre>

    <h4>Object Initializer — Inizializzazione Compatta</h4>
    <pre><span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">int</span>     Id       { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span>    Attivo   { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;
    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; Tag { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
}

<span class="cm">// SENZA object initializer — verboso:</span>
Prodotto p1 = <span class="kw">new</span> <span class="ty">Prodotto</span>();
p1.Id     = <span class="num">1</span>;
p1.Nome   = <span class="str">"Laptop"</span>;
p1.Prezzo = <span class="num">999.99m</span>;
p1.Attivo = <span class="kw">true</span>;

<span class="cm">// CON object initializer — compatto e leggibile:</span>
Prodotto p2 = <span class="kw">new</span> <span class="ty">Prodotto</span> {
    Id     = <span class="num">2</span>,
    Nome   = <span class="str">"Mouse"</span>,
    Prezzo = <span class="num">29.99m</span>,
    Attivo = <span class="kw">true</span>,
    Tag    = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt; { <span class="str">"periferica"</span>, <span class="str">"input"</span> }
};

<span class="cm">// Con target-typed new (C# 9+) — il tipo viene inferito:</span>
Prodotto p3 = <span class="kw">new</span>() {
    Id     = <span class="num">3</span>,
    Nome   = <span class="str">"Tastiera"</span>,
    Prezzo = <span class="num">59.99m</span>
};

<span class="cm">// Anche nelle liste — molto comune:</span>
List&lt;Prodotto&gt; catalogo = <span class="kw">new</span>() {
    <span class="kw">new</span>() { Id = <span class="num">1</span>, Nome = <span class="str">"Monitor"</span>,  Prezzo = <span class="num">399m</span> },
    <span class="kw">new</span>() { Id = <span class="num">2</span>, Nome = <span class="str">"Webcam"</span>,   Prezzo = <span class="num">79m</span>  },
    <span class="kw">new</span>() { Id = <span class="num">3</span>, Nome = <span class="str">"Microfono"</span>, Prezzo = <span class="num">129m</span> }
};</pre>
    <div class="note">L'object initializer chiama prima il costruttore vuoto, poi assegna le proprietà. Se la classe non ha un costruttore senza parametri, devi usare quello disponibile prima della parentesi graffa.</div>

    <h4>Object Initializer con Costruttore</h4>
    <pre><span class="kw">class</span> <span class="ty">Ordine</span> {
    <span class="kw">public</span> <span class="ty">int</span>     Id        { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  Cliente   { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  Stato     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Totale    { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> DateTime DataOrdine { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// Costruttore con parametri obbligatori:</span>
    <span class="kw">public</span> <span class="fn">Ordine</span>(<span class="ty">int</span> id, <span class="ty">string</span> cliente) {
        Id      = id;
        Cliente = cliente;
        Stato   = <span class="str">"In attesa"</span>;
        DataOrdine = DateTime.Now;
    }
}

<span class="cm">// Costruttore + object initializer insieme:</span>
Ordine o1 = <span class="kw">new</span> <span class="ty">Ordine</span>(<span class="num">101</span>, <span class="str">"Mario Rossi"</span>) {
    Stato  = <span class="str">"Confermato"</span>,    <span class="cm">// sovrascrive il default</span>
    Totale = <span class="num">299.90m</span>
};

Ordine o2 = <span class="kw">new</span> <span class="ty">Ordine</span>(<span class="num">102</span>, <span class="str">"Anna Bianchi"</span>) {
    Totale = <span class="num">59.99m</span>
    <span class="cm">// Stato rimane "In attesa" (default del costruttore)</span>
};</pre>

    <h4>Confronto: static vs istanza</h4>
    <pre><span class="cm">// Visualizza la differenza in memoria:</span>

<span class="cm">//  ┌─────────────────────────────────────────────────────┐</span>
<span class="cm">//  │  MEMORIA                                            │</span>
<span class="cm">//  │                                                     │</span>
<span class="cm">//  │  [Classe Contatore] ←── static Totale = 3          │</span>
<span class="cm">//  │         │                                           │</span>
<span class="cm">//  │  ┌──────┴──────┬──────────────┐                     │</span>
<span class="cm">//  │  ↓            ↓              ↓                      │</span>
<span class="cm">//  │ [c1]         [c2]           [c3]                    │</span>
<span class="cm">//  │ Id=1         Id=2           Id=3                    │</span>
<span class="cm">//  │ Nome="Alice" Nome="Bob"     Nome="Carlo"            │</span>
<span class="cm">//  │                                                     │</span>
<span class="cm">//  │ Tutti vedono lo stesso Totale!                      │</span>
<span class="cm">//  └─────────────────────────────────────────────────────┘</span>

<span class="kw">class</span> <span class="ty">Contatore</span> {
    <span class="kw">public</span> <span class="kw">static</span>  <span class="ty">int</span>    Totale { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="num">0</span>;  <span class="cm">// uno solo</span>
    <span class="kw">public</span>         <span class="ty">int</span>    Id     { <span class="kw">get</span>; }                        <span class="cm">// per istanza</span>
    <span class="kw">public</span>         <span class="ty">string</span> Nome   { <span class="kw">get</span>; }                        <span class="cm">// per istanza</span>

    <span class="kw">public</span> <span class="fn">Contatore</span>(<span class="ty">string</span> nome) {
        Totale++;
        Id   = Totale;
        Nome = nome;
    }
}</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Accedere a membro non-static da contesto static:</span>
<span class="kw">class</span> <span class="ty">Esempio</span> {
    <span class="kw">public</span> <span class="ty">int</span> Valore = <span class="num">10</span>;

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">MetodoStatico</span>() {
        <span class="cm">// Console.WriteLine(Valore);  → ERRORE! non sa "quale" istanza</span>
        Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> Esempio().Valore);  <span class="cm">// OK (crea istanza)</span>
    }
}

<span class="cm">// 2. Object initializer su proprietà init-only senza init:</span>
<span class="kw">class</span> <span class="ty">Persona</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; }  <span class="cm">// solo getter</span>
}
<span class="cm">// new Persona { Nome = "Marco" };  → ERRORE! Nome non ha setter</span>
<span class="cm">// Soluzione: usa { get; set; } oppure { get; init; }</span>

<span class="cm">// 3. Pensare che static si resetti tra le chiamate:</span>
<span class="kw">class</span> <span class="ty">Cache</span> {
    <span class="kw">public</span> <span class="kw">static</span> List&lt;<span class="ty">string</span>&gt; Dati = <span class="kw">new</span>();  <span class="cm">// persiste finché il programma gira!</span>
}
Cache.Dati.<span class="fn">Add</span>(<span class="str">"A"</span>);
<span class="cm">// ...più avanti nel codice...</span>
Console.<span class="fn">WriteLine</span>(Cache.Dati.Count);  <span class="cm">// 1 — non si è resettato!</span>

<span class="cm">// 4. Dimenticare che il costruttore statico non può avere parametri:</span>
<span class="kw">class</span> <span class="ty">Sbagliata</span> {
    <span class="cm">// static Sbagliata(int x) { }  → ERRORE! nessun parametro consentito</span>
    <span class="kw">static</span> <span class="fn">Sbagliata</span>() { }  <span class="cm">// OK</span>
}</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una static class "Convertitore" con metodi statici:</span>
<span class="cm">//    KmToMiglia(double km), CelsiusToFahrenheit(double c),</span>
<span class="cm">//    EuroToDollaro(decimal euro, decimal tasso)</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea una classe "GiocatoreOnline" con:</span>
<span class="cm">//    - Static: GiocatoriConnessi (contatore), RecordPunteggio</span>
<span class="cm">//    - Istanza: Nome, Punteggio, Livello</span>
<span class="cm">//    - Metodo: AggiornaRecord() che aggiorna quello statico se batte il record</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Implementa un Singleton "GestoreCarrello" che:</span>
<span class="cm">//    - Ha una sola istanza per tutta l'app</span>
<span class="cm">//    - Gestisce prodotti (Aggiungi, Rimuovi, Svuota)</span>
<span class="cm">//    - Tiene traccia del totale in tempo reale</span>
<span class="cm">//    - Usa object initializer per creare i prodotti</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Convertitore ---</span>
<span class="kw">static</span> <span class="kw">class</span> <span class="ty">Convertitore</span> {
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span>  <span class="fn">KmToMiglia</span>(<span class="ty">double</span> km)               => km * <span class="num">0.621371</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span>  <span class="fn">MigliaToKm</span>(<span class="ty">double</span> miglia)           => miglia / <span class="num">0.621371</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span>  <span class="fn">CelsiusToFahrenheit</span>(<span class="ty">double</span> c)       => c * <span class="num">9</span> / <span class="num">5</span> + <span class="num">32</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">double</span>  <span class="fn">FahrenheitToCelsius</span>(<span class="ty">double</span> f)       => (f - <span class="num">32</span>) * <span class="num">5</span> / <span class="num">9</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">decimal</span> <span class="fn">EuroToDollaro</span>(<span class="ty">decimal</span> euro, <span class="ty">decimal</span> tasso) => euro * tasso;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">decimal</span> <span class="fn">DollaroToEuro</span>(<span class="ty">decimal</span> dollaro, <span class="ty">decimal</span> tasso) => dollaro / tasso;
}

Console.<span class="fn">WriteLine</span>(Convertitore.<span class="fn">KmToMiglia</span>(<span class="num">100</span>));           <span class="cm">// 62.14</span>
Console.<span class="fn">WriteLine</span>(Convertitore.<span class="fn">CelsiusToFahrenheit</span>(<span class="num">100</span>)); <span class="cm">// 212</span>
Console.<span class="fn">WriteLine</span>(Convertitore.<span class="fn">EuroToDollaro</span>(<span class="num">100</span>, <span class="num">1.08m</span>)); <span class="cm">// 108</span>

<span class="cm">// --- 2. GiocatoreOnline ---</span>
<span class="kw">class</span> <span class="ty">GiocatoreOnline</span> {
    <span class="cm">// Static — condivisi tra tutti i giocatori:</span>
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> GiocatoriConnessi { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="num">0</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">int</span> RecordPunteggio   { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="num">0</span>;
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> DetentoreRecord { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="str">"Nessuno"</span>;

    <span class="cm">// Istanza — ogni giocatore ha i propri:</span>
    <span class="kw">public</span> <span class="ty">string</span> Nome       { <span class="kw">get</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    Punteggio  { <span class="kw">get</span>; <span class="kw">private set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>    Livello    { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="num">1</span>;

    <span class="kw">public</span> <span class="fn">GiocatoreOnline</span>(<span class="ty">string</span> nome) {
        Nome = nome;
        GiocatoriConnessi++;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{nome} connesso. Giocatori online: {GiocatoriConnessi}"</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">AggiungiPunti</span>(<span class="ty">int</span> punti) {
        Punteggio += punti;
        <span class="kw">if</span> (Punteggio >= Livello * <span class="num">100</span>) Livello++;
        <span class="fn">AggiornaRecord</span>();
    }

    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">AggiornaRecord</span>() {
        <span class="kw">if</span> (Punteggio > RecordPunteggio) {
            RecordPunteggio   = Punteggio;
            DetentoreRecord   = Nome;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"🏆 Nuovo record! {Nome}: {Punteggio} punti!"</span>);
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Disconnetti</span>() {
        GiocatoriConnessi--;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{Nome} disconnesso. Giocatori online: {GiocatoriConnessi}"</span>);
    }
}

<span class="cm">// --- 3. GestoreCarrello Singleton ---</span>
<span class="kw">class</span> <span class="ty">Articolo</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>     Quantita { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">1</span>;
}

<span class="kw">class</span> <span class="ty">GestoreCarrello</span> {
    <span class="kw">private</span> <span class="kw">static</span> GestoreCarrello? _istanza;
    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">object</span> _lock = <span class="kw">new</span>();
    <span class="kw">private</span> List&lt;Articolo&gt; _articoli = <span class="kw">new</span>();

    <span class="kw">private</span> <span class="fn">GestoreCarrello</span>() { }

    <span class="kw">public</span> <span class="kw">static</span> GestoreCarrello Istanza {
        <span class="kw">get</span> {
            <span class="kw">lock</span> (_lock) { <span class="kw">return</span> _istanza ??= <span class="kw">new</span> <span class="ty">GestoreCarrello</span>(); }
        }
    }

    <span class="kw">public</span> <span class="ty">decimal</span> Totale => _articoli.<span class="fn">Sum</span>(a => a.Prezzo * a.Quantita);
    <span class="kw">public</span> <span class="ty">int</span>     NumArticoli => _articoli.<span class="fn">Sum</span>(a => a.Quantita);

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(Articolo articolo) {
        <span class="kw">var</span> esistente = _articoli.<span class="fn">FirstOrDefault</span>(a => a.Nome == articolo.Nome);
        <span class="kw">if</span> (esistente != <span class="kw">null</span>)
            esistente.Quantita += articolo.Quantita;
        <span class="kw">else</span>
            _articoli.<span class="fn">Add</span>(articolo);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ {articolo.Nome} aggiunto. Totale: {Totale:C}"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">string</span> nome) {
        <span class="kw">var</span> art = _articoli.<span class="fn">FirstOrDefault</span>(a => a.Nome == nome);
        <span class="kw">if</span> (art == <span class="kw">null</span>) <span class="kw">return</span> <span class="kw">false</span>;
        _articoli.<span class="fn">Remove</span>(art);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ {nome} rimosso. Totale: {Totale:C}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Svuota</span>() { _articoli.<span class="fn">Clear</span>(); Console.<span class="fn">WriteLine</span>(<span class="str">"Carrello svuotato."</span>); }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaCarrello</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- CARRELLO ---"</span>);
        <span class="kw">foreach</span> (<span class="kw">var</span> a <span class="kw">in</span> _articoli)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {a.Nome} x{a.Quantita} = {a.Prezzo * a.Quantita:C}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  TOTALE: {Totale:C}"</span>);
    }
}

<span class="cm">// Utilizzo con object initializer:</span>
GestoreCarrello.Istanza.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Articolo</span> { Nome = <span class="str">"Laptop"</span>,   Prezzo = <span class="num">999m</span> });
GestoreCarrello.Istanza.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Articolo</span> { Nome = <span class="str">"Mouse"</span>,    Prezzo = <span class="num">29m</span>,  Quantita = <span class="num">2</span> });
GestoreCarrello.Istanza.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Articolo</span> { Nome = <span class="str">"Tastiera"</span>, Prezzo = <span class="num">59m</span> });
GestoreCarrello.Istanza.<span class="fn">StampaCarrello</span>();
GestoreCarrello.Istanza.<span class="fn">Rimuovi</span>(<span class="str">"Mouse"</span>);
GestoreCarrello.Istanza.<span class="fn">StampaCarrello</span>();</pre>

  </div>
</div>
      <!-- 10. is, as, typeof -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>10. is, as, typeof — Type Checking</h3><div class="topic-sub">is, as, typeof, GetType, pattern matching, cast sicuro</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è il Type Checking?</h4>
    <p>In C# puoi lavorare con oggetti di tipo generico (come <strong>object</strong> o una classe base) e dover capire <strong>qual è il tipo reale</strong> a runtime. Gli operatori <strong>is</strong>, <strong>as</strong>, <strong>typeof</strong> e <strong>GetType()</strong> servono esattamente a questo.</p>
    <table>
      <tr><th>Operatore</th><th>Scopo</th><th>Restituisce</th><th>Quando usarlo</th></tr>
      <tr><td>is</td><td>Controlla il tipo</td><td>bool</td><td>Verificare prima di usare</td></tr>
      <tr><td>as</td><td>Cast sicuro</td><td>Tipo o null</td><td>Cast che può fallire</td></tr>
      <tr><td>(Tipo)</td><td>Cast diretto</td><td>Tipo o eccezione</td><td>Sei sicuro del tipo</td></tr>
      <tr><td>typeof</td><td>Tipo a compile-time</td><td>Type</td><td>Confronto tipi, reflection</td></tr>
      <tr><td>GetType()</td><td>Tipo a runtime</td><td>Type</td><td>Tipo reale dell'istanza</td></tr>
    </table>

    <h4>is — Controllo del Tipo</h4>
    <pre><span class="kw">class</span> <span class="ty">Animale</span> { <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; } }
<span class="kw">class</span> <span class="ty">Cane</span>    : <span class="ty">Animale</span> { <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Abbaia</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"BAU!"</span>); }
<span class="kw">class</span> <span class="ty">Gatto</span>   : <span class="ty">Animale</span> { <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Miagola</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"MIAO!"</span>); }
<span class="kw">class</span> <span class="ty">Uccello</span> : <span class="ty">Animale</span> { <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Canta</span>() => Console.<span class="fn">WriteLine</span>(<span class="str">"TWEET!"</span>); }

Animale animale = <span class="kw">new</span> <span class="ty">Cane</span> { Nome = <span class="str">"Fido"</span> };

<span class="cm">// is — restituisce true/false:</span>
Console.<span class="fn">WriteLine</span>(animale <span class="kw">is</span> Cane);    <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(animale <span class="kw">is</span> Gatto);   <span class="cm">// False</span>
Console.<span class="fn">WriteLine</span>(animale <span class="kw">is</span> Animale); <span class="cm">// True — Cane È UN Animale</span>
Console.<span class="fn">WriteLine</span>(animale <span class="kw">is</span> <span class="ty">object</span>);  <span class="cm">// True — tutto è object</span>

<span class="cm">// is con null check:</span>
Animale? forse = <span class="kw">null</span>;
Console.<span class="fn">WriteLine</span>(forse <span class="kw">is</span> Cane);      <span class="cm">// False — null non è nulla</span>
Console.<span class="fn">WriteLine</span>(forse <span class="kw">is</span> <span class="kw">null</span>);      <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(forse <span class="kw">is not null</span>);  <span class="cm">// False</span></pre>

    <h4>is con Pattern Variable (C# 7+)</h4>
    <pre><span class="cm">// Controlla il tipo E crea la variabile nello stesso colpo:</span>
Animale[] zoo = {
    <span class="kw">new</span> <span class="ty">Cane</span>    { Nome = <span class="str">"Fido"</span>  },
    <span class="kw">new</span> <span class="ty">Gatto</span>   { Nome = <span class="str">"Micia"</span> },
    <span class="kw">new</span> <span class="ty">Uccello</span> { Nome = <span class="str">"Tweety"</span>},
    <span class="kw">new</span> <span class="ty">Cane</span>    { Nome = <span class="str">"Rex"</span>   }
};

<span class="kw">foreach</span> (Animale a <span class="kw">in</span> zoo) {
    <span class="cm">// is pattern variable — dichiarazione + controllo in uno:</span>
    <span class="kw">if</span> (a <span class="kw">is</span> Cane cane) {
        cane.<span class="fn">Abbaia</span>();   <span class="cm">// cane è già di tipo Cane, nessun cast!</span>
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Il cane si chiama {cane.Nome}"</span>);
    }
    <span class="kw">else if</span> (a <span class="kw">is</span> Gatto gatto) {
        gatto.<span class="fn">Miagola</span>();
    }
    <span class="kw">else if</span> (a <span class="kw">is</span> Uccello uccello) {
        uccello.<span class="fn">Canta</span>();
    }
}

<span class="cm">// La variabile esiste solo se il check è vero:</span>
<span class="kw">if</span> (animale <span class="kw">is</span> Cane c && c.Nome.<span class="fn">StartsWith</span>(<span class="str">"F"</span>)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{c.Nome} inizia per F ed è un cane!"</span>);
}</pre>

    <h4>as — Cast Sicuro</h4>
    <pre><span class="cm">// as — prova il cast, restituisce null se fallisce (NON lancia eccezione):</span>
Animale animale = <span class="kw">new</span> <span class="ty">Cane</span> { Nome = <span class="str">"Fido"</span> };

Cane?   cane  = animale <span class="kw">as</span> Cane;   <span class="cm">// OK — restituisce il Cane</span>
Gatto?  gatto = animale <span class="kw">as</span> Gatto;  <span class="cm">// FALLISCE — restituisce null</span>

Console.<span class="fn">WriteLine</span>(cane  != <span class="kw">null</span>);  <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(gatto != <span class="kw">null</span>);  <span class="cm">// False</span>

<span class="cm">// Uso tipico — controlla null dopo as:</span>
Cane? c = animale <span class="kw">as</span> Cane;
<span class="kw">if</span> (c != <span class="kw">null</span>) {
    c.<span class="fn">Abbaia</span>();
}

<span class="cm">// Con null-conditional operator — ancora più compatto:</span>
(animale <span class="kw">as</span> Cane)?.<span class="fn">Abbaia</span>();  <span class="cm">// abbaia solo se è un Cane</span>
(animale <span class="kw">as</span> Gatto)?.<span class="fn">Miagola</span>(); <span class="cm">// non fa nulla — è null</span>

<span class="cm">// as funziona solo con tipi reference (classi) e nullable:</span>
<span class="cm">// int x = animale as int;  → ERRORE! int non è nullable</span>
<span class="ty">int</span>? x = <span class="str">"42"</span> <span class="kw">as</span> <span class="ty">int</span>?;  <span class="cm">// null — string non è int</span></pre>

    <h4>Cast Diretto vs as — Differenza Chiave</h4>
    <pre><span class="kw">object</span> obj = <span class="str">"Ciao"</span>;

<span class="cm">// Cast diretto — lancia InvalidCastException se fallisce:</span>
<span class="kw">try</span> {
    <span class="ty">int</span> n = (<span class="ty">int</span>)obj;  <span class="cm">// ECCEZIONE! string non è int</span>
} <span class="kw">catch</span> (InvalidCastException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Cast fallito: {ex.Message}"</span>);
}

<span class="cm">// as — null invece di eccezione:</span>
<span class="ty">string</span>? s = obj <span class="kw">as</span> <span class="ty">string</span>;  <span class="cm">// OK — obj è string</span>
Console.<span class="fn">WriteLine</span>(s);          <span class="cm">// "Ciao"</span>

<span class="cm">// Quando usare quale:</span>
<span class="cm">// Cast diretto → sei CERTO del tipo (es. da database tipizzato)</span>
<span class="cm">// as           → il tipo è INCERTO (es. da API esterna, deserializzazione)</span>
<span class="cm">// is pattern   → vuoi controllare E usare subito (preferito in C# moderno)</span>

<span class="cm">// Confronto prestazioni — is pattern è il più moderno e leggibile:</span>
<span class="cm">// VECCHIO stile (doppio cast — inefficiente):</span>
<span class="kw">if</span> (animale <span class="kw">is</span> Cane) {
    Cane c2 = (Cane)animale;  <span class="cm">// cast già fatto da is — ridondante!</span>
    c2.<span class="fn">Abbaia</span>();
}

<span class="cm">// MODERNO (un solo controllo):</span>
<span class="kw">if</span> (animale <span class="kw">is</span> Cane c3) {
    c3.<span class="fn">Abbaia</span>();  <span class="cm">// diretto, un solo check</span>
}</pre>
    <div class="tip">In C# moderno preferisci sempre <code>is Tipo variabile</code> rispetto a <code>as</code> + null check. È più leggibile, più sicuro e non fa il cast due volte.</div>

    <h4>typeof vs GetType()</h4>
    <pre><span class="cm">// typeof — tipo noto a COMPILE TIME (non serve un'istanza):</span>
Type t1 = <span class="kw">typeof</span>(<span class="ty">int</span>);
Type t2 = <span class="kw">typeof</span>(<span class="ty">string</span>);
Type t3 = <span class="kw">typeof</span>(Cane);
Type t4 = <span class="kw">typeof</span>(List&lt;<span class="ty">string</span>&gt;);

Console.<span class="fn">WriteLine</span>(t1);  <span class="cm">// System.Int32</span>
Console.<span class="fn">WriteLine</span>(t2);  <span class="cm">// System.String</span>
Console.<span class="fn">WriteLine</span>(t3);  <span class="cm">// MiaApp.Cane</span>
Console.<span class="fn">WriteLine</span>(t3.Name);          <span class="cm">// Cane</span>
Console.<span class="fn">WriteLine</span>(t3.IsClass);       <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(t3.BaseType);      <span class="cm">// MiaApp.Animale</span>

<span class="cm">// GetType() — tipo reale a RUNTIME (serve un'istanza):</span>
Animale animale1 = <span class="kw">new</span> <span class="ty">Cane</span>  { Nome = <span class="str">"Fido"</span>  };
Animale animale2 = <span class="kw">new</span> <span class="ty">Gatto</span> { Nome = <span class="str">"Micia"</span> };

Console.<span class="fn">WriteLine</span>(animale1.<span class="fn">GetType</span>());        <span class="cm">// MiaApp.Cane</span>
Console.<span class="fn">WriteLine</span>(animale2.<span class="fn">GetType</span>());        <span class="cm">// MiaApp.Gatto</span>
Console.<span class="fn">WriteLine</span>(animale1.<span class="fn">GetType</span>().Name);   <span class="cm">// Cane</span>

<span class="cm">// Differenza fondamentale — typeof vs GetType():</span>
Console.<span class="fn">WriteLine</span>(animale1.<span class="fn">GetType</span>() == <span class="kw">typeof</span>(Cane));    <span class="cm">// True — tipo esatto</span>
Console.<span class="fn">WriteLine</span>(animale1.<span class="fn">GetType</span>() == <span class="kw">typeof</span>(Animale)); <span class="cm">// False! è Cane, non Animale</span>
Console.<span class="fn">WriteLine</span>(animale1 <span class="kw">is</span> Animale);                   <span class="cm">// True — is considera ereditarietà</span></pre>
    <div class="warn">GetType() == typeof(X) controlla il tipo ESATTO, ignorando l'ereditarietà. <code>is</code> invece restituisce true anche per i tipi base. Scegli in base a ciò che ti serve.</div>

    <h4>Pattern Matching Avanzato con switch (C# 8+)</h4>
    <pre><span class="cm">// switch expression con type pattern — molto più pulito di if/else a catena:</span>
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">DescriviAnimale</span>(Animale a) => a <span class="kw">switch</span> {
    Cane    c => <span class="str">$"{c.Nome} è un cane che abbaia"</span>,
    Gatto   g => <span class="str">$"{g.Nome} è un gatto che miagola"</span>,
    Uccello u => <span class="str">$"{u.Nome} è un uccello che canta"</span>,
    <span class="kw">null</span>      => <span class="str">"Animale nullo!"</span>,
    _         => <span class="str">$"{a.Nome} è un animale sconosciuto"</span>
};

Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviAnimale</span>(<span class="kw">new</span> <span class="ty">Cane</span>  { Nome = <span class="str">"Rex"</span>   }));
Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviAnimale</span>(<span class="kw">new</span> <span class="ty">Gatto</span> { Nome = <span class="str">"Luna"</span>  }));
Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviAnimale</span>(<span class="kw">new</span> <span class="ty">Uccello</span>{ Nome = <span class="str">"Tweety"</span>}));

<span class="cm">// Con condizioni aggiuntive (when guard):</span>
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">ClassificaOggetto</span>(<span class="ty">object</span> obj) => obj <span class="kw">switch</span> {
    <span class="ty">int</span> n <span class="kw">when</span> n < <span class="num">0</span>  => <span class="str">"Numero negativo"</span>,
    <span class="ty">int</span> n <span class="kw">when</span> n == <span class="num">0</span> => <span class="str">"Zero"</span>,
    <span class="ty">int</span> n              => <span class="str">$"Numero positivo: {n}"</span>,
    <span class="ty">string</span> s <span class="kw">when</span> s.<span class="fn">Length</span> == <span class="num">0</span> => <span class="str">"Stringa vuota"</span>,
    <span class="ty">string</span> s           => <span class="str">$"Stringa: {s}"</span>,
    <span class="kw">null</span>               => <span class="str">"Null"</span>,
    _                  => <span class="str">$"Tipo sconosciuto: {obj.GetType().Name}"</span>
};

Console.<span class="fn">WriteLine</span>(<span class="fn">ClassificaOggetto</span>(-<span class="num">5</span>));     <span class="cm">// Numero negativo</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">ClassificaOggetto</span>(<span class="num">42</span>));     <span class="cm">// Numero positivo: 42</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">ClassificaOggetto</span>(<span class="str">"Ciao"</span>)); <span class="cm">// Stringa: Ciao</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">ClassificaOggetto</span>(<span class="kw">null</span>));   <span class="cm">// Null</span></pre>

    <h4>Esempio Completo — Sistema di Pagamento</h4>
    <pre><span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Pagamento</span> {
    <span class="kw">public</span> <span class="ty">decimal</span> Importo { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> DateTime Data   { <span class="kw">get</span>; } = DateTime.Now;
}

<span class="kw">class</span> <span class="ty">CartaCredito</span> : <span class="ty">Pagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> NumeroCarta { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Circuito    { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// Visa, Mastercard...</span>
}

<span class="kw">class</span> <span class="ty">BoniificoBancario</span> : <span class="ty">Pagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> IBAN       { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Causale    { <span class="kw">get</span>; <span class="kw">set</span>; }
}

<span class="kw">class</span> <span class="ty">PayPal</span> : <span class="ty">Pagamento</span> {
    <span class="kw">public</span> <span class="ty">string</span> Email      { <span class="kw">get</span>; <span class="kw">set</span>; }
}

<span class="kw">static</span> <span class="ty">void</span> <span class="fn">ElaboraPagamento</span>(Pagamento p) {
    <span class="ty">string</span> dettaglio = p <span class="kw">switch</span> {
        CartaCredito cc   => <span class="str">$"Carta {cc.Circuito} **** {cc.NumeroCarta[^4..]}"</span>,
        BoniificoBancario b => <span class="str">$"Bonifico IBAN {b.IBAN} — {b.Causale}"</span>,
        PayPal pp         => <span class="str">$"PayPal: {pp.Email}"</span>,
        _                 => <span class="str">"Metodo sconosciuto"</span>
    };

    Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Pagamento {p.Importo:C} via {dettaglio}"</span>);

    <span class="cm">// Logica extra solo per certi tipi:</span>
    <span class="kw">if</span> (p <span class="kw">is</span> CartaCredito carta && carta.Importo > <span class="num">500m</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"⚠️ Importo elevato — richiesta autorizzazione extra"</span>);
    }
}

List&lt;Pagamento&gt; pagamenti = <span class="kw">new</span>() {
    <span class="kw">new</span> <span class="ty">CartaCredito</span>    { Importo = <span class="num">99.99m</span>,  NumeroCarta = <span class="str">"1234567890123456"</span>, Circuito = <span class="str">"Visa"</span> },
    <span class="kw">new</span> <span class="ty">BoniificoBancario</span>{ Importo = <span class="num">750m</span>,    IBAN = <span class="str">"IT1234567890"</span>, Causale = <span class="str">"Fattura #42"</span> },
    <span class="kw">new</span> <span class="ty">PayPal</span>          { Importo = <span class="num">29.99m</span>,  Email = <span class="str">"mario@email.it"</span> },
    <span class="kw">new</span> <span class="ty">CartaCredito</span>    { Importo = <span class="num">1200m</span>,   NumeroCarta = <span class="str">"9876543210987654"</span>, Circuito = <span class="str">"Mastercard"</span> }
};

<span class="kw">foreach</span> (<span class="kw">var</span> p <span class="kw">in</span> pagamenti) <span class="fn">ElaboraPagamento</span>(p);</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Cast diretto senza controllo — pericoloso:</span>
Animale a = <span class="kw">new</span> <span class="ty">Gatto</span>();
<span class="cm">// Cane c = (Cane)a;  → InvalidCastException a runtime!</span>
<span class="cm">// Soluzione: usa is oppure as</span>

<span class="cm">// 2. Confondere typeof e GetType():</span>
Animale animale = <span class="kw">new</span> <span class="ty">Cane</span>();
<span class="kw">bool</span> sbagliato = animale.<span class="fn">GetType</span>() == <span class="kw">typeof</span>(Animale);  <span class="cm">// False! è Cane</span>
<span class="kw">bool</span> corretto  = animale <span class="kw">is</span> Animale;                     <span class="cm">// True</span>
<span class="kw">bool</span> esatto    = animale.<span class="fn">GetType</span>() == <span class="kw">typeof</span>(Cane);      <span class="cm">// True</span>

<span class="cm">// 3. as su tipi value (non funziona):</span>
<span class="ty">object</span> obj = <span class="num">42</span>;
<span class="cm">// int n = obj as int;   → ERRORE! int non è nullable</span>
<span class="ty">int</span>? n = obj <span class="kw">as</span> <span class="ty">int</span>?;  <span class="cm">// OK — usa int?</span>
<span class="ty">int</span> m = (<span class="ty">int</span>)obj;       <span class="cm">// OK — cast diretto (sei sicuro del tipo)</span>

<span class="cm">// 4. Dimenticare il null check dopo as:</span>
Cane? c2 = animale <span class="kw">as</span> Cane;
c2.<span class="fn">Abbaia</span>();  <span class="cm">// ❌ NullReferenceException se non è un Cane!</span>
<span class="kw">if</span> (c2 != <span class="kw">null</span>) c2.<span class="fn">Abbaia</span>();  <span class="cm">// ✓</span>
(animale <span class="kw">as</span> Cane)?.<span class="fn">Abbaia</span>();   <span class="cm">// ✓ alternativa compatta</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea un array di object con int, string, double, bool e DateTime.</span>
<span class="cm">//    Scorri l'array e stampa il tipo e il valore di ogni elemento.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Gerarchia: Forma -> Rettangolo, Cerchio, Triangolo</span>
<span class="cm">//    Scrivi un metodo DescriviForma(Forma f) che usa switch expression</span>
<span class="cm">//    e restituisce una stringa con tipo, dimensioni e area.</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "SerializzatoreBase" che accetta object e restituisce una stringa.</span>
<span class="cm">//    Deve gestire: int, double, bool, string, DateTime, List&lt;string&gt;, null</span>
<span class="cm">//    Usa is pattern e switch expression. Ogni tipo ha un formato diverso.</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Array di object ---</span>
<span class="ty">object</span>[] dati = { <span class="num">42</span>, <span class="str">"Ciao"</span>, <span class="num">3.14</span>, <span class="kw">true</span>, DateTime.Now, <span class="kw">null</span>! };

<span class="kw">foreach</span> (<span class="ty">object</span> item <span class="kw">in</span> dati) {
    <span class="ty">string</span> info = item <span class="kw">switch</span> {
        <span class="ty">int</span>      n => <span class="str">$"int     → {n}"</span>,
        <span class="ty">string</span>   s => <span class="str">$"string  → \"{s}\""</span>,
        <span class="ty">double</span>   d => <span class="str">$"double  → {d:F2}"</span>,
        <span class="ty">bool</span>     b => <span class="str">$"bool    → {b}"</span>,
        DateTime dt => <span class="str">$"DateTime → {dt:dd/MM/yyyy HH:mm}"</span>,
        <span class="kw">null</span>       => <span class="str">"null    → (nessun valore)"</span>,
        _          => <span class="str">$"altro   → {item.GetType().Name}"</span>
    };
    Console.<span class="fn">WriteLine</span>(info);
}

<span class="cm">// --- 2. DescriviForma ---</span>
<span class="kw">abstract</span> <span class="kw">class</span> <span class="ty">Forma</span> { }
<span class="kw">class</span> <span class="ty">Rettangolo</span> : <span class="ty">Forma</span> { <span class="kw">public</span> <span class="ty">double</span> Base, Altezza; }
<span class="kw">class</span> <span class="ty">Cerchio</span>    : <span class="ty">Forma</span> { <span class="kw">public</span> <span class="ty">double</span> Raggio; }
<span class="kw">class</span> <span class="ty">Triangolo</span>  : <span class="ty">Forma</span> { <span class="kw">public</span> <span class="ty">double</span> Base, Altezza; }

<span class="kw">static</span> <span class="ty">string</span> <span class="fn">DescriviForma</span>(Forma f) => f <span class="kw">switch</span> {
    Rettangolo r => <span class="str">$"Rettangolo {r.Base}x{r.Altezza} — Area: {r.Base * r.Altezza:F2}"</span>,
    Cerchio    c => <span class="str">$"Cerchio r={c.Raggio} — Area: {Math.PI * c.Raggio * c.Raggio:F2}"</span>,
    Triangolo  t => <span class="str">$"Triangolo b={t.Base} h={t.Altezza} — Area: {t.Base * t.Altezza / 2:F2}"</span>,
    <span class="kw">null</span>         => <span class="str">"Forma nulla"</span>,
    _            => <span class="str">"Forma sconosciuta"</span>
};

Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviForma</span>(<span class="kw">new</span> <span class="ty">Rettangolo</span> { Base = <span class="num">5</span>, Altezza = <span class="num">3</span> }));
Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviForma</span>(<span class="kw">new</span> <span class="ty">Cerchio</span>    { Raggio = <span class="num">4</span> }));
Console.<span class="fn">WriteLine</span>(<span class="fn">DescriviForma</span>(<span class="kw">new</span> <span class="ty">Triangolo</span>  { Base = <span class="num">6</span>, Altezza = <span class="num">4</span> }));

<span class="cm">// --- 3. SerializzatoreBase ---</span>
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">Serializza</span>(<span class="ty">object</span>? obj) => obj <span class="kw">switch</span> {
    <span class="kw">null</span>              => <span class="str">"null"</span>,
    <span class="ty">bool</span>   b          => b ? <span class="str">"true"</span> : <span class="str">"false"</span>,
    <span class="ty">int</span>    n          => <span class="str">$"int:{n}"</span>,
    <span class="ty">double</span> d          => <span class="str">$"double:{d:F4}"</span>,
    DateTime dt       => <span class="str">$"date:{dt:yyyy-MM-ddTHH:mm:ss}"</span>,
    <span class="ty">string</span> s <span class="kw">when</span> s.<span class="fn">Length</span> == <span class="num">0</span> => <span class="str">"\"\""</span>,
    <span class="ty">string</span> s          => <span class="str">$"\"{s}\""</span>,
    List&lt;<span class="ty">string</span>&gt; lst  => <span class="str">$"[{string.Join(", ", lst.Select(x => $"\"{x}\""))}]"</span>,
    _                 => <span class="str">$"unknown:{obj.GetType().Name}"</span>
};

Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="kw">null</span>));                                   <span class="cm">// null</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="kw">true</span>));                                   <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="num">42</span>));                                     <span class="cm">// int:42</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="num">3.14</span>));                                   <span class="cm">// double:3.1400</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="str">"Ciao"</span>));                                 <span class="cm">// "Ciao"</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(DateTime.Now));                           <span class="cm">// date:2025-...</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">Serializza</span>(<span class="kw">new</span> List&lt;<span class="ty">string</span>&gt; { <span class="str">"a"</span>, <span class="str">"b"</span>, <span class="str">"c"</span> }));  <span class="cm">// ["a", "b", "c"]</span></pre>

  </div>
</div>
      <!-- 11. File di Testo -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>11. File di Testo</h3><div class="topic-sub">File, StreamReader, StreamWriter, Path, Directory, encoding</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è System.IO?</h4>
    <p>Il namespace <strong>System.IO</strong> contiene tutte le classi per lavorare con file e cartelle. Puoi leggere, scrivere, spostare e organizzare file di testo in modo semplice con la classe statica <strong>File</strong>, oppure gestire file grandi riga per riga con <strong>StreamReader</strong> e <strong>StreamWriter</strong>.</p>
    <table>
      <tr><th>Classe / Metodo</th><th>Scopo</th><th>Quando usarlo</th></tr>
      <tr><td>File.ReadAllText</td><td>Legge tutto il file in una stringa</td><td>File piccoli</td></tr>
      <tr><td>File.ReadAllLines</td><td>Legge ogni riga in un array</td><td>File strutturati per righe</td></tr>
      <tr><td>File.WriteAllText</td><td>Scrive (o sovrascrive) tutto</td><td>Scrittura semplice</td></tr>
      <tr><td>File.AppendAllText</td><td>Aggiunge in fondo senza sovrascrivere</td><td>Log, append</td></tr>
      <tr><td>StreamReader</td><td>Lettura riga per riga</td><td>File grandi, parsing</td></tr>
      <tr><td>StreamWriter</td><td>Scrittura incrementale</td><td>Scrittura progressiva</td></tr>
      <tr><td>Path</td><td>Manipola percorsi</td><td>Sempre — evita errori cross-OS</td></tr>
      <tr><td>Directory</td><td>Crea, elenca, elimina cartelle</td><td>Gestione cartelle</td></tr>
    </table>

    <h4>Lettura e Scrittura Base con File</h4>
    <pre><span class="kw">using</span> System.IO;

<span class="cm">// ═══ SCRITTURA ═══</span>
<span class="cm">// Scrive tutto (crea il file o sovrascrive):</span>
File.<span class="fn">WriteAllText</span>(<span class="str">"note.txt"</span>, <span class="str">"Ciao Mondo!\nSeconda riga."</span>);

<span class="cm">// Scrive un array di righe (aggiunge \n automaticamente tra le righe):</span>
<span class="ty">string</span>[] righe = { <span class="str">"Prima riga"</span>, <span class="str">"Seconda riga"</span>, <span class="str">"Terza riga"</span> };
File.<span class="fn">WriteAllLines</span>(<span class="str">"lista.txt"</span>, righe);

<span class="cm">// Aggiunge in fondo senza sovrascrivere:</span>
File.<span class="fn">AppendAllText</span>(<span class="str">"note.txt"</span>, <span class="str">"\nRiga aggiunta dopo"</span>);

<span class="cm">// ═══ LETTURA ═══</span>
<span class="cm">// Legge tutto in una stringa:</span>
<span class="ty">string</span> testo = File.<span class="fn">ReadAllText</span>(<span class="str">"note.txt"</span>);
Console.<span class="fn">WriteLine</span>(testo);

<span class="cm">// Legge ogni riga in un array:</span>
<span class="ty">string</span>[] tutteLeRighe = File.<span class="fn">ReadAllLines</span>(<span class="str">"lista.txt"</span>);
<span class="kw">foreach</span> (<span class="ty">string</span> riga <span class="kw">in</span> tutteLeRighe)
    Console.<span class="fn">WriteLine</span>(riga);

<span class="cm">// Legge riga per riga senza caricare tutto in memoria (C# 8+):</span>
<span class="kw">foreach</span> (<span class="ty">string</span> riga <span class="kw">in</span> File.<span class="fn">ReadLines</span>(<span class="str">"lista.txt"</span>))
    Console.<span class="fn">WriteLine</span>(riga);  <span class="cm">// lazy — non carica tutto</span></pre>
    <div class="note">Usa <code>File.ReadAllText</code> per file piccoli. Per file grandi (MB), preferisci <code>File.ReadLines</code> o <code>StreamReader</code> che leggono riga per riga senza caricare tutto in memoria.</div>

    <h4>Operazioni su File — Exists, Copy, Move, Delete</h4>
    <pre><span class="cm">// Controlla se esiste PRIMA di operare:</span>
<span class="ty">string</span> percorso = <span class="str">"dati.txt"</span>;

<span class="kw">if</span> (File.<span class="fn">Exists</span>(percorso)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Il file esiste!"</span>);

    <span class="cm">// Copia (il terzo parametro = sovrascrive se esiste già):</span>
    File.<span class="fn">Copy</span>(percorso, <span class="str">"backup_dati.txt"</span>, overwrite: <span class="kw">true</span>);

    <span class="cm">// Sposta o rinomina:</span>
    File.<span class="fn">Move</span>(<span class="str">"vecchio_nome.txt"</span>, <span class="str">"nuovo_nome.txt"</span>);

    <span class="cm">// Elimina:</span>
    File.<span class="fn">Delete</span>(<span class="str">"backup_dati.txt"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">"Backup eliminato."</span>);
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato."</span>);
    File.<span class="fn">WriteAllText</span>(percorso, <span class="str">"File creato automaticamente."</span>);
}

<span class="cm">// Informazioni sul file:</span>
FileInfo info = <span class="kw">new</span> <span class="ty">FileInfo</span>(percorso);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Nome:      {info.Name}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Estensione:{info.Extension}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Dimensione:{info.Length} byte"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Creato:    {info.CreationTime}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Modificato:{info.LastWriteTime}"</span>);</pre>

    <h4>Path — Gestione Percorsi Cross-Platform</h4>
    <pre><span class="cm">// Path aiuta a costruire percorsi in modo sicuro su Windows, Mac, Linux:</span>
<span class="ty">string</span> cartella = <span class="str">"C:\\Utenti\\Marco\\Documenti"</span>;
<span class="ty">string</span> file     = <span class="str">"report.txt"</span>;

<span class="cm">// Combina percorsi (usa il separatore corretto per l'OS):</span>
<span class="ty">string</span> percorsoCompleto = Path.<span class="fn">Combine</span>(cartella, file);
Console.<span class="fn">WriteLine</span>(percorsoCompleto);  <span class="cm">// C:\Utenti\Marco\Documenti\report.txt</span>

<span class="cm">// Combina più segmenti:</span>
<span class="ty">string</span> percorso = Path.<span class="fn">Combine</span>(<span class="str">"C:\\"</span>, <span class="str">"Progetti"</span>, <span class="str">"MiaApp"</span>, <span class="str">"dati.json"</span>);

<span class="cm">// Estrae informazioni dal percorso:</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetFileName</span>(percorso));            <span class="cm">// dati.json</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetFileNameWithoutExtension</span>(percorso)); <span class="cm">// dati</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetExtension</span>(percorso));           <span class="cm">// .json</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetDirectoryName</span>(percorso));       <span class="cm">// C:\Progetti\MiaApp</span>

<span class="cm">// Percorsi speciali del sistema:</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetTempPath</span>());                    <span class="cm">// cartella temporanea</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetTempFileName</span>());                <span class="cm">// file temp univoco</span>
Console.<span class="fn">WriteLine</span>(Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.Desktop));

<span class="cm">// Cambia estensione:</span>
<span class="ty">string</span> nuovo = Path.<span class="fn">ChangeExtension</span>(<span class="str">"report.txt"</span>, <span class="str">".csv"</span>);
Console.<span class="fn">WriteLine</span>(nuovo);  <span class="cm">// report.csv</span></pre>
    <div class="warn">Non costruire mai percorsi con concatenazione di stringhe (<code>"C:\\" + cartella + "\\" + file</code>). Usa sempre <code>Path.Combine()</code> — gestisce automaticamente i separatori per Windows, Mac e Linux.</div>

    <h4>StreamReader e StreamWriter — File Grandi</h4>
    <pre><span class="cm">// StreamWriter — scrittura incrementale:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"log.txt"</span>, append: <span class="kw">true</span>)) {
    sw.<span class="fn">WriteLine</span>(<span class="str">$"[{DateTime.Now:HH:mm:ss}] Applicazione avviata"</span>);
    sw.<span class="fn">WriteLine</span>(<span class="str">$"[{DateTime.Now:HH:mm:ss}] Utente connesso: Marco"</span>);
    sw.<span class="fn">Write</span>(<span class="str">"Senza a capo"</span>);
    sw.<span class="fn">WriteLine</span>(<span class="str">" — continuazione sulla stessa riga"</span>);
}  <span class="cm">// using chiude e salva automaticamente il file</span>

<span class="cm">// StreamReader — lettura riga per riga (ideale per file grandi):</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"log.txt"</span>)) {
    <span class="ty">string</span>? riga;
    <span class="ty">int</span> numeroRiga = <span class="num">1</span>;

    <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{numeroRiga,4}: {riga}"</span>);
        numeroRiga++;
    }
}

<span class="cm">// Leggi tutto in una volta con StreamReader:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"log.txt"</span>)) {
    <span class="ty">string</span> tuttoIlTesto = sr.<span class="fn">ReadToEnd</span>();
    Console.<span class="fn">WriteLine</span>(tuttoIlTesto);
}</pre>

    <h4>Encoding — Gestione Caratteri Speciali</h4>
    <pre><span class="kw">using</span> System.Text;

<span class="cm">// Di default C# usa UTF-8. Per caratteri speciali (àèéìòù) specifica l'encoding:</span>
File.<span class="fn">WriteAllText</span>(<span class="str">"testo.txt"</span>, <span class="str">"Ciao! àèéìòù €"</span>, Encoding.UTF8);

<span class="cm">// Lettura con encoding specifico:</span>
<span class="ty">string</span> letto = File.<span class="fn">ReadAllText</span>(<span class="str">"testo.txt"</span>, Encoding.UTF8);

<span class="cm">// StreamWriter con encoding:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"testo.txt"</span>, <span class="kw">false</span>, Encoding.UTF8)) {
    sw.<span class="fn">WriteLine</span>(<span class="str">"Testo con caratteri italiani: àèéìòù"</span>);
}

<span class="cm">// StreamReader con encoding:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"testo.txt"</span>, Encoding.UTF8)) {
    Console.<span class="fn">WriteLine</span>(sr.<span class="fn">ReadToEnd</span>());
}

<span class="cm">// Encoding disponibili:</span>
<span class="cm">// Encoding.UTF8       → standard moderno (raccomandato)</span>
<span class="cm">// Encoding.Unicode    → UTF-16</span>
<span class="cm">// Encoding.ASCII      → solo caratteri base (no àèé...)</span>
<span class="cm">// Encoding.Latin1     → ISO-8859-1 (vecchi file italiani)</span></pre>

    <h4>Directory — Gestione Cartelle</h4>
    <pre><span class="cm">// Crea cartelle (anche annidate):</span>
Directory.<span class="fn">CreateDirectory</span>(<span class="str">"Dati\\Log\\2025"</span>);  <span class="cm">// crea tutta la catena</span>

<span class="cm">// Controlla se esiste:</span>
<span class="kw">if</span> (Directory.<span class="fn">Exists</span>(<span class="str">"Dati"</span>)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Cartella trovata!"</span>);
}

<span class="cm">// Elenca file in una cartella:</span>
<span class="ty">string</span>[] file = Directory.<span class="fn">GetFiles</span>(<span class="str">"Dati"</span>);
<span class="ty">string</span>[] solotxt = Directory.<span class="fn">GetFiles</span>(<span class="str">"Dati"</span>, <span class="str">"*.txt"</span>);           <span class="cm">// solo .txt</span>
<span class="ty">string</span>[] ricorsivo = Directory.<span class="fn">GetFiles</span>(<span class="str">"Dati"</span>, <span class="str">"*"</span>, SearchOption.AllDirectories);

<span class="kw">foreach</span> (<span class="ty">string</span> f <span class="kw">in</span> solotxt)
    Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetFileName</span>(f));

<span class="cm">// Elenca sottocartelle:</span>
<span class="ty">string</span>[] sottocartelle = Directory.<span class="fn">GetDirectories</span>(<span class="str">"Dati"</span>);

<span class="cm">// Elimina cartella (recursive = elimina anche il contenuto):</span>
Directory.<span class="fn">Delete</span>(<span class="str">"Dati\\Temp"</span>, recursive: <span class="kw">true</span>);

<span class="cm">// Cartella corrente:</span>
Console.<span class="fn">WriteLine</span>(Directory.<span class="fn">GetCurrentDirectory</span>());</pre>

    <h4>Gestione Errori con try/catch</h4>
    <pre><span class="cm">// Le operazioni su file possono fallire — gestisci sempre le eccezioni:</span>
<span class="kw">static</span> <span class="ty">string</span> <span class="fn">LeggiFileSicuro</span>(<span class="ty">string</span> percorso) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(percorso))
            <span class="kw">return</span> <span class="str">$"File non trovato: {percorso}"</span>;

        <span class="kw">return</span> File.<span class="fn">ReadAllText</span>(percorso, Encoding.UTF8);
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        <span class="kw">return</span> <span class="str">"Accesso negato — permessi insufficienti."</span>;
    }
    <span class="kw">catch</span> (IOException ex) {
        <span class="kw">return</span> <span class="str">$"Errore I/O: {ex.Message}"</span>;
    }
}

<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">ScriviFileSicuro</span>(<span class="ty">string</span> percorso, <span class="ty">string</span> contenuto) {
    <span class="kw">try</span> {
        <span class="ty">string</span>? cartella = Path.<span class="fn">GetDirectoryName</span>(percorso);
        <span class="kw">if</span> (!<span class="ty">string</span>.IsNullOrEmpty(cartella))
            Directory.<span class="fn">CreateDirectory</span>(cartella);  <span class="cm">// crea cartella se non esiste</span>

        File.<span class="fn">WriteAllText</span>(percorso, contenuto, Encoding.UTF8);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">catch</span> (Exception ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore scrittura: {ex.Message}"</span>);
        <span class="kw">return</span> <span class="kw">false</span>;
    }
}

<span class="cm">// Utilizzo:</span>
<span class="ty">string</span> testo = <span class="fn">LeggiFileSicuro</span>(<span class="str">"config.txt"</span>);
Console.<span class="fn">WriteLine</span>(testo);

<span class="kw">bool</span> ok = <span class="fn">ScriviFileSicuro</span>(<span class="str">"Output\\risultati.txt"</span>, <span class="str">"Dati salvati!"</span>);
Console.<span class="fn">WriteLine</span>(ok ? <span class="str">"✓ Salvato"</span> : <span class="str">"❌ Errore"</span>);</pre>
    <div class="tip">Controlla sempre <code>File.Exists()</code> prima di leggere e avvolgi le operazioni su file in try/catch. Le eccezioni più comuni sono <code>FileNotFoundException</code>, <code>UnauthorizedAccessException</code> e <code>IOException</code>.</div>

    <h4>Esempio Completo — Gestore di Note</h4>
    <pre><span class="kw">class</span> <span class="ty">GestoreNote</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _percorsoFile;

    <span class="kw">public</span> <span class="fn">GestoreNote</span>(<span class="ty">string</span> percorso) {
        _percorsoFile = percorso;
        <span class="cm">// Crea il file se non esiste:</span>
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_percorsoFile))
            File.<span class="fn">WriteAllText</span>(_percorsoFile, <span class="str">""</span>, Encoding.UTF8);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">AggiungiNota</span>(<span class="ty">string</span> testo) {
        <span class="ty">string</span> riga = <span class="str">$"[{DateTime.Now:dd/MM/yyyy HH:mm}] {testo}"</span>;
        File.<span class="fn">AppendAllText</span>(_percorsoFile, riga + Environment.NewLine, Encoding.UTF8);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Nota aggiunta: {testo}"</span>);
    }

    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; <span class="fn">LeggiTutte</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_percorsoFile))
            <span class="kw">return</span> <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();

        <span class="kw">return</span> File.<span class="fn">ReadAllLines</span>(_percorsoFile, Encoding.UTF8)
                   .<span class="fn">Where</span>(r => !<span class="ty">string</span>.IsNullOrWhiteSpace(r))
                   .<span class="fn">ToList</span>();
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaTutte</span>() {
        <span class="kw">var</span> note = <span class="fn">LeggiTutte</span>();
        <span class="kw">if</span> (note.Count == <span class="num">0</span>) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Nessuna nota."</span>);
            <span class="kw">return</span>;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n=== NOTE ({note.Count}) ==="</span>);
        <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i < note.Count; i++)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {i + 1}. {note[i]}"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">EliminaNota</span>(<span class="ty">int</span> indice) {
        <span class="kw">var</span> note = <span class="fn">LeggiTutte</span>();
        <span class="kw">if</span> (indice < <span class="num">1</span> || indice > note.Count) <span class="kw">return</span> <span class="kw">false</span>;

        note.<span class="fn">RemoveAt</span>(indice - <span class="num">1</span>);
        File.<span class="fn">WriteAllLines</span>(_percorsoFile, note, Encoding.UTF8);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Nota {indice} eliminata."</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">SvuotaTutte</span>() {
        File.<span class="fn">WriteAllText</span>(_percorsoFile, <span class="str">""</span>, Encoding.UTF8);
        Console.<span class="fn">WriteLine</span>(<span class="str">"✓ Tutte le note eliminate."</span>);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">EsportaBackup</span>(<span class="ty">string</span> destinazione) {
        File.<span class="fn">Copy</span>(_percorsoFile, destinazione, overwrite: <span class="kw">true</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Backup salvato in: {destinazione}"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> note = <span class="kw">new</span> <span class="ty">GestoreNote</span>(<span class="str">"mie_note.txt"</span>);
note.<span class="fn">AggiungiNota</span>(<span class="str">"Comprare il pane"</span>);
note.<span class="fn">AggiungiNota</span>(<span class="str">"Studiare C#"</span>);
note.<span class="fn">AggiungiNota</span>(<span class="str">"Chiamare Marco"</span>);
note.<span class="fn">StampaTutte</span>();
note.<span class="fn">EliminaNota</span>(<span class="num">2</span>);
note.<span class="fn">StampaTutte</span>();
note.<span class="fn">EsportaBackup</span>(<span class="str">"backup_note.txt"</span>);</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Costruire percorsi con + invece di Path.Combine:</span>
<span class="ty">string</span> sbagliato = <span class="str">"C:\\Dati"</span> + <span class="str">"\\"</span> + <span class="str">"file.txt"</span>;  <span class="cm">// ❌ fragile</span>
<span class="ty">string</span> corretto  = Path.<span class="fn">Combine</span>(<span class="str">"C:\\Dati"</span>, <span class="str">"file.txt"</span>);  <span class="cm">// ✓</span>

<span class="cm">// 2. Leggere senza controllare se il file esiste:</span>
<span class="ty">string</span> testo = File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);  <span class="cm">// ❌ FileNotFoundException se manca!</span>
<span class="kw">if</span> (File.<span class="fn">Exists</span>(<span class="str">"file.txt"</span>))
    testo = File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);     <span class="cm">// ✓</span>

<span class="cm">// 3. Dimenticare di chiudere StreamReader/Writer:</span>
StreamReader sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>);
<span class="ty">string</span> contenuto = sr.<span class="fn">ReadToEnd</span>();
<span class="cm">// sr.Close();  ← ci si dimentica!</span>
<span class="cm">// ✓ Usa sempre using:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr2 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>))
    contenuto = sr2.<span class="fn">ReadToEnd</span>();  <span class="cm">// chiuso automaticamente</span>

<span class="cm">// 4. WriteAllText sovrascrive silenziosamente:</span>
File.<span class="fn">WriteAllText</span>(<span class="str">"importante.txt"</span>, <span class="str">"Nuovi dati"</span>);  <span class="cm">// ❌ cancella il precedente!</span>
<span class="cm">// Usa AppendAllText per aggiungere, o controlla prima con Exists()</span>

<span class="cm">// 5. Usare ReadAllText su file enormi:</span>
<span class="ty">string</span> gigante = File.<span class="fn">ReadAllText</span>(<span class="str">"log_gigante.txt"</span>);  <span class="cm">// ❌ carica tutto in RAM</span>
<span class="kw">foreach</span> (<span class="ty">string</span> r <span class="kw">in</span> File.<span class="fn">ReadLines</span>(<span class="str">"log_gigante.txt"</span>))  <span class="cm">// ✓ lazy, riga per riga</span>
    Console.<span class="fn">WriteLine</span>(r);</pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea un programma che chiede all'utente di inserire frasi</span>
<span class="cm">//    e le salva in "diario.txt" con data e ora, una per riga.</span>
<span class="cm">//    Alla fine stampa il contenuto del file.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea "AnalizzatoreFile" che legge un file .txt e stampa:</span>
<span class="cm">//    - Numero totale di righe</span>
<span class="cm">//    - Numero totale di parole</span>
<span class="cm">//    - Numero totale di caratteri</span>
<span class="cm">//    - La riga più lunga</span>
<span class="cm">//    - Le 3 parole più frequenti</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea un sistema "GestoreCSV" che:</span>
<span class="cm">//    - Scrive una lista di Prodotti (Id, Nome, Prezzo) in formato CSV</span>
<span class="cm">//    - Legge un CSV e lo converte in List&lt;Prodotto&gt;</span>
<span class="cm">//    - Supporta aggiunta, ricerca per nome, e calcolo del totale</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Diario ---</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Scrivi le tue frasi (lascia vuoto per finire):"</span>);
<span class="ty">string</span> percorsoDiario = <span class="str">"diario.txt"</span>;

<span class="kw">while</span> (<span class="kw">true</span>) {
    Console.<span class="fn">Write</span>(<span class="str">"> "</span>);
    <span class="ty">string</span>? input = Console.<span class="fn">ReadLine</span>();
    <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(input)) <span class="kw">break</span>;

    <span class="ty">string</span> riga = <span class="str">$"[{DateTime.Now:dd/MM/yyyy HH:mm:ss}] {input}"</span>;
    File.<span class="fn">AppendAllText</span>(percorsoDiario, riga + Environment.NewLine, Encoding.UTF8);
}

Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- Contenuto del diario ---"</span>);
Console.<span class="fn">WriteLine</span>(File.<span class="fn">ReadAllText</span>(percorsoDiario, Encoding.UTF8));

<span class="cm">// --- 2. AnalizzatoreFile ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">AnalizzaFile</span>(<span class="ty">string</span> percorso) {
    <span class="kw">if</span> (!File.<span class="fn">Exists</span>(percorso)) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato."</span>);
        <span class="kw">return</span>;
    }

    <span class="ty">string</span>[] righe   = File.<span class="fn">ReadAllLines</span>(percorso, Encoding.UTF8);
    <span class="ty">string</span>  tuttoTesto = <span class="ty">string</span>.<span class="fn">Join</span>(<span class="str">" "</span>, righe);
    <span class="ty">string</span>[] parole  = tuttoTesto.<span class="fn">Split</span>(<span class="kw">new</span> <span class="ty">char</span>[] { <span class="str">' '</span>, <span class="str">'\t'</span>, <span class="str">'\n'</span> },
                                    StringSplitOptions.RemoveEmptyEntries);

    <span class="ty">string</span> rigaPiuLunga = righe.<span class="fn">OrderByDescending</span>(r => r.Length).<span class="fn">FirstOrDefault</span>() ?? <span class="str">""</span>;

    <span class="kw">var</span> parolePiuFrequenti = parole
        .<span class="fn">GroupBy</span>(p => p.<span class="fn">ToLower</span>())
        .<span class="fn">OrderByDescending</span>(g => g.Count())
        .<span class="fn">Take</span>(<span class="num">3</span>)
        .<span class="fn">Select</span>(g => <span class="str">$"\"{g.Key}\" ({g.Count()}x)"</span>);

    Console.<span class="fn">WriteLine</span>(<span class="str">$"Righe:              {righe.Length}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Parole:             {parole.Length}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Caratteri:          {tuttoTesto.Length}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Riga più lunga:     {rigaPiuLunga}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Parole frequenti:   {string.Join(", ", parolePiuFrequenti)}"</span>);
}

<span class="fn">AnalizzaFile</span>(<span class="str">"diario.txt"</span>);

<span class="cm">// --- 3. GestoreCSV ---</span>
<span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">int</span>     Id     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  Nome   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="kw">override</span> <span class="ty">string</span> <span class="fn">ToString</span>() => <span class="str">$"{Id},{Nome},{Prezzo}"</span>;
}

<span class="kw">class</span> <span class="ty">GestoreCSV</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _file;

    <span class="kw">public</span> <span class="fn">GestoreCSV</span>(<span class="ty">string</span> file) {
        _file = file;
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_file))
            File.<span class="fn">WriteAllText</span>(_file, <span class="str">"Id,Nome,Prezzo\n"</span>, Encoding.UTF8);
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(Prodotto p) {
        File.<span class="fn">AppendAllText</span>(_file, p + Environment.NewLine, Encoding.UTF8);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Aggiunto: {p.Nome}"</span>);
    }

    <span class="kw">public</span> List&lt;Prodotto&gt; <span class="fn">LeggiTutti</span>() {
        <span class="kw">return</span> File.<span class="fn">ReadAllLines</span>(_file, Encoding.UTF8)
            .<span class="fn">Skip</span>(<span class="num">1</span>)  <span class="cm">// salta intestazione</span>
            .<span class="fn">Where</span>(r => !<span class="ty">string</span>.IsNullOrWhiteSpace(r))
            .<span class="fn">Select</span>(r => {
                <span class="kw">var</span> col = r.<span class="fn">Split</span>(<span class="str">','</span>);
                <span class="kw">return</span> <span class="kw">new</span> <span class="ty">Prodotto</span> {
                    Id     = <span class="ty">int</span>.Parse(col[<span class="num">0</span>]),
                    Nome   = col[<span class="num">1</span>],
                    Prezzo = <span class="ty">decimal</span>.Parse(col[<span class="num">2</span>])
                };
            }).<span class="fn">ToList</span>();
    }

    <span class="kw">public</span> Prodotto? <span class="fn">CercaPerNome</span>(<span class="ty">string</span> nome) =>
        <span class="fn">LeggiTutti</span>().<span class="fn">FirstOrDefault</span>(p => p.Nome.Contains(nome, StringComparison.OrdinalIgnoreCase));

    <span class="kw">public</span> <span class="ty">decimal</span> <span class="fn">TotaleInventario</span>() =>
        <span class="fn">LeggiTutti</span>().<span class="fn">Sum</span>(p => p.Prezzo);
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> csv = <span class="kw">new</span> <span class="ty">GestoreCSV</span>(<span class="str">"prodotti.csv"</span>);
csv.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Prodotto</span> { Id = <span class="num">1</span>, Nome = <span class="str">"Laptop"</span>,    Prezzo = <span class="num">999m</span>  });
csv.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Prodotto</span> { Id = <span class="num">2</span>, Nome = <span class="str">"Mouse"</span>,     Prezzo = <span class="num">29m</span>   });
csv.<span class="fn">Aggiungi</span>(<span class="kw">new</span> <span class="ty">Prodotto</span> { Id = <span class="num">3</span>, Nome = <span class="str">"Tastiera"</span>,  Prezzo = <span class="num">59m</span>   });

Prodotto? trovato = csv.<span class="fn">CercaPerNome</span>(<span class="str">"mouse"</span>);
Console.<span class="fn">WriteLine</span>(trovato != <span class="kw">null</span> ? <span class="str">$"Trovato: {trovato.Nome} — {trovato.Prezzo:C}"</span> : <span class="str">"Non trovato"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Totale inventario: {csv.TotaleInventario():C}"</span>);</pre>

  </div>
</div>
      <!-- 12. StreamReader & StreamWriter -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>12. StreamReader &amp; StreamWriter</h3><div class="topic-sub">stream, buffer, encoding, using, lettura riga per riga, file grandi</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è uno Stream?</h4>
    <p>Uno <strong>stream</strong> è un flusso continuo di dati — come un rubinetto d'acqua. Invece di caricare tutto in memoria in una volta, leggi o scrivi <strong>un pezzo alla volta</strong>. <strong>StreamReader</strong> e <strong>StreamWriter</strong> sono stream specializzati per testo, e sono la scelta giusta quando lavori con file grandi o vuoi controllo fine sulla lettura/scrittura.</p>
    <table>
      <tr><th>Caratteristica</th><th>File.ReadAllText</th><th>StreamReader</th></tr>
      <tr><td>Carica tutto in RAM</td><td>✓ Sì</td><td>✗ No — riga per riga</td></tr>
      <tr><td>Semplicità</td><td>Molto semplice</td><td>Più verboso</td></tr>
      <tr><td>File grandi (100MB+)</td><td>Pericoloso</td><td>✓ Ideale</td></tr>
      <tr><td>Controllo encoding</td><td>Limitato</td><td>Completo</td></tr>
      <tr><td>Lettura parziale</td><td>No</td><td>✓ Sì</td></tr>
      <tr><td>Quando usarlo</td><td>File piccoli (&lt;10MB)</td><td>File grandi o parsing</td></tr>
    </table>

    <h4>StreamWriter — Scrittura Base</h4>
    <pre><span class="kw">using</span> System.IO;
<span class="kw">using</span> System.Text;

<span class="cm">// Crea o sovrascrive il file:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"dati.txt"</span>)) {
    sw.<span class="fn">WriteLine</span>(<span class="str">"Prima riga"</span>);      <span class="cm">// scrive + a capo</span>
    sw.<span class="fn">WriteLine</span>(<span class="str">"Seconda riga"</span>);
    sw.<span class="fn">Write</span>(<span class="str">"Senza a capo"</span>);       <span class="cm">// scrive senza \n</span>
    sw.<span class="fn">Write</span>(<span class="str">" — continua qui\n"</span>); <span class="cm">// va a capo manuale</span>
    sw.<span class="fn">WriteLine</span>(<span class="str">$"Numero: {42}"</span>);  <span class="cm">// interpolazione</span>
}  <span class="cm">// using chiude e svuota il buffer automaticamente!</span>

<span class="cm">// Append — aggiunge in fondo senza sovrascrivere:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"dati.txt"</span>, append: <span class="kw">true</span>)) {
    sw.<span class="fn">WriteLine</span>(<span class="str">"Riga aggiunta in fondo"</span>);
    sw.<span class="fn">WriteLine</span>(<span class="str">$"[{DateTime.Now:HH:mm:ss}] Log entry"</span>);
}

<span class="cm">// Con encoding esplicito (secondo param = append, terzo = encoding):</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"testo.txt"</span>, <span class="kw">false</span>, Encoding.UTF8)) {
    sw.<span class="fn">WriteLine</span>(<span class="str">"Caratteri italiani: à è é ì ò ù"</span>);
    sw.<span class="fn">WriteLine</span>(<span class="str">"Simboli: € © ® ™"</span>);
}

<span class="cm">// AutoFlush — svuota il buffer ad ogni WriteLine (utile per log real-time):</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"realtime.txt"</span>, <span class="kw">true</span>, Encoding.UTF8)) {
    sw.AutoFlush = <span class="kw">true</span>;  <span class="cm">// ogni WriteLine scrive subito su disco</span>
    sw.<span class="fn">WriteLine</span>(<span class="str">"Visibile subito nel file!"</span>);
}</pre>
    <div class="warn">Senza <code>using</code>, il buffer potrebbe non essere scritto su disco! Lo stream va sempre chiuso — <code>using</code> garantisce la chiusura anche in caso di eccezione.</div>

    <h4>StreamReader — Lettura Base</h4>
    <pre><span class="cm">// Lettura riga per riga — ideale per file grandi:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"dati.txt"</span>)) {
    <span class="ty">string</span>? riga;
    <span class="ty">int</span> numero = <span class="num">1</span>;

    <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"{numero,4}: {riga}"</span>);
        numero++;
    }
}

<span class="cm">// Leggi tutto in una stringa (come File.ReadAllText ma con più controllo):</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"dati.txt"</span>)) {
    <span class="ty">string</span> tutto = sr.<span class="fn">ReadToEnd</span>();
    Console.<span class="fn">WriteLine</span>(tutto);
}

<span class="cm">// Leggi un numero specifico di caratteri:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"dati.txt"</span>)) {
    <span class="ty">char</span>[] buffer = <span class="kw">new</span> <span class="ty">char</span>[<span class="num">100</span>];
    <span class="ty">int</span> letti = sr.<span class="fn">Read</span>(buffer, <span class="num">0</span>, <span class="num">100</span>);  <span class="cm">// legge max 100 caratteri</span>
    Console.<span class="fn">WriteLine</span>(<span class="kw">new</span> <span class="ty">string</span>(buffer, <span class="num">0</span>, letti));
}

<span class="cm">// Con encoding:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"testo.txt"</span>, Encoding.UTF8)) {
    <span class="ty">string</span>? riga;
    <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
        Console.<span class="fn">WriteLine</span>(riga);
}

<span class="cm">// Controlla se sei arrivato alla fine del file:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"dati.txt"</span>)) {
    <span class="kw">while</span> (!sr.EndOfStream) {
        <span class="ty">string</span> riga = sr.<span class="fn">ReadLine</span>()!;
        Console.<span class="fn">WriteLine</span>(riga);
    }
}</pre>

    <h4>using — Perché è Fondamentale</h4>
    <pre><span class="cm">// Senza using — devi chiudere manualmente (e gestire eccezioni):</span>
StreamWriter? sw = <span class="kw">null</span>;
<span class="kw">try</span> {
    sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>);
    sw.<span class="fn">WriteLine</span>(<span class="str">"Dati"</span>);
}
<span class="kw">finally</span> {
    sw?.<span class="fn">Close</span>();  <span class="cm">// devi farlo tu — e si dimentica spesso!</span>
}

<span class="cm">// Con using — chiusura garantita, codice pulito:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw2 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>)) {
    sw2.<span class="fn">WriteLine</span>(<span class="str">"Dati"</span>);
}  <span class="cm">// sw2.Dispose() chiamato automaticamente, anche se c'è un'eccezione</span>

<span class="cm">// Sintassi moderna (C# 8+) — using senza parentesi graffe:</span>
<span class="kw">using</span> <span class="ty">StreamWriter</span> sw3 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>);
sw3.<span class="fn">WriteLine</span>(<span class="str">"Riga 1"</span>);
sw3.<span class="fn">WriteLine</span>(<span class="str">"Riga 2"</span>);
<span class="cm">// sw3 viene disposto automaticamente alla fine del blocco corrente</span>

<span class="cm">// Più using annidati — scrivere e leggere insieme:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> scrittore = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"input.txt"</span>))
    scrittore.<span class="fn">WriteLine</span>(<span class="str">"Dati da processare"</span>);

<span class="kw">using</span> (<span class="ty">StreamReader</span> lettore = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"input.txt"</span>))
<span class="kw">using</span> (<span class="ty">StreamWriter</span> output  = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"output.txt"</span>)) {
    <span class="ty">string</span>? riga;
    <span class="kw">while</span> ((riga = lettore.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
        output.<span class="fn">WriteLine</span>(riga.<span class="fn">ToUpper</span>());  <span class="cm">// trasforma e riscrive</span>
}</pre>
    <div class="note"><code>using</code> funziona con qualsiasi classe che implementa <code>IDisposable</code> — non solo stream. Ogni volta che una classe ha un metodo <code>Dispose()</code> o <code>Close()</code>, è un candidato per <code>using</code>.</div>

    <h4>Encoding — Gestione Caratteri</h4>
    <pre><span class="kw">using</span> System.Text;

<span class="cm">// I principali encoding che incontrerai:</span>
<span class="cm">//  Encoding.UTF8     → standard moderno, supporta tutti i caratteri</span>
<span class="cm">//  Encoding.Unicode  → UTF-16, usato da Windows internamente</span>
<span class="cm">//  Encoding.ASCII    → solo 128 caratteri base (no àèéìòù)</span>
<span class="cm">//  Encoding.Latin1   → ISO-8859-1, vecchi file europei</span>

<span class="cm">// UTF8 senza BOM (Byte Order Mark) — raccomandato per interoperabilità:</span>
Encoding utf8NoBom = <span class="kw">new</span> UTF8Encoding(<span class="kw">false</span>);

<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"nobom.txt"</span>, <span class="kw">false</span>, utf8NoBom))
    sw.<span class="fn">WriteLine</span>(<span class="str">"File senza BOM — compatibile con Linux/Mac"</span>);

<span class="cm">// Rileva automaticamente l'encoding (con BOM):</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>, detectEncodingFromByteOrderMarks: <span class="kw">true</span>)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Encoding rilevato: {sr.CurrentEncoding.EncodingName}"</span>);
    Console.<span class="fn">WriteLine</span>(sr.<span class="fn">ReadToEnd</span>());
}

<span class="cm">// Converti tra encoding — leggi Latin1, riscrivi UTF8:</span>
<span class="ty">string</span> contenuto;
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"vecchio.txt"</span>, Encoding.Latin1))
    contenuto = sr.<span class="fn">ReadToEnd</span>();

<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"moderno.txt"</span>, <span class="kw">false</span>, Encoding.UTF8))
    sw.<span class="fn">Write</span>(contenuto);

Console.<span class="fn">WriteLine</span>(<span class="str">"✓ Convertito da Latin1 a UTF8"</span>);</pre>

    <h4>Buffer e Prestazioni</h4>
    <pre><span class="cm">// StreamReader/Writer usano un buffer interno (default 4096 byte)</span>
<span class="cm">// Per file molto grandi puoi aumentarlo:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(
    <span class="str">"gigante.txt"</span>,
    Encoding.UTF8,
    detectEncodingFromByteOrderMarks: <span class="kw">true</span>,
    bufferSize: <span class="num">65536</span>))  <span class="cm">// 64KB buffer — più veloce per file grandi</span>
{
    <span class="ty">string</span>? riga;
    <span class="ty">long</span> righeProcessate = <span class="num">0</span>;

    <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
        <span class="cm">// Processa riga per riga senza caricare tutto in RAM:</span>
        righeProcessate++;
        <span class="kw">if</span> (righeProcessate % <span class="num">10000</span> == <span class="num">0</span>)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Processate {righeProcessate} righe..."</span>);
    }
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Totale righe: {righeProcessate}"</span>);
}

<span class="cm">// Flush manuale — forza la scrittura del buffer su disco:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"output.txt"</span>)) {
    <span class="kw">for</span> (<span class="ty">int</span> i = <span class="num">0</span>; i < <span class="num">1000</span>; i++) {
        sw.<span class="fn">WriteLine</span>(<span class="str">$"Riga {i}"</span>);
        <span class="kw">if</span> (i % <span class="num">100</span> == <span class="num">0</span>) sw.<span class="fn">Flush</span>();  <span class="cm">// salva ogni 100 righe</span>
    }
}</pre>

    <h4>Esempio Completo — Logger con Rotazione File</h4>
    <pre><span class="kw">class</span> <span class="ty">Logger</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _cartella;
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">long</span>   _maxBytes;   <span class="cm">// dimensione massima per file</span>
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">object</span> _lock = <span class="kw">new</span>();

    <span class="kw">public</span> <span class="fn">Logger</span>(<span class="ty">string</span> cartella, <span class="ty">long</span> maxBytes = <span class="num">1024</span> * <span class="num">1024</span>) {  <span class="cm">// 1MB default</span>
        _cartella = cartella;
        _maxBytes = maxBytes;
        Directory.<span class="fn">CreateDirectory</span>(cartella);
    }

    <span class="kw">private</span> <span class="ty">string</span> FileOggi =>
        Path.<span class="fn">Combine</span>(_cartella, <span class="str">$"log_{DateTime.Now:yyyy-MM-dd}.txt"</span>);

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Scrivi</span>(<span class="ty">string</span> livello, <span class="ty">string</span> messaggio) {
        <span class="kw">lock</span> (_lock) {
            <span class="ty">string</span> entry = <span class="str">$"[{DateTime.Now:HH:mm:ss.fff}] [{livello,-5}] {messaggio}"</span>;
            Console.<span class="fn">WriteLine</span>(entry);

            <span class="kw">using</span> <span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(FileOggi, <span class="kw">true</span>, Encoding.UTF8);
            sw.AutoFlush = <span class="kw">true</span>;
            sw.<span class="fn">WriteLine</span>(entry);
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Info</span>(<span class="ty">string</span> msg)  => <span class="fn">Scrivi</span>(<span class="str">"INFO"</span>,  msg);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Warn</span>(<span class="ty">string</span> msg)  => <span class="fn">Scrivi</span>(<span class="str">"WARN"</span>,  msg);
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Error</span>(<span class="ty">string</span> msg) => <span class="fn">Scrivi</span>(<span class="str">"ERROR"</span>, msg);

    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; <span class="fn">LeggiOggi</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(FileOggi)) <span class="kw">return</span> <span class="kw">new</span>();

        List&lt;<span class="ty">string</span>&gt; righe = <span class="kw">new</span>();
        <span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(FileOggi, Encoding.UTF8))
        {
            <span class="ty">string</span>? riga;
            <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
                righe.<span class="fn">Add</span>(riga);
        }
        <span class="kw">return</span> righe;
    }

    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; <span class="fn">CercaNeiLog</span>(<span class="ty">string</span> termine) {
        List&lt;<span class="ty">string</span>&gt; risultati = <span class="kw">new</span>();

        <span class="kw">foreach</span> (<span class="ty">string</span> file <span class="kw">in</span> Directory.<span class="fn">GetFiles</span>(_cartella, <span class="str">"log_*.txt"</span>)) {
            <span class="kw">using</span> <span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(file, Encoding.UTF8);
            <span class="ty">string</span>? riga;
            <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
                <span class="kw">if</span> (riga.<span class="fn">Contains</span>(termine, StringComparison.OrdinalIgnoreCase))
                    risultati.<span class="fn">Add</span>(<span class="str">$"{Path.GetFileName(file)}: {riga}"</span>);
        }
        <span class="kw">return</span> risultati;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaStatistiche</span>() {
        <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(_cartella, <span class="str">"log_*.txt"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n=== Statistiche Log ==="</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"File totali: {files.Length}"</span>);

        <span class="kw">foreach</span> (<span class="ty">string</span> f <span class="kw">in</span> files) {
            FileInfo fi = <span class="kw">new</span> <span class="ty">FileInfo</span>(f);
            <span class="ty">int</span> righe = <span class="num">0</span>;
            <span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(f))
                <span class="kw">while</span> (sr.<span class="fn">ReadLine</span>() != <span class="kw">null</span>) righe++;

            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {fi.Name}: {righe} righe, {fi.Length / 1024.0:F1} KB"</span>);
        }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> log = <span class="kw">new</span> <span class="ty">Logger</span>(<span class="str">"Logs"</span>);
log.<span class="fn">Info</span>(<span class="str">"Applicazione avviata"</span>);
log.<span class="fn">Info</span>(<span class="str">"Utente connesso: Marco"</span>);
log.<span class="fn">Warn</span>(<span class="str">"Connessione lenta rilevata"</span>);
log.<span class="fn">Error</span>(<span class="str">"Timeout durante la richiesta"</span>);

Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- Log di oggi ---"</span>);
<span class="kw">foreach</span> (<span class="ty">string</span> r <span class="kw">in</span> log.<span class="fn">LeggiOggi</span>())
    Console.<span class="fn">WriteLine</span>(r);

Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- Cerca ERROR ---"</span>);
<span class="kw">foreach</span> (<span class="ty">string</span> r <span class="kw">in</span> log.<span class="fn">CercaNeiLog</span>(<span class="str">"ERROR"</span>))
    Console.<span class="fn">WriteLine</span>(r);

log.<span class="fn">StampaStatistiche</span>();</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Dimenticare using — il file rimane bloccato:</span>
StreamWriter sw4 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>);
sw4.<span class="fn">WriteLine</span>(<span class="str">"Dati"</span>);
<span class="cm">// sw4.Close();  ← dimenticato! file bloccato finché il GC non interviene</span>
<span class="cm">// ✓ Usa sempre using</span>

<span class="cm">// 2. Leggere e scrivere lo stesso file contemporaneamente:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr2 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>))
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw5 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>))  <span class="cm">// ❌ stesso file!</span>
    sw5.<span class="fn">WriteLine</span>(sr2.<span class="fn">ReadToEnd</span>());  <span class="cm">// comportamento imprevedibile</span>
<span class="cm">// ✓ Leggi tutto, chiudi il reader, poi apri il writer:</span>
<span class="ty">string</span> contenuto2;
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr3 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>))
    contenuto2 = sr3.<span class="fn">ReadToEnd</span>();
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw6 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>))
    sw6.<span class="fn">Write</span>(contenuto2.<span class="fn">ToUpper</span>());

<span class="cm">// 3. ReadLine() restituisce null a fine file — non stringa vuota:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr4 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>)) {
    <span class="ty">string</span> riga2 = sr4.<span class="fn">ReadLine</span>()!;  <span class="cm">// ❌ può essere null!</span>
    <span class="ty">string</span>? riga3 = sr4.<span class="fn">ReadLine</span>();  <span class="cm">// ✓ string? — gestisci il null</span>
    <span class="kw">if</span> (riga3 != <span class="kw">null</span>) Console.<span class="fn">WriteLine</span>(riga3);
}

<span class="cm">// 4. Encoding sbagliato — caratteri corrotti:</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw7 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.txt"</span>, <span class="kw">false</span>, Encoding.UTF8))
    sw7.<span class="fn">WriteLine</span>(<span class="str">"àèéìòù"</span>);

<span class="kw">using</span> (<span class="ty">StreamReader</span> sr5 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>, Encoding.ASCII))  <span class="cm">// ❌ encoding sbagliato</span>
    Console.<span class="fn">WriteLine</span>(sr5.<span class="fn">ReadToEnd</span>());  <span class="cm">// caratteri corrotti: ÃÃ©ÃÃ²Ã¹</span>
<span class="cm">// ✓ Usa sempre lo stesso encoding in scrittura e lettura</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Leggi il file "studenti.txt" (un nome per riga) con StreamReader.</span>
<span class="cm">//    Stampa ogni nome con il numero di riga davanti.</span>
<span class="cm">//    Alla fine stampa quanti studenti ci sono in totale.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea "ConvertitoreFile" che:</span>
<span class="cm">//    - Legge un file .txt con StreamReader</span>
<span class="cm">//    - Trasforma ogni riga in MAIUSCOLO</span>
<span class="cm">//    - Rimuove le righe vuote</span>
<span class="cm">//    - Aggiunge il numero di riga davanti</span>
<span class="cm">//    - Salva il risultato in un nuovo file con StreamWriter</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "GestoreMultiFile" che:</span>
<span class="cm">//    - Legge più file .txt da una cartella</span>
<span class="cm">//    - Unisce tutto il contenuto in un unico file "merged.txt"</span>
<span class="cm">//    - Aggiunge un'intestazione tra ogni file con il nome del file sorgente</span>
<span class="cm">//    - Conta e stampa le statistiche (righe totali, parole totali, file uniti)</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Lettura studenti ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">LeggiStudenti</span>(<span class="ty">string</span> percorso) {
    <span class="kw">if</span> (!File.<span class="fn">Exists</span>(percorso)) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato."</span>);
        <span class="kw">return</span>;
    }

    <span class="ty">int</span> contatore = <span class="num">0</span>;
    <span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(percorso, Encoding.UTF8)) {
        <span class="ty">string</span>? riga;
        <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
            <span class="kw">if</span> (!<span class="ty">string</span>.IsNullOrWhiteSpace(riga)) {
                contatore++;
                Console.<span class="fn">WriteLine</span>(<span class="str">$"{contatore,3}. {riga}"</span>);
            }
        }
    }
    Console.<span class="fn">WriteLine</span>(<span class="str">$"\nTotale studenti: {contatore}"</span>);
}

<span class="cm">// --- 2. ConvertitoreFile ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">ConvertiFIle</span>(<span class="ty">string</span> input, <span class="ty">string</span> output) {
    <span class="ty">int</span> righeProcessate = <span class="num">0</span>;

    <span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(input, Encoding.UTF8))
    <span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(output, <span class="kw">false</span>, Encoding.UTF8)) {
        <span class="ty">string</span>? riga;
        <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
            <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(riga)) <span class="kw">continue</span>;  <span class="cm">// salta vuote</span>
            righeProcessate++;
            sw.<span class="fn">WriteLine</span>(<span class="str">$"{righeProcessate,4}: {riga.ToUpper()}"</span>);
        }
    }
    Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Convertito: {righeProcessate} righe → {output}"</span>);
}

<span class="fn">ConvertiFIle</span>(<span class="str">"input.txt"</span>, <span class="str">"output_convertito.txt"</span>);

<span class="cm">// --- 3. GestoreMultiFile ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">UnisciFile</span>(<span class="ty">string</span> cartella, <span class="ty">string</span> outputFile) {
    <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(cartella, <span class="str">"*.txt"</span>)
                               .<span class="fn">Where</span>(f => Path.<span class="fn">GetFileName</span>(f) != Path.<span class="fn">GetFileName</span>(outputFile))
                               .<span class="fn">ToArray</span>();

    <span class="kw">if</span> (files.Length == <span class="num">0</span>) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Nessun file trovato."</span>);
        <span class="kw">return</span>;
    }

    <span class="ty">int</span> righetotali = <span class="num">0</span>;
    <span class="ty">int</span> paroleTotali = <span class="num">0</span>;

    <span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(outputFile, <span class="kw">false</span>, Encoding.UTF8)) {
        sw.<span class="fn">WriteLine</span>(<span class="str">$"=== FILE UNITI IL {DateTime.Now:dd/MM/yyyy HH:mm} ==="</span>);
        sw.<span class="fn">WriteLine</span>(<span class="str">$"Sorgenti: {files.Length} file\n"</span>);

        <span class="kw">foreach</span> (<span class="ty">string</span> file <span class="kw">in</span> files) {
            <span class="ty">string</span> nomeFile = Path.<span class="fn">GetFileName</span>(file);
            sw.<span class="fn">WriteLine</span>(<span class="str">$"{'=',60}"</span>);
            sw.<span class="fn">WriteLine</span>(<span class="str">$"  SORGENTE: {nomeFile}"</span>);
            sw.<span class="fn">WriteLine</span>(<span class="str">$"{'=',60}"</span>);

            <span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(file, Encoding.UTF8)) {
                <span class="ty">string</span>? riga;
                <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>) {
                    sw.<span class="fn">WriteLine</span>(riga);
                    righetotali++;
                    paroleTotali += riga.<span class="fn">Split</span>(<span class="str">' '</span>, StringSplitOptions.RemoveEmptyEntries).Length;
                }
            }
            sw.<span class="fn">WriteLine</span>();
        }
    }

    Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Uniti {files.Length} file → {outputFile}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  Righe totali: {righetotali}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  Parole totali: {paroleTotali}"</span>);
}

<span class="fn">UnisciFile</span>(<span class="str">"Documenti"</span>, <span class="str">"Documenti\\merged.txt"</span>);</pre>

  </div>
</div>
      <!-- 13. JSON -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>13. JSON</h3><div class="topic-sub">JsonSerializer, Serialize, Deserialize, opzioni, attributi, file</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è JSON?</h4>
    <p>JSON (JavaScript Object Notation) è il formato standard per scambiare dati tra applicazioni. È leggibile dall'uomo e supportato da tutti i linguaggi e servizi web. In C# il namespace <strong>System.Text.Json</strong> (built-in da .NET 3.1+) fornisce tutto il necessario per serializzare oggetti in JSON e deserializzarli di nuovo.</p>
    <table>
      <tr><th>Operazione</th><th>Metodo</th><th>Descrizione</th></tr>
      <tr><td>Oggetto → JSON</td><td>JsonSerializer.Serialize()</td><td>Converte un oggetto in stringa JSON</td></tr>
      <tr><td>JSON → Oggetto</td><td>JsonSerializer.Deserialize&lt;T&gt;()</td><td>Ricostruisce un oggetto dalla stringa</td></tr>
      <tr><td>Oggetto → File</td><td>Serialize + File.WriteAllText</td><td>Salva JSON su disco</td></tr>
      <tr><td>File → Oggetto</td><td>File.ReadAllText + Deserialize</td><td>Carica JSON da disco</td></tr>
      <tr><td>Formattare</td><td>JsonSerializerOptions</td><td>Indentazione, naming, null handling</td></tr>
    </table>

    <h4>Serializzazione Base — Oggetto → JSON</h4>
    <pre><span class="kw">using</span> System.Text.Json;

<span class="kw">class</span> <span class="ty">Studente</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Nome  { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>     Eta   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>  Email { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span>    Attivo { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;
}

Studente s = <span class="kw">new</span> <span class="ty">Studente</span> { Nome = <span class="str">"Marco"</span>, Eta = <span class="num">20</span>, Email = <span class="str">"marco@email.it"</span> };

<span class="cm">// Serializzazione compatta (una riga):</span>
<span class="ty">string</span> jsonCompatto = JsonSerializer.<span class="fn">Serialize</span>(s);
Console.<span class="fn">WriteLine</span>(jsonCompatto);
<span class="cm">// {"Nome":"Marco","Eta":20,"Email":"marco@email.it","Attivo":true}</span>

<span class="cm">// Serializzazione indentata — leggibile:</span>
<span class="kw">var</span> opzioni = <span class="kw">new</span> JsonSerializerOptions { WriteIndented = <span class="kw">true</span> };
<span class="ty">string</span> jsonBello = JsonSerializer.<span class="fn">Serialize</span>(s, opzioni);
Console.<span class="fn">WriteLine</span>(jsonBello);
<span class="cm">// {</span>
<span class="cm">//   "Nome": "Marco",</span>
<span class="cm">//   "Eta": 20,</span>
<span class="cm">//   "Email": "marco@email.it",</span>
<span class="cm">//   "Attivo": true</span>
<span class="cm">// }</span>

<span class="cm">// Serializzare liste:</span>
List&lt;Studente&gt; studenti = <span class="kw">new</span>() {
    <span class="kw">new</span>() { Nome = <span class="str">"Marco"</span>,  Eta = <span class="num">20</span>, Email = <span class="str">"marco@email.it"</span>  },
    <span class="kw">new</span>() { Nome = <span class="str">"Anna"</span>,   Eta = <span class="num">22</span>, Email = <span class="str">"anna@email.it"</span>   },
    <span class="kw">new</span>() { Nome = <span class="str">"Giulia"</span>, Eta = <span class="num">19</span>, Email = <span class="str">"giulia@email.it"</span> }
};

<span class="ty">string</span> jsonLista = JsonSerializer.<span class="fn">Serialize</span>(studenti, opzioni);
Console.<span class="fn">WriteLine</span>(jsonLista);
<span class="cm">// [ { "Nome": "Marco", ... }, { "Nome": "Anna", ... }, ... ]</span></pre>

    <h4>Deserializzazione — JSON → Oggetto</h4>
    <pre><span class="ty">string</span> jsonSingolo = <span class="str">"""{"Nome":"Luca","Eta":25,"Email":"luca@email.it","Attivo":true}"""</span>;

<span class="cm">// JSON → oggetto tipizzato:</span>
Studente? luca = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(jsonSingolo);
Console.<span class="fn">WriteLine</span>(<span class="str">$"{luca?.Nome}, {luca?.Eta} anni"</span>);  <span class="cm">// Luca, 25 anni</span>

<span class="cm">// JSON lista → List&lt;T&gt;:</span>
<span class="ty">string</span> jsonArray = <span class="str">"""
[
  {"Nome":"Marco","Eta":20,"Email":"marco@email.it","Attivo":true},
  {"Nome":"Anna","Eta":22,"Email":"anna@email.it","Attivo":false}
]
"""</span>;

List&lt;Studente&gt;? lista = JsonSerializer.<span class="fn">Deserialize</span>&lt;List&lt;Studente&gt;&gt;(jsonArray);
<span class="kw">foreach</span> (<span class="kw">var</span> st <span class="kw">in</span> lista!)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{st.Nome} — Attivo: {st.Attivo}"</span>);

<span class="cm">// Deserializzazione sicura con try/catch:</span>
<span class="kw">try</span> {
    <span class="ty">string</span> jsonRotto = <span class="str">"""{"Nome":"Mario","Eta":}"""</span>;  <span class="cm">// JSON non valido!</span>
    Studente? s2 = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(jsonRotto);
}
<span class="kw">catch</span> (JsonException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"JSON non valido: {ex.Message}"</span>);
}</pre>
    <div class="warn">Deserialize restituisce sempre un tipo nullable (es. <code>Studente?</code>). Controlla sempre il null prima di usare il risultato, e avvolgi la chiamata in un try/catch per gestire JSON malformato.</div>

    <h4>JsonSerializerOptions — Personalizzare il Comportamento</h4>
    <pre><span class="kw">using</span> System.Text.Json;
<span class="kw">using</span> System.Text.Json.Serialization;

<span class="cm">// Opzioni più comuni:</span>
<span class="kw">var</span> opzioni = <span class="kw">new</span> JsonSerializerOptions {
    WriteIndented          = <span class="kw">true</span>,                          <span class="cm">// indenta l'output</span>
    PropertyNamingPolicy   = JsonNamingPolicy.CamelCase,     <span class="cm">// Nome → nome</span>
    DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull,  <span class="cm">// ignora null</span>
    PropertyNameCaseInsensitive = <span class="kw">true</span>,                    <span class="cm">// deserializza case-insensitive</span>
    AllowTrailingCommas    = <span class="kw">true</span>,                          <span class="cm">// tollera virgole finali</span>
    ReadCommentHandling    = JsonCommentHandling.Skip,       <span class="cm">// ignora // commenti</span>
};

<span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">string</span>  NomeProdotto { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo       { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>? Descrizione  { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// nullable</span>
}

Prodotto p = <span class="kw">new</span>() { NomeProdotto = <span class="str">"Laptop"</span>, Prezzo = <span class="num">999m</span>, Descrizione = <span class="kw">null</span> };

<span class="cm">// Senza opzioni:</span>
Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(p));
<span class="cm">// {"NomeProdotto":"Laptop","Prezzo":999,"Descrizione":null}</span>

<span class="cm">// Con CamelCase + ignora null:</span>
Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(p, opzioni));
<span class="cm">// {</span>
<span class="cm">//   "nomeProdotto": "Laptop",</span>
<span class="cm">//   "prezzo": 999</span>
<span class="cm">// }   ← Descrizione omessa perché null!</span>

<span class="cm">// CamelCase è lo standard nelle API REST — raccomandato per interoperabilità</span></pre>

    <h4>Attributi JSON — Controllo Fine</h4>
    <pre><span class="kw">using</span> System.Text.Json.Serialization;

<span class="kw">class</span> <span class="ty">Utente</span> {
    <span class="cm">// JsonPropertyName — rinomina la proprietà nel JSON:</span>
    [JsonPropertyName(<span class="str">"nome_completo"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> NomeCompleto { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// JsonIgnore — esclude dal JSON (sempre):</span>
    [JsonIgnore]
    <span class="kw">public</span> <span class="ty">string</span> Password { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// JsonIgnore condizionale — escludi solo se null:</span>
    [JsonIgnore(Condition = JsonIgnoreCondition.WhenWritingNull)]
    <span class="kw">public</span> <span class="ty">string</span>? AvatarUrl { <span class="kw">get</span>; <span class="kw">set</span>; }

    <span class="cm">// JsonInclude — include anche proprietà non-public (C# 10+):</span>
    [JsonInclude]
    <span class="kw">public</span> <span class="ty">int</span> Eta { <span class="kw">get</span>; <span class="kw">private set</span>; } = <span class="num">25</span>;

    <span class="cm">// JsonPropertyOrder — controlla l'ordine nel JSON:</span>
    [JsonPropertyOrder(<span class="num">1</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Email { <span class="kw">get</span>; <span class="kw">set</span>; }

    [JsonPropertyOrder(<span class="num">2</span>)]
    <span class="kw">public</span> DateTime DataRegistrazione { <span class="kw">get</span>; <span class="kw">set</span>; } = DateTime.Now;
}

Utente u = <span class="kw">new</span>() {
    NomeCompleto = <span class="str">"Mario Rossi"</span>,
    Password     = <span class="str">"segreta123"</span>,
    Email        = <span class="str">"mario@email.it"</span>
};

Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(u, <span class="kw">new</span> JsonSerializerOptions { WriteIndented = <span class="kw">true</span> }));
<span class="cm">// {</span>
<span class="cm">//   "nome_completo": "Mario Rossi",   ← rinominato</span>
<span class="cm">//   "Eta": 25,                         ← incluso con JsonInclude</span>
<span class="cm">//   "Email": "mario@email.it",         ← ordine 1</span>
<span class="cm">//   "DataRegistrazione": "2025-..."    ← ordine 2</span>
<span class="cm">//   ← Password ASSENTE (JsonIgnore)</span>
<span class="cm">//   ← AvatarUrl ASSENTE (null)</span>
<span class="cm">// }</span></pre>

    <h4>Salvare e Caricare da File</h4>
    <pre><span class="kw">using</span> System.Text.Json;
<span class="kw">using</span> System.IO;

<span class="kw">class</span> <span class="ty">ConfigApp</span> {
    <span class="kw">public</span> <span class="ty">string</span> NomeApp    { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="str">"MiaApp"</span>;
    <span class="kw">public</span> <span class="ty">string</span> Tema       { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="str">"dark"</span>;
    <span class="kw">public</span> <span class="ty">int</span>    FontSize   { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="num">14</span>;
    <span class="kw">public</span> <span class="ty">bool</span>   AutoSave   { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;
    <span class="kw">public</span> List&lt;<span class="ty">string</span>&gt; FileRecenti { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
}

<span class="kw">static</span> <span class="kw">class</span> <span class="ty">GestoreConfig</span> {
    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">string</span> _file = <span class="str">"config.json"</span>;
    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> JsonSerializerOptions _opzioni = <span class="kw">new</span>() {
        WriteIndented = <span class="kw">true</span>,
        PropertyNameCaseInsensitive = <span class="kw">true</span>
    };

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">Salva</span>(ConfigApp config) {
        <span class="ty">string</span> json = JsonSerializer.<span class="fn">Serialize</span>(config, _opzioni);
        File.<span class="fn">WriteAllText</span>(_file, json);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Config salvata in {_file}"</span>);
    }

    <span class="kw">public</span> <span class="kw">static</span> ConfigApp <span class="fn">Carica</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_file)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Config non trovata, uso default."</span>);
            <span class="kw">return</span> <span class="kw">new</span> <span class="ty">ConfigApp</span>();
        }

        <span class="kw">try</span> {
            <span class="ty">string</span> json = File.<span class="fn">ReadAllText</span>(_file);
            <span class="kw">return</span> JsonSerializer.<span class="fn">Deserialize</span>&lt;ConfigApp&gt;(json, _opzioni)
                   ?? <span class="kw">new</span> <span class="ty">ConfigApp</span>();
        }
        <span class="kw">catch</span> (JsonException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Config corrotta: {ex.Message}. Uso default."</span>);
            <span class="kw">return</span> <span class="kw">new</span> <span class="ty">ConfigApp</span>();
        }
    }
}

<span class="cm">// Utilizzo:</span>
ConfigApp cfg = GestoreConfig.<span class="fn">Carica</span>();
cfg.Tema = <span class="str">"light"</span>;
cfg.FontSize = <span class="num">16</span>;
cfg.FileRecenti.<span class="fn">Add</span>(<span class="str">"progetto1.cs"</span>);
GestoreConfig.<span class="fn">Salva</span>(cfg);

ConfigApp cfgRicaricata = GestoreConfig.<span class="fn">Carica</span>();
Console.<span class="fn">WriteLine</span>(<span class="str">$"Tema: {cfgRicaricata.Tema}, Font: {cfgRicaricata.FontSize}"</span>);</pre>

    <h4>Strutture JSON Complesse — Classi Annidate</h4>
    <pre><span class="kw">class</span> <span class="ty">Indirizzo</span> {
    <span class="kw">public</span> <span class="ty">string</span> Via    { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Citta  { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> CAP    { <span class="kw">get</span>; <span class="kw">set</span>; }
}

<span class="kw">class</span> <span class="ty">Ordine</span> {
    <span class="kw">public</span> <span class="ty">int</span>      Id         { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span>   Cliente    { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> DateTime Data       { <span class="kw">get</span>; <span class="kw">set</span>; } = DateTime.Now;
    <span class="kw">public</span> Indirizzo Spedizione { <span class="kw">get</span>; <span class="kw">set</span>; }           <span class="cm">// oggetto annidato</span>
    <span class="kw">public</span> List&lt;Prodotto&gt; Prodotti { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>(); <span class="cm">// lista annidata</span>
    <span class="kw">public</span> <span class="ty">decimal</span> Totale => Prodotti.<span class="fn">Sum</span>(p => p.Prezzo);
}

Ordine ordine = <span class="kw">new</span>() {
    Id      = <span class="num">101</span>,
    Cliente = <span class="str">"Mario Rossi"</span>,
    Spedizione = <span class="kw">new</span>() { Via = <span class="str">"Via Roma 1"</span>, Citta = <span class="str">"Milano"</span>, CAP = <span class="str">"20100"</span> },
    Prodotti = <span class="kw">new</span>() {
        <span class="kw">new</span>() { NomeProdotto = <span class="str">"Laptop"</span>,   Prezzo = <span class="num">999m</span> },
        <span class="kw">new</span>() { NomeProdotto = <span class="str">"Mouse"</span>,    Prezzo = <span class="num">29m</span>  },
        <span class="kw">new</span>() { NomeProdotto = <span class="str">"Tastiera"</span>, Prezzo = <span class="num">59m</span>  }
    }
};

<span class="ty">string</span> json = JsonSerializer.<span class="fn">Serialize</span>(ordine, <span class="kw">new</span> JsonSerializerOptions { WriteIndented = <span class="kw">true</span> });
Console.<span class="fn">WriteLine</span>(json);
File.<span class="fn">WriteAllText</span>(<span class="str">"ordine.json"</span>, json);

<span class="cm">// Ricarica e usa:</span>
Ordine? ricaricato = JsonSerializer.<span class="fn">Deserialize</span>&lt;Ordine&gt;(File.<span class="fn">ReadAllText</span>(<span class="str">"ordine.json"</span>));
Console.<span class="fn">WriteLine</span>(<span class="str">$"Ordine #{ricaricato?.Id} — Totale: {ricaricato?.Totale:C}"</span>);</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Proprietà senza setter — non deserializzate:</span>
<span class="kw">class</span> <span class="ty">SbagliataA</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; }  <span class="cm">// ❌ solo getter — Deserialize non può impostarlo</span>
}
<span class="kw">class</span> <span class="ty">CorreataA</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }   <span class="cm">// ✓</span>
    <span class="kw">public</span> <span class="ty">string</span> Desc { <span class="kw">get</span>; <span class="kw">init</span>; }  <span class="cm">// ✓ init funziona con Deserialize</span>
}

<span class="cm">// 2. Dimenticare il null check sul risultato:</span>
Studente letto = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(json)!;  <span class="cm">// ❌ può essere null</span>
Studente? lettoSicuro = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(json);
<span class="kw">if</span> (lettoSicuro != <span class="kw">null</span>) Console.<span class="fn">WriteLine</span>(lettoSicuro.Nome);   <span class="cm">// ✓</span>

<span class="cm">// 3. Usare JsonIgnore sulla proprietà sbagliata — dati persi:</span>
<span class="kw">class</span> <span class="ty">SbagliataB</span> {
    [JsonIgnore]
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// ❌ non salvato e non caricato!</span>
}

<span class="cm">// 4. Case sensitivity — di default il Deserialize è case-sensitive:</span>
<span class="ty">string</span> jsonMin = <span class="str">"""{"nome":"Luca","eta":30}"""</span>;  <span class="cm">// chiavi minuscole</span>
Studente? s3 = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(jsonMin);
Console.<span class="fn">WriteLine</span>(s3?.Nome);  <span class="cm">// null! "nome" ≠ "Nome"</span>

<span class="cm">// ✓ Usa PropertyNameCaseInsensitive:</span>
<span class="kw">var</span> opt = <span class="kw">new</span> JsonSerializerOptions { PropertyNameCaseInsensitive = <span class="kw">true</span> };
Studente? s4 = JsonSerializer.<span class="fn">Deserialize</span>&lt;Studente&gt;(jsonMin, opt);
Console.<span class="fn">WriteLine</span>(s4?.Nome);  <span class="cm">// "Luca" ✓</span>

<span class="cm">// 5. Serializzare proprietà calcolate read-only — incluse di default:</span>
<span class="kw">class</span> <span class="ty">Carrello</span> {
    <span class="kw">public</span> List&lt;<span class="ty">decimal</span>&gt; Prezzi { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
    <span class="kw">public</span> <span class="ty">decimal</span> Totale => Prezzi.<span class="fn">Sum</span>();  <span class="cm">// incluso nel JSON ma ignorato in Deserialize</span>
}
<span class="cm">// Soluzione: aggiungi [JsonIgnore] se non vuoi Totale nel JSON</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una classe "Contatto" con Nome, Telefono, Email.</span>
<span class="cm">//    Serializza una lista di 3 contatti in JSON indentato.</span>
<span class="cm">//    Salvala in "rubrica.json", ricaricala e stampala.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Crea "RubricaManager" con metodi:</span>
<span class="cm">//    Aggiungi(Contatto), Rimuovi(string nome), Cerca(string nome),</span>
<span class="cm">//    Salva(), Carica() — tutto persistito su "rubrica.json"</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Simula una risposta API REST. Crea classi:</span>
<span class="cm">//    ApiResponse&lt;T&gt; { bool Success, string Message, T Data, DateTime Timestamp }</span>
<span class="cm">//    Serializza/deserializza risposte con dati di tipo Studente e List&lt;Prodotto&gt;.</span>
<span class="cm">//    Usa CamelCase e JsonIgnore sulle proprietà sensibili.</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Rubrica semplice ---</span>
<span class="kw">class</span> <span class="ty">Contatto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Telefono { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Email    { <span class="kw">get</span>; <span class="kw">set</span>; }
}

List&lt;Contatto&gt; rubrica = <span class="kw">new</span>() {
    <span class="kw">new</span>() { Nome = <span class="str">"Mario Rossi"</span>,  Telefono = <span class="str">"333-1234567"</span>, Email = <span class="str">"mario@email.it"</span>  },
    <span class="kw">new</span>() { Nome = <span class="str">"Anna Bianchi"</span>, Telefono = <span class="str">"347-9876543"</span>, Email = <span class="str">"anna@email.it"</span>   },
    <span class="kw">new</span>() { Nome = <span class="str">"Luca Verdi"</span>,   Telefono = <span class="str">"320-5551234"</span>, Email = <span class="str">"luca@email.it"</span>   }
};

<span class="kw">var</span> opzioniJson = <span class="kw">new</span> JsonSerializerOptions { WriteIndented = <span class="kw">true</span> };
<span class="ty">string</span> json = JsonSerializer.<span class="fn">Serialize</span>(rubrica, opzioniJson);
File.<span class="fn">WriteAllText</span>(<span class="str">"rubrica.json"</span>, json);
Console.<span class="fn">WriteLine</span>(<span class="str">"✓ Rubrica salvata."</span>);

List&lt;Contatto&gt;? caricata = JsonSerializer.<span class="fn">Deserialize</span>&lt;List&lt;Contatto&gt;&gt;(
    File.<span class="fn">ReadAllText</span>(<span class="str">"rubrica.json"</span>));

Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- Rubrica ---"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> c <span class="kw">in</span> caricata!)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  {c.Nome,-20} {c.Telefono,-15} {c.Email}"</span>);

<span class="cm">// --- 2. RubricaManager ---</span>
<span class="kw">class</span> <span class="ty">RubricaManager</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _file = <span class="str">"rubrica.json"</span>;
    <span class="kw">private</span> <span class="kw">readonly</span> JsonSerializerOptions _opt = <span class="kw">new</span>() {
        WriteIndented = <span class="kw">true</span>, PropertyNameCaseInsensitive = <span class="kw">true</span>
    };
    <span class="kw">private</span> List&lt;Contatto&gt; _contatti;

    <span class="kw">public</span> <span class="fn">RubricaManager</span>() { _contatti = <span class="fn">Carica</span>(); }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(Contatto c) {
        _contatti.<span class="fn">Add</span>(c);
        <span class="fn">Salva</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Aggiunto: {c.Nome}"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">string</span> nome) {
        <span class="kw">var</span> c = _contatti.<span class="fn">FirstOrDefault</span>(x => x.Nome.Equals(nome, StringComparison.OrdinalIgnoreCase));
        <span class="kw">if</span> (c == <span class="kw">null</span>) <span class="kw">return</span> <span class="kw">false</span>;
        _contatti.<span class="fn">Remove</span>(c);
        <span class="fn">Salva</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">$"✓ Rimosso: {nome}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> Contatto? <span class="fn">Cerca</span>(<span class="ty">string</span> nome) =>
        _contatti.<span class="fn">FirstOrDefault</span>(x => x.Nome.Contains(nome, StringComparison.OrdinalIgnoreCase));

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n=== Rubrica ({_contatti.Count} contatti) ==="</span>);
        <span class="kw">foreach</span> (<span class="kw">var</span> c <span class="kw">in</span> _contatti)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {c.Nome,-20} {c.Telefono,-15} {c.Email}"</span>);
    }

    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">Salva</span>() =>
        File.<span class="fn">WriteAllText</span>(_file, JsonSerializer.<span class="fn">Serialize</span>(_contatti, _opt));

    <span class="kw">private</span> List&lt;Contatto&gt; <span class="fn">Carica</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_file)) <span class="kw">return</span> <span class="kw">new</span>();
        <span class="kw">try</span> {
            <span class="kw">return</span> JsonSerializer.<span class="fn">Deserialize</span>&lt;List&lt;Contatto&gt;&gt;(File.<span class="fn">ReadAllText</span>(_file), _opt) ?? <span class="kw">new</span>();
        } <span class="kw">catch</span> { <span class="kw">return</span> <span class="kw">new</span>(); }
    }
}

<span class="cm">// --- 3. ApiResponse generica ---</span>
<span class="kw">class</span> <span class="ty">ApiResponse</span>&lt;<span class="ty">T</span>&gt; {
    [JsonPropertyName(<span class="str">"success"</span>)]
    <span class="kw">public</span> <span class="ty">bool</span> Success { <span class="kw">get</span>; <span class="kw">set</span>; }

    [JsonPropertyName(<span class="str">"message"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Message { <span class="kw">get</span>; <span class="kw">set</span>; }

    [JsonPropertyName(<span class="str">"data"</span>)]
    <span class="kw">public</span> T? Data { <span class="kw">get</span>; <span class="kw">set</span>; }

    [JsonPropertyName(<span class="str">"timestamp"</span>)]
    <span class="kw">public</span> DateTime Timestamp { <span class="kw">get</span>; <span class="kw">set</span>; } = DateTime.UtcNow;

    <span class="kw">public</span> <span class="kw">static</span> ApiResponse&lt;T&gt; <span class="fn">Ok</span>(T data, <span class="ty">string</span> msg = <span class="str">"OK"</span>) =>
        <span class="kw">new</span>() { Success = <span class="kw">true</span>,  Message = msg,   Data = data };

    <span class="kw">public</span> <span class="kw">static</span> ApiResponse&lt;T&gt; <span class="fn">Fail</span>(<span class="ty">string</span> msg) =>
        <span class="kw">new</span>() { Success = <span class="kw">false</span>, Message = msg };
}

<span class="kw">var</span> opt2 = <span class="kw">new</span> JsonSerializerOptions { WriteIndented = <span class="kw">true</span> };

<span class="cm">// Risposta con Studente:</span>
<span class="kw">var</span> risposta1 = ApiResponse&lt;Studente&gt;.<span class="fn">Ok</span>(<span class="kw">new</span>() { Nome = <span class="str">"Marco"</span>, Eta = <span class="num">20</span>, Email = <span class="str">"m@e.it"</span> });
Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(risposta1, opt2));

<span class="cm">// Risposta con lista prodotti:</span>
<span class="kw">var</span> risposta2 = ApiResponse&lt;List&lt;Prodotto&gt;&gt;.<span class="fn">Ok</span>(<span class="kw">new</span>() {
    <span class="kw">new</span>() { NomeProdotto = <span class="str">"Laptop"</span>, Prezzo = <span class="num">999m</span> },
    <span class="kw">new</span>() { NomeProdotto = <span class="str">"Mouse"</span>,  Prezzo = <span class="num">29m</span>  }
}, <span class="str">"Prodotti trovati"</span>);
Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(risposta2, opt2));

<span class="cm">// Risposta di errore:</span>
<span class="kw">var</span> errore = ApiResponse&lt;Studente&gt;.<span class="fn">Fail</span>(<span class="str">"Studente non trovato"</span>);
Console.<span class="fn">WriteLine</span>(JsonSerializer.<span class="fn">Serialize</span>(errore, opt2));</pre>

  </div>
</div>
      <!-- 14. XML -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>14. XML</h3><div class="topic-sub">XmlSerializer, XDocument, LINQ to XML, attributi, namespace</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'è XML?</h4>
    <p>XML (eXtensible Markup Language) è un formato di testo strutturato basato su tag, simile all'HTML. Era lo standard dominante per lo scambio dati prima di JSON. Lo trovi ancora oggi in file di configurazione (.csproj, web.config), feed RSS, documenti Office e molte API legacy. In C# hai due approcci principali: <strong>XmlSerializer</strong> per mappare classi su XML automaticamente, e <strong>XDocument</strong> (LINQ to XML) per costruire e interrogare XML in modo flessibile.</p>
    <table>
      <tr><th>Approccio</th><th>Quando usarlo</th><th>Pro</th><th>Contro</th></tr>
      <tr><td>XmlSerializer</td><td>Mappare classi C# su XML</td><td>Semplice, automatico</td><td>Richiede costruttore vuoto, meno flessibile</td></tr>
      <tr><td>XDocument (LINQ to XML)</td><td>Costruire/interrogare XML</td><td>Flessibile, query LINQ</td><td>Più verboso</td></tr>
      <tr><td>XmlReader/XmlWriter</td><td>File XML enormi</td><td>Bassa memoria</td><td>Molto verboso</td></tr>
    </table>

    <h4>XmlSerializer — Classe verso XML</h4>
    <pre><span class="kw">using</span> System.Xml.Serialization;
<span class="kw">using</span> System.IO;

<span class="cm">// La classe deve avere costruttore senza parametri (anche implicito):</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Prodotto</span> {
    <span class="kw">public</span> <span class="ty">string</span>  Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo   { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">int</span>     Quantita { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">bool</span>    Attivo   { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">true</span>;
}

Prodotto p = <span class="kw">new</span>() { Nome = <span class="str">"Laptop"</span>, Prezzo = <span class="num">999.99m</span>, Quantita = <span class="num">5</span> };

<span class="cm">// Oggetto → XML (su file):</span>
XmlSerializer ser = <span class="kw">new</span> <span class="ty">XmlSerializer</span>(<span class="kw">typeof</span>(Prodotto));
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"prodotto.xml"</span>))
    ser.<span class="fn">Serialize</span>(sw, p);

<span class="cm">// Risultato in prodotto.xml:</span>
<span class="cm">// &lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="cm">// &lt;Prodotto&gt;</span>
<span class="cm">//   &lt;Nome&gt;Laptop&lt;/Nome&gt;</span>
<span class="cm">//   &lt;Prezzo&gt;999.99&lt;/Prezzo&gt;</span>
<span class="cm">//   &lt;Quantita&gt;5&lt;/Quantita&gt;</span>
<span class="cm">//   &lt;Attivo&gt;true&lt;/Attivo&gt;</span>
<span class="cm">// &lt;/Prodotto&gt;</span>

<span class="cm">// XML → Oggetto:</span>
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"prodotto.xml"</span>)) {
    Prodotto? letto = (Prodotto?)ser.<span class="fn">Deserialize</span>(sr);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{letto?.Nome} — {letto?.Prezzo:C}"</span>);
}

<span class="cm">// Serializzare in una stringa invece che su file:</span>
<span class="kw">using</span> (<span class="ty">StringWriter</span> sw = <span class="kw">new</span> <span class="ty">StringWriter</span>()) {
    ser.<span class="fn">Serialize</span>(sw, p);
    <span class="ty">string</span> xmlStringa = sw.<span class="fn">ToString</span>();
    Console.<span class="fn">WriteLine</span>(xmlStringa);
}

<span class="cm">// Deserializzare da stringa:</span>
<span class="ty">string</span> xmlInput = <span class="str">"&lt;Prodotto&gt;&lt;Nome&gt;Mouse&lt;/Nome&gt;&lt;Prezzo&gt;29&lt;/Prezzo&gt;&lt;Quantita&gt;10&lt;/Quantita&gt;&lt;Attivo&gt;true&lt;/Attivo&gt;&lt;/Prodotto&gt;"</span>;
<span class="kw">using</span> (<span class="ty">StringReader</span> sr = <span class="kw">new</span> <span class="ty">StringReader</span>(xmlInput)) {
    Prodotto? daStringa = (Prodotto?)ser.<span class="fn">Deserialize</span>(sr);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{daStringa?.Nome} — Q.ta: {daStringa?.Quantita}"</span>);
}</pre>

    <h4>Attributi XML — Controllo della Struttura</h4>
    <pre><span class="kw">using</span> System.Xml.Serialization;

<span class="cm">// Attributi per personalizzare l'output XML:</span>
[XmlRoot(<span class="str">"catalogo"</span>)]  <span class="cm">// rinomina il tag radice</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Catalogo</span> {
    [XmlAttribute(<span class="str">"versione"</span>)]   <span class="cm">// diventa attributo XML, non elemento figlio</span>
    <span class="kw">public</span> <span class="ty">string</span> Versione { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="str">"1.0"</span>;

    [XmlElement(<span class="str">"prodotto"</span>)]     <span class="cm">// rinomina il tag elemento</span>
    <span class="kw">public</span> List&lt;ArticoloXml&gt; Prodotti { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();

    [XmlIgnore]                   <span class="cm">// escludi dal XML</span>
    <span class="kw">public</span> <span class="ty">int</span> NumeroProdotti => Prodotti.Count;
}

<span class="kw">public</span> <span class="kw">class</span> <span class="ty">ArticoloXml</span> {
    [XmlAttribute(<span class="str">"id"</span>)]
    <span class="kw">public</span> <span class="ty">int</span> Id { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlElement(<span class="str">"nome"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlElement(<span class="str">"prezzo"</span>)]
    <span class="kw">public</span> <span class="ty">decimal</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlIgnore]
    <span class="kw">public</span> <span class="ty">string</span> Note { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// non incluso nell'XML</span>
}

Catalogo cat = <span class="kw">new</span>() {
    Versione = <span class="str">"2.0"</span>,
    Prodotti = <span class="kw">new</span>() {
        <span class="kw">new</span>() { Id = <span class="num">1</span>, Nome = <span class="str">"Laptop"</span>,   Prezzo = <span class="num">999m</span>  },
        <span class="kw">new</span>() { Id = <span class="num">2</span>, Nome = <span class="str">"Mouse"</span>,    Prezzo = <span class="num">29m</span>   },
        <span class="kw">new</span>() { Id = <span class="num">3</span>, Nome = <span class="str">"Tastiera"</span>, Prezzo = <span class="num">59m</span>   }
    }
};

XmlSerializer serCat = <span class="kw">new</span> <span class="ty">XmlSerializer</span>(<span class="kw">typeof</span>(Catalogo));
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"catalogo.xml"</span>))
    serCat.<span class="fn">Serialize</span>(sw, cat);

<span class="cm">// Risultato:</span>
<span class="cm">// &lt;catalogo versione="2.0"&gt;</span>
<span class="cm">//   &lt;prodotto id="1"&gt;</span>
<span class="cm">//     &lt;nome&gt;Laptop&lt;/nome&gt;</span>
<span class="cm">//     &lt;prezzo&gt;999&lt;/prezzo&gt;</span>
<span class="cm">//   &lt;/prodotto&gt;</span>
<span class="cm">//   ...ecc</span>
<span class="cm">// &lt;/catalogo&gt;</span></pre>
    <div class="note">XmlSerializer richiede che la classe abbia un costruttore pubblico senza parametri. Se hai solo un costruttore con parametri, la serializzazione fallisce a runtime con un errore non sempre chiaro.</div>

    <h4>XDocument — LINQ to XML</h4>
    <pre><span class="kw">using</span> System.Xml.Linq;

<span class="cm">// Costruire XML da zero con XDocument:</span>
XDocument doc = <span class="kw">new</span> <span class="ty">XDocument</span>(
    <span class="kw">new</span> <span class="ty">XDeclaration</span>(<span class="str">"1.0"</span>, <span class="str">"utf-8"</span>, <span class="kw">null</span>),
    <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"catalogo"</span>,
        <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"versione"</span>, <span class="str">"1.0"</span>),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prodotto"</span>,
            <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"id"</span>, <span class="num">1</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>,   <span class="str">"Laptop"</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">999.99</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"attivo"</span>, <span class="kw">true</span>)
        ),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prodotto"</span>,
            <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"id"</span>, <span class="num">2</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>,   <span class="str">"Mouse"</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">29.99</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"attivo"</span>, <span class="kw">true</span>)
        )
    )
);

<span class="cm">// Salva su file:</span>
doc.<span class="fn">Save</span>(<span class="str">"catalogo_xdoc.xml"</span>);

<span class="cm">// Stampa come stringa:</span>
Console.<span class="fn">WriteLine</span>(doc);

<span class="cm">// Carica da file:</span>
XDocument caricato = XDocument.<span class="fn">Load</span>(<span class="str">"catalogo_xdoc.xml"</span>);

<span class="cm">// Carica da stringa:</span>
XDocument daStringa = XDocument.<span class="fn">Parse</span>(<span class="str">"&lt;root&gt;&lt;item&gt;test&lt;/item&gt;&lt;/root&gt;"</span>);</pre>

    <h4>LINQ to XML — Interrogare e Modificare</h4>
    <pre><span class="kw">using</span> System.Xml.Linq;

XDocument doc = XDocument.<span class="fn">Load</span>(<span class="str">"catalogo_xdoc.xml"</span>);

<span class="cm">// Leggi tutti i prodotti:</span>
<span class="kw">var</span> prodotti = doc.<span class="fn">Descendants</span>(<span class="str">"prodotto"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> prod <span class="kw">in</span> prodotti) {
    <span class="ty">int</span>     id     = (<span class="ty">int</span>)prod.<span class="fn">Attribute</span>(<span class="str">"id"</span>)!;
    <span class="ty">string</span>  nome   = (<span class="ty">string</span>)prod.<span class="fn">Element</span>(<span class="str">"nome"</span>)!;
    <span class="ty">decimal</span> prezzo = (<span class="ty">decimal</span>)prod.<span class="fn">Element</span>(<span class="str">"prezzo"</span>)!;
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  [{id}] {nome,-15} {prezzo:C}"</span>);
}

<span class="cm">// Filtra con LINQ — prodotti sopra 50 euro:</span>
<span class="kw">var</span> cari = doc.<span class="fn">Descendants</span>(<span class="str">"prodotto"</span>)
              .<span class="fn">Where</span>(p => (<span class="ty">decimal</span>)p.<span class="fn">Element</span>(<span class="str">"prezzo"</span>)! > <span class="num">50</span>)
              .<span class="fn">Select</span>(p => (<span class="ty">string</span>)p.<span class="fn">Element</span>(<span class="str">"nome"</span>)!);

Console.<span class="fn">WriteLine</span>(<span class="str">"Prodotti sopra 50 euro:"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> nome <span class="kw">in</span> cari) Console.<span class="fn">WriteLine</span>(<span class="str">$"  {nome}"</span>);

<span class="cm">// Aggiungi un elemento:</span>
doc.<span class="fn">Root</span>!.<span class="fn">Add</span>(
    <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prodotto"</span>,
        <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"id"</span>, <span class="num">3</span>),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>,   <span class="str">"Tastiera"</span>),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">59.99</span>),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"attivo"</span>, <span class="kw">true</span>)
    )
);

<span class="cm">// Modifica un elemento esistente:</span>
XElement? laptop = doc.<span class="fn">Descendants</span>(<span class="str">"prodotto"</span>)
                     .<span class="fn">FirstOrDefault</span>(p => (<span class="ty">string</span>)p.<span class="fn">Element</span>(<span class="str">"nome"</span>)! == <span class="str">"Laptop"</span>);
<span class="kw">if</span> (laptop != <span class="kw">null</span>) {
    laptop.<span class="fn">Element</span>(<span class="str">"prezzo"</span>)!.Value = <span class="str">"899.99"</span>;  <span class="cm">// aggiorna il prezzo</span>
    laptop.<span class="fn">Add</span>(<span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"sconto"</span>, <span class="str">"10%"</span>));    <span class="cm">// aggiunge nuovo figlio</span>
}

<span class="cm">// Rimuovi un elemento:</span>
XElement? daRimuovere = doc.<span class="fn">Descendants</span>(<span class="str">"prodotto"</span>)
                           .<span class="fn">FirstOrDefault</span>(p => (<span class="ty">int</span>)p.<span class="fn">Attribute</span>(<span class="str">"id"</span>)! == <span class="num">2</span>);
daRimuovere?.<span class="fn">Remove</span>();

doc.<span class="fn">Save</span>(<span class="str">"catalogo_modificato.xml"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">"Catalogo aggiornato salvato."</span>);</pre>

    <h4>Esempio Completo — Rubrica XML</h4>
    <pre><span class="kw">using</span> System.Xml.Serialization;
<span class="kw">using</span> System.Xml.Linq;

[XmlRoot(<span class="str">"rubrica"</span>)]
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Rubrica</span> {
    [XmlElement(<span class="str">"contatto"</span>)]
    <span class="kw">public</span> List&lt;ContattoXml&gt; Contatti { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
}

<span class="kw">public</span> <span class="kw">class</span> <span class="ty">ContattoXml</span> {
    [XmlAttribute(<span class="str">"id"</span>)]
    <span class="kw">public</span> <span class="ty">int</span>    Id       { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlElement(<span class="str">"nome"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlElement(<span class="str">"telefono"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Telefono { <span class="kw">get</span>; <span class="kw">set</span>; }

    [XmlElement(<span class="str">"email"</span>)]
    <span class="kw">public</span> <span class="ty">string</span> Email    { <span class="kw">get</span>; <span class="kw">set</span>; }
}

<span class="kw">class</span> <span class="ty">GestoreRubricaXml</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span>        _file = <span class="str">"rubrica.xml"</span>;
    <span class="kw">private</span> <span class="kw">readonly</span> XmlSerializer  _ser  = <span class="kw">new</span> <span class="ty">XmlSerializer</span>(<span class="kw">typeof</span>(Rubrica));
    <span class="kw">private</span> Rubrica _rubrica;

    <span class="kw">public</span> <span class="fn">GestoreRubricaXml</span>() { _rubrica = <span class="fn">Carica</span>(); }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(ContattoXml c) {
        c.Id = _rubrica.Contatti.Count > <span class="num">0</span>
               ? _rubrica.Contatti.<span class="fn">Max</span>(x => x.Id) + <span class="num">1</span>
               : <span class="num">1</span>;
        _rubrica.Contatti.<span class="fn">Add</span>(c);
        <span class="fn">Salva</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Contatto aggiunto: {c.Nome} (id={c.Id})"</span>);
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">int</span> id) {
        <span class="kw">var</span> c = _rubrica.Contatti.<span class="fn">FirstOrDefault</span>(x => x.Id == id);
        <span class="kw">if</span> (c == <span class="kw">null</span>) <span class="kw">return</span> <span class="kw">false</span>;
        _rubrica.Contatti.<span class="fn">Remove</span>(c);
        <span class="fn">Salva</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Rimosso: {c.Nome}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> ContattoXml? <span class="fn">Cerca</span>(<span class="ty">string</span> nome) =>
        _rubrica.Contatti.<span class="fn">FirstOrDefault</span>(c =>
            c.Nome.<span class="fn">Contains</span>(nome, StringComparison.OrdinalIgnoreCase));

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n--- Rubrica ({_rubrica.Contatti.Count} contatti) ---"</span>);
        <span class="kw">foreach</span> (<span class="kw">var</span> c <span class="kw">in</span> _rubrica.Contatti)
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  [{c.Id}] {c.Nome,-20} {c.Telefono,-15} {c.Email}"</span>);
    }

    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">Salva</span>() {
        <span class="kw">using</span> <span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(_file);
        _ser.<span class="fn">Serialize</span>(sw, _rubrica);
    }

    <span class="kw">private</span> Rubrica <span class="fn">Carica</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_file)) <span class="kw">return</span> <span class="kw">new</span> <span class="ty">Rubrica</span>();
        <span class="kw">try</span> {
            <span class="kw">using</span> <span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(_file);
            <span class="kw">return</span> (<span class="ty">Rubrica</span>?)_ser.<span class="fn">Deserialize</span>(sr) ?? <span class="kw">new</span> <span class="ty">Rubrica</span>();
        } <span class="kw">catch</span> { <span class="kw">return</span> <span class="kw">new</span> <span class="ty">Rubrica</span>(); }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> rubrica = <span class="kw">new</span> <span class="ty">GestoreRubricaXml</span>();
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Mario Rossi"</span>,  Telefono = <span class="str">"333-1111"</span>, Email = <span class="str">"mario@email.it"</span>  });
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Anna Bianchi"</span>, Telefono = <span class="str">"347-2222"</span>, Email = <span class="str">"anna@email.it"</span>   });
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Luca Verdi"</span>,   Telefono = <span class="str">"320-3333"</span>, Email = <span class="str">"luca@email.it"</span>   });
rubrica.<span class="fn">Stampa</span>();

ContattoXml? trovato = rubrica.<span class="fn">Cerca</span>(<span class="str">"anna"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nCercato: {trovato?.Nome ?? "non trovato"}"</span>);

rubrica.<span class="fn">Rimuovi</span>(<span class="num">2</span>);
rubrica.<span class="fn">Stampa</span>();</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Classe senza costruttore senza parametri:</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">SbagliataA</span> {
    <span class="kw">public</span> <span class="fn">SbagliataA</span>(<span class="ty">string</span> nome) { }  <span class="cm">// solo costruttore con parametri</span>
}
<span class="cm">// new XmlSerializer(typeof(SbagliataA));  -> InvalidOperationException a runtime!</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">CorreataA</span> {
    <span class="kw">public</span> <span class="fn">CorreataA</span>() { }              <span class="cm">// costruttore vuoto obbligatorio</span>
    <span class="kw">public</span> <span class="fn">CorreataA</span>(<span class="ty">string</span> nome) { }
}

<span class="cm">// 2. Proprietà private non serializzate:</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">SbagliataB</span> {
    <span class="kw">private</span> <span class="ty">string</span> _nome;              <span class="cm">// non serializzato — deve essere public</span>
    <span class="kw">public</span>  <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }  <span class="cm">// serializzato</span>
}

<span class="cm">// 3. Null su Element() o Attribute() con LINQ to XML:</span>
XDocument d = XDocument.<span class="fn">Parse</span>(<span class="str">"&lt;root&gt;&lt;item&gt;test&lt;/item&gt;&lt;/root&gt;"</span>);
<span class="ty">string</span> valore = (<span class="ty">string</span>)d.<span class="fn">Root</span>.<span class="fn">Element</span>(<span class="str">"nonEsiste"</span>)!;  <span class="cm">// NullReferenceException!</span>
<span class="ty">string</span>? sicuro = (<span class="ty">string</span>?)d.<span class="fn">Root</span>?.<span class="fn">Element</span>(<span class="str">"nonEsiste"</span>);  <span class="cm">// null — sicuro</span>

<span class="cm">// 4. Dimenticare di chiudere lo StreamWriter dopo la serializzazione:</span>
StreamWriter sw2 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.xml"</span>);
ser.<span class="fn">Serialize</span>(sw2, p);
<span class="cm">// sw2.Close();  dimenticato! file potrebbe essere incompleto</span>
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw3 = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"file.xml"</span>))  <span class="cm">// sempre con using</span>
    ser.<span class="fn">Serialize</span>(sw3, p);

<span class="cm">// 5. XmlSerializer è case-sensitive sui nomi dei tag:</span>
<span class="ty">string</span> xmlSbagliato = <span class="str">"&lt;Prodotto&gt;&lt;nome&gt;Laptop&lt;/nome&gt;&lt;/Prodotto&gt;"</span>;
<span class="cm">// "nome" minuscolo non corrisponde alla proprietà "Nome" — rimane null dopo Deserialize</span>
<span class="cm">// Usa [XmlElement("nome")] se il tuo XML usa lettere minuscole</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea una classe "Libro" con Titolo, Autore, Anno, Prezzo.</span>
<span class="cm">//    Serializza una lista di 3 libri in "libreria.xml".</span>
<span class="cm">//    Ricaricala e stampa ogni libro a console.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Usa XDocument per costruire un XML di un menu ristorante:</span>
<span class="cm">//    Menu con sezioni (Antipasti, Primi, Secondi, Dolci),</span>
<span class="cm">//    ogni sezione con piatti (nome, descrizione, prezzo).</span>
<span class="cm">//    Interrogalo con LINQ: trova tutti i piatti sotto 10 euro.</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "GestoreInventario" che usa XmlSerializer per:</span>
<span class="cm">//    Aggiungere, rimuovere, aggiornare prodotti in "inventario.xml".</span>
<span class="cm">//    Calcola il valore totale dell'inventario (prezzo x quantita).</span>
<span class="cm">//    Genera un report XML con i prodotti sotto soglia (quantita &lt; 5).</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Libreria ---</span>
[XmlRoot(<span class="str">"libreria"</span>)]
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Libreria</span> {
    [XmlElement(<span class="str">"libro"</span>)]
    <span class="kw">public</span> List&lt;Libro&gt; Libri { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
}

<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Libro</span> {
    [XmlElement(<span class="str">"titolo"</span>)]  <span class="kw">public</span> <span class="ty">string</span>  Titolo { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlElement(<span class="str">"autore"</span>)]  <span class="kw">public</span> <span class="ty">string</span>  Autore { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlAttribute(<span class="str">"anno"</span>)]  <span class="kw">public</span> <span class="ty">int</span>     Anno   { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlElement(<span class="str">"prezzo"</span>)]  <span class="kw">public</span> <span class="ty">decimal</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }
}

Libreria lib = <span class="kw">new</span>() {
    Libri = <span class="kw">new</span>() {
        <span class="kw">new</span>() { Titolo = <span class="str">"Il Nome della Rosa"</span>, Autore = <span class="str">"Umberto Eco"</span>,     Anno = <span class="num">1980</span>, Prezzo = <span class="num">14.90m</span> },
        <span class="kw">new</span>() { Titolo = <span class="str">"Se questo è un uomo"</span>, Autore = <span class="str">"Primo Levi"</span>,      Anno = <span class="num">1947</span>, Prezzo = <span class="num">12.00m</span> },
        <span class="kw">new</span>() { Titolo = <span class="str">"I Promessi Sposi"</span>,   Autore = <span class="str">"Alessandro Manzoni"</span>, Anno = <span class="num">1842</span>, Prezzo = <span class="num">9.90m</span>  }
    }
};

XmlSerializer serLib = <span class="kw">new</span> <span class="ty">XmlSerializer</span>(<span class="kw">typeof</span>(Libreria));
<span class="kw">using</span> (<span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"libreria.xml"</span>))
    serLib.<span class="fn">Serialize</span>(sw, lib);

Libreria? caricata;
<span class="kw">using</span> (<span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"libreria.xml"</span>))
    caricata = (<span class="ty">Libreria</span>?)serLib.<span class="fn">Deserialize</span>(sr);

<span class="kw">foreach</span> (<span class="kw">var</span> l <span class="kw">in</span> caricata!.Libri)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  [{l.Anno}] {l.Titolo} — {l.Autore} ({l.Prezzo:C})"</span>);

<span class="cm">// --- 2. Menu ristorante con XDocument ---</span>
XDocument menu = <span class="kw">new</span> <span class="ty">XDocument</span>(
    <span class="kw">new</span> <span class="ty">XDeclaration</span>(<span class="str">"1.0"</span>, <span class="str">"utf-8"</span>, <span class="kw">null</span>),
    <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"menu"</span>,
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"sezione"</span>, <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"nome"</span>, <span class="str">"Antipasti"</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"piatto"</span>,
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>, <span class="str">"Bruschetta"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"descrizione"</span>, <span class="str">"Pane tostato con pomodoro"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">6.50</span>)),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"piatto"</span>,
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>, <span class="str">"Tagliere di salumi"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"descrizione"</span>, <span class="str">"Selezione di salumi misti"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">12.00</span>))
        ),
        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"sezione"</span>, <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"nome"</span>, <span class="str">"Primi"</span>),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"piatto"</span>,
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>, <span class="str">"Spaghetti al pomodoro"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"descrizione"</span>, <span class="str">"Pasta con salsa di pomodoro fresco"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">9.00</span>)),
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"piatto"</span>,
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>, <span class="str">"Risotto ai funghi"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"descrizione"</span>, <span class="str">"Riso con porcini freschi"</span>),
                <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>, <span class="num">13.00</span>))
        )
    )
);

menu.<span class="fn">Save</span>(<span class="str">"menu.xml"</span>);

<span class="cm">// LINQ — trova piatti sotto 10 euro:</span>
<span class="kw">var</span> economici = menu.<span class="fn">Descendants</span>(<span class="str">"piatto"</span>)
                    .<span class="fn">Where</span>(p => (<span class="ty">double</span>)p.<span class="fn">Element</span>(<span class="str">"prezzo"</span>)! < <span class="num">10</span>)
                    .<span class="fn">Select</span>(p => <span class="str">$"{(string)p.Element("nome")!} — {(double)p.Element("prezzo")!:C}"</span>);

Console.<span class="fn">WriteLine</span>(<span class="str">"Piatti sotto 10 euro:"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> piatto <span class="kw">in</span> economici)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  {piatto}"</span>);

<span class="cm">// --- 3. GestoreInventario ---</span>
[XmlRoot(<span class="str">"inventario"</span>)]
<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Inventario</span> {
    [XmlElement(<span class="str">"articolo"</span>)]
    <span class="kw">public</span> List&lt;Articolo&gt; Articoli { <span class="kw">get</span>; <span class="kw">set</span>; } = <span class="kw">new</span>();
}

<span class="kw">public</span> <span class="kw">class</span> <span class="ty">Articolo</span> {
    [XmlAttribute(<span class="str">"id"</span>)]     <span class="kw">public</span> <span class="ty">int</span>     Id       { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlElement(<span class="str">"nome"</span>)]     <span class="kw">public</span> <span class="ty">string</span>  Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlElement(<span class="str">"prezzo"</span>)]   <span class="kw">public</span> <span class="ty">decimal</span> Prezzo   { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlElement(<span class="str">"quantita"</span>)] <span class="kw">public</span> <span class="ty">int</span>     Quantita { <span class="kw">get</span>; <span class="kw">set</span>; }
    [XmlIgnore]               <span class="kw">public</span> <span class="ty">decimal</span> Valore   => Prezzo * Quantita;
}

<span class="kw">class</span> <span class="ty">GestoreInventario</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span>       _file = <span class="str">"inventario.xml"</span>;
    <span class="kw">private</span> <span class="kw">readonly</span> XmlSerializer _ser  = <span class="kw">new</span> <span class="ty">XmlSerializer</span>(<span class="kw">typeof</span>(Inventario));
    <span class="kw">private</span> Inventario _inv;

    <span class="kw">public</span> <span class="fn">GestoreInventario</span>() { _inv = <span class="fn">Carica</span>(); }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiungi</span>(Articolo a) {
        a.Id = _inv.Articoli.Count > <span class="num">0</span> ? _inv.Articoli.<span class="fn">Max</span>(x => x.Id) + <span class="num">1</span> : <span class="num">1</span>;
        _inv.Articoli.<span class="fn">Add</span>(a);
        <span class="fn">Salva</span>();
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiorna</span>(<span class="ty">int</span> id, <span class="ty">int</span> nuovaQuantita) {
        <span class="kw">var</span> a = _inv.Articoli.<span class="fn">FirstOrDefault</span>(x => x.Id == id);
        <span class="kw">if</span> (a == <span class="kw">null</span>) <span class="kw">return</span>;
        a.Quantita = nuovaQuantita;
        <span class="fn">Salva</span>();
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Aggiornato: {a.Nome} → Q.ta {nuovaQuantita}"</span>);
    }

    <span class="kw">public</span> <span class="ty">decimal</span> <span class="fn">ValoreTotale</span>() => _inv.Articoli.<span class="fn">Sum</span>(a => a.Valore);

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">ReportSottoSoglia</span>(<span class="ty">int</span> soglia = <span class="num">5</span>) {
        <span class="kw">var</span> critici = _inv.Articoli.<span class="fn">Where</span>(a => a.Quantita < soglia).<span class="fn">ToList</span>();
        XDocument report = <span class="kw">new</span> <span class="ty">XDocument</span>(
            <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"report"</span>,
                <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"data"</span>, DateTime.Now.<span class="fn">ToString</span>(<span class="str">"yyyy-MM-dd"</span>)),
                <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"soglia"</span>, soglia),
                critici.<span class="fn">Select</span>(a =>
                    <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"articolo_critico"</span>,
                        <span class="kw">new</span> <span class="ty">XAttribute</span>(<span class="str">"id"</span>, a.Id),
                        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"nome"</span>,     a.Nome),
                        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"quantita"</span>, a.Quantita),
                        <span class="kw">new</span> <span class="ty">XElement</span>(<span class="str">"prezzo"</span>,   a.Prezzo)))
            )
        );
        report.<span class="fn">Save</span>(<span class="str">"report_scorte.xml"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Report generato: {critici.Count} articoli sotto soglia."</span>);
    }

    <span class="kw">private</span> <span class="ty">void</span> <span class="fn">Salva</span>() {
        <span class="kw">using</span> <span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(_file);
        _ser.<span class="fn">Serialize</span>(sw, _inv);
    }

    <span class="kw">private</span> Inventario <span class="fn">Carica</span>() {
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(_file)) <span class="kw">return</span> <span class="kw">new</span> <span class="ty">Inventario</span>();
        <span class="kw">try</span> {
            <span class="kw">using</span> <span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(_file);
            <span class="kw">return</span> (<span class="ty">Inventario</span>?)_ser.<span class="fn">Deserialize</span>(sr) ?? <span class="kw">new</span> <span class="ty">Inventario</span>();
        } <span class="kw">catch</span> { <span class="kw">return</span> <span class="kw">new</span> <span class="ty">Inventario</span>(); }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> inv = <span class="kw">new</span> <span class="ty">GestoreInventario</span>();
inv.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Laptop"</span>,   Prezzo = <span class="num">999m</span>, Quantita = <span class="num">3</span>  });
inv.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Mouse"</span>,    Prezzo = <span class="num">29m</span>,  Quantita = <span class="num">20</span> });
inv.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Tastiera"</span>, Prezzo = <span class="num">59m</span>,  Quantita = <span class="num">2</span>  });
Console.<span class="fn">WriteLine</span>(<span class="str">$"Valore totale inventario: {inv.ValoreTotale():C}"</span>);
inv.<span class="fn">Aggiorna</span>(<span class="num">2</span>, <span class="num">8</span>);
inv.<span class="fn">ReportSottoSoglia</span>(<span class="num">5</span>);</pre>

  </div>
</div>
      <!-- 15. Eccezioni I/O -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>15. Eccezioni I/O</h3><div class="topic-sub">FileNotFoundException, IOException, UnauthorizedAccessException, pattern robusti</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Perche le Operazioni I/O Falliscono?</h4>
    <p>Lavorare con file e cartelle e intrinsecamente rischioso: il file potrebbe non esistere, l'utente potrebbe non avere i permessi, il disco potrebbe essere pieno, o un altro processo potrebbe tenere il file bloccato. A differenza di un errore di logica nel codice, questi problemi dipendono dall'ambiente esterno e non puoi prevederli a compile time. Per questo ogni operazione I/O seria deve essere protetta con try/catch.</p>
    <table>
      <tr><th>Eccezione</th><th>Causa tipica</th><th>Come evitarla</th></tr>
      <tr><td>FileNotFoundException</td><td>File non esiste al percorso indicato</td><td>File.Exists() prima di leggere</td></tr>
      <tr><td>DirectoryNotFoundException</td><td>Cartella del percorso inesistente</td><td>Directory.Exists() o CreateDirectory()</td></tr>
      <tr><td>IOException</td><td>File bloccato da un altro processo</td><td>Catch + retry o messaggio utente</td></tr>
      <tr><td>UnauthorizedAccessException</td><td>Permessi insufficienti sul file</td><td>Catch + messaggio, non si puo aggirare</td></tr>
      <tr><td>PathTooLongException</td><td>Percorso supera 260 caratteri (Windows)</td><td>Path.Combine, evita percorsi lunghi</td></tr>
      <tr><td>DriveNotFoundException</td><td>Disco o unita non disponibile</td><td>Catch + verifica unita prima</td></tr>
      <tr><td>EndOfStreamException</td><td>Lettura oltre la fine dello stream</td><td>Controlla EndOfStream prima di leggere</td></tr>
    </table>

    <h4>Gerarchia delle Eccezioni I/O</h4>
    <pre><span class="cm">// La gerarchia e importante — catch piu specifico sempre PRIMA:</span>

<span class="cm">//  Exception</span>
<span class="cm">//  └── SystemException</span>
<span class="cm">//      ├── IOException                     ← genitore di tutti gli I/O</span>
<span class="cm">//      │   ├── FileNotFoundException       ← file mancante</span>
<span class="cm">//      │   ├── DirectoryNotFoundException  ← cartella mancante</span>
<span class="cm">//      │   ├── EndOfStreamException        ← lettura oltre la fine</span>
<span class="cm">//      │   └── DriveNotFoundException      ← disco non trovato</span>
<span class="cm">//      └── UnauthorizedAccessException     ← permessi (NON figlia di IOException!)</span>

<span class="cm">// SBAGLIATO — IOException cattura tutto prima di FileNotFoundException:</span>
<span class="kw">try</span> {
    File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);
}
<span class="kw">catch</span> (IOException ex) {                  <span class="cm">// cattura anche FileNotFoundException!</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Errore generico"</span>);
}
<span class="kw">catch</span> (FileNotFoundException ex) {        <span class="cm">// non raggiunto mai — codice morto!</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"File mancante"</span>);
}

<span class="cm">// CORRETTO — dal piu specifico al piu generico:</span>
<span class="kw">try</span> {
    File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);
}
<span class="kw">catch</span> (FileNotFoundException ex) {        <span class="cm">// prima il piu specifico</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"File mancante"</span>);
}
<span class="kw">catch</span> (UnauthorizedAccessException ex) {  <span class="cm">// NON figlia di IOException</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">"Permessi negati"</span>);
}
<span class="kw">catch</span> (IOException ex) {                  <span class="cm">// tutti gli altri errori I/O</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
}</pre>
    <div class="warn">Cattura sempre le eccezioni dal piu specifico al piu generico. IOException e il genitore di FileNotFoundException e DirectoryNotFoundException — se la metti prima, le figlie non vengono mai raggiunte.</div>

    <h4>Pattern Base — Lettura e Scrittura Sicura</h4>
    <pre><span class="cm">// Lettura sicura con tutti i casi gestiti:</span>
<span class="kw">static</span> <span class="ty">string</span>? <span class="fn">LeggiFileSicuro</span>(<span class="ty">string</span> percorso) {
    <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(percorso))
        <span class="kw">throw new</span> ArgumentException(<span class="str">"Percorso non valido."</span>);

    <span class="kw">try</span> {
        <span class="kw">return</span> File.<span class="fn">ReadAllText</span>(percorso);
    }
    <span class="kw">catch</span> (FileNotFoundException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"File non trovato: {percorso}"</span>);
        <span class="kw">return</span> <span class="kw">null</span>;
    }
    <span class="kw">catch</span> (DirectoryNotFoundException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Cartella non trovata: {Path.GetDirectoryName(percorso)}"</span>);
        <span class="kw">return</span> <span class="kw">null</span>;
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Accesso negato: {percorso}"</span>);
        <span class="kw">return</span> <span class="kw">null</span>;
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
        <span class="kw">return</span> <span class="kw">null</span>;
    }
}

<span class="cm">// Scrittura sicura con creazione automatica della cartella:</span>
<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">ScriviFileSicuro</span>(<span class="ty">string</span> percorso, <span class="ty">string</span> contenuto) {
    <span class="kw">try</span> {
        <span class="ty">string</span>? cartella = Path.<span class="fn">GetDirectoryName</span>(percorso);
        <span class="kw">if</span> (!<span class="ty">string</span>.IsNullOrEmpty(cartella))
            Directory.<span class="fn">CreateDirectory</span>(cartella);  <span class="cm">// crea se non esiste</span>

        File.<span class="fn">WriteAllText</span>(percorso, contenuto);
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Permessi insufficienti per scrivere: {percorso}"</span>);
        <span class="kw">return</span> <span class="kw">false</span>;
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore scrittura: {ex.Message}"</span>);
        <span class="kw">return</span> <span class="kw">false</span>;
    }
}

<span class="cm">// Utilizzo:</span>
<span class="ty">string</span>? testo = <span class="fn">LeggiFileSicuro</span>(<span class="str">"config.txt"</span>);
<span class="kw">if</span> (testo != <span class="kw">null</span>)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Letto: {testo.Length} caratteri"</span>);

<span class="kw">bool</span> ok = <span class="fn">ScriviFileSicuro</span>(<span class="str">"Output\\risultati.txt"</span>, <span class="str">"Dati salvati."</span>);
Console.<span class="fn">WriteLine</span>(ok ? <span class="str">"Salvato."</span> : <span class="str">"Salvataggio fallito."</span>);</pre>

    <h4>using + try/catch — Il Pattern Completo</h4>
    <pre><span class="cm">// using garantisce la chiusura dello stream, try/catch gestisce gli errori.</span>
<span class="cm">// Vanno usati INSIEME — uno non sostituisce l'altro:</span>

<span class="kw">static</span> <span class="ty">void</span> <span class="fn">ProcessaFile</span>(<span class="ty">string</span> input, <span class="ty">string</span> output) {
    StreamReader? sr = <span class="kw">null</span>;
    StreamWriter? sw = <span class="kw">null</span>;

    <span class="kw">try</span> {
        sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(input);
        sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(output);

        <span class="ty">string</span>? riga;
        <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
            sw.<span class="fn">WriteLine</span>(riga.<span class="fn">ToUpper</span>());

        Console.<span class="fn">WriteLine</span>(<span class="str">"Elaborazione completata."</span>);
    }
    <span class="kw">catch</span> (FileNotFoundException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"File sorgente non trovato: {ex.FileName}"</span>);
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Permessi insufficienti."</span>);
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
    }
    <span class="kw">finally</span> {
        sr?.<span class="fn">Dispose</span>();   <span class="cm">// chiude sempre, anche se c'e un'eccezione</span>
        sw?.<span class="fn">Dispose</span>();
    }
}

<span class="cm">// Versione moderna con using dichiarativo (C# 8+) — piu pulita:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">ProcessaFileModerno</span>(<span class="ty">string</span> input, <span class="ty">string</span> output) {
    <span class="kw">try</span> {
        <span class="kw">using</span> <span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(input);
        <span class="kw">using</span> <span class="ty">StreamWriter</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(output);

        <span class="ty">string</span>? riga;
        <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
            sw.<span class="fn">WriteLine</span>(riga.<span class="fn">ToUpper</span>());

        Console.<span class="fn">WriteLine</span>(<span class="str">"Elaborazione completata."</span>);
    }
    <span class="kw">catch</span> (FileNotFoundException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"File sorgente non trovato: {ex.FileName}"</span>);
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
    }
}  <span class="cm">// sr e sw vengono disposti automaticamente all'uscita dal blocco try</span></pre>
    <div class="note">Il costruttore di StreamReader lancia gia FileNotFoundException se il file non esiste — non serve controllare File.Exists() prima. Usare Exists() e poi aprire il file crea una race condition: il file potrebbe sparire tra il controllo e l'apertura.</div>

    <h4>Proprieta Utili delle Eccezioni I/O</h4>
    <pre><span class="cm">// Le eccezioni I/O contengono informazioni preziose per il debug:</span>
<span class="kw">try</span> {
    File.<span class="fn">ReadAllText</span>(<span class="str">"cartella\\file.txt"</span>);
}
<span class="kw">catch</span> (FileNotFoundException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Messaggio:  {ex.Message}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"File:       {ex.FileName}"</span>);     <span class="cm">// percorso del file mancante</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Stack:      {ex.StackTrace}"</span>);   <span class="cm">// dove e avvenuto l'errore</span>
}
<span class="kw">catch</span> (IOException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Messaggio:  {ex.Message}"</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"HResult:    {ex.HResult}"</span>);     <span class="cm">// codice errore di sistema</span>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Inner:      {ex.InnerException?.Message}"</span>);
}

<span class="cm">// IOException con HResult — codici comuni su Windows:</span>
<span class="cm">// -2147024864 (0x80070020) → file bloccato da un altro processo</span>
<span class="cm">// -2147024784 (0x80070050) → file esiste gia (in alcune operazioni)</span>
<span class="cm">// -2147024895 (0x80070001) → funzione non supportata</span>

<span class="cm">// Controllo del codice di errore:</span>
<span class="kw">try</span> {
    File.<span class="fn">Copy</span>(<span class="str">"origine.txt"</span>, <span class="str">"destinazione.txt"</span>);
}
<span class="kw">catch</span> (IOException ex) <span class="kw">when</span> (ex.HResult == -<span class="num">2147024864</span>) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"File bloccato da un altro processo. Riprova tra qualche secondo."</span>);
}
<span class="kw">catch</span> (IOException ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O generico: {ex.Message}"</span>);
}</pre>

    <h4>Retry — Ritentare in Caso di File Bloccato</h4>
    <pre><span class="cm">// Un file bloccato da un altro processo e un errore temporaneo — si puo ritentare:</span>
<span class="kw">static</span> <span class="ty">string</span>? <span class="fn">LeggiConRetry</span>(<span class="ty">string</span> percorso, <span class="ty">int</span> maxTentativi = <span class="num">3</span>, <span class="ty">int</span> attesaMs = <span class="num">500</span>) {
    <span class="kw">for</span> (<span class="ty">int</span> tentativo = <span class="num">1</span>; tentativo <= maxTentativi; tentativo++) {
        <span class="kw">try</span> {
            <span class="kw">return</span> File.<span class="fn">ReadAllText</span>(percorso);
        }
        <span class="kw">catch</span> (FileNotFoundException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"File non trovato — nessun retry."</span>);
            <span class="kw">return</span> <span class="kw">null</span>;  <span class="cm">// inutile ritentare — il file non c'e</span>
        }
        <span class="kw">catch</span> (IOException ex) <span class="kw">when</span> (tentativo < maxTentativi) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Tentativo {tentativo}/{maxTentativi} fallito: {ex.Message}"</span>);
            Thread.<span class="fn">Sleep</span>(attesaMs * tentativo);  <span class="cm">// attesa crescente</span>
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Tutti i tentativi esauriti: {ex.Message}"</span>);
            <span class="kw">return</span> <span class="kw">null</span>;
        }
    }
    <span class="kw">return</span> <span class="kw">null</span>;
}

<span class="ty">string</span>? contenuto = <span class="fn">LeggiConRetry</span>(<span class="str">"log_attivo.txt"</span>, maxTentativi: <span class="num">3</span>, attesaMs: <span class="num">200</span>);
Console.<span class="fn">WriteLine</span>(contenuto ?? <span class="str">"Lettura fallita."</span>);</pre>

    <h4>Esempio Completo — Gestore File Robusto</h4>
    <pre><span class="kw">class</span> <span class="ty">GestoreFileRobusto</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _cartellaBase;

    <span class="kw">public</span> <span class="fn">GestoreFileRobusto</span>(<span class="ty">string</span> cartella) {
        _cartellaBase = cartella;
        <span class="kw">try</span> {
            Directory.<span class="fn">CreateDirectory</span>(cartella);
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            <span class="kw">throw new</span> InvalidOperationException(
                <span class="str">$"Impossibile creare la cartella base: {cartella}"</span>);
        }
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Scrivi</span>(<span class="ty">string</span> nomeFile, <span class="ty">string</span> contenuto) {
        <span class="ty">string</span> percorso = Path.<span class="fn">Combine</span>(_cartellaBase, nomeFile);
        <span class="kw">try</span> {
            File.<span class="fn">WriteAllText</span>(percorso, contenuto);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Scritto: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">true</span>;
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Permessi negati per: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore scrittura {nomeFile}: {ex.Message}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">string</span>? <span class="fn">Leggi</span>(<span class="ty">string</span> nomeFile) {
        <span class="ty">string</span> percorso = Path.<span class="fn">Combine</span>(_cartellaBase, nomeFile);
        <span class="kw">try</span> {
            <span class="kw">return</span> File.<span class="fn">ReadAllText</span>(percorso);
        }
        <span class="kw">catch</span> (FileNotFoundException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"File non trovato: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">null</span>;
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Permessi negati per: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">null</span>;
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore lettura {nomeFile}: {ex.Message}"</span>);
            <span class="kw">return</span> <span class="kw">null</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Elimina</span>(<span class="ty">string</span> nomeFile) {
        <span class="ty">string</span> percorso = Path.<span class="fn">Combine</span>(_cartellaBase, nomeFile);
        <span class="kw">try</span> {
            <span class="kw">if</span> (!File.<span class="fn">Exists</span>(percorso)) {
                Console.<span class="fn">WriteLine</span>(<span class="str">$"File gia assente: {nomeFile}"</span>);
                <span class="kw">return</span> <span class="kw">false</span>;
            }
            File.<span class="fn">Delete</span>(percorso);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Eliminato: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">true</span>;
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Permessi negati per eliminare: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"File bloccato, impossibile eliminare: {ex.Message}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Copia</span>(<span class="ty">string</span> nomeFile, <span class="ty">string</span> destinazione) {
        <span class="ty">string</span> percorsoOrigine = Path.<span class="fn">Combine</span>(_cartellaBase, nomeFile);
        <span class="kw">try</span> {
            <span class="ty">string</span>? cartellaDestinazione = Path.<span class="fn">GetDirectoryName</span>(destinazione);
            <span class="kw">if</span> (!<span class="ty">string</span>.IsNullOrEmpty(cartellaDestinazione))
                Directory.<span class="fn">CreateDirectory</span>(cartellaDestinazione);

            File.<span class="fn">Copy</span>(percorsoOrigine, destinazione, overwrite: <span class="kw">true</span>);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Copiato: {nomeFile} → {destinazione}"</span>);
            <span class="kw">return</span> <span class="kw">true</span>;
        }
        <span class="kw">catch</span> (FileNotFoundException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"File sorgente non trovato: {nomeFile}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Permessi insufficienti per la copia."</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore copia: {ex.Message}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">ElencaFile</span>() {
        <span class="kw">try</span> {
            <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(_cartellaBase);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"\n--- File in {_cartellaBase} ({files.Length}) ---"</span>);
            <span class="kw">foreach</span> (<span class="ty">string</span> f <span class="kw">in</span> files) {
                FileInfo fi = <span class="kw">new</span> <span class="ty">FileInfo</span>(f);
                Console.<span class="fn">WriteLine</span>(<span class="str">$"  {fi.Name,-30} {fi.Length,8} byte"</span>);
            }
        }
        <span class="kw">catch</span> (DirectoryNotFoundException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Cartella non trovata."</span>);
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Permessi insufficienti per elencare i file."</span>);
        }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> gestore = <span class="kw">new</span> <span class="ty">GestoreFileRobusto</span>(<span class="str">"Archivio"</span>);
gestore.<span class="fn">Scrivi</span>(<span class="str">"note.txt"</span>,   <span class="str">"Contenuto delle note"</span>);
gestore.<span class="fn">Scrivi</span>(<span class="str">"config.txt"</span>, <span class="str">"chiave=valore"</span>);
gestore.<span class="fn">ElencaFile</span>();

<span class="ty">string</span>? letto = gestore.<span class="fn">Leggi</span>(<span class="str">"note.txt"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Letto: {letto}"</span>);

gestore.<span class="fn">Copia</span>(<span class="str">"note.txt"</span>, <span class="str">"Backup\\note_backup.txt"</span>);
gestore.<span class="fn">Elimina</span>(<span class="str">"config.txt"</span>);
gestore.<span class="fn">ElencaFile</span>();</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Ingoiare silenziosamente l'eccezione — il peggior pattern possibile:</span>
<span class="kw">try</span> {
    File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);
}
<span class="kw">catch</span> (Exception) { }  <span class="cm">// silenzio totale — l'errore sparisce!</span>
<span class="cm">// Almeno logga qualcosa — anche solo Console.WriteLine(ex.Message)</span>

<span class="cm">// 2. Catch troppo generico — perdi informazioni:</span>
<span class="kw">catch</span> (Exception ex) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Qualcosa e andato storto"</span>);  <span class="cm">// inutile per debug</span>
}
<span class="cm">// Cattura il tipo specifico e usa ex.Message, ex.FileName ecc.</span>

<span class="cm">// 3. Re-throw sbagliato — perde lo stack trace originale:</span>
<span class="kw">catch</span> (IOException ex) {
    <span class="kw">throw</span> ex;   <span class="cm">// sbagliato! azzera lo stack trace</span>
    <span class="kw">throw</span>;      <span class="cm">// corretto — rilancia con stack trace intatto</span>
}

<span class="cm">// 4. Dimenticare di disporre lo stream anche in caso di errore:</span>
StreamReader sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>);
<span class="kw">try</span> {
    Console.<span class="fn">WriteLine</span>(sr.<span class="fn">ReadToEnd</span>());
}
<span class="kw">catch</span> (IOException ex) {
    Console.<span class="fn">WriteLine</span>(ex.Message);
    <span class="cm">// sr non viene chiuso se c'e un'eccezione!</span>
}
<span class="cm">// Corretto con using:</span>
<span class="kw">try</span> {
    <span class="kw">using</span> <span class="ty">StreamReader</span> sr2 = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>);
    Console.<span class="fn">WriteLine</span>(sr2.<span class="fn">ReadToEnd</span>());
}
<span class="kw">catch</span> (IOException ex) {
    Console.<span class="fn">WriteLine</span>(ex.Message);  <span class="cm">// sr2 viene chiuso anche qui</span>
}

<span class="cm">// 5. Race condition — Exists() non garantisce nulla:</span>
<span class="kw">if</span> (File.<span class="fn">Exists</span>(<span class="str">"file.txt"</span>)) {
    <span class="cm">// Un altro processo potrebbe eliminare il file qui!</span>
    <span class="ty">string</span> s = File.<span class="fn">ReadAllText</span>(<span class="str">"file.txt"</span>);  <span class="cm">// potrebbe ancora lanciare FileNotFoundException</span>
}
<span class="cm">// Apri direttamente con try/catch — e la soluzione corretta</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Scrivi un metodo LeggiRighe(string percorso) che:</span>
<span class="cm">//    Legge tutte le righe di un file con StreamReader.</span>
<span class="cm">//    Gestisce FileNotFoundException, UnauthorizedAccessException e IOException.</span>
<span class="cm">//    Restituisce un array vuoto in caso di errore.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Scrivi un metodo CopiaCartellaIntera(string origine, string destinazione) che:</span>
<span class="cm">//    Copia tutti i file .txt da una cartella a un'altra.</span>
<span class="cm">//    Gestisce ogni errore per singolo file senza interrompere la copia degli altri.</span>
<span class="cm">//    Stampa un riepilogo finale: N copiati, M falliti.</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Implementa un metodo ScriviConBackup(string percorso, string contenuto) che:</span>
<span class="cm">//    Prima di sovrascrivere, crea un backup del file esistente (.bak).</span>
<span class="cm">//    Se la scrittura fallisce, ripristina automaticamente il backup.</span>
<span class="cm">//    Gestisce tutti i casi di errore possibili con messaggi chiari.</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. LeggiRighe ---</span>
<span class="kw">static</span> <span class="ty">string</span>[] <span class="fn">LeggiRighe</span>(<span class="ty">string</span> percorso) {
    <span class="kw">try</span> {
        <span class="kw">using</span> <span class="ty">StreamReader</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(percorso);
        List&lt;<span class="ty">string</span>&gt; righe = <span class="kw">new</span>();
        <span class="ty">string</span>? riga;
        <span class="kw">while</span> ((riga = sr.<span class="fn">ReadLine</span>()) != <span class="kw">null</span>)
            righe.<span class="fn">Add</span>(riga);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Lette {righe.Count} righe da {Path.GetFileName(percorso)}"</span>);
        <span class="kw">return</span> righe.<span class="fn">ToArray</span>();
    }
    <span class="kw">catch</span> (FileNotFoundException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"File non trovato: {percorso}"</span>);
        <span class="kw">return</span> Array.Empty&lt;<span class="ty">string</span>&gt;();
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Accesso negato: {percorso}"</span>);
        <span class="kw">return</span> Array.Empty&lt;<span class="ty">string</span>&gt;();
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Errore I/O: {ex.Message}"</span>);
        <span class="kw">return</span> Array.Empty&lt;<span class="ty">string</span>&gt;();
    }
}

<span class="cm">// --- 2. CopiaCartellaIntera ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">CopiaCartellaIntera</span>(<span class="ty">string</span> origine, <span class="ty">string</span> destinazione) {
    <span class="ty">int</span> copiati = <span class="num">0</span>;
    <span class="ty">int</span> falliti  = <span class="num">0</span>;

    <span class="ty">string</span>[] files;
    <span class="kw">try</span> {
        files = Directory.<span class="fn">GetFiles</span>(origine, <span class="str">"*.txt"</span>);
    }
    <span class="kw">catch</span> (DirectoryNotFoundException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Cartella di origine non trovata: {origine}"</span>);
        <span class="kw">return</span>;
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Accesso negato alla cartella: {origine}"</span>);
        <span class="kw">return</span>;
    }

    <span class="kw">try</span> { Directory.<span class="fn">CreateDirectory</span>(destinazione); }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Impossibile creare destinazione: {ex.Message}"</span>);
        <span class="kw">return</span>;
    }

    <span class="kw">foreach</span> (<span class="ty">string</span> file <span class="kw">in</span> files) {
        <span class="ty">string</span> nomeFile = Path.<span class="fn">GetFileName</span>(file);
        <span class="ty">string</span> dest     = Path.<span class="fn">Combine</span>(destinazione, nomeFile);
        <span class="kw">try</span> {
            File.<span class="fn">Copy</span>(file, dest, overwrite: <span class="kw">true</span>);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  Copiato: {nomeFile}"</span>);
            copiati++;
        }
        <span class="kw">catch</span> (UnauthorizedAccessException) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  Permessi negati: {nomeFile}"</span>);
            falliti++;
        }
        <span class="kw">catch</span> (IOException ex) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  Errore copia {nomeFile}: {ex.Message}"</span>);
            falliti++;
        }
    }

    Console.<span class="fn">WriteLine</span>(<span class="str">$"\nRiepilogo: {copiati} copiati, {falliti} falliti."</span>);
}

<span class="cm">// --- 3. ScriviConBackup ---</span>
<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">ScriviConBackup</span>(<span class="ty">string</span> percorso, <span class="ty">string</span> contenuto) {
    <span class="ty">string</span> backup = percorso + <span class="str">".bak"</span>;
    <span class="ty">bool</span>   backupCreato = <span class="kw">false</span>;

    <span class="kw">try</span> {
        <span class="cm">// Crea backup se il file esiste gia:</span>
        <span class="kw">if</span> (File.<span class="fn">Exists</span>(percorso)) {
            File.<span class="fn">Copy</span>(percorso, backup, overwrite: <span class="kw">true</span>);
            backupCreato = <span class="kw">true</span>;
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Backup creato: {backup}"</span>);
        }

        <span class="cm">// Scrivi il nuovo contenuto:</span>
        File.<span class="fn">WriteAllText</span>(percorso, contenuto);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Scritto correttamente: {percorso}"</span>);

        <span class="cm">// Tutto ok — elimina il backup:</span>
        <span class="kw">if</span> (backupCreato && File.<span class="fn">Exists</span>(backup))
            File.<span class="fn">Delete</span>(backup);

        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">catch</span> (UnauthorizedAccessException) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Permessi insufficienti per la scrittura."</span>);
        <span class="fn">RipristinaBackup</span>(percorso, backup, backupCreato);
        <span class="kw">return</span> <span class="kw">false</span>;
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Scrittura fallita: {ex.Message}"</span>);
        <span class="fn">RipristinaBackup</span>(percorso, backup, backupCreato);
        <span class="kw">return</span> <span class="kw">false</span>;
    }
}

<span class="kw">static</span> <span class="ty">void</span> <span class="fn">RipristinaBackup</span>(<span class="ty">string</span> percorso, <span class="ty">string</span> backup, <span class="ty">bool</span> backupCreato) {
    <span class="kw">if</span> (!backupCreato || !File.<span class="fn">Exists</span>(backup)) <span class="kw">return</span>;
    <span class="kw">try</span> {
        File.<span class="fn">Copy</span>(backup, percorso, overwrite: <span class="kw">true</span>);
        File.<span class="fn">Delete</span>(backup);
        Console.<span class="fn">WriteLine</span>(<span class="str">"Backup ripristinato con successo."</span>);
    }
    <span class="kw">catch</span> (IOException ex) {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Ripristino fallito: {ex.Message}. Backup disponibile in: {backup}"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
<span class="fn">ScriviConBackup</span>(<span class="str">"dati.txt"</span>, <span class="str">"Prima versione"</span>);
<span class="fn">ScriviConBackup</span>(<span class="str">"dati.txt"</span>, <span class="str">"Seconda versione — sovrascrive con backup"</span>);</pre>

  </div>
</div>
      <!-- 16. Dictionary<K,V> -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>16. Dictionary&lt;K,V&gt;</h3><div class="topic-sub">chiave-valore, TryGetValue, ContainsKey, iterazione, dizionari annidati</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'e un Dictionary?</h4>
    <p>Un <strong>Dictionary&lt;K,V&gt;</strong> e una collezione che associa ogni <strong>chiave</strong> (Key) a un <strong>valore</strong> (Value). Le chiavi sono uniche — non puoi avere due voci con la stessa chiave. L'accesso e estremamente veloce: trovare un valore per chiave e O(1), indipendentemente da quante voci ci sono.</p>
    <table>
      <tr><th>Caratteristica</th><th>List&lt;T&gt;</th><th>Dictionary&lt;K,V&gt;</th><th>Array</th></tr>
      <tr><td>Accesso</td><td>Per indice [0]</td><td>Per chiave ["nome"]</td><td>Per indice [0]</td></tr>
      <tr><td>Duplicati</td><td>Ammessi</td><td>Chiavi uniche</td><td>Ammessi</td></tr>
      <tr><td>Ricerca</td><td>O(n) — scorre tutto</td><td>O(1) — hash table</td><td>O(n)</td></tr>
      <tr><td>Ordine</td><td>Mantenuto</td><td>Non garantito</td><td>Mantenuto</td></tr>
      <tr><td>Usalo per</td><td>Sequenze ordinate</td><td>Lookup rapido per chiave</td><td>Dati fissi</td></tr>
    </table>

    <h4>Creazione e Inizializzazione</h4>
    <pre><span class="kw">using</span> System.Collections.Generic;

<span class="cm">// Creazione vuota:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; eta = <span class="kw">new</span> Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt;();

<span class="cm">// Con collection initializer — sintassi classica:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; voti = <span class="kw">new</span>() {
    { <span class="str">"Marco"</span>,  <span class="num">8</span> },
    { <span class="str">"Giulia"</span>, <span class="num">9</span> },
    { <span class="str">"Luca"</span>,   <span class="num">7</span> }
};

<span class="cm">// Sintassi alternativa con = (C# 6+):</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; capitali = <span class="kw">new</span>() {
    [<span class="str">"Italia"</span>]   = <span class="str">"Roma"</span>,
    [<span class="str">"Francia"</span>]  = <span class="str">"Parigi"</span>,
    [<span class="str">"Germania"</span>] = <span class="str">"Berlino"</span>,
    [<span class="str">"Spagna"</span>]   = <span class="str">"Madrid"</span>
};

<span class="cm">// Chiave di qualsiasi tipo:</span>
Dictionary&lt;<span class="ty">int</span>, <span class="ty">string</span>&gt; codici = <span class="kw">new</span>() {
    [<span class="num">39</span>]  = <span class="str">"Italia"</span>,
    [<span class="num">33</span>]  = <span class="str">"Francia"</span>,
    [<span class="num">44</span>]  = <span class="str">"Regno Unito"</span>
};

<span class="cm">// Valore come classe:</span>
Dictionary&lt;<span class="ty">string</span>, Studente&gt; studenti = <span class="kw">new</span>() {
    [<span class="str">"S001"</span>] = <span class="kw">new</span>() { Nome = <span class="str">"Marco"</span>,  Eta = <span class="num">20</span> },
    [<span class="str">"S002"</span>] = <span class="kw">new</span>() { Nome = <span class="str">"Giulia"</span>, Eta = <span class="num">22</span> }
};

Console.<span class="fn">WriteLine</span>(capitali[<span class="str">"Italia"</span>]);   <span class="cm">// Roma</span>
Console.<span class="fn">WriteLine</span>(codici[<span class="num">39</span>]);           <span class="cm">// Italia</span>
Console.<span class="fn">WriteLine</span>(studenti[<span class="str">"S001"</span>].Nome); <span class="cm">// Marco</span></pre>

    <h4>Aggiunta, Modifica e Rimozione</h4>
    <pre><span class="cm">// Aggiungere voci:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; magazzino = <span class="kw">new</span>();

magazzino[<span class="str">"Laptop"</span>]   = <span class="num">10</span>;  <span class="cm">// aggiunge se non esiste, sovrascrive se esiste</span>
magazzino[<span class="str">"Mouse"</span>]    = <span class="num">50</span>;
magazzino[<span class="str">"Tastiera"</span>] = <span class="num">30</span>;

<span class="cm">// Add() — aggiunge MA lancia eccezione se la chiave esiste gia:</span>
magazzino.<span class="fn">Add</span>(<span class="str">"Monitor"</span>, <span class="num">8</span>);
<span class="cm">// magazzino.Add("Laptop", 5);  → ArgumentException! chiave duplicata</span>

<span class="cm">// TryAdd() — aggiunge solo se la chiave NON esiste (nessuna eccezione):</span>
<span class="kw">bool</span> aggiunto = magazzino.<span class="fn">TryAdd</span>(<span class="str">"Laptop"</span>, <span class="num">99</span>);  <span class="cm">// false — gia esiste, non modifica</span>
<span class="kw">bool</span> aggiunto2 = magazzino.<span class="fn">TryAdd</span>(<span class="str">"Webcam"</span>, <span class="num">15</span>); <span class="cm">// true — aggiunta</span>

<span class="cm">// Modificare:</span>
magazzino[<span class="str">"Mouse"</span>] = <span class="num">45</span>;  <span class="cm">// sovrascrive il valore esistente</span>
magazzino[<span class="str">"Mouse"</span>]++;    <span class="cm">// incrementa</span>
magazzino[<span class="str">"Mouse"</span>] += <span class="num">5</span>; <span class="cm">// aggiunge 5</span>

<span class="cm">// Rimuovere:</span>
magazzino.<span class="fn">Remove</span>(<span class="str">"Monitor"</span>);                          <span class="cm">// rimuove</span>
<span class="kw">bool</span> rimosso = magazzino.<span class="fn">Remove</span>(<span class="str">"Laptop"</span>);           <span class="cm">// restituisce true se trovato</span>
<span class="kw">bool</span> rimosso2 = magazzino.<span class="fn">Remove</span>(<span class="str">"NonEsiste"</span>);       <span class="cm">// false — nessuna eccezione</span>

<span class="cm">// Remove con out — ottieni il valore prima di rimuovere:</span>
<span class="kw">if</span> (magazzino.<span class="fn">Remove</span>(<span class="str">"Mouse"</span>, <span class="kw">out int</span> quantitaRimossa))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Rimosso Mouse — aveva {quantitaRimossa} unita"</span>);

<span class="cm">// Svuotare:</span>
magazzino.<span class="fn">Clear</span>();
Console.<span class="fn">WriteLine</span>(magazzino.Count);  <span class="cm">// 0</span></pre>

    <h4>Lettura Sicura — ContainsKey e TryGetValue</h4>
    <pre><span class="cm">// Accesso diretto — PERICOLOSO se la chiave non esiste:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; prezzi = <span class="kw">new</span>() {
    [<span class="str">"Laptop"</span>] = <span class="num">999</span>,
    [<span class="str">"Mouse"</span>]  = <span class="num">29</span>
};

<span class="cm">// int p = prezzi["Tablet"];  → KeyNotFoundException!</span>

<span class="cm">// Metodo 1 — ContainsKey (due accessi al dizionario):</span>
<span class="kw">if</span> (prezzi.<span class="fn">ContainsKey</span>(<span class="str">"Tablet"</span>)) {
    Console.<span class="fn">WriteLine</span>(prezzi[<span class="str">"Tablet"</span>]);
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Tablet non in catalogo"</span>);
}

<span class="cm">// Metodo 2 — TryGetValue (un solo accesso, piu efficiente):</span>
<span class="kw">if</span> (prezzi.<span class="fn">TryGetValue</span>(<span class="str">"Laptop"</span>, <span class="kw">out int</span> prezzo)) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Laptop costa {prezzo:C}"</span>);  <span class="cm">// prezzo = 999</span>
} <span class="kw">else</span> {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Prodotto non trovato"</span>);
}

<span class="cm">// Metodo 3 — GetValueOrDefault (valore di fallback):</span>
<span class="ty">int</span> prezzoTablet = prezzi.<span class="fn">GetValueOrDefault</span>(<span class="str">"Tablet"</span>, <span class="num">0</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Prezzo Tablet: {prezzoTablet}"</span>);  <span class="cm">// 0 — non trovato</span>

<span class="ty">int</span> prezzoMouse = prezzi.<span class="fn">GetValueOrDefault</span>(<span class="str">"Mouse"</span>);   <span class="cm">// 29</span>

<span class="cm">// Pattern moderno — null-coalescing con GetValueOrDefault:</span>
<span class="ty">string</span> descr = prezzi.<span class="fn">GetValueOrDefault</span>(<span class="str">"Webcam"</span>, -<span class="num">1</span>) == -<span class="num">1</span>
               ? <span class="str">"non disponibile"</span>
               : <span class="str">$"{prezzi["Webcam"]:C}"</span>;</pre>
    <div class="tip">Preferisci sempre TryGetValue rispetto a ContainsKey + accesso diretto. E un'unica operazione invece di due, quindi piu efficiente e non crea race condition in contesti multi-thread.</div>

    <h4>Iterazione</h4>
    <pre><span class="cm">// Itera sulle coppie chiave-valore:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; voti = <span class="kw">new</span>() {
    [<span class="str">"Marco"</span>]  = <span class="num">8</span>,
    [<span class="str">"Giulia"</span>] = <span class="num">9</span>,
    [<span class="str">"Luca"</span>]   = <span class="num">7</span>,
    [<span class="str">"Anna"</span>]   = <span class="num">10</span>
};

<span class="cm">// foreach su KeyValuePair:</span>
<span class="kw">foreach</span> (KeyValuePair&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; coppia <span class="kw">in</span> voti)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{coppia.Key}: {coppia.Value}"</span>);

<span class="cm">// Con var — piu conciso:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> coppia <span class="kw">in</span> voti)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{coppia.Key}: {coppia.Value}"</span>);

<span class="cm">// Destructuring (C# 7+) — ancora piu leggibile:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> (nome, voto) <span class="kw">in</span> voti)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{nome,-10} → {voto}/10"</span>);

<span class="cm">// Solo le chiavi:</span>
<span class="kw">foreach</span> (<span class="ty">string</span> chiave <span class="kw">in</span> voti.Keys)
    Console.<span class="fn">WriteLine</span>(chiave);

<span class="cm">// Solo i valori:</span>
<span class="kw">foreach</span> (<span class="ty">int</span> voto <span class="kw">in</span> voti.Values)
    Console.<span class="fn">Write</span>(<span class="str">$"{voto} "</span>);

<span class="cm">// Ordinato per chiave:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> (nome, voto) <span class="kw">in</span> voti.<span class="fn">OrderBy</span>(kvp => kvp.Key))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{nome}: {voto}"</span>);

<span class="cm">// Ordinato per valore decrescente:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> (nome, voto) <span class="kw">in</span> voti.<span class="fn">OrderByDescending</span>(kvp => kvp.Value))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{nome}: {voto}"</span>);</pre>

    <h4>Dizionari Annidati e Valori Complessi</h4>
    <pre><span class="cm">// Dizionario con lista come valore:</span>
Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">string</span>&gt;&gt; corsi = <span class="kw">new</span>() {
    [<span class="str">"Matematica"</span>] = <span class="kw">new</span>() { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span> },
    [<span class="str">"Informatica"</span>] = <span class="kw">new</span>() { <span class="str">"Luca"</span>, <span class="str">"Anna"</span>, <span class="str">"Marco"</span> }
};

<span class="cm">// Aggiungere uno studente a un corso esistente:</span>
corsi[<span class="str">"Matematica"</span>].<span class="fn">Add</span>(<span class="str">"Luca"</span>);

<span class="cm">// Pattern sicuro — crea la lista se non esiste:</span>
<span class="ty">string</span> corso = <span class="str">"Fisica"</span>;
<span class="kw">if</span> (!corsi.<span class="fn">ContainsKey</span>(corso))
    corsi[corso] = <span class="kw">new</span> List&lt;<span class="ty">string</span>&gt;();
corsi[corso].<span class="fn">Add</span>(<span class="str">"Sara"</span>);

<span class="cm">// Con GetValueOrDefault + ??:</span>
(corsi.<span class="fn">GetValueOrDefault</span>(<span class="str">"Storia"</span>) ?? (corsi[<span class="str">"Storia"</span>] = <span class="kw">new</span>())).<span class="fn">Add</span>(<span class="str">"Pietro"</span>);

<span class="cm">// Dizionario annidato (dizionario di dizionari):</span>
Dictionary&lt;<span class="ty">string</span>, Dictionary&lt;<span class="ty">string</span>, <span class="ty">decimal</span>&gt;&gt; catalogo = <span class="kw">new</span>() {
    [<span class="str">"Elettronica"</span>] = <span class="kw">new</span>() {
        [<span class="str">"Laptop"</span>]   = <span class="num">999m</span>,
        [<span class="str">"Mouse"</span>]    = <span class="num">29m</span>
    },
    [<span class="str">"Abbigliamento"</span>] = <span class="kw">new</span>() {
        [<span class="str">"Maglia"</span>]   = <span class="num">25m</span>,
        [<span class="str">"Pantaloni"</span>] = <span class="num">49m</span>
    }
};

<span class="cm">// Accesso annidato:</span>
Console.<span class="fn">WriteLine</span>(catalogo[<span class="str">"Elettronica"</span>][<span class="str">"Laptop"</span>]);  <span class="cm">// 999</span>

<span class="cm">// Itera il catalogo:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> (categoria, prodotti) <span class="kw">in</span> catalogo) {
    Console.<span class="fn">WriteLine</span>(<span class="str">$"\n{categoria}:"</span>);
    <span class="kw">foreach</span> (<span class="kw">var</span> (nome, prezzo) <span class="kw">in</span> prodotti)
        Console.<span class="fn">WriteLine</span>(<span class="str">$"  {nome,-15} {prezzo:C}"</span>);
}</pre>

    <h4>Esempio Completo — Rubrica Contatti</h4>
    <pre><span class="kw">class</span> <span class="ty">Contatto</span> {
    <span class="kw">public</span> <span class="ty">string</span> Nome     { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Telefono { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="ty">string</span> Email    { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public override</span> <span class="ty">string</span> <span class="fn">ToString</span>() =>
        <span class="str">$"{Nome,-20} {Telefono,-15} {Email}"</span>;
}

<span class="kw">class</span> <span class="ty">Rubrica</span> {
    <span class="cm">// Chiave = nome normalizzato, Valore = Contatto</span>
    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, Contatto&gt; _contatti = <span class="kw">new</span>();

    <span class="kw">public</span> <span class="ty">int</span> Count => _contatti.Count;

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Aggiungi</span>(Contatto c) {
        <span class="ty">string</span> chiave = c.Nome.<span class="fn">ToLower</span>().<span class="fn">Trim</span>();
        <span class="kw">if</span> (_contatti.<span class="fn">ContainsKey</span>(chiave)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Contatto gia esistente: {c.Nome}"</span>);
            <span class="kw">return</span> <span class="kw">false</span>;
        }
        _contatti[chiave] = c;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Aggiunto: {c.Nome}"</span>);
        <span class="kw">return</span> <span class="kw">true</span>;
    }

    <span class="kw">public</span> Contatto? <span class="fn">Cerca</span>(<span class="ty">string</span> nome) {
        _contatti.<span class="fn">TryGetValue</span>(nome.<span class="fn">ToLower</span>().<span class="fn">Trim</span>(), <span class="kw">out</span> Contatto? c);
        <span class="kw">return</span> c;
    }

    <span class="kw">public</span> <span class="ty">bool</span> <span class="fn">Rimuovi</span>(<span class="ty">string</span> nome) {
        <span class="ty">string</span> chiave = nome.<span class="fn">ToLower</span>().<span class="fn">Trim</span>();
        <span class="kw">if</span> (_contatti.<span class="fn">Remove</span>(chiave, <span class="kw">out</span> Contatto? rimosso)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Rimosso: {rimosso.Nome}"</span>);
            <span class="kw">return</span> <span class="kw">true</span>;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Contatto non trovato: {nome}"</span>);
        <span class="kw">return</span> <span class="kw">false</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Aggiorna</span>(<span class="ty">string</span> nome, <span class="ty">string</span>? nuovoTelefono = <span class="kw">null</span>, <span class="ty">string</span>? nuovaEmail = <span class="kw">null</span>) {
        <span class="kw">if</span> (!_contatti.<span class="fn">TryGetValue</span>(nome.<span class="fn">ToLower</span>(), <span class="kw">out</span> Contatto? c)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Contatto non trovato: {nome}"</span>);
            <span class="kw">return</span>;
        }
        <span class="kw">if</span> (nuovoTelefono != <span class="kw">null</span>) c.Telefono = nuovoTelefono;
        <span class="kw">if</span> (nuovaEmail    != <span class="kw">null</span>) c.Email    = nuovaEmail;
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Aggiornato: {c.Nome}"</span>);
    }

    <span class="kw">public</span> List&lt;Contatto&gt; <span class="fn">CercaParziale</span>(<span class="ty">string</span> termine) =>
        _contatti.Values
                 .<span class="fn">Where</span>(c => c.Nome.<span class="fn">Contains</span>(termine, StringComparison.OrdinalIgnoreCase)
                          || c.Email.<span class="fn">Contains</span>(termine, StringComparison.OrdinalIgnoreCase))
                 .<span class="fn">ToList</span>();

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Stampa</span>() {
        <span class="kw">if</span> (_contatti.Count == <span class="num">0</span>) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Rubrica vuota."</span>);
            <span class="kw">return</span>;
        }
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n--- Rubrica ({_contatti.Count} contatti) ---"</span>);
        <span class="kw">foreach</span> (<span class="kw">var</span> c <span class="kw">in</span> _contatti.Values.<span class="fn">OrderBy</span>(c => c.Nome))
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {c}"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> rubrica = <span class="kw">new</span> <span class="ty">Rubrica</span>();
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Mario Rossi"</span>,  Telefono = <span class="str">"333-1111"</span>, Email = <span class="str">"mario@email.it"</span>  });
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Anna Bianchi"</span>, Telefono = <span class="str">"347-2222"</span>, Email = <span class="str">"anna@email.it"</span>   });
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Luca Verdi"</span>,   Telefono = <span class="str">"320-3333"</span>, Email = <span class="str">"luca@email.it"</span>   });
rubrica.<span class="fn">Aggiungi</span>(<span class="kw">new</span>() { Nome = <span class="str">"Mario Rossi"</span>,  Telefono = <span class="str">"000-0000"</span>, Email = <span class="str">"dup@email.it"</span>    });  <span class="cm">// duplicato</span>

rubrica.<span class="fn">Stampa</span>();

Contatto? trovato = rubrica.<span class="fn">Cerca</span>(<span class="str">"anna bianchi"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nCercato: {trovato?.Nome ?? "non trovato"}"</span>);

rubrica.<span class="fn">Aggiorna</span>(<span class="str">"luca verdi"</span>, nuovoTelefono: <span class="str">"320-9999"</span>);

List&lt;Contatto&gt; risultati = rubrica.<span class="fn">CercaParziale</span>(<span class="str">"mario"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"\nRisultati per 'mario': {risultati.Count}"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> c <span class="kw">in</span> risultati) Console.<span class="fn">WriteLine</span>(<span class="str">$"  {c}"</span>);

rubrica.<span class="fn">Rimuovi</span>(<span class="str">"Anna Bianchi"</span>);
rubrica.<span class="fn">Stampa</span>();</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Accesso diretto a chiave inesistente:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; d = <span class="kw">new</span>() { [<span class="str">"a"</span>] = <span class="num">1</span> };
<span class="ty">int</span> x = d[<span class="str">"b"</span>];  <span class="cm">// KeyNotFoundException!</span>
<span class="ty">int</span> y = d.<span class="fn">GetValueOrDefault</span>(<span class="str">"b"</span>, <span class="num">0</span>);  <span class="cm">// sicuro — restituisce 0</span>

<span class="cm">// 2. Modificare il dizionario durante l'iterazione:</span>
<span class="kw">foreach</span> (<span class="kw">var</span> kvp <span class="kw">in</span> d) {
    d.<span class="fn">Remove</span>(kvp.Key);  <span class="cm">// InvalidOperationException!</span>
}
<span class="cm">// Raccogli le chiavi prima, poi rimuovi:</span>
<span class="kw">foreach</span> (<span class="ty">string</span> chiave <span class="kw">in</span> d.Keys.<span class="fn">ToList</span>()) {  <span class="cm">// ToList() crea una copia</span>
    d.<span class="fn">Remove</span>(chiave);  <span class="cm">// sicuro</span>
}

<span class="cm">// 3. Aggiungere con Add() su chiave esistente:</span>
d[<span class="str">"a"</span>] = <span class="num">1</span>;
d.<span class="fn">Add</span>(<span class="str">"a"</span>, <span class="num">2</span>);  <span class="cm">// ArgumentException!</span>
d[<span class="str">"a"</span>] = <span class="num">2</span>;    <span class="cm">// corretto — sovrascrive senza eccezione</span>
d.<span class="fn">TryAdd</span>(<span class="str">"a"</span>, <span class="num">2</span>); <span class="cm">// corretto — non fa nulla se esiste gia</span>

<span class="cm">// 4. Chiave null — non ammessa:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; d2 = <span class="kw">new</span>();
<span class="cm">// d2[null] = 1;  → ArgumentNullException!</span>
<span class="cm">// Valida sempre la chiave prima di usarla</span>

<span class="cm">// 5. Confronto case-sensitive per default:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; d3 = <span class="kw">new</span>() { [<span class="str">"Marco"</span>] = <span class="num">25</span> };
Console.<span class="fn">WriteLine</span>(d3.<span class="fn">ContainsKey</span>(<span class="str">"marco"</span>));  <span class="cm">// False! case-sensitive</span>

<span class="cm">// Usa StringComparer per case-insensitive:</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; d4 = <span class="kw">new</span>(StringComparer.OrdinalIgnoreCase) {
    [<span class="str">"Marco"</span>] = <span class="num">25</span>
};
Console.<span class="fn">WriteLine</span>(d4.<span class="fn">ContainsKey</span>(<span class="str">"marco"</span>));  <span class="cm">// True!</span>
Console.<span class="fn">WriteLine</span>(d4.<span class="fn">ContainsKey</span>(<span class="str">"MARCO"</span>));  <span class="cm">// True!</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Crea un dizionario che mappa parole italiane alle inglesi.</span>
<span class="cm">//    Chiedi all'utente una parola e stampa la traduzione.</span>
<span class="cm">//    Se la parola non esiste, stampalo chiaramente.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Dato un testo qualsiasi, conta quante volte appare ogni parola.</span>
<span class="cm">//    Usa un Dictionary&lt;string, int&gt; come contatore.</span>
<span class="cm">//    Stampa le 5 parole piu frequenti in ordine decrescente.</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "GestoreVoti" con Dictionary&lt;string, List&lt;int&gt;&gt;.</span>
<span class="cm">//    Metodi: AggiungiVoto(studente, voto), Media(studente),</span>
<span class="cm">//    MigliorStudente(), StampaClassifica().</span>
<span class="cm">//    La classifica deve essere ordinata per media decrescente.</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Dizionario traduzioni ---</span>
Dictionary&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; traduzioni = <span class="kw">new</span>(StringComparer.OrdinalIgnoreCase) {
    [<span class="str">"cane"</span>]    = <span class="str">"dog"</span>,
    [<span class="str">"gatto"</span>]   = <span class="str">"cat"</span>,
    [<span class="str">"casa"</span>]    = <span class="str">"house"</span>,
    [<span class="str">"libro"</span>]   = <span class="str">"book"</span>,
    [<span class="str">"acqua"</span>]   = <span class="str">"water"</span>,
    [<span class="str">"sole"</span>]    = <span class="str">"sun"</span>
};

Console.<span class="fn">Write</span>(<span class="str">"Inserisci una parola italiana: "</span>);
<span class="ty">string</span>? input = Console.<span class="fn">ReadLine</span>();

<span class="kw">if</span> (!<span class="ty">string</span>.IsNullOrWhiteSpace(input)) {
    <span class="kw">if</span> (traduzioni.<span class="fn">TryGetValue</span>(input, <span class="kw">out</span> <span class="ty">string</span>? traduzione))
        Console.<span class="fn">WriteLine</span>(<span class="str">$"'{input}' in inglese e '{traduzione}'"</span>);
    <span class="kw">else</span>
        Console.<span class="fn">WriteLine</span>(<span class="str">$"'{input}' non e nel dizionario."</span>);
}

<span class="cm">// --- 2. Contatore parole ---</span>
<span class="ty">string</span> testo = <span class="str">"il gatto sul tetto il gatto dorme il sole splende sul tetto"</span>;
<span class="ty">string</span>[] parole = testo.<span class="fn">Split</span>(<span class="str">' '</span>, StringSplitOptions.RemoveEmptyEntries);

Dictionary&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt; contatore = <span class="kw">new</span>(StringComparer.OrdinalIgnoreCase);

<span class="kw">foreach</span> (<span class="ty">string</span> parola <span class="kw">in</span> parole) {
    <span class="kw">if</span> (contatore.<span class="fn">ContainsKey</span>(parola))
        contatore[parola]++;
    <span class="kw">else</span>
        contatore[parola] = <span class="num">1</span>;
}

<span class="cm">// Oppure con TryGetValue:</span>
<span class="cm">// if (!contatore.TryGetValue(parola, out int n)) n = 0;</span>
<span class="cm">// contatore[parola] = n + 1;</span>

Console.<span class="fn">WriteLine</span>(<span class="str">"\nTop 5 parole piu frequenti:"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> (parola, freq) <span class="kw">in</span> contatore.<span class="fn">OrderByDescending</span>(kvp => kvp.Value).<span class="fn">Take</span>(<span class="num">5</span>))
    Console.<span class="fn">WriteLine</span>(<span class="str">$"  '{parola}' — {freq} volta/e"</span>);

<span class="cm">// --- 3. GestoreVoti ---</span>
<span class="kw">class</span> <span class="ty">GestoreVoti</span> {
    <span class="kw">private</span> Dictionary&lt;<span class="ty">string</span>, List&lt;<span class="ty">int</span>&gt;&gt; _voti = <span class="kw">new</span>(StringComparer.OrdinalIgnoreCase);

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">AggiungiVoto</span>(<span class="ty">string</span> studente, <span class="ty">int</span> voto) {
        <span class="kw">if</span> (voto < <span class="num">0</span> || voto > <span class="num">10</span>) {
            Console.<span class="fn">WriteLine</span>(<span class="str">"Voto non valido (0-10)."</span>);
            <span class="kw">return</span>;
        }
        <span class="kw">if</span> (!_voti.<span class="fn">ContainsKey</span>(studente))
            _voti[studente] = <span class="kw">new</span> List&lt;<span class="ty">int</span>&gt;();
        _voti[studente].<span class="fn">Add</span>(voto);
    }

    <span class="kw">public</span> <span class="ty">double</span> <span class="fn">Media</span>(<span class="ty">string</span> studente) {
        <span class="kw">if</span> (!_voti.<span class="fn">TryGetValue</span>(studente, <span class="kw">out</span> List&lt;<span class="ty">int</span>&gt;? lista) || lista.Count == <span class="num">0</span>)
            <span class="kw">return</span> <span class="num">0</span>;
        <span class="kw">return</span> lista.<span class="fn">Average</span>();
    }

    <span class="kw">public</span> <span class="ty">string</span>? <span class="fn">MigliorStudente</span>() =>
        _voti.Count == <span class="num">0</span> ? <span class="kw">null</span>
        : _voti.<span class="fn">MaxBy</span>(kvp => kvp.Value.<span class="fn">Average</span>()).Key;

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">StampaClassifica</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">"\n--- Classifica ---"</span>);
        <span class="ty">int</span> pos = <span class="num">1</span>;
        <span class="kw">foreach</span> (<span class="kw">var</span> (studente, voti) <span class="kw">in</span> _voti.<span class="fn">OrderByDescending</span>(kvp => kvp.Value.<span class="fn">Average</span>())) {
            <span class="ty">double</span> media = voti.<span class="fn">Average</span>();
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {pos++}. {studente,-15} Media: {media:F1} ({voti.Count} voti)"</span>);
        }
    }
}

<span class="kw">var</span> g = <span class="kw">new</span> <span class="ty">GestoreVoti</span>();
g.<span class="fn">AggiungiVoto</span>(<span class="str">"Marco"</span>,  <span class="num">8</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Marco"</span>,  <span class="num">7</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Marco"</span>,  <span class="num">9</span>);
g.<span class="fn">AggiungiVoto</span>(<span class="str">"Giulia"</span>, <span class="num">9</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Giulia"</span>, <span class="num">10</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Giulia"</span>, <span class="num">9</span>);
g.<span class="fn">AggiungiVoto</span>(<span class="str">"Luca"</span>,   <span class="num">6</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Luca"</span>,   <span class="num">7</span>); g.<span class="fn">AggiungiVoto</span>(<span class="str">"Luca"</span>,  <span class="num">5</span>);

Console.<span class="fn">WriteLine</span>(<span class="str">$"Media Marco: {g.Media("Marco"):F1}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Miglior studente: {g.MigliorStudente()}"</span>);
g.<span class="fn">StampaClassifica</span>();</pre>

  </div>
</div>
      <!-- 17. Classe Path -->
<div class="topic-card">
  <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>17. Classe Path</h3><div class="topic-sub">Combine, GetFileName, GetExtension, GetDirectoryName, percorsi cross-platform</div></div><span class="arrow">▼</span></div>
  <div class="topic-body">

    <h4>Cos'e la Classe Path?</h4>
    <p>La classe statica <strong>Path</strong> (in System.IO) fornisce metodi per manipolare percorsi di file e cartelle in modo sicuro e cross-platform. Il problema di costruire percorsi a mano e che il separatore e diverso tra sistemi operativi: <code>\</code> su Windows, <code>/</code> su Linux e Mac. Path gestisce tutto questo automaticamente, rendendo il codice portabile.</p>
    <table>
      <tr><th>Metodo</th><th>Descrizione</th><th>Esempio risultato</th></tr>
      <tr><td>Path.Combine()</td><td>Unisce segmenti di percorso</td><td>C:\Users\Marco\doc.txt</td></tr>
      <tr><td>Path.GetFileName()</td><td>Nome file con estensione</td><td>doc.txt</td></tr>
      <tr><td>Path.GetFileNameWithoutExtension()</td><td>Nome file senza estensione</td><td>doc</td></tr>
      <tr><td>Path.GetExtension()</td><td>Solo l'estensione</td><td>.txt</td></tr>
      <tr><td>Path.GetDirectoryName()</td><td>Cartella contenitore</td><td>C:\Users\Marco</td></tr>
      <tr><td>Path.GetFullPath()</td><td>Percorso assoluto completo</td><td>C:\App\note.txt</td></tr>
      <tr><td>Path.ChangeExtension()</td><td>Cambia estensione</td><td>doc.pdf</td></tr>
      <tr><td>Path.GetTempPath()</td><td>Cartella temporanea di sistema</td><td>C:\Users\Marco\AppData\Local\Temp\</td></tr>
      <tr><td>Path.GetTempFileName()</td><td>File temporaneo univoco</td><td>tmp3F2A.tmp</td></tr>
      <tr><td>Path.GetRandomFileName()</td><td>Nome casuale senza creare file</td><td>abc123de.fgh</td></tr>
    </table>

    <h4>Path.Combine — Unire Percorsi</h4>
    <pre><span class="kw">using</span> System.IO;

<span class="cm">// SBAGLIATO — concatenazione manuale, fragile e non cross-platform:</span>
<span class="ty">string</span> p1 = <span class="str">"C:\\Users"</span> + <span class="str">"\\"</span> + <span class="str">"Marco"</span> + <span class="str">"\\"</span> + <span class="str">"doc.txt"</span>;  <span class="cm">// funziona solo su Windows</span>
<span class="ty">string</span> p2 = <span class="str">"C:\\Users\\"</span> + <span class="str">"\\Marco"</span>;  <span class="cm">// doppio separatore — sbagliato!</span>

<span class="cm">// CORRETTO — Path.Combine gestisce i separatori automaticamente:</span>
<span class="ty">string</span> percorso = Path.<span class="fn">Combine</span>(<span class="str">"C:\\Users"</span>, <span class="str">"Marco"</span>, <span class="str">"Documenti"</span>, <span class="str">"doc.txt"</span>);
Console.<span class="fn">WriteLine</span>(percorso);
<span class="cm">// Windows: C:\Users\Marco\Documenti\doc.txt</span>
<span class="cm">// Linux:   C:/Users/Marco/Documenti/doc.txt</span>

<span class="cm">// Combine gestisce separatori ridondanti:</span>
<span class="ty">string</span> a = Path.<span class="fn">Combine</span>(<span class="str">"C:\\Users\\"</span>, <span class="str">"Marco"</span>);   <span class="cm">// C:\Users\Marco — no doppio \</span>
<span class="ty">string</span> b = Path.<span class="fn">Combine</span>(<span class="str">"C:\\Users"</span>,  <span class="str">"\\Marco"</span>);  <span class="cm">// \Marco — attenzione! percorso assoluto vince</span>

<span class="cm">// Combine con variabili:</span>
<span class="ty">string</span> cartellaBase = <span class="str">"C:\\MiaApp"</span>;
<span class="ty">string</span> sottoCartella = <span class="str">"Dati"</span>;
<span class="ty">string</span> nomeFile      = <span class="str">"config.json"</span>;

<span class="ty">string</span> percorsoConfig = Path.<span class="fn">Combine</span>(cartellaBase, sottoCartella, nomeFile);
<span class="cm">// C:\MiaApp\Dati\config.json</span>

<span class="cm">// Percorso relativo — funziona anche senza radice:</span>
<span class="ty">string</span> relativo = Path.<span class="fn">Combine</span>(<span class="str">"Output"</span>, <span class="str">"Report"</span>, <span class="str">"2025.pdf"</span>);
<span class="cm">// Output\Report\2025.pdf (relativo alla cartella corrente)</span>

<span class="cm">// Path.DirectorySeparatorChar — separatore corrente del sistema:</span>
Console.<span class="fn">WriteLine</span>(Path.DirectorySeparatorChar);  <span class="cm">// \ su Windows, / su Linux</span>
Console.<span class="fn">WriteLine</span>(Path.AltDirectorySeparatorChar); <span class="cm">// / su tutti</span></pre>
    <div class="warn">Quando usi Path.Combine, se uno dei segmenti inizia con il separatore (es. "\\Marco" o "/Marco") viene trattato come percorso assoluto e i segmenti precedenti vengono ignorati. Verifica sempre i tuoi input.</div>

    <h4>Estrarre Informazioni da un Percorso</h4>
    <pre><span class="ty">string</span> path = <span class="str">@"C:\Users\Marco\Documenti\report_2025.pdf"</span>;

<span class="cm">// Estrai le parti del percorso:</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetFileName</span>(path));                   <span class="cm">// report_2025.pdf</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetFileNameWithoutExtension</span>(path));    <span class="cm">// report_2025</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetExtension</span>(path));                   <span class="cm">// .pdf</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetDirectoryName</span>(path));               <span class="cm">// C:\Users\Marco\Documenti</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">GetPathRoot</span>(path));                    <span class="cm">// C:\</span>

<span class="cm">// Controlla il tipo di percorso:</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">IsPathRooted</span>(path));                   <span class="cm">// True — percorso assoluto</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">IsPathRooted</span>(<span class="str">"note.txt"</span>));             <span class="cm">// False — relativo</span>
Console.<span class="fn">WriteLine</span>(Path.<span class="fn">IsPathFullyQualified</span>(path));           <span class="cm">// True</span>

<span class="cm">// Percorso assoluto da relativo:</span>
<span class="ty">string</span> assoluto = Path.<span class="fn">GetFullPath</span>(<span class="str">"note.txt"</span>);
Console.<span class="fn">WriteLine</span>(assoluto);  <span class="cm">// es: C:\MiaApp\note.txt (cartella di lavoro attuale)</span>

<span class="ty">string</span> assoluto2 = Path.<span class="fn">GetFullPath</span>(<span class="str">"Output\\report.txt"</span>, <span class="str">@"C:\Progetti"</span>);
Console.<span class="fn">WriteLine</span>(assoluto2);  <span class="cm">// C:\Progetti\Output\report.txt</span>

<span class="cm">// Cambia estensione:</span>
<span class="ty">string</span> comePdf  = Path.<span class="fn">ChangeExtension</span>(path, <span class="str">".txt"</span>);
<span class="ty">string</span> senzaEst = Path.<span class="fn">ChangeExtension</span>(path, <span class="kw">null</span>);  <span class="cm">// rimuove l'estensione</span>
Console.<span class="fn">WriteLine</span>(comePdf);   <span class="cm">// C:\Users\Marco\Documenti\report_2025.txt</span>
Console.<span class="fn">WriteLine</span>(senzaEst);  <span class="cm">// C:\Users\Marco\Documenti\report_2025</span></pre>

    <h4>Percorsi Speciali del Sistema</h4>
    <pre><span class="cm">// Cartella temporanea:</span>
<span class="ty">string</span> temp = Path.<span class="fn">GetTempPath</span>();
Console.<span class="fn">WriteLine</span>(temp);  <span class="cm">// C:\Users\Marco\AppData\Local\Temp\</span>

<span class="cm">// File temporaneo — crea il file fisicamente:</span>
<span class="ty">string</span> fileTemp = Path.<span class="fn">GetTempFileName</span>();
Console.<span class="fn">WriteLine</span>(fileTemp);  <span class="cm">// C:\...\Temp\tmp3F2A.tmp</span>
File.<span class="fn">Delete</span>(fileTemp);  <span class="cm">// elimina quando non serve piu</span>

<span class="cm">// Nome casuale — NON crea il file:</span>
<span class="ty">string</span> nomeRandom = Path.<span class="fn">GetRandomFileName</span>();
Console.<span class="fn">WriteLine</span>(nomeRandom);  <span class="cm">// es: a3b7k2d9.xyz</span>

<span class="cm">// Cartelle speciali del sistema operativo:</span>
<span class="ty">string</span> desktop    = Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.Desktop);
<span class="ty">string</span> documenti  = Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.MyDocuments);
<span class="ty">string</span> appData    = Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.ApplicationData);
<span class="ty">string</span> programmi  = Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.ProgramFiles);

Console.<span class="fn">WriteLine</span>(desktop);   <span class="cm">// C:\Users\Marco\Desktop</span>
Console.<span class="fn">WriteLine</span>(documenti); <span class="cm">// C:\Users\Marco\Documents</span>
Console.<span class="fn">WriteLine</span>(appData);   <span class="cm">// C:\Users\Marco\AppData\Roaming</span>

<span class="cm">// Uso tipico — salva dati app in AppData:</span>
<span class="ty">string</span> cartellaApp = Path.<span class="fn">Combine</span>(appData, <span class="str">"MiaApp"</span>);
Directory.<span class="fn">CreateDirectory</span>(cartellaApp);
<span class="ty">string</span> configPath = Path.<span class="fn">Combine</span>(cartellaApp, <span class="str">"settings.json"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Config salvata in: {configPath}"</span>);</pre>

    <h4>Validazione dei Percorsi</h4>
    <pre><span class="cm">// Caratteri non validi nei percorsi e nei nomi file:</span>
<span class="ty">char</span>[] invalidiPercorso = Path.<span class="fn">GetInvalidPathChars</span>();
<span class="ty">char</span>[] invalidiNome     = Path.<span class="fn">GetInvalidFileNameChars</span>();

Console.<span class="fn">WriteLine</span>(<span class="str">$"Caratteri invalidi percorso: {invalidiPercorso.Length}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Caratteri invalidi nome: {invalidiNome.Length}"</span>);

<span class="cm">// Metodo di validazione:</span>
<span class="kw">static</span> <span class="ty">bool</span> <span class="fn">IsNomeFileValido</span>(<span class="ty">string</span> nome) {
    <span class="kw">if</span> (<span class="ty">string</span>.IsNullOrWhiteSpace(nome)) <span class="kw">return</span> <span class="kw">false</span>;
    <span class="ty">char</span>[] invalidi = Path.<span class="fn">GetInvalidFileNameChars</span>();
    <span class="kw">return</span> !nome.<span class="fn">Any</span>(c => invalidi.<span class="fn">Contains</span>(c));
}

<span class="kw">static</span> <span class="ty">string</span> <span class="fn">SanitizzaNome</span>(<span class="ty">string</span> nome) {
    <span class="ty">char</span>[] invalidi = Path.<span class="fn">GetInvalidFileNameChars</span>();
    <span class="kw">foreach</span> (<span class="ty">char</span> c <span class="kw">in</span> invalidi)
        nome = nome.<span class="fn">Replace</span>(c, <span class="str">'_'</span>);
    <span class="kw">return</span> nome;
}

Console.<span class="fn">WriteLine</span>(<span class="fn">IsNomeFileValido</span>(<span class="str">"report.pdf"</span>));    <span class="cm">// True</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">IsNomeFileValido</span>(<span class="str">"re:port?.pdf"</span>));  <span class="cm">// False — : e ? non validi</span>
Console.<span class="fn">WriteLine</span>(<span class="fn">SanitizzaNome</span>(<span class="str">"report: 2025?.pdf"</span>));  <span class="cm">// report_ 2025_.pdf</span></pre>

    <h4>Esempio Completo — Gestore Percorsi Applicazione</h4>
    <pre><span class="cm">// Classe che centralizza tutti i percorsi di un'applicazione:</span>
<span class="kw">static</span> <span class="kw">class</span> <span class="ty">PercorsiApp</span> {
    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="ty">string</span> _nomeApp = <span class="str">"GestioneOrdini"</span>;

    <span class="cm">// Cartella base dell'app in AppData:</span>
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Radice => Path.<span class="fn">Combine</span>(
        Environment.<span class="fn">GetFolderPath</span>(Environment.SpecialFolder.ApplicationData),
        _nomeApp);

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Dati     => Path.<span class="fn">Combine</span>(Radice, <span class="str">"Dati"</span>);
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Log      => Path.<span class="fn">Combine</span>(Radice, <span class="str">"Log"</span>);
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Backup   => Path.<span class="fn">Combine</span>(Radice, <span class="str">"Backup"</span>);
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> Config   => Path.<span class="fn">Combine</span>(Radice, <span class="str">"config.json"</span>);
    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> LogOggi  => Path.<span class="fn">Combine</span>(Log, <span class="str">$"log_{DateTime.Now:yyyy-MM-dd}.txt"</span>);

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> <span class="fn">FileOrdine</span>(<span class="ty">int</span> id) =>
        Path.<span class="fn">Combine</span>(Dati, <span class="str">$"ordine_{id:D6}.json"</span>);

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">string</span> <span class="fn">FileBackup</span>(<span class="ty">string</span> nomeFile) {
        <span class="ty">string</span> nome = Path.<span class="fn">GetFileNameWithoutExtension</span>(nomeFile);
        <span class="ty">string</span> ext  = Path.<span class="fn">GetExtension</span>(nomeFile);
        <span class="ty">string</span> data = DateTime.Now.<span class="fn">ToString</span>(<span class="str">"yyyyMMdd_HHmmss"</span>);
        <span class="kw">return</span> Path.<span class="fn">Combine</span>(Backup, <span class="str">$"{nome}_{data}{ext}"</span>);
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">CreaStruttura</span>() {
        Directory.<span class="fn">CreateDirectory</span>(Dati);
        Directory.<span class="fn">CreateDirectory</span>(Log);
        Directory.<span class="fn">CreateDirectory</span>(Backup);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Struttura creata in: {Radice}"</span>);
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="ty">void</span> <span class="fn">StampaPercorsi</span>() {
        Console.<span class="fn">WriteLine</span>(<span class="str">$"\n--- Percorsi Applicazione ---"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Radice:  {Radice}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Dati:    {Dati}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Log:     {Log}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Backup:  {Backup}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Config:  {Config}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Log oggi:{LogOggi}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Ordine 42:   {FileOrdine(42)}"</span>);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Backup conf: {FileBackup("config.json")}"</span>);
    }
}

<span class="cm">// Utilizzo:</span>
PercorsiApp.<span class="fn">CreaStruttura</span>();
PercorsiApp.<span class="fn">StampaPercorsi</span>();

<span class="cm">// Crea un file ordine:</span>
<span class="ty">string</span> fileOrdine = PercorsiApp.<span class="fn">FileOrdine</span>(<span class="num">42</span>);
File.<span class="fn">WriteAllText</span>(fileOrdine, <span class="str">"""{"id":42,"cliente":"Mario","totale":99.99}"""</span>);

<span class="cm">// Crea backup prima di modificare il config:</span>
<span class="kw">if</span> (File.<span class="fn">Exists</span>(PercorsiApp.Config)) {
    <span class="ty">string</span> backupConfig = PercorsiApp.<span class="fn">FileBackup</span>(<span class="str">"config.json"</span>);
    File.<span class="fn">Copy</span>(PercorsiApp.Config, backupConfig);
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Backup creato: {Path.GetFileName(backupConfig)}"</span>);
}</pre>

    <h4>Errori Comuni</h4>
    <pre><span class="cm">// 1. Concatenazione manuale — non cross-platform:</span>
<span class="ty">string</span> sbagliato = <span class="str">"C:\\Users"</span> + <span class="str">"\\"</span> + <span class="str">"Marco"</span>;  <span class="cm">// fragile su Linux/Mac</span>
<span class="ty">string</span> corretto  = Path.<span class="fn">Combine</span>(<span class="str">"C:\\Users"</span>, <span class="str">"Marco"</span>);  <span class="cm">// sempre corretto</span>

<span class="cm">// 2. Segmento con separatore iniziale — sovrascrive il precedente:</span>
<span class="ty">string</span> risultato = Path.<span class="fn">Combine</span>(<span class="str">"C:\\App"</span>, <span class="str">"\\Dati"</span>);  <span class="cm">// \Dati — C:\App ignorato!</span>
<span class="ty">string</span> giusto    = Path.<span class="fn">Combine</span>(<span class="str">"C:\\App"</span>, <span class="str">"Dati"</span>);    <span class="cm">// C:\App\Dati</span>

<span class="cm">// 3. GetDirectoryName su solo nome file restituisce null:</span>
<span class="ty">string</span>? dir = Path.<span class="fn">GetDirectoryName</span>(<span class="str">"nota.txt"</span>);  <span class="cm">// null — nessuna cartella</span>
<span class="ty">string</span>? dir2 = Path.<span class="fn">GetDirectoryName</span>(<span class="str">@"C:\App\nota.txt"</span>);  <span class="cm">// C:\App</span>
<span class="cm">// Controlla sempre il null prima di usare il risultato</span>

<span class="cm">// 4. GetTempFileName crea il file — elimina quando non serve:</span>
<span class="ty">string</span> temp = Path.<span class="fn">GetTempFileName</span>();  <span class="cm">// crea il file fisicamente!</span>
<span class="cm">// ... usa il file ...</span>
File.<span class="fn">Delete</span>(temp);  <span class="cm">// elimina — altrimenti accumuli file temp</span>

<span class="cm">// 5. ChangeExtension senza punto — aggiunge il punto automaticamente:</span>
<span class="ty">string</span> a = Path.<span class="fn">ChangeExtension</span>(<span class="str">"file.txt"</span>, <span class="str">"pdf"</span>);   <span class="cm">// file.pdf — punto aggiunto</span>
<span class="ty">string</span> b = Path.<span class="fn">ChangeExtension</span>(<span class="str">"file.txt"</span>, <span class="str">".pdf"</span>);  <span class="cm">// file.pdf — identico</span>
<span class="ty">string</span> c = Path.<span class="fn">ChangeExtension</span>(<span class="str">"file.txt"</span>, <span class="kw">null</span>);    <span class="cm">// file   — estensione rimossa</span></pre>

    <h4>Esercizi</h4>
    <pre><span class="cm">// FACILE:</span>
<span class="cm">// 1. Dato un percorso completo come input dell'utente,</span>
<span class="cm">//    stampa separatamente: cartella, nome file, estensione.</span>
<span class="cm">//    Poi crea una versione backup aggiungendo "_backup" al nome.</span>

<span class="cm">// MEDIO:</span>
<span class="cm">// 2. Scrivi un metodo OrganizzaFile(string cartella) che:</span>
<span class="cm">//    Legge tutti i file nella cartella,</span>
<span class="cm">//    li raggruppa per estensione in sottocartelle (.txt → Testo, .pdf → PDF ecc.),</span>
<span class="cm">//    sposta (File.Move) ogni file nella sottocartella corretta.</span>

<span class="cm">// DIFFICILE:</span>
<span class="cm">// 3. Crea "GestoreVersioni" che:</span>
<span class="cm">//    Ogni volta che salvi un file, crea una versione numerata (file_v1.txt, file_v2.txt).</span>
<span class="cm">//    Metodi: Salva(percorso, contenuto), Ripristina(percorso, versione),</span>
<span class="cm">//    ElencaVersioni(percorso), EliminaVersioniVecchie(percorso, mantieni N).</span></pre>

    <h4>Soluzioni</h4>
    <pre><span class="cm">// --- 1. Analisi percorso ---</span>
Console.<span class="fn">Write</span>(<span class="str">"Inserisci un percorso completo: "</span>);
<span class="ty">string</span> input = Console.<span class="fn">ReadLine</span>() ?? <span class="str">@"C:\Users\Marco\Documenti\report.pdf"</span>;

Console.<span class="fn">WriteLine</span>(<span class="str">$"Cartella:   {Path.GetDirectoryName(input) ?? "(nessuna)"}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Nome file:  {Path.GetFileName(input)}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Solo nome:  {Path.GetFileNameWithoutExtension(input)}"</span>);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Estensione: {Path.GetExtension(input)}"</span>);

<span class="ty">string</span> nomeBackup = Path.<span class="fn">GetFileNameWithoutExtension</span>(input) + <span class="str">"_backup"</span>
                   + Path.<span class="fn">GetExtension</span>(input);
<span class="ty">string</span> percorsoBackup = Path.<span class="fn">Combine</span>(
    Path.<span class="fn">GetDirectoryName</span>(input) ?? <span class="str">"."</span>, nomeBackup);
Console.<span class="fn">WriteLine</span>(<span class="str">$"Backup:     {percorsoBackup}"</span>);

<span class="cm">// --- 2. OrganizzaFile ---</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">OrganizzaFile</span>(<span class="ty">string</span> cartella) {
    <span class="kw">if</span> (!Directory.<span class="fn">Exists</span>(cartella)) {
        Console.<span class="fn">WriteLine</span>(<span class="str">"Cartella non trovata."</span>);
        <span class="kw">return</span>;
    }

    Dictionary&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; mappaCartelle = <span class="kw">new</span>(StringComparer.OrdinalIgnoreCase) {
        [<span class="str">".txt"</span>]  = <span class="str">"Testo"</span>,
        [<span class="str">".pdf"</span>]  = <span class="str">"PDF"</span>,
        [<span class="str">".jpg"</span>]  = <span class="str">"Immagini"</span>,
        [<span class="str">".png"</span>]  = <span class="str">"Immagini"</span>,
        [<span class="str">".docx"</span>] = <span class="str">"Word"</span>,
        [<span class="str">".xlsx"</span>] = <span class="str">"Excel"</span>,
        [<span class="str">".json"</span>] = <span class="str">"Dati"</span>,
        [<span class="str">".xml"</span>]  = <span class="str">"Dati"</span>
    };

    <span class="ty">int</span> spostati = <span class="num">0</span>;
    <span class="kw">foreach</span> (<span class="ty">string</span> file <span class="kw">in</span> Directory.<span class="fn">GetFiles</span>(cartella)) {
        <span class="ty">string</span> ext          = Path.<span class="fn">GetExtension</span>(file);
        <span class="ty">string</span> nomeCartella = mappaCartelle.<span class="fn">GetValueOrDefault</span>(ext, <span class="str">"Altro"</span>);
        <span class="ty">string</span> destinazione = Path.<span class="fn">Combine</span>(cartella, nomeCartella);

        Directory.<span class="fn">CreateDirectory</span>(destinazione);
        <span class="ty">string</span> dest = Path.<span class="fn">Combine</span>(destinazione, Path.<span class="fn">GetFileName</span>(file));

        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(dest)) {
            File.<span class="fn">Move</span>(file, dest);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Spostato: {Path.GetFileName(file)} → {nomeCartella}"</span>);
            spostati++;
        }
    }
    Console.<span class="fn">WriteLine</span>(<span class="str">$"\nFile organizzati: {spostati}"</span>);
}

<span class="cm">// --- 3. GestoreVersioni ---</span>
<span class="kw">class</span> <span class="ty">GestoreVersioni</span> {
    <span class="kw">private</span> <span class="kw">readonly</span> <span class="ty">string</span> _cartellaVersioni;

    <span class="kw">public</span> <span class="fn">GestoreVersioni</span>(<span class="ty">string</span> cartella) {
        _cartellaVersioni = cartella;
        Directory.<span class="fn">CreateDirectory</span>(cartella);
    }

    <span class="kw">private</span> <span class="ty">string</span> <span class="fn">PercorsoVersione</span>(<span class="ty">string</span> percorso, <span class="ty">int</span> v) {
        <span class="ty">string</span> nome = Path.<span class="fn">GetFileNameWithoutExtension</span>(percorso);
        <span class="ty">string</span> ext  = Path.<span class="fn">GetExtension</span>(percorso);
        <span class="kw">return</span> Path.<span class="fn">Combine</span>(_cartellaVersioni, <span class="str">$"{nome}_v{v}{ext}"</span>);
    }

    <span class="kw">private</span> <span class="ty">int</span> <span class="fn">ProssimaVersione</span>(<span class="ty">string</span> percorso) {
        <span class="ty">string</span> nome    = Path.<span class="fn">GetFileNameWithoutExtension</span>(percorso);
        <span class="ty">string</span> ext     = Path.<span class="fn">GetExtension</span>(percorso);
        <span class="ty">string</span> pattern = <span class="str">$"{nome}_v*{ext}"</span>;
        <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(_cartellaVersioni, pattern);
        <span class="kw">return</span> files.Length + <span class="num">1</span>;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Salva</span>(<span class="ty">string</span> percorso, <span class="ty">string</span> contenuto) {
        <span class="ty">int</span> versione = <span class="fn">ProssimaVersione</span>(percorso);
        <span class="ty">string</span> dest  = <span class="fn">PercorsoVersione</span>(percorso, versione);
        File.<span class="fn">WriteAllText</span>(dest, contenuto);
        File.<span class="fn">WriteAllText</span>(percorso, contenuto);  <span class="cm">// aggiorna anche il file principale</span>
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Salvata versione {versione}: {Path.GetFileName(dest)}"</span>);
    }

    <span class="kw">public</span> <span class="ty">string</span>? <span class="fn">Ripristina</span>(<span class="ty">string</span> percorso, <span class="ty">int</span> versione) {
        <span class="ty">string</span> src = <span class="fn">PercorsoVersione</span>(percorso, versione);
        <span class="kw">if</span> (!File.<span class="fn">Exists</span>(src)) {
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Versione {versione} non trovata."</span>);
            <span class="kw">return</span> <span class="kw">null</span>;
        }
        <span class="ty">string</span> contenuto = File.<span class="fn">ReadAllText</span>(src);
        File.<span class="fn">WriteAllText</span>(percorso, contenuto);
        Console.<span class="fn">WriteLine</span>(<span class="str">$"Ripristinata versione {versione}."</span>);
        <span class="kw">return</span> contenuto;
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">ElencaVersioni</span>(<span class="ty">string</span> percorso) {
        <span class="ty">string</span> nome    = Path.<span class="fn">GetFileNameWithoutExtension</span>(percorso);
        <span class="ty">string</span> ext     = Path.<span class="fn">GetExtension</span>(percorso);
        <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(_cartellaVersioni, <span class="str">$"{nome}_v*{ext}"</span>);

        Console.<span class="fn">WriteLine</span>(<span class="str">$"\nVersioni di {Path.GetFileName(percorso)}:"</span>);
        <span class="kw">foreach</span> (<span class="ty">string</span> f <span class="kw">in</span> files.<span class="fn">OrderBy</span>(x => x)) {
            FileInfo fi = <span class="kw">new</span>(f);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"  {fi.Name,-30} {fi.Length,6} byte  {fi.LastWriteTime:dd/MM HH:mm}"</span>);
        }
    }

    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">EliminaVersioniVecchie</span>(<span class="ty">string</span> percorso, <span class="ty">int</span> mantieni = <span class="num">3</span>) {
        <span class="ty">string</span> nome    = Path.<span class="fn">GetFileNameWithoutExtension</span>(percorso);
        <span class="ty">string</span> ext     = Path.<span class="fn">GetExtension</span>(percorso);
        <span class="ty">string</span>[] files = Directory.<span class="fn">GetFiles</span>(_cartellaVersioni, <span class="str">$"{nome}_v*{ext}"</span>)
                                   .<span class="fn">OrderByDescending</span>(x => x)
                                   .<span class="fn">ToArray</span>();

        <span class="kw">foreach</span> (<span class="ty">string</span> f <span class="kw">in</span> files.<span class="fn">Skip</span>(mantieni)) {
            File.<span class="fn">Delete</span>(f);
            Console.<span class="fn">WriteLine</span>(<span class="str">$"Eliminata vecchia versione: {Path.GetFileName(f)}"</span>);
        }
    }
}

<span class="cm">// Utilizzo:</span>
<span class="kw">var</span> gv = <span class="kw">new</span> <span class="ty">GestoreVersioni</span>(<span class="str">"Versioni"</span>);
gv.<span class="fn">Salva</span>(<span class="str">"documento.txt"</span>, <span class="str">"Prima versione del documento."</span>);
gv.<span class="fn">Salva</span>(<span class="str">"documento.txt"</span>, <span class="str">"Seconda versione con modifiche."</span>);
gv.<span class="fn">Salva</span>(<span class="str">"documento.txt"</span>, <span class="str">"Terza versione finale."</span>);
gv.<span class="fn">ElencaVersioni</span>(<span class="str">"documento.txt"</span>);
gv.<span class="fn">Ripristina</span>(<span class="str">"documento.txt"</span>, <span class="num">1</span>);
gv.<span class="fn">EliminaVersioniVecchie</span>(<span class="str">"documento.txt"</span>, mantieni: <span class="num">2</span>);</pre>

  </div>
</div>

    <!-- SECTION AVANZATO (23) -->
    <div class="section" id="section-advanced">
      <div class="section-title">III — Avanzato <span class="tag">ADV</span></div>
      <!-- 1. LINQ -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>1. LINQ</h3><div class="topic-sub">Where, Select, OrderBy, GroupBy, First, Count, Sum, Any, All</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <p>LINQ (Language Integrated Query) permette di interrogare collezioni come se fossero database.</p>
          <pre><span class="kw">using</span> System.Linq;

List&lt;<span class="ty">int</span>&gt; numeri = <span class="kw">new</span>() { <span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>,<span class="num">7</span>,<span class="num">8</span>,<span class="num">9</span>,<span class="num">10</span> };

<span class="cm">// Where — filtra:</span>
<span class="kw">var</span> pari = numeri.<span class="fn">Where</span>(n => n % <span class="num">2</span> == <span class="num">0</span>);  <span class="cm">// 2,4,6,8,10</span>

<span class="cm">// Select — trasforma:</span>
<span class="kw">var</span> quadrati = numeri.<span class="fn">Select</span>(n => n * n);   <span class="cm">// 1,4,9,16…</span>

<span class="cm">// OrderBy / OrderByDescending:</span>
<span class="kw">var</span> ordinati = numeri.<span class="fn">OrderByDescending</span>(n => n);

<span class="cm">// First / FirstOrDefault:</span>
<span class="ty">int</span> primo = numeri.<span class="fn">First</span>(n => n > <span class="num">5</span>);   <span class="cm">// 6 (lancia eccezione se non trovato)</span>
<span class="ty">int</span> safe  = numeri.<span class="fn">FirstOrDefault</span>(n => n > <span class="num">100</span>);  <span class="cm">// 0 (default)</span>

<span class="cm">// Aggregazioni:</span>
<span class="ty">int</span> somma = numeri.<span class="fn">Sum</span>();
<span class="ty">double</span> media = numeri.<span class="fn">Average</span>();
<span class="ty">int</span> max = numeri.<span class="fn">Max</span>();
<span class="ty">int</span> conteggio = numeri.<span class="fn">Count</span>(n => n > <span class="num">5</span>);

<span class="cm">// Any / All:</span>
<span class="ty">bool</span> haNegativi = numeri.<span class="fn">Any</span>(n => n < <span class="num">0</span>);   <span class="cm">// false</span>
<span class="ty">bool</span> tuttiPos   = numeri.<span class="fn">All</span>(n => n > <span class="num">0</span>);   <span class="cm">// true</span>

<span class="cm">// Concatenazione:</span>
<span class="kw">var</span> risultato = numeri
    .<span class="fn">Where</span>(n => n % <span class="num">2</span> == <span class="num">0</span>)
    .<span class="fn">Select</span>(n => n * <span class="num">10</span>)
    .<span class="fn">OrderBy</span>(n => n)
    .<span class="fn">ToList</span>();

<span class="cm">// GroupBy:</span>
<span class="kw">var</span> gruppi = numeri.<span class="fn">GroupBy</span>(n => n % <span class="num">2</span> == <span class="num">0</span> ? <span class="str">"pari"</span> : <span class="str">"dispari"</span>);
<span class="kw">foreach</span> (<span class="kw">var</span> g <span class="kw">in</span> gruppi)
    Console.<span class="fn">WriteLine</span>(<span class="str">$"{g.Key}: {string.Join(", ", g)}"</span>);

<span class="cm">// Sintassi query (alternativa):</span>
<span class="kw">var</span> query = <span class="kw">from</span> n <span class="kw">in</span> numeri
            <span class="kw">where</span> n > <span class="num">5</span>
            <span class="kw">orderby</span> n
            <span class="kw">select</span> n;</pre>
        </div>
      </div>
      <!-- 2. Generics -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>2. Generics &lt;T&gt;</h3><div class="topic-sub">Classi e metodi generici, constraints where T:</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Metodo generico — funziona con qualsiasi tipo:</span>
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Stampa</span>&lt;T&gt;(T valore) =>
    Console.<span class="fn">WriteLine</span>(<span class="str">$"Valore: {valore} (tipo: {typeof(T).Name})"</span>);

<span class="fn">Stampa</span>(<span class="num">42</span>);        <span class="cm">// int</span>
<span class="fn">Stampa</span>(<span class="str">"Ciao"</span>);   <span class="cm">// string</span>
<span class="fn">Stampa</span>(<span class="num">3.14</span>);     <span class="cm">// double</span>

<span class="cm">// Classe generica:</span>
<span class="kw">class</span> <span class="ty">Scatola</span>&lt;T&gt; {
    <span class="kw">public</span> T Contenuto { <span class="kw">get</span>; <span class="kw">set</span>; }
    <span class="kw">public</span> <span class="fn">Scatola</span>(T contenuto) { Contenuto = contenuto; }
    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">Descrivi</span>() => <span class="str">$"Contiene: {Contenuto}"</span>;
}

Scatola&lt;<span class="ty">int</span>&gt;    s1 = <span class="kw">new</span>(<span class="num">42</span>);
Scatola&lt;<span class="ty">string</span>&gt; s2 = <span class="kw">new</span>(<span class="str">"Ciao"</span>);

<span class="cm">// Constraints — limitare il tipo:</span>
<span class="kw">static</span> T <span class="fn">Massimo</span>&lt;T&gt;(T a, T b) <span class="kw">where</span> T : IComparable&lt;T&gt;
    => a.CompareTo(b) > <span class="num">0</span> ? a : b;

<span class="fn">Massimo</span>(<span class="num">3</span>, <span class="num">7</span>);        <span class="cm">// 7</span>
<span class="fn">Massimo</span>(<span class="str">"abc"</span>, <span class="str">"xyz"</span>); <span class="cm">// "xyz"</span></pre>
        </div>
      </div>
      <!-- 3. Delegates & Events -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>3. Delegates &amp; Events</h3><div class="topic-sub">delegate, Func, Action, Predicate, event</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Delegate — puntatore a un metodo:</span>
<span class="kw">delegate</span> <span class="ty">int</span> Operazione(<span class="ty">int</span> a, <span class="ty">int</span> b);

<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Somma</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) => a + b;
<span class="kw">static</span> <span class="ty">int</span> <span class="fn">Prodotto</span>(<span class="ty">int</span> a, <span class="ty">int</span> b) => a * b;

Operazione op = Somma;
Console.<span class="fn">WriteLine</span>(op(<span class="num">3</span>, <span class="num">4</span>));   <span class="cm">// 7</span>
op = Prodotto;
Console.<span class="fn">WriteLine</span>(op(<span class="num">3</span>, <span class="num">4</span>));   <span class="cm">// 12</span>

<span class="cm">// Func&lt;...&gt; — delegate che restituisce un valore:</span>
Func&lt;<span class="ty">int</span>, <span class="ty">int</span>, <span class="ty">int</span>&gt; somma = (a, b) => a + b;
Func&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt;   lunghezza = s => s.Length;

<span class="cm">// Action&lt;...&gt; — delegate void:</span>
Action&lt;<span class="ty">string</span>&gt; stampa = s => Console.<span class="fn">WriteLine</span>(s);
stampa(<span class="str">"Ciao!"</span>);

<span class="cm">// Predicate&lt;T&gt; — delegate che restituisce bool:</span>
Predicate&lt;<span class="ty">int</span>&gt; ePari = n => n % <span class="num">2</span> == <span class="num">0</span>;

<span class="cm">// Event:</span>
<span class="kw">class</span> <span class="ty">Bottone</span> {
    <span class="kw">public</span> <span class="kw">event</span> Action Click;
    <span class="kw">public</span> <span class="ty">void</span> <span class="fn">Premi</span>() => Click?.Invoke();
}
Bottone b = <span class="kw">new</span>();
b.Click += () => Console.<span class="fn">WriteLine</span>(<span class="str">"Cliccato!"</span>);
b.<span class="fn">Premi</span>();</pre>
        </div>
      </div>
      <!-- 4. Lambda & Closures -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>4. Lambda &amp; Closures</h3><div class="topic-sub">Espressioni lambda, variabili catturate, metodi anonimi</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Sintassi lambda:</span>
<span class="cm">// (parametri) => espressione</span>
<span class="cm">// (parametri) => { blocco di codice }</span>

Func&lt;<span class="ty">int</span>, <span class="ty">int</span>&gt; quadrato = x => x * x;
Func&lt;<span class="ty">int</span>, <span class="ty">int</span>, <span class="ty">int</span>&gt; somma = (a, b) => a + b;
Action saluta = () => Console.<span class="fn">WriteLine</span>(<span class="str">"Ciao!"</span>);

<span class="cm">// Lambda con corpo:</span>
Func&lt;<span class="ty">int</span>, <span class="ty">string</span>&gt; classifica = n => {
    <span class="kw">if</span> (n >= <span class="num">90</span>) <span class="kw">return</span> <span class="str">"Ottimo"</span>;
    <span class="kw">if</span> (n >= <span class="num">60</span>) <span class="kw">return</span> <span class="str">"Sufficiente"</span>;
    <span class="kw">return</span> <span class="str">"Insufficiente"</span>;
};

<span class="cm">// Closure — cattura variabile esterna:</span>
<span class="ty">int</span> moltiplicatore = <span class="num">3</span>;
Func&lt;<span class="ty">int</span>, <span class="ty">int</span>&gt; moltiplica = n => n * moltiplicatore;
Console.<span class="fn">WriteLine</span>(moltiplica(<span class="num">5</span>));  <span class="cm">// 15</span>
moltiplicatore = <span class="num">10</span>;
Console.<span class="fn">WriteLine</span>(moltiplica(<span class="num">5</span>));  <span class="cm">// 50 ← usa il valore aggiornato!</span></pre>
        </div>
      </div>
      <!-- 5. async / await -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>5. async / await</h3><div class="topic-sub">Task, async, await, Task.WhenAll, Task.WhenAny</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="kw">using</span> System.Threading.Tasks;

<span class="cm">// Metodo asincrono — non blocca il thread:</span>
<span class="kw">static</span> <span class="kw">async</span> Task&lt;<span class="ty">string</span>&gt; <span class="fn">ScaricaDati</span>() {
    <span class="kw">await</span> Task.<span class="fn">Delay</span>(<span class="num">2000</span>);  <span class="cm">// simula attesa 2 secondi</span>
    <span class="kw">return</span> <span class="str">"Dati scaricati!"</span>;
}

<span class="cm">// Chiamata:</span>
<span class="kw">static</span> <span class="kw">async</span> Task <span class="fn">Main</span>(<span class="ty">string</span>[] args) {
    Console.<span class="fn">WriteLine</span>(<span class="str">"Inizio..."</span>);
    <span class="ty">string</span> risultato = <span class="kw">await</span> <span class="fn">ScaricaDati</span>();
    Console.<span class="fn">WriteLine</span>(risultato);
}

<span class="cm">// Task.WhenAll — esegue più task in parallelo:</span>
Task&lt;<span class="ty">string</span>&gt; t1 = <span class="fn">ScaricaDati</span>();
Task&lt;<span class="ty">string</span>&gt; t2 = <span class="fn">ScaricaDati</span>();
<span class="ty">string</span>[] risultati = <span class="kw">await</span> Task.<span class="fn">WhenAll</span>(t1, t2);

<span class="cm">// void async (per event handler):</span>
<span class="kw">async</span> <span class="ty">void</span> <span class="fn">OnClick</span>() {
    <span class="kw">await</span> Task.<span class="fn">Delay</span>(<span class="num">1000</span>);
    Console.<span class="fn">WriteLine</span>(<span class="str">"Fatto!"</span>);
}</pre>
          <table>
            <tr><th>Tipo di ritorno</th><th>Usa quando</th></tr>
            <tr><td>Task</td><td>Metodo async void (operazioni)</td></tr>
            <tr><td>Task&lt;T&gt;</td><td>Metodo async che restituisce T</td></tr>
            <tr><td>async void</td><td>Solo per event handler</td></tr>
          </table>
        </div>
      </div>
      <!-- 6. DateTime & TimeSpan -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>6. DateTime &amp; TimeSpan</h3><div class="topic-sub">Now, Today, Parse, Format, Add, differenza tra date</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Ottenere la data/ora corrente:</span>
DateTime ora  = DateTime.Now;    <span class="cm">// data e ora locali</span>
DateTime oggi = DateTime.Today;  <span class="cm">// solo data (ora = 00:00:00)</span>
DateTime utc  = DateTime.UtcNow; <span class="cm">// UTC</span>

<span class="cm">// Creare una data specifica:</span>
DateTime natale = <span class="kw">new</span> DateTime(<span class="num">2025</span>, <span class="num">12</span>, <span class="num">25</span>);
DateTime precisa = <span class="kw">new</span> DateTime(<span class="num">2025</span>, <span class="num">12</span>, <span class="num">25</span>, <span class="num">18</span>, <span class="num">30</span>, <span class="num">0</span>); <span class="cm">// 18:30:00</span>

<span class="cm">// Formattazione:</span>
Console.<span class="fn">WriteLine</span>(ora.<span class="fn">ToString</span>(<span class="str">"dd/MM/yyyy"</span>));        <span class="cm">// 25/12/2025</span>
Console.<span class="fn">WriteLine</span>(ora.<span class="fn">ToString</span>(<span class="str">"HH:mm:ss"</span>));           <span class="cm">// 18:30:00</span>
Console.<span class="fn">WriteLine</span>(ora.<span class="fn">ToString</span>(<span class="str">"dd/MM/yyyy HH:mm"</span>));  <span class="cm">// 25/12/2025 18:30</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Oggi è {ora:dddd d MMMM yyyy}"</span>);   <span class="cm">// Giovedì 25 Dicembre 2025</span>

<span class="cm">// Aggiungere/sottrarre tempo:</span>
DateTime domani     = oggi.<span class="fn">AddDays</span>(<span class="num">1</span>);
DateTime settimana  = oggi.<span class="fn">AddDays</span>(<span class="num">7</span>);
DateTime mesePrima  = oggi.<span class="fn">AddMonths</span>(-<span class="num">1</span>);
DateTime tra2ore    = ora.<span class="fn">AddHours</span>(<span class="num">2</span>);

<span class="cm">// Proprietà:</span>
Console.<span class="fn">WriteLine</span>(ora.Year);        <span class="cm">// 2025</span>
Console.<span class="fn">WriteLine</span>(ora.Month);       <span class="cm">// 12</span>
Console.<span class="fn">WriteLine</span>(ora.Day);         <span class="cm">// 25</span>
Console.<span class="fn">WriteLine</span>(ora.DayOfWeek);   <span class="cm">// Thursday</span>

<span class="cm">// TimeSpan — differenza tra date:</span>
TimeSpan diff = natale - oggi;
Console.<span class="fn">WriteLine</span>(<span class="str">$"Giorni a Natale: {diff.Days}"</span>);

<span class="cm">// Parse:</span>
DateTime d = DateTime.<span class="fn">Parse</span>(<span class="str">"25/12/2025"</span>);
<span class="ty">bool</span> ok = DateTime.<span class="fn">TryParse</span>(<span class="str">"abc"</span>, <span class="kw">out</span> DateTime result);</pre>
        </div>
      </div>
      <!-- 7. StringBuilder -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>7. StringBuilder</h3><div class="topic-sub">Append, Insert, Replace, Remove — performance per stringhe lunghe</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <p>Le stringhe normali sono <strong>immutabili</strong> — ogni += crea una nuova stringa. StringBuilder modifica il buffer direttamente, molto più efficiente per molte concatenazioni.</p>
          <pre><span class="kw">using</span> System.Text;

StringBuilder sb = <span class="kw">new</span> StringBuilder();
sb.<span class="fn">Append</span>(<span class="str">"Ciao"</span>);
sb.<span class="fn">Append</span>(<span class="str">" "</span>);
sb.<span class="fn">Append</span>(<span class="str">"Mondo"</span>);
sb.<span class="fn">AppendLine</span>(<span class="str">"!"</span>);         <span class="cm">// aggiunge + \n</span>
sb.<span class="fn">Insert</span>(<span class="num">0</span>, <span class="str">">>> "</span>);       <span class="cm">// inserisce in posizione 0</span>
sb.<span class="fn">Replace</span>(<span class="str">"Mondo"</span>, <span class="str">"Italia"</span>); <span class="cm">// sostituisce</span>
sb.<span class="fn">Remove</span>(<span class="num">0</span>, <span class="num">4</span>);             <span class="cm">// rimuove 4 caratteri da posizione 0</span>
Console.<span class="fn">WriteLine</span>(sb.Length); <span class="cm">// lunghezza buffer</span>
<span class="ty">string</span> risultato = sb.<span class="fn">ToString</span>(); <span class="cm">// converte in stringa</span>
sb.<span class="fn">Clear</span>();                   <span class="cm">// svuota</span></pre>
          <div class="warn">Per meno di ~10 concatenazioni, usa += normale. StringBuilder conviene per loop con molte operazioni.</div>
        </div>
      </div>
      <!-- 8. Random & Utilità -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>8. Random &amp; Utilità</h3><div class="topic-sub">Random, Next, NextDouble, Shuffle, Math completa</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Random:</span>
Random rnd = <span class="kw">new</span> Random();
<span class="ty">int</span>    n1 = rnd.<span class="fn">Next</span>();           <span class="cm">// numero casuale qualsiasi</span>
<span class="ty">int</span>    n2 = rnd.<span class="fn">Next</span>(<span class="num">10</span>);         <span class="cm">// 0–9</span>
<span class="ty">int</span>    n3 = rnd.<span class="fn">Next</span>(<span class="num">1</span>, <span class="num">101</span>);     <span class="cm">// 1–100</span>
<span class="ty">double</span> d  = rnd.<span class="fn">NextDouble</span>();     <span class="cm">// 0.0–1.0</span>

<span class="cm">// Random con seed (stessa sequenza):</span>
Random rndFisso = <span class="kw">new</span> Random(<span class="num">42</span>);

<span class="cm">// Mescolare una lista:</span>
List&lt;<span class="ty">int</span>&gt; lista = <span class="kw">new</span>() { <span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span> };
<span class="kw">var</span> mescolata = lista.<span class="fn">OrderBy</span>(_ => rnd.<span class="fn">Next</span>()).<span class="fn">ToList</span>();

<span class="cm">// Scegliere elemento casuale:</span>
<span class="ty">string</span>[] nomi = { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span>, <span class="str">"Luca"</span> };
<span class="ty">string</span> casuale = nomi[rnd.<span class="fn">Next</span>(nomi.Length)];</pre>
        </div>
      </div>
      <!-- 9. Tuple & ValueTuple -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>9. Tuple &amp; ValueTuple</h3><div class="topic-sub">Ritorno multiplo, named tuples, decostruzione</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Tuple — restituire più valori da un metodo:</span>
<span class="kw">static</span> (int min, int max) <span class="fn">TrovaMinMax</span>(<span class="ty">int</span>[] arr) {
    <span class="kw">return</span> (arr.<span class="fn">Min</span>(), arr.<span class="fn">Max</span>());
}

<span class="ty">int</span>[] numeri = { <span class="num">3</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">2</span>, <span class="num">9</span> };
<span class="kw">var</span> (min, max) = <span class="fn">TrovaMinMax</span>(numeri);  <span class="cm">// decostruzione</span>
Console.<span class="fn">WriteLine</span>(<span class="str">$"Min: {min}, Max: {max}"</span>);

<span class="cm">// Named tuple:</span>
(<span class="ty">string</span> Nome, <span class="ty">int</span> Eta) persona = (<span class="str">"Marco"</span>, <span class="num">25</span>);
Console.<span class="fn">WriteLine</span>(persona.Nome);  <span class="cm">// "Marco"</span>
Console.<span class="fn">WriteLine</span>(persona.Eta);   <span class="cm">// 25</span>

<span class="cm">// Tuple anonima:</span>
<span class="kw">var</span> t = (<span class="num">1</span>, <span class="str">"ciao"</span>, <span class="kw">true</span>);
Console.<span class="fn">WriteLine</span>(t.Item1);  <span class="cm">// 1</span>
Console.<span class="fn">WriteLine</span>(t.Item2);  <span class="cm">// "ciao"</span></pre>
        </div>
      </div>
      <!-- 10. Pattern Matching -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>10. Pattern Matching</h3><div class="topic-sub">switch expression avanzata, is, when, positional patterns</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Pattern con is:</span>
<span class="kw">if</span> (obj <span class="kw">is</span> <span class="ty">int</span> n && n > <span class="num">0</span>) Console.<span class="fn">WriteLine</span>(<span class="str">$"Intero positivo: {n}"</span>);
<span class="kw">if</span> (obj <span class="kw">is</span> <span class="ty">string</span> s && s.Length > <span class="num">5</span>) Console.<span class="fn">WriteLine</span>(<span class="str">$"Stringa lunga: {s}"</span>);
<span class="kw">if</span> (obj <span class="kw">is</span> <span class="kw">null</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"È null"</span>);
<span class="kw">if</span> (obj <span class="kw">is not</span> <span class="kw">null</span>) Console.<span class="fn">WriteLine</span>(<span class="str">"Non è null"</span>);

<span class="cm">// switch expression con pattern:</span>
<span class="ty">string</span> Descrivi(object obj) => obj <span class="kw">switch</span> {
    <span class="ty">int</span> n <span class="kw">when</span> n < <span class="num">0</span>   => <span class="str">"negativo"</span>,
    <span class="ty">int</span> n <span class="kw">when</span> n == <span class="num">0</span>  => <span class="str">"zero"</span>,
    <span class="ty">int</span> n               => <span class="str">$"positivo {n}"</span>,
    <span class="ty">string</span> s            => <span class="str">$"stringa: {s}"</span>,
    <span class="kw">null</span>                => <span class="str">"null"</span>,
    _                   => <span class="str">"altro"</span>
};

<span class="cm">// Range pattern (C# 9+):</span>
<span class="ty">string</span> Giudizio(<span class="ty">int</span> voto) => voto <span class="kw">switch</span> {
    >= <span class="num">90</span>         => <span class="str">"Ottimo"</span>,
    >= <span class="num">75</span> <span class="kw">and</span> < <span class="num">90</span> => <span class="str">"Buono"</span>,
    >= <span class="num">60</span>         => <span class="str">"Sufficiente"</span>,
    _             => <span class="str">"Insufficiente"</span>
};</pre>
        </div>
      </div>
      <!-- 11. Record -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>11. Record</h3><div class="topic-sub">Immutabilità, with expression, value equality (C# 9+)</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Record — tipo immutabile con uguaglianza per valore:</span>
<span class="kw">record</span> <span class="ty">Persona</span>(<span class="ty">string</span> Nome, <span class="ty">int</span> Eta);

Persona p1 = <span class="kw">new</span>(<span class="str">"Marco"</span>, <span class="num">25</span>);
Persona p2 = <span class="kw">new</span>(<span class="str">"Marco"</span>, <span class="num">25</span>);

Console.<span class="fn">WriteLine</span>(p1 == p2);     <span class="cm">// true! (valore, non riferimento)</span>
Console.<span class="fn">WriteLine</span>(p1);           <span class="cm">// Persona { Nome = Marco, Eta = 25 }</span>

<span class="cm">// with — crea una copia modificando alcuni valori:</span>
Persona p3 = p1 <span class="kw">with</span> { Eta = <span class="num">30</span> };
Console.<span class="fn">WriteLine</span>(p3);  <span class="cm">// Persona { Nome = Marco, Eta = 30 }</span>

<span class="cm">// Record con corpo (aggiungere metodi):</span>
<span class="kw">record</span> <span class="ty">Prodotto</span>(<span class="ty">string</span> Nome, <span class="ty">double</span> Prezzo) {
    <span class="kw">public</span> <span class="ty">string</span> <span class="fn">Descrivi</span>() => <span class="str">$"{Nome}: €{Prezzo:F2}"</span>;
}</pre>
          <div class="note">Record sono ideali per DTO (Data Transfer Objects), modelli di dati, configurazioni — qualsiasi cosa che non deve cambiare dopo la creazione.</div>
        </div>
      </div>
      <!-- 12. HashSet, Queue & Stack -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>12. HashSet, Queue &amp; Stack</h3><div class="topic-sub">Collezioni specializzate, unicità, FIFO, LIFO</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <h4>HashSet — elementi unici</h4>
          <pre>HashSet&lt;<span class="ty">string</span>&gt; hs = <span class="kw">new</span>() { <span class="str">"a"</span>, <span class="str">"b"</span>, <span class="str">"c"</span> };
hs.<span class="fn">Add</span>(<span class="str">"a"</span>);         <span class="cm">// ignorato, già presente</span>
hs.<span class="fn">Contains</span>(<span class="str">"b"</span>);   <span class="cm">// true — O(1)!</span>
hs.<span class="fn">Remove</span>(<span class="str">"c"</span>);
Console.<span class="fn">WriteLine</span>(hs.Count);  <span class="cm">// 2</span>

<span class="cm">// Operazioni insiemistiche:</span>
hs.<span class="fn">UnionWith</span>(altro);     <span class="cm">// unione</span>
hs.<span class="fn">IntersectWith</span>(altro); <span class="cm">// intersezione</span>
hs.<span class="fn">ExceptWith</span>(altro);    <span class="cm">// differenza</span></pre>
          <h4>Queue — FIFO (primo entrato, primo uscito)</h4>
          <pre>Queue&lt;<span class="ty">string</span>&gt; fila = <span class="kw">new</span>();
fila.<span class="fn">Enqueue</span>(<span class="str">"primo"</span>);
fila.<span class="fn">Enqueue</span>(<span class="str">"secondo"</span>);
<span class="ty">string</span> prossimo = fila.<span class="fn">Dequeue</span>();   <span class="cm">// "primo" (ed è rimosso)</span>
<span class="ty">string</span> spia     = fila.<span class="fn">Peek</span>();     <span class="cm">// "secondo" (non rimosso)</span></pre>
          <h4>Stack — LIFO (ultimo entrato, primo uscito)</h4>
          <pre>Stack&lt;<span class="ty">int</span>&gt; pila = <span class="kw">new</span>();
pila.<span class="fn">Push</span>(<span class="num">1</span>); pila.<span class="fn">Push</span>(<span class="num">2</span>); pila.<span class="fn">Push</span>(<span class="num">3</span>);
<span class="ty">int</span> cima = pila.<span class="fn">Pop</span>();   <span class="cm">// 3 (ed è rimosso)</span>
<span class="ty">int</span> spia  = pila.<span class="fn">Peek</span>(); <span class="cm">// 2 (non rimosso)</span></pre>
        </div>
      </div>
      <!-- 13. Regular Expressions -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>13. Regular Expressions (Regex)</h3><div class="topic-sub">IsMatch, Match, Replace, Groups</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="kw">using</span> System.Text.RegularExpressions;

<span class="cm">// IsMatch — controlla se corrisponde:</span>
<span class="ty">bool</span> eEmail = Regex.<span class="fn">IsMatch</span>(testo, <span class="str">@"^[\w.-]+@[\w.-]+\.\w+$"</span>);
<span class="ty">bool</span> eNumero = Regex.<span class="fn">IsMatch</span>(testo, <span class="str">@"^\d+$"</span>);

<span class="cm">// Match — trova prima corrispondenza:</span>
Match m = Regex.<span class="fn">Match</span>(<span class="str">"Ciao Marco 123"</span>, <span class="str">@"\d+"</span>);
<span class="kw">if</span> (m.Success) Console.<span class="fn">WriteLine</span>(m.Value);  <span class="cm">// "123"</span>

<span class="cm">// Matches — tutte le corrispondenze:</span>
MatchCollection mc = Regex.<span class="fn">Matches</span>(<span class="str">"uno1 due2 tre3"</span>, <span class="str">@"\d"</span>);
<span class="kw">foreach</span> (Match match <span class="kw">in</span> mc) Console.<span class="fn">Write</span>(match.Value + <span class="str">" "</span>); <span class="cm">// 1 2 3</span>

<span class="cm">// Replace:</span>
<span class="ty">string</span> pulito = Regex.<span class="fn">Replace</span>(<span class="str">"Hello   World"</span>, <span class="str">@"\s+"</span>, <span class="str">" "</span>);  <span class="cm">// "Hello World"</span>

<span class="cm">// Gruppi di cattura:</span>
Match data = Regex.<span class="fn">Match</span>(<span class="str">"25/12/2025"</span>, <span class="str">@"(\d{2})/(\d{2})/(\d{4})"</span>);
Console.<span class="fn">WriteLine</span>(data.Groups[<span class="num">1</span>].Value);  <span class="cm">// "25"</span>
Console.<span class="fn">WriteLine</span>(data.Groups[<span class="num">3</span>].Value);  <span class="cm">// "2025"</span></pre>
          <h4>Pattern comuni</h4>
          <table>
            <tr><th>Pattern</th><th>Significato</th></tr>
            <tr><td>\d</td><td>cifra (0-9)</td></tr>
            <tr><td>\w</td><td>parola (a-z, A-Z, 0-9, _)</td></tr>
            <tr><td>\s</td><td>spazio bianco</td></tr>
            <tr><td>.</td><td>qualsiasi carattere</td></tr>
            <tr><td>*</td><td>0 o più volte</td></tr>
            <tr><td>+</td><td>1 o più volte</td></tr>
            <tr><td>^</td><td>inizio stringa</td></tr>
            <tr><td>$</td><td>fine stringa</td></tr>
          </table>
        </div>
      </div>
      <!-- 14. Preprocessore & Attributi -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>14. Preprocessore &amp; Attributi</h3><div class="topic-sub">#region, #if DEBUG, [Obsolete], [Serializable], [Conditional]</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <h4>Direttive del preprocessore</h4>
          <pre><span class="cm">// #region — organizza il codice in blocchi espandibili:</span>
<span class="kw">#region</span> Metodi di utilità
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">MioMetodo</span>() { }
<span class="kw">#endregion</span>

<span class="cm">// #if — codice condizionale (solo in certi build):</span>
<span class="kw">#if</span> DEBUG
Console.<span class="fn">WriteLine</span>(<span class="str">"Modalità debug attiva"</span>);
<span class="kw">#else</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"Produzione"</span>);
<span class="kw">#endif</span>

<span class="cm">// #pragma — disabilita warning specifici:</span>
<span class="kw">#pragma</span> warning disable CS0168
<span class="ty">int</span> variabileNonUsata;
<span class="kw">#pragma</span> warning restore CS0168</pre>
          <h4>Attributi comuni</h4>
          <pre><span class="cm">// [Obsolete] — marca come deprecato:</span>
[Obsolete(<span class="str">"Usa NuovoMetodo() invece"</span>)]
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">VecchioMetodo</span>() { }

<span class="cm">// [Serializable] — per serializzazione:</span>
[Serializable]
<span class="kw">class</span> <span class="ty">MiaClasse</span> { }

<span class="cm">// [Conditional] — metodo chiamato solo in certi build:</span>
[System.Diagnostics.Conditional(<span class="str">"DEBUG"</span>)]
<span class="kw">static</span> <span class="ty">void</span> <span class="fn">Log</span>(<span class="ty">string</span> msg) => Console.<span class="fn">WriteLine</span>(<span class="str">$"[LOG] {msg}"</span>);

<span class="cm">// [JsonPropertyName] — per JSON:</span>
[System.Text.Json.Serialization.JsonPropertyName(<span class="str">"nome_prodotto"</span>)]
<span class="kw">public</span> <span class="ty">string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }</pre>
        </div>
      </div>
      <!-- 15. IDisposable & using -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>15. IDisposable &amp; using</h3><div class="topic-sub">Gestione risorse non gestite, pattern Dispose, using sintattico</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <div class="info">Implementa <b>IDisposable</b> per rilasciare risorse non gestite (file, connessioni DB, socket). Il blocco <code>using</code> chiama <code>Dispose()</code> automaticamente anche in caso di eccezione.</div>
          <pre><span class="cm">// Implementare IDisposable:</span>
<span class="kw">class</span> <span class="ty">RisorsaPersonalizzata</span> : IDisposable {
  <span class="kw">private bool</span> _disposed = <span class="kw">false</span>;
  <span class="kw">private</span> IntPtr _handle; <span class="cm">// risorsa non gestita</span>

  <span class="kw">public void</span> <span class="fn">Dispose</span>() {
    <span class="fn">Dispose</span>(<span class="kw">true</span>);
    GC.<span class="fn">SuppressFinalize</span>(<span class="kw">this</span>);
  }
  <span class="kw">protected virtual void</span> <span class="fn">Dispose</span>(<span class="kw">bool</span> disposing) {
    <span class="kw">if</span> (!_disposed) {
      <span class="kw">if</span> (disposing) { <span class="cm">/* libera risorse gestite */</span> }
      <span class="cm">// libera risorse non gestite qui</span>
      _disposed = <span class="kw">true</span>;
    }
  }
  ~<span class="ty">RisorsaPersonalizzata</span>() { <span class="fn">Dispose</span>(<span class="kw">false</span>); }
}

<span class="cm">// using — Dispose() chiamato automaticamente:</span>
<span class="kw">using</span> (<span class="kw">var</span> r = <span class="kw">new</span> <span class="ty">RisorsaPersonalizzata</span>()) {
  <span class="cm">// usa r</span>
} <span class="cm">// r.Dispose() chiamato qui, anche se c'è eccezione</span>

<span class="cm">// Sintassi moderna (C# 8+):</span>
<span class="kw">using var</span> r = <span class="kw">new</span> <span class="ty">RisorsaPersonalizzata</span>();
<span class="cm">// Dispose() chiamato alla fine dello scope</span>

<span class="cm">// Più risorse:</span>
<span class="kw">using var</span> sr = <span class="kw">new</span> <span class="ty">StreamReader</span>(<span class="str">"file.txt"</span>);
<span class="kw">using var</span> sw = <span class="kw">new</span> <span class="ty">StreamWriter</span>(<span class="str">"out.txt"</span>);</pre>
          <div class="warn">Regola: se una classe gestisce FileStream, SqlConnection, HttpClient o qualsiasi risorsa non gestita, implementa sempre IDisposable!</div>
        </div>
      </div>
      <!-- 16. IEnumerable & yield -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>16. IEnumerable&lt;T&gt; &amp; yield</h3><div class="topic-sub">Iteratori personalizzati, lazy evaluation, yield return, yield break</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <div class="info"><code>IEnumerable&lt;T&gt;</code> è l'interfaccia alla base di foreach e LINQ. <code>yield return</code> permette di creare sequenze pigre senza costruire un'intera lista in memoria.</div>
          <pre><span class="cm">// IEnumerable&lt;T&gt; — base di foreach e LINQ:</span>
<span class="kw">IEnumerable</span>&lt;<span class="ty">int</span>&gt; numeri = <span class="kw">new</span> <span class="ty">List</span>&lt;<span class="ty">int</span>&gt; { <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span> };
<span class="kw">foreach</span> (<span class="kw">int</span> n <span class="kw">in</span> numeri) Console.<span class="fn">WriteLine</span>(n);

<span class="cm">// Iteratore con yield return (lazy — genera 1 per volta):</span>
<span class="kw">static</span> <span class="ty">IEnumerable</span>&lt;<span class="ty">int</span>&gt; <span class="fn">Pari</span>(<span class="kw">int</span> max) {
  <span class="kw">for</span> (<span class="kw">int</span> i = <span class="num">0</span>; i &lt;= max; i += <span class="num">2</span>)
    <span class="kw">yield return</span> i; <span class="cm">// produce un valore e si ferma</span>
}
<span class="kw">foreach</span> (<span class="kw">int</span> p <span class="kw">in</span> <span class="fn">Pari</span>(<span class="num">10</span>)) Console.<span class="fn">Write</span>(p + <span class="str">" "</span>); <span class="cm">// 0 2 4 6 8 10</span>

<span class="cm">// yield break — ferma l'iteratore:</span>
<span class="kw">static</span> <span class="ty">IEnumerable</span>&lt;<span class="ty">int</span>&gt; <span class="fn">Finoa</span>(<span class="kw">int</span>[] arr, <span class="kw">int</span> stop) {
  <span class="kw">foreach</span> (<span class="kw">var</span> n <span class="kw">in</span> arr) {
    <span class="kw">if</span> (n == stop) <span class="kw">yield break</span>;
    <span class="kw">yield return</span> n;
  }
}

<span class="cm">// Classe iterabile personalizzata:</span>
<span class="kw">class</span> <span class="ty">Intervallo</span> : IEnumerable&lt;<span class="ty">int</span>&gt; {
  <span class="kw">int</span> _da, _a;
  <span class="kw">public</span> <span class="ty">Intervallo</span>(<span class="kw">int</span> da, <span class="kw">int</span> a) { _da = da; _a = a; }
  <span class="kw">public</span> <span class="ty">IEnumerator</span>&lt;<span class="ty">int</span>&gt; <span class="fn">GetEnumerator</span>() {
    <span class="kw">for</span> (<span class="kw">int</span> i = _da; i &lt;= _a; i++) <span class="kw">yield return</span> i;
  }
  System.Collections.<span class="ty">IEnumerator</span> System.Collections.IEnumerable.<span class="fn">GetEnumerator</span>() =&gt; <span class="fn">GetEnumerator</span>();
}
<span class="kw">foreach</span> (<span class="kw">var</span> n <span class="kw">in</span> <span class="kw">new</span> <span class="ty">Intervallo</span>(<span class="num">1</span>, <span class="num">5</span>)) Console.<span class="fn">Write</span>(n + <span class="str">" "</span>); <span class="cm">// 1 2 3 4 5</span></pre>
        </div>
      </div>
      <!-- 17. Extension Methods -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>17. Extension Methods</h3><div class="topic-sub">Metodi estensione, this keyword, static class</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <div class="info">I metodi estensione permettono di aggiungere metodi a qualsiasi tipo — anche sealed o di libreria — senza ereditarietà. Devono stare in una classe <code>static</code> e il primo parametro usa <code>this</code>.</div>
          <pre><span class="cm">// Classe statica con metodi estensione:</span>
<span class="kw">static class</span> <span class="ty">StringExtensions</span> {
  <span class="cm">// 'this string s' = si applica a string</span>
  <span class="kw">public static string</span> <span class="fn">Capitalizza</span>(<span class="kw">this string</span> s) {
    <span class="kw">if</span> (<span class="ty">string</span>.<span class="fn">IsNullOrEmpty</span>(s)) <span class="kw">return</span> s;
    <span class="kw">return</span> <span class="ty">char</span>.<span class="fn">ToUpper</span>(s[<span class="num">0</span>]) + s[<span class="num">1</span>..].ToLower();
  }
  <span class="kw">public static bool</span> <span class="fn">EEmail</span>(<span class="kw">this string</span> s) =&gt;
    s.<span class="fn">Contains</span>(<span class="str">"@"</span>) &amp;&amp; s.<span class="fn">Contains</span>(<span class="str">"."</span>);
  <span class="kw">public static</span> <span class="ty">string</span> <span class="fn">Ripeti</span>(<span class="kw">this string</span> s, <span class="kw">int</span> n) =&gt;
    <span class="ty">string</span>.<span class="fn">Concat</span>(Enumerable.<span class="fn">Repeat</span>(s, n));
}

<span class="cm">// Uso — come se fossero metodi nativi:</span>
<span class="kw">string</span> nome = <span class="str">"mario"</span>;
Console.<span class="fn">WriteLine</span>(nome.<span class="fn">Capitalizza</span>());  <span class="cm">// "Mario"</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f286978186b2979f939b9edc919d9f">[email&#160;protected]</a>"</span>.<span class="fn">EEmail</span>()); <span class="cm">// true</span>
Console.<span class="fn">WriteLine</span>(<span class="str">"ab"</span>.<span class="fn">Ripeti</span>(<span class="num">3</span>));          <span class="cm">// "ababab"</span>

<span class="cm">// Estensione su List&lt;T&gt;:</span>
<span class="kw">static class</span> <span class="ty">ListExtensions</span> {
  <span class="kw">public static void</span> <span class="fn">StampaTutti</span>&lt;T&gt;(<span class="kw">this</span> <span class="ty">List</span>&lt;T&gt; lista) {
    lista.<span class="fn">ForEach</span>(item =&gt; Console.<span class="fn">WriteLine</span>(item));
  }
  <span class="kw">public static</span> T <span class="fn">CasualeItem</span>&lt;T&gt;(<span class="kw">this</span> <span class="ty">List</span>&lt;T&gt; lista) =&gt;
    lista[<span class="kw">new</span> <span class="ty">Random</span>().<span class="fn">Next</span>(lista.<span class="fn">Count</span>)];
}
<span class="kw">var</span> nomi = <span class="kw">new</span> <span class="ty">List</span>&lt;<span class="ty">string</span>&gt; { <span class="str">"Marco"</span>, <span class="str">"Giulia"</span>, <span class="str">"Luca"</span> };
nomi.<span class="fn">StampaTutti</span>();
Console.<span class="fn">WriteLine</span>(nomi.<span class="fn">CasualeItem</span>());

<span class="cm">// LINQ è interamente costruito su extension methods!</span></pre>
        </div>
      </div>
      <!-- 18. Thread, Task & Parallel -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>18. Thread, Task &amp; Parallelismo</h3><div class="topic-sub">Task.Run, lock, CancellationToken, Parallel, Interlocked</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <div class="info">Per operazioni CPU-intensive usa <code>Task.Run</code>. Per evitare race conditions su dati condivisi usa <code>lock</code>. <code>CancellationToken</code> permette di annullare operazioni in modo cooperativo.</div>
          <pre><span class="cm">// Task.Run — esegui su thread pool:</span>
<span class="ty">Task</span> t = <span class="ty">Task</span>.<span class="fn">Run</span>(() =&gt; Console.<span class="fn">WriteLine</span>(<span class="str">"Su altro thread!"</span>));
t.<span class="fn">Wait</span>(); <span class="cm">// aspetta il completamento</span>

<span class="kw">int</span> risultato = <span class="kw">await</span> <span class="ty">Task</span>.<span class="fn">Run</span>(() =&gt; {
  <span class="kw">int</span> s = <span class="num">0</span>;
  <span class="kw">for</span> (<span class="kw">int</span> i = <span class="num">0</span>; i &lt; <span class="num">1000000</span>; i++) s += i;
  <span class="kw">return</span> s;
});

<span class="cm">// lock — evita race conditions:</span>
<span class="kw">private readonly object</span> _lock = <span class="kw">new</span> <span class="kw">object</span>();
<span class="kw">private int</span> _contatore = <span class="num">0</span>;
<span class="kw">void</span> <span class="fn">Incrementa</span>() {
  <span class="kw">lock</span> (_lock) { _contatore++; } <span class="cm">// solo 1 thread alla volta</span>
}

<span class="cm">// CancellationToken — annullamento cooperativo:</span>
<span class="kw">var</span> cts = <span class="kw">new</span> <span class="ty">CancellationTokenSource</span>();
cts.<span class="fn">CancelAfter</span>(<span class="num">3000</span>); <span class="cm">// annulla dopo 3 secondi</span>
<span class="kw">try</span> {
  <span class="kw">await</span> <span class="ty">Task</span>.<span class="fn">Run</span>(<span class="kw">async</span> () =&gt; {
    <span class="kw">while</span> (<span class="kw">true</span>) {
      cts.Token.<span class="fn">ThrowIfCancellationRequested</span>();
      <span class="kw">await</span> <span class="ty">Task</span>.<span class="fn">Delay</span>(<span class="num">500</span>, cts.Token);
      Console.<span class="fn">WriteLine</span>(<span class="str">"Lavoro..."</span>);
    }
  }, cts.Token);
}
<span class="kw">catch</span> (<span class="ty">OperationCanceledException</span>) { Console.<span class="fn">WriteLine</span>(<span class="str">"Annullato!"</span>); }

<span class="cm">// Parallel.For — CPU-bound parallelismo:</span>
<span class="ty">Parallel</span>.<span class="fn">For</span>(<span class="num">0</span>, <span class="num">10</span>, i =&gt; Console.<span class="fn">WriteLine</span>($<span class="str">"Item {i}"</span>));
<span class="ty">Parallel</span>.<span class="fn">ForEach</span>(nomi, nome =&gt; Console.<span class="fn">WriteLine</span>(nome));

<span class="cm">// Thread diretto (raramente necessario):</span>
<span class="kw">var</span> thread = <span class="kw">new</span> <span class="ty">Thread</span>(() =&gt; Console.<span class="fn">WriteLine</span>(<span class="str">"Thread!"</span>));
thread.IsBackground = <span class="kw">true</span>;
thread.<span class="fn">Start</span>();
thread.<span class="fn">Join</span>(); <span class="cm">// aspetta</span></pre>
          <div class="warn">Preferisci sempre async/await e Task.Run al threading diretto. Usa lock solo quando necessario — preferisci ConcurrentDictionary e Interlocked per dati condivisi semplici.</div>
        </div>
      </div>
      <!-- 19. Collezioni Avanzate -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>19. Collezioni Avanzate</h3><div class="topic-sub">SortedDictionary, ConcurrentDictionary, LinkedList, SortedSet</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// SortedDictionary — chiavi sempre ordinate:</span>
<span class="kw">var</span> sd = <span class="kw">new</span> <span class="ty">SortedDictionary</span>&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt;();
sd[<span class="str">"banana"</span>] = <span class="num">2</span>; sd[<span class="str">"arancia"</span>] = <span class="num">5</span>; sd[<span class="str">"ciliegia"</span>] = <span class="num">1</span>;
<span class="kw">foreach</span> (<span class="kw">var</span> kv <span class="kw">in</span> sd) Console.<span class="fn">WriteLine</span>(kv.Key); <span class="cm">// arancia, banana, ciliegia</span>

<span class="cm">// SortedSet — elementi unici e ordinati:</span>
<span class="kw">var</span> ss = <span class="kw">new</span> <span class="ty">SortedSet</span>&lt;<span class="ty">int</span>&gt; { <span class="num">5</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">2</span> };
<span class="cm">// ss = { 1, 2, 3, 5 } — no duplicati, sempre ordinato</span>
ss.<span class="fn">Min</span>; ss.<span class="fn">Max</span>; <span class="cm">// 1, 5</span>

<span class="cm">// ConcurrentDictionary — thread-safe:</span>
<span class="kw">var</span> cd = <span class="kw">new</span> <span class="ty">ConcurrentDictionary</span>&lt;<span class="ty">string</span>, <span class="ty">int</span>&gt;();
cd.<span class="fn">TryAdd</span>(<span class="str">"Marco"</span>, <span class="num">25</span>);
cd.<span class="fn">AddOrUpdate</span>(<span class="str">"Marco"</span>, <span class="num">1</span>, (key, old) =&gt; old + <span class="num">1</span>); <span class="cm">// incrementa</span>
cd.<span class="fn">GetOrAdd</span>(<span class="str">"Giulia"</span>, <span class="num">30</span>); <span class="cm">// aggiunge solo se manca</span>
cd.<span class="fn">TryRemove</span>(<span class="str">"Marco"</span>, <span class="kw">out int</span> val);

<span class="cm">// LinkedList — inserimento O(1) ovunque:</span>
<span class="kw">var</span> ll = <span class="kw">new</span> <span class="ty">LinkedList</span>&lt;<span class="ty">string</span>&gt;();
ll.<span class="fn">AddLast</span>(<span class="str">"B"</span>); ll.<span class="fn">AddFirst</span>(<span class="str">"A"</span>); ll.<span class="fn">AddLast</span>(<span class="str">"C"</span>);
<span class="ty">LinkedListNode</span>&lt;<span class="ty">string</span>&gt; nodo = ll.<span class="fn">Find</span>(<span class="str">"B"</span>);
ll.<span class="fn">AddAfter</span>(nodo, <span class="str">"B2"</span>);
ll.<span class="fn">Remove</span>(nodo);

<span class="cm">// Interlocked — operazioni atomiche senza lock:</span>
<span class="kw">private int</span> _count = <span class="num">0</span>;
<span class="ty">Interlocked</span>.<span class="fn">Increment</span>(<span class="kw">ref</span> _count);  <span class="cm">// thread-safe ++</span>
<span class="ty">Interlocked</span>.<span class="fn">Decrement</span>(<span class="kw">ref</span> _count);  <span class="cm">// thread-safe --</span>
<span class="ty">Interlocked</span>.<span class="fn">Add</span>(<span class="kw">ref</span> _count, <span class="num">5</span>);      <span class="cm">// thread-safe += 5</span></pre>
          <div class="table-wrap"><table><tr><th>Collezione</th><th>Ordinata</th><th>Thread-safe</th><th>Uso principale</th></tr>
          <tr><td>Dictionary</td><td>No</td><td>No</td><td>Ricerca veloce</td></tr>
          <tr><td>SortedDictionary</td><td>Sì (chiave)</td><td>No</td><td>Dati ordinati</td></tr>
          <tr><td>ConcurrentDictionary</td><td>No</td><td>Sì</td><td>Multi-threading</td></tr>
          <tr><td>LinkedList</td><td>No</td><td>No</td><td>Inserimenti frequenti</td></tr>
          <tr><td>SortedSet</td><td>Sì</td><td>No</td><td>Elementi unici ordinati</td></tr></table></div>
        </div>
      </div>
      <!-- 20. Interfacce Fondamentali -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>20. Interfacce Fondamentali</h3><div class="topic-sub">IComparable&lt;T&gt;, IEquatable&lt;T&gt;, IComparer&lt;T&gt;, ICloneable</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// IComparable&lt;T&gt; — permette ordinamento naturale:</span>
<span class="kw">class</span> <span class="ty">Studente</span> : IComparable&lt;<span class="ty">Studente</span>&gt; {
  <span class="kw">public string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
  <span class="kw">public int</span> Voto { <span class="kw">get</span>; <span class="kw">set</span>; }
  <span class="kw">public int</span> <span class="fn">CompareTo</span>(<span class="ty">Studente</span>? other) {
    <span class="kw">if</span> (other == <span class="kw">null</span>) <span class="kw">return</span> <span class="num">1</span>;
    <span class="kw">return</span> Voto.<span class="fn">CompareTo</span>(other.Voto); <span class="cm">// ordine per voto</span>
  }
}
<span class="kw">var</span> studenti = <span class="kw">new</span> <span class="ty">List</span>&lt;<span class="ty">Studente</span>&gt; { ... };
studenti.<span class="fn">Sort</span>(); <span class="cm">// usa CompareTo automaticamente</span>

<span class="cm">// IEquatable&lt;T&gt; — uguaglianza personalizzata:</span>
<span class="kw">class</span> <span class="ty">Punto</span> : IEquatable&lt;<span class="ty">Punto</span>&gt; {
  <span class="kw">public int</span> X, Y;
  <span class="kw">public bool</span> <span class="fn">Equals</span>(<span class="ty">Punto</span>? other) =&gt;
    other != <span class="kw">null</span> &amp;&amp; X == other.X &amp;&amp; Y == other.Y;
  <span class="kw">public override bool</span> <span class="fn">Equals</span>(<span class="kw">object</span>? obj) =&gt;
    obj <span class="kw">is</span> <span class="ty">Punto</span> p &amp;&amp; <span class="fn">Equals</span>(p);
  <span class="kw">public override int</span> <span class="fn">GetHashCode</span>() =&gt; HashCode.<span class="fn">Combine</span>(X, Y);
}
<span class="kw">var</span> p1 = <span class="kw">new</span> <span class="ty">Punto</span> { X=<span class="num">1</span>, Y=<span class="num">2</span> };
<span class="kw">var</span> p2 = <span class="kw">new</span> <span class="ty">Punto</span> { X=<span class="num">1</span>, Y=<span class="num">2</span> };
Console.<span class="fn">WriteLine</span>(p1.<span class="fn">Equals</span>(p2)); <span class="cm">// true!</span>

<span class="cm">// IComparer&lt;T&gt; — ordinamento alternativo:</span>
<span class="kw">class</span> <span class="ty">OrdinaNome</span> : IComparer&lt;<span class="ty">Studente</span>&gt; {
  <span class="kw">public int</span> <span class="fn">Compare</span>(<span class="ty">Studente</span>? a, <span class="ty">Studente</span>? b) =&gt;
    <span class="ty">string</span>.<span class="fn">Compare</span>(a?.Nome, b?.Nome, <span class="ty">StringComparison</span>.OrdinalIgnoreCase);
}
studenti.<span class="fn">Sort</span>(<span class="kw">new</span> <span class="ty">OrdinaNome</span>()); <span class="cm">// ordina per nome</span>

<span class="cm">// Confronto con lambda (più pratico):</span>
studenti.<span class="fn">Sort</span>((a, b) =&gt; a.Nome.<span class="fn">CompareTo</span>(b.Nome));
<span class="kw">var</span> ordinati = studenti.<span class="fn">OrderBy</span>(s =&gt; s.Voto).<span class="fn">ThenBy</span>(s =&gt; s.Nome);</pre>
        </div>
      </div>
      <!-- 21. Operator Overloading -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>21. Operator Overloading</h3><div class="topic-sub">Sovraccaricare +, -, ==, !=, >, &lt;, conversioni implicite/esplicite</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <div class="info">In C# puoi ridefinire il comportamento degli operatori per le tue classi/struct. Gli operatori di uguaglianza (==, !=) vanno sempre in coppia, così come (&lt;, &gt;) e (&lt;=, &gt;=).</div>
          <pre><span class="kw">struct</span> <span class="ty">Vettore2D</span> {
  <span class="kw">public double</span> X, Y;
  <span class="kw">public</span> <span class="ty">Vettore2D</span>(<span class="kw">double</span> x, <span class="kw">double</span> y) { X = x; Y = y; }

  <span class="cm">// Operatori aritmetici:</span>
  <span class="kw">public static</span> <span class="ty">Vettore2D</span> <span class="kw">operator</span> +(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt;
    <span class="kw">new</span>(a.X + b.X, a.Y + b.Y);
  <span class="kw">public static</span> <span class="ty">Vettore2D</span> <span class="kw">operator</span> -(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt;
    <span class="kw">new</span>(a.X - b.X, a.Y - b.Y);
  <span class="kw">public static</span> <span class="ty">Vettore2D</span> <span class="kw">operator</span> *(<span class="ty">Vettore2D</span> v, <span class="kw">double</span> s) =&gt;
    <span class="kw">new</span>(v.X * s, v.Y * s);

  <span class="cm">// Uguaglianza (sempre in coppia!):</span>
  <span class="kw">public static bool</span> <span class="kw">operator</span> ==(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt;
    a.X == b.X &amp;&amp; a.Y == b.Y;
  <span class="kw">public static bool</span> <span class="kw">operator</span> !=(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt; !(a == b);

  <span class="cm">// Confronto (sempre in coppia!):</span>
  <span class="kw">public static bool</span> <span class="kw">operator</span> &gt;(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt;
    a.<span class="fn">Lunghezza</span>() &gt; b.<span class="fn">Lunghezza</span>();
  <span class="kw">public static bool</span> <span class="kw">operator</span> &lt;(<span class="ty">Vettore2D</span> a, <span class="ty">Vettore2D</span> b) =&gt; b &gt; a;

  <span class="kw">public double</span> <span class="fn">Lunghezza</span>() =&gt; Math.<span class="fn">Sqrt</span>(X*X + Y*Y);
  <span class="kw">public override string</span> <span class="fn">ToString</span>() =&gt; $<span class="str">"({X}, {Y})"</span>;

  <span class="cm">// Conversioni implicite/esplicite:</span>
  <span class="kw">public static implicit operator</span> <span class="ty">Vettore2D</span>((<span class="kw">double</span>,<span class="kw">double</span>) t) =&gt;
    <span class="kw">new</span>(t.Item1, t.Item2);
  <span class="kw">public static explicit operator</span> <span class="ty">string</span>(<span class="ty">Vettore2D</span> v) =&gt; v.<span class="fn">ToString</span>();
}

<span class="ty">Vettore2D</span> v1 = <span class="kw">new</span>(<span class="num">3</span>, <span class="num">4</span>);
<span class="ty">Vettore2D</span> v2 = <span class="kw">new</span>(<span class="num">1</span>, <span class="num">2</span>);
<span class="ty">Vettore2D</span> v3 = v1 + v2;          <span class="cm">// (4, 6)</span>
<span class="kw">bool</span> uguale = v1 == v2;           <span class="cm">// false</span>
<span class="ty">Vettore2D</span> v4 = (<span class="num">5.0</span>, <span class="num">6.0</span>);      <span class="cm">// conversione implicita da tuple</span>
Console.<span class="fn">WriteLine</span>(v3);            <span class="cm">// (4, 6)</span></pre>
        </div>
      </div>
      <!-- 22. Indexers & Proprietà Avanzate -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>22. Indexers &amp; Proprietà Avanzate</h3><div class="topic-sub">Indicizzatori, init-only, required, backing field</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Indexer — accesso con [] sulla tua classe:</span>
<span class="kw">class</span> <span class="ty">Rubrica</span> {
  <span class="kw">private</span> <span class="ty">Dictionary</span>&lt;<span class="ty">string</span>, <span class="ty">string</span>&gt; _dati = <span class="kw">new</span>();

  <span class="cm">// Indexer con chiave string:</span>
  <span class="kw">public string this</span>[<span class="ty">string</span> nome] {
    <span class="kw">get</span> =&gt; _dati.<span class="fn">GetValueOrDefault</span>(nome, <span class="str">"N/A"</span>);
    <span class="kw">set</span> =&gt; _dati[nome] = value;
  }
  <span class="cm">// Indexer con indice int:</span>
  <span class="kw">public string this</span>[<span class="kw">int</span> i] =&gt; _dati.<span class="fn">ElementAt</span>(i).Value;
}
<span class="ty">Rubrica</span> r = <span class="kw">new</span>();
r[<span class="str">"Marco"</span>] = <span class="str">"123-456"</span>; <span class="cm">// set</span>
Console.<span class="fn">WriteLine</span>(r[<span class="str">"Marco"</span>]); <span class="cm">// get → "123-456"</span>

<span class="cm">// init-only property (C# 9+) — si imposta solo in inizializzazione:</span>
<span class="kw">class</span> <span class="ty">Persona</span> {
  <span class="kw">public string</span> Nome { <span class="kw">get</span>; <span class="kw">init</span>; } <span class="cm">// solo con new + {}</span>
  <span class="kw">public int</span> Eta { <span class="kw">get</span>; <span class="kw">init</span>; }
}
<span class="ty">Persona</span> p = <span class="kw">new</span>() { Nome = <span class="str">"Marco"</span>, Eta = <span class="num">25</span> };
<span class="cm">// p.Nome = "Giulia"; // ERRORE — non modificabile dopo init</span>

<span class="cm">// required property (C# 11+) — obbligatoria in inizializzazione:</span>
<span class="kw">class</span> <span class="ty">Prodotto</span> {
  <span class="kw">public required string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; }
  <span class="kw">public required double</span> Prezzo { <span class="kw">get</span>; <span class="kw">set</span>; }
}
<span class="cm">// new Prodotto() — ERRORE: Nome e Prezzo sono required</span>
<span class="ty">Prodotto</span> prod = <span class="kw">new</span>() { Nome = <span class="str">"Pizza"</span>, Prezzo = <span class="num">8.50</span> }; <span class="cm">// OK</span>

<span class="cm">// Proprietà calcolate e backing field avanzate:</span>
<span class="kw">class</span> <span class="ty">Cerchio</span> {
  <span class="kw">private double</span> _raggio;
  <span class="kw">public double</span> Raggio {
    <span class="kw">get</span> =&gt; _raggio;
    <span class="kw">set</span> =&gt; _raggio = value &lt; <span class="num">0</span> ? <span class="kw">throw new</span> <span class="ty">ArgumentException</span>(<span class="str">"Negativo!"</span>) : value;
  }
  <span class="kw">public double</span> Area =&gt; Math.PI * _raggio * _raggio;           <span class="cm">// calcolata</span>
  <span class="kw">public double</span> Circonferenza =&gt; <span class="num">2</span> * Math.PI * _raggio;       <span class="cm">// calcolata</span>
  <span class="kw">public double</span> Diametro { <span class="kw">get</span> =&gt; _raggio * <span class="num">2</span>; <span class="kw">set</span> =&gt; _raggio = value / <span class="num">2</span>; }
}</pre>
        </div>
      </div>
      <!-- 23. Namespaces & using -->
      <div class="topic-card">
        <div class="topic-header" onclick="toggle(this.closest('.topic-card'))"><div><h3>23. Namespaces &amp; using Direttive</h3><div class="topic-sub">namespace, using, global using, alias, file-scoped</div></div><span class="arrow">▼</span></div>
        <div class="topic-body">
          <pre><span class="cm">// Definire un namespace:</span>
<span class="kw">namespace</span> MiaApp.Modelli {
  <span class="kw">class</span> <span class="ty">Utente</span> { <span class="kw">public string</span> Nome { <span class="kw">get</span>; <span class="kw">set</span>; } }
}
<span class="kw">namespace</span> MiaApp.Servizi {
  <span class="kw">class</span> <span class="ty">UtenteService</span> {
    <span class="cm">// Accesso con nome completo:</span>
    MiaApp.Modelli.<span class="ty">Utente</span> u = <span class="kw">new</span>();
  }
}

<span class="cm">// using — importa namespace:</span>
<span class="kw">using</span> System.Collections.Generic;
<span class="kw">using</span> System.Linq;
<span class="kw">using</span> MiaApp.Modelli;

<span class="cm">// Alias — rinomina per conflitti:</span>
<span class="kw">using</span> Win = System.Windows;
<span class="kw">using</span> Web = System.Web;
Win.<span class="ty">Point</span> p1 = <span class="kw">new</span>();
Web.<span class="ty">HttpContext</span> ctx = ...;

<span class="cm">// using static — importa membri statici direttamente:</span>
<span class="kw">using static</span> System.Math;
<span class="kw">using static</span> System.Console;
<span class="fn">WriteLine</span>(<span class="fn">Sqrt</span>(<span class="num">16</span>)); <span class="cm">// senza Math. e Console.</span>

<span class="cm">// global using (C# 10+) — vale per tutto il progetto:</span>
<span class="cm">// In GlobalUsings.cs:</span>
<span class="kw">global using</span> System;
<span class="kw">global using</span> System.Collections.Generic;
<span class="kw">global using</span> System.Linq;
<span class="cm">// Ora disponibili in tutti i file senza dichiarare!</span>

<span class="cm">// File-scoped namespace (C# 10+) — meno indentazione:</span>
<span class="kw">namespace</span> MiaApp.Modelli; <span class="cm">// nessuna { }</span>
<span class="kw">class</span> <span class="ty">Prodotto</span> { } <span class="cm">// automaticamente in MiaApp.Modelli</span>
<span class="kw">class</span> <span class="ty">Ordine</span> { }   <span class="cm">// stesso namespace</span>

<span class="cm">// namespace annidati — equivalenti:</span>
<span class="kw">namespace</span> A { <span class="kw">namespace</span> B { <span class="kw">class</span> <span class="ty">C</span> {} } }
<span class="kw">namespace</span> A.B { <span class="kw">class</span> <span class="ty">C</span> {} } <span class="cm">// identico</span></pre>
          <div class="warn">Best practice: usa file-scoped namespace (C# 10+) e global using per ridurre il boilerplate. Ogni file dovrebbe avere un solo namespace e una sola classe principale.</div>
        </div>
      </div>
    </div>
  </main>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
const MODS = ['fundamentals','intermediate','advanced'];

let currentMod = 'fundamentals';
let currentCard = -1;

function showMod(modId, btn) {
  currentMod = modId;
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById('section-' + modId).classList.add('active');
  if (btn) {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  document.querySelectorAll('.tree-mod').forEach(m => {
    if (m.dataset.mod === modId) {
      m.classList.add('open');
    } else {
      m.classList.remove('open');
    }
  });
  markTreeItem(-1);
}

function showTopic(modId, idx) {
  if (modId !== currentMod) {
    const btn = document.querySelector(`.nav-btn[data-mod="${modId}"]`);
    showMod(modId, btn);
  }
  currentCard = idx;
  const cards = document.querySelectorAll(`#section-${modId} .topic-card`);
  cards.forEach((c, i) => {
    if (i === idx) c.classList.add('open');
    else c.classList.remove('open');
  });
  if (cards[idx]) {
    setTimeout(() => cards[idx].scrollIntoView({behavior:'smooth', block:'start'}), 60);
  }
  markTreeItem(idx);
  closeResults();
}

function markTreeItem(idx) {
  document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
  if (idx < 0) return;
  const grp = document.querySelector(`.tree-mod[data-mod="${currentMod}"]`);
  if (grp) {
    const children = grp.nextElementSibling?.querySelectorAll('.tree-item');
    if (children && children[idx]) children[idx].classList.add('active');
  }
}

function treeToggle(el) {
  const modId = el.dataset.mod;
  const isOpen = el.classList.contains('open');
  if (!isOpen) {
    const btn = document.querySelector(`.nav-btn[data-mod="${modId}"]`);
    showMod(modId, btn);
  } else {
    el.classList.remove('open');
  }
}

function toggle(card) { card.classList.toggle('open'); }

(function() {
  const firstMod = document.querySelector('.tree-mod[data-mod="fundamentals"]');
  if (firstMod) firstMod.classList.add('open');
  document.getElementById('section-fundamentals').classList.add('active');
})();

// Search (aggiornato con i nuovi moduli)
const MODULE_LABELS = {
  fundamentals:'I — Fondamenti',
  intermediate:'II — Intermedio',
  advanced:'III — Avanzato'
};
let _index = null;
function getIndex() {
  if (_index) return _index;
  _index = [];
  MODS.forEach(modId => {
    document.querySelectorAll('#section-' + modId + ' .topic-card').forEach((card, idx) => {
      const title = card.querySelector('h3')?.textContent || '';
      const sub   = card.querySelector('.topic-sub')?.textContent || '';
      const body  = card.querySelector('.topic-body')?.textContent || '';
      _index.push({ modId, idx, title, sub,
        text: (title+' '+sub+' '+body).toLowerCase(),
        bodySnippet: body.trim().slice(0,200) });
    });
  });
  return _index;
}
function esc(s) { return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
function highlight(s, q) {
  return s.replace(new RegExp('('+esc(q)+')','gi'),'<span class="sr-highlight">$1</span>');
}
function onSearch() {
  const q = document.getElementById('searchInput').value.trim();
  const clearBtn = document.getElementById('searchClear');
  const hint = document.getElementById('searchHint');
  clearBtn.style.display = q ? 'block' : 'none';
  if (hint) hint.style.display = q ? 'none' : '';
  if (!q) { closeResults(); return; }
  openResults();
  const results = getIndex().filter(r => r.text.includes(q.toLowerCase())).slice(0,18);
  const box = document.getElementById('searchResults');
  if (!results.length) {
    box.innerHTML = '<div class="sr-empty">Nessun risultato per "<b>'+q+'</b>"</div>';
    return;
  }
  box.innerHTML = results.map(r => {
    const bl = r.bodySnippet.toLowerCase();
    const pos = bl.indexOf(q.toLowerCase());
    let snippet = pos !== -1
      ? (pos>20?'\u2026':'')+r.bodySnippet.slice(Math.max(0,pos-20), Math.min(r.bodySnippet.length,pos+q.length+50))+'\u2026'
      : r.bodySnippet.slice(0,80)+'\u2026';
    return '<div class="sr-item" onclick="showTopic(\'' + r.modId + '\',' + r.idx + ')">'
      + '<div class="sr-mod">' + MODULE_LABELS[r.modId] + '</div>'
      + '<div class="sr-title">' + highlight(r.title, q) + '</div>'
      + '<div class="sr-sub">' + highlight(snippet, q) + '</div>'
      + '</div>';
  }).join('');
}
function openResults() { if (document.getElementById('searchInput').value.trim()) document.getElementById('searchResults').classList.add('open'); }
function closeResults() { document.getElementById('searchResults').classList.remove('open'); }
function clearSearch() {
  document.getElementById('searchInput').value = '';
  document.getElementById('searchClear').style.display = 'none';
  const hint = document.getElementById('searchHint');
  if (hint) hint.style.display = '';
  closeResults();
}
document.addEventListener('click', e => {
  if (!document.getElementById('searchWrap').contains(e.target)) closeResults();
});
document.addEventListener('keydown', e => {
  const inp = document.getElementById('searchInput');
  if (e.key === '/' && document.activeElement !== inp) {
    e.preventDefault(); inp.focus();
  }
  if (e.key === 'Escape') { clearSearch(); inp.blur(); }
});
</script>
</body>
</html>